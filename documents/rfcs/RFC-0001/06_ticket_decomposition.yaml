rfc_ticket_decomposition:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  principles:
  - "Tickets are atomic and independently verifiable"
  - "Each ticket references requirement_ids and evidence_ids"
  - "Cross-ticket dependencies are explicit and minimal"
  - "Every PRD requirement is covered by at least one ticket"
  - "Tickets are ordered to enable incremental progress"
  ticket_plan:
    ticket_storage_root: "documents/work/tickets/"
    tickets:
    # =================================================================
    # PHASE 1: Core Kernel Infrastructure
    # =================================================================
    - ticket_id: TCK-00001
      title: "Implement ledger storage layer with SQLite WAL"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00001.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00001.md"
      scope:
        in_scope:
        - "Create SQLite database with events table"
        - "Implement append-only write semantics"
        - "Implement cursor-based read"
        - "Enable WAL mode for concurrent reads"
        - "Create artifact_refs table for CAS"
        out_of_scope:
        - "Hash chaining (TCK-00003)"
        - "Projection tables (TCK-00004)"
      binds:
        requirement_ids:
        - REQ-0008
        - REQ-0006
        evidence_ids:
        - EVID-0004
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies: []
      definition_of_done:
        criteria:
        - "SQLite database created with correct schema"
        - "Events can be appended in order"
        - "Events can be read by sequence number or cursor"
        - "WAL mode verified with concurrent read test"
        - "Unit tests for all CRUD operations"
        evidence_ids:
        - EVID-0004

    - ticket_id: TCK-00002
      title: "Define kernel event schemas with prost"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00002.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00002.md"
      scope:
        in_scope:
        - "Create proto/ directory with .proto files"
        - "Define KernelEvent envelope"
        - "Define all event types (Session, Work, Tool, Lease, Policy, Adjudication, Evidence)"
        - "Configure prost build.rs for code generation"
        - "Add canonical encoding tests"
        out_of_scope:
        - "Tool protocol messages (TCK-00013)"
      binds:
        requirement_ids:
        - REQ-0012
        evidence_ids:
        - EVID-0008
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies: []
      definition_of_done:
        criteria:
        - "Proto files compile without errors"
        - "Generated Rust types are usable"
        - "Canonical encoding produces deterministic bytes"
        - "No maps in signed message types"
        - "Roundtrip encode/decode tests pass"
        evidence_ids:
        - EVID-0008

    - ticket_id: TCK-00003
      title: "Implement hash-chain and signature primitives"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00003.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00003.md"
      scope:
        in_scope:
        - "Implement Blake3 hashing for events"
        - "Implement Ed25519 signing and verification"
        - "Create KeyManager for key storage"
        - "Implement hash-chain linking"
        - "Implement signature verification"
        out_of_scope:
        - "Key rotation (TCK-00004 dependency for projections)"
      binds:
        requirement_ids:
        - REQ-0006
        - REQ-1004
        evidence_ids:
        - EVID-0004
        - EVID-1004
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      - DOMAIN_SECURITY
      dependencies:
      - TCK-00002
      definition_of_done:
        criteria:
        - "Events are hashed with Blake3"
        - "Events are signed with Ed25519"
        - "Hash chain links to previous event"
        - "Signature verification detects tampering"
        - "Key storage with 0600 permissions"
        evidence_ids:
        - EVID-0004
        - EVID-1004

    - ticket_id: TCK-00004
      title: "Implement reducer framework with checkpointing"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00004.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00004.md"
      scope:
        in_scope:
        - "Define Reducer trait"
        - "Implement checkpoint storage"
        - "Implement incremental event processing"
        - "Create projection tables (active_leases, session_health)"
        - "Property tests for determinism"
        out_of_scope:
        - "Specific reducers (handled in later tickets)"
      binds:
        requirement_ids:
        - REQ-0007
        - REQ-0025
        evidence_ids:
        - EVID-0005
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00001
      - TCK-00002
      definition_of_done:
        criteria:
        - "Reducer trait defined with apply method"
        - "Checkpoints stored and loaded correctly"
        - "Incremental processing from checkpoint works"
        - "Property tests verify determinism"
        - "Replay from genesis produces same projection"
        evidence_ids:
        - EVID-0005

    # =================================================================
    # PHASE 2: Supervisor & Sessions
    # =================================================================
    - ticket_id: TCK-00005
      title: "Implement session lifecycle state machine"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00005.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00005.md"
      scope:
        in_scope:
        - "Define session states (Starting, Running, Terminating, Terminated)"
        - "Implement state transitions"
        - "Emit SessionStarted, SessionTerminated events"
        - "Track session metadata"
        out_of_scope:
        - "Entropy budget (TCK-00006)"
        - "Crash detection (TCK-00007)"
      binds:
        requirement_ids:
        - REQ-0013
        - REQ-0018
        evidence_ids:
        - EVID-0006
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00002
      - TCK-00003
      definition_of_done:
        criteria:
        - "Session state machine implemented"
        - "State transitions emit correct events"
        - "Actor identity persists across restarts"
        - "Session metadata tracked correctly"
        - "Unit tests for all state transitions"
        evidence_ids:
        - EVID-0006

    - ticket_id: TCK-00006
      title: "Implement entropy budget tracker"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00006.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00006.md"
      scope:
        in_scope:
        - "Define entropy budget configuration"
        - "Track entropy consumption (errors, stalls, violations)"
        - "Emit BudgetExceeded event"
        - "Integrate with session lifecycle"
        out_of_scope:
        - "Stall detection logic (TCK-00007)"
      binds:
        requirement_ids:
        - REQ-0035
        - REQ-0019
        evidence_ids:
        - EVID-0006
        - EVID-0018
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00005
      definition_of_done:
        criteria:
        - "Entropy budget configurable per session"
        - "Entropy increments on errors and violations"
        - "BudgetExceeded event emitted at threshold"
        - "Session terminated when budget exceeded"
        - "Budget visible in session_health projection"
        evidence_ids:
        - EVID-0006
        - EVID-0018

    - ticket_id: TCK-00007
      title: "Implement crash detection and restart logic"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00007.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00007.md"
      scope:
        in_scope:
        - "Detect session process exit"
        - "Classify exit (success, failure, signal)"
        - "Implement exponential backoff for restarts"
        - "Recovery from ledger state"
        out_of_scope:
        - "Quarantine logic (TCK-00008)"
      binds:
        requirement_ids:
        - REQ-0018
        - REQ-0027
        evidence_ids:
        - EVID-0006
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00005
      - TCK-00006
      definition_of_done:
        criteria:
        - "Process exit detected and classified"
        - "Exit classification emitted as event"
        - "Backoff applied between restarts"
        - "Session resumes from ledger cursor"
        - "Restart limit configurable"
        evidence_ids:
        - EVID-0006

    - ticket_id: TCK-00008
      title: "Implement quarantine mechanism"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00008.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00008.md"
      scope:
        in_scope:
        - "Define quarantine triggers (entropy exceeded, violations)"
        - "Emit SessionQuarantined event"
        - "Prevent session restart while quarantined"
        - "Implement quarantine duration and release"
        out_of_scope:
        - "Manual quarantine management CLI (TCK-00023)"
      binds:
        requirement_ids:
        - REQ-0018
        - REQ-0027
        evidence_ids:
        - EVID-0006
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00007
      definition_of_done:
        criteria:
        - "Quarantine triggered on threshold"
        - "SessionQuarantined event emitted"
        - "Quarantined sessions cannot restart"
        - "Quarantine expires after configured duration"
        - "Quarantine visible in projection"
        evidence_ids:
        - EVID-0006

    # =================================================================
    # PHASE 3: Policy Engine
    # =================================================================
    - ticket_id: TCK-00009
      title: "Implement policy DSL parser"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00009.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00009.md"
      scope:
        in_scope:
        - "Define policy YAML schema"
        - "Parse policy files with serde_yaml"
        - "Validate policy structure"
        - "Load policy at startup"
        - "Emit PolicyLoaded event"
        out_of_scope:
        - "Rule evaluation (TCK-00010)"
        - "Hot reload (future enhancement)"
      binds:
        requirement_ids:
        - REQ-0004
        - REQ-0005
        evidence_ids:
        - EVID-0003
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      - DOMAIN_SECURITY
      dependencies:
      - TCK-00002
      definition_of_done:
        criteria:
        - "Policy YAML schema documented"
        - "Parser handles all rule types"
        - "Invalid policies rejected with clear errors"
        - "PolicyLoaded event includes hash"
        - "Example policy files created"
        evidence_ids:
        - EVID-0003

    - ticket_id: TCK-00010
      title: "Implement default-deny evaluation engine"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00010.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00010.md"
      scope:
        in_scope:
        - "Evaluate tool requests against policy rules"
        - "Default-deny if no rule matches"
        - "Emit ToolDecided event with rule_id"
        - "Track which rule matched"
        out_of_scope:
        - "Budget enforcement (TCK-00011)"
      binds:
        requirement_ids:
        - REQ-0004
        - REQ-0005
        evidence_ids:
        - EVID-0003
        - EVID-0013
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      - DOMAIN_SECURITY
      dependencies:
      - TCK-00009
      definition_of_done:
        criteria:
        - "Default-deny for unmatched requests"
        - "Allow rules grant specific permissions"
        - "Deny rules override allow rules"
        - "ToolDecided event includes rule_id"
        - "Fuzz tests for policy evaluation"
        evidence_ids:
        - EVID-0003
        - EVID-0013

    - ticket_id: TCK-00011
      title: "Implement budget enforcement"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00011.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00011.md"
      scope:
        in_scope:
        - "Track token budgets per session"
        - "Track tool call budgets"
        - "Track time budgets"
        - "Deny requests exceeding budget"
        - "Emit BudgetExceeded event"
        out_of_scope:
        - "Budget reporting in projections (TCK-00004 handled this)"
      binds:
        requirement_ids:
        - REQ-0005
        - REQ-0019
        evidence_ids:
        - EVID-0018
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00010
      definition_of_done:
        criteria:
        - "Token budget tracked per session"
        - "Tool call budget tracked"
        - "Time budget tracked"
        - "Requests denied when budget exceeded"
        - "BudgetExceeded event emitted"
        evidence_ids:
        - EVID-0018

    - ticket_id: TCK-00012
      title: "Implement audit event emission"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00012.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00012.md"
      scope:
        in_scope:
        - "Emit PolicyViolation events"
        - "Include rationale codes in all decisions"
        - "Structured logging with tracing"
        - "Audit event retention configuration"
        out_of_scope:
        - "External audit log shipping"
      binds:
        requirement_ids:
        - REQ-0017
        - REQ-0027
        evidence_ids:
        - EVID-0011
        - EVID-0012
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00010
      definition_of_done:
        criteria:
        - "PolicyViolation events emitted on violations"
        - "All events include rationale_code"
        - "Structured logs via tracing"
        - "Audit events queryable by type"
        - "Retention policy documented"
        evidence_ids:
        - EVID-0011
        - EVID-0012

    # =================================================================
    # PHASE 4: Syscall Mediation
    # =================================================================
    - ticket_id: TCK-00013
      title: "Define tool request/response contract"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00013.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00013.md"
      scope:
        in_scope:
        - "Define ToolRequest protobuf messages"
        - "Define ToolResponse protobuf messages"
        - "Define tool types (FileRead, FileWrite, ShellExec, etc.)"
        - "Implement request parsing and validation"
        out_of_scope:
        - "Specific tool implementations (TCK-00014, 15, 16)"
      binds:
        requirement_ids:
        - REQ-0004
        - REQ-0012
        evidence_ids:
        - EVID-0008
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00002
      definition_of_done:
        criteria:
        - "ToolRequest/ToolResponse protos defined"
        - "All tool types covered"
        - "Request validation rejects malformed input"
        - "Fuzz tests for request parsing"
        - "Documentation for tool contract"
        evidence_ids:
        - EVID-0008

    - ticket_id: TCK-00014
      title: "Implement filesystem mediation adapter"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00014.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00014.md"
      scope:
        in_scope:
        - "Implement FileRead tool"
        - "Implement FileWrite tool"
        - "Implement FileEdit tool"
        - "Restrict paths to workspace"
        - "Track file modifications"
        out_of_scope:
        - "Diff generation (part of review flow)"
      binds:
        requirement_ids:
        - REQ-0004
        evidence_ids:
        - EVID-0003
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00013
      - TCK-00010
      definition_of_done:
        criteria:
        - "FileRead returns file contents"
        - "FileWrite writes to allowed paths"
        - "FileEdit applies text replacements"
        - "Paths outside workspace rejected"
        - "File operations logged"
        evidence_ids:
        - EVID-0003

    - ticket_id: TCK-00015
      title: "Implement shell command mediation adapter"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00015.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00015.md"
      scope:
        in_scope:
        - "Implement ShellExec tool"
        - "Policy-based command allowlisting"
        - "Timeout enforcement"
        - "Network access flag handling"
        - "Output capture"
        out_of_scope:
        - "Seccomp sandboxing (future enhancement)"
      binds:
        requirement_ids:
        - REQ-0004
        evidence_ids:
        - EVID-0003
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      - DOMAIN_SECURITY
      dependencies:
      - TCK-00013
      - TCK-00010
      definition_of_done:
        criteria:
        - "ShellExec runs commands in subprocess"
        - "Commands checked against allowlist"
        - "Timeout kills long-running commands"
        - "Network access denied by default"
        - "Output captured and hashed"
        evidence_ids:
        - EVID-0003

    - ticket_id: TCK-00016
      title: "Implement inference syscall adapter"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00016.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00016.md"
      scope:
        in_scope:
        - "Implement InferenceCall tool"
        - "Provider abstraction (local, remote)"
        - "Token budget deduction"
        - "Prompt/response logging"
        out_of_scope:
        - "Specific provider implementations (adapter code)"
      binds:
        requirement_ids:
        - REQ-0004
        - REQ-0019
        evidence_ids:
        - EVID-0003
        - EVID-0018
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00013
      - TCK-00011
      definition_of_done:
        criteria:
        - "InferenceCall submits to provider"
        - "Token budget deducted"
        - "Prompts/responses logged (hashed)"
        - "Provider switchable via config"
        - "Timeout handling"
        evidence_ids:
        - EVID-0003
        - EVID-0018

    # =================================================================
    # PHASE 5: Work Protocol (HWP)
    # =================================================================
    - ticket_id: TCK-00017
      title: "Implement work contract data model"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00017.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00017.md"
      scope:
        in_scope:
        - "Define Work struct with states"
        - "Implement WorkOpened, WorkTransitioned events"
        - "Spec snapshot handling"
        - "Requirement binding"
        out_of_scope:
        - "Lease integration (TCK-00018)"
        - "Evidence publication (TCK-00019)"
      binds:
        requirement_ids:
        - REQ-0014
        - REQ-0001
        evidence_ids:
        - EVID-0001
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00002
      - TCK-00004
      definition_of_done:
        criteria:
        - "Work states defined (OPEN, CLAIMED, IN_PROGRESS, REVIEW, NEEDS_INPUT, COMPLETED, ABORTED)"
        - "WorkOpened includes spec_snapshot_hash"
        - "State transitions validated"
        - "Work projection tracks all active work"
        - "Requirement IDs linked to work"
        evidence_ids:
        - EVID-0001

    - ticket_id: TCK-00018
      title: "Implement lease registrar"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00018.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00018.md"
      scope:
        in_scope:
        - "Implement lease issuance"
        - "Implement lease renewal"
        - "Implement lease release"
        - "Enforce at-most-one lease per work_id"
        - "Registrar signing of leases"
        out_of_scope:
        - "Federation lease reconciliation (RFC-0002)"
      binds:
        requirement_ids:
        - REQ-0022
        - REQ-0036
        evidence_ids:
        - EVID-0006
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00017
      - TCK-00003
      definition_of_done:
        criteria:
        - "LeaseIssued event with registrar signature"
        - "Duplicate claims rejected"
        - "LeaseRenewed extends expiration"
        - "LeaseReleased frees work_id"
        - "LeaseExpired auto-triggers on timeout"
        evidence_ids:
        - EVID-0006

    - ticket_id: TCK-00019
      title: "Implement evidence bundle publisher"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00019.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00019.md"
      scope:
        in_scope:
        - "Implement ArtifactPublish tool"
        - "Content-addressed storage"
        - "EvidencePublished event"
        - "Evidence bundle assembly"
        out_of_scope:
        - "Evidence verification scripts (documented in PRD)"
      binds:
        requirement_ids:
        - REQ-0015
        - REQ-0009
        evidence_ids:
        - EVID-0002
        - EVID-0010
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00017
      - TCK-00013
      definition_of_done:
        criteria:
        - "Artifacts stored in CAS"
        - "EvidencePublished links work_id to artifact"
        - "Evidence bundle indexed in projection"
        - "Verification commands documented"
        - "Category classification enforced"
        evidence_ids:
        - EVID-0002
        - EVID-0010

    - ticket_id: TCK-00020
      title: "Implement gate receipt generator"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00020.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00020.md"
      scope:
        in_scope:
        - "Generate GateReceipt from evidence"
        - "Auto-populate from harness data"
        - "Emit GateReceiptGenerated event"
        - "Validate evidence completeness"
        out_of_scope:
        - "Gate review UI (CLI only)"
      binds:
        requirement_ids:
        - REQ-0016
        - REQ-0038
        evidence_ids:
        - EVID-0016
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00019
      definition_of_done:
        criteria:
        - "Gate receipt generated from evidence bundle"
        - "80-95% of receipt auto-populated"
        - "PASS/FAIL result computed"
        - "Receipt signed"
        - "Work blocked if evidence incomplete"
        evidence_ids:
        - EVID-0016

    # =================================================================
    # PHASE 6: Adapters
    # =================================================================
    - ticket_id: TCK-00021
      title: "Implement black-box adapter (observation-based)"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00021.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00021.md"
      scope:
        in_scope:
        - "Spawn agent process"
        - "Monitor filesystem for changes"
        - "Detect tool requests from side effects"
        - "Emit normalized events"
        out_of_scope:
        - "Vendor-specific parsing (generic observer)"
      binds:
        requirement_ids:
        - REQ-0010
        evidence_ids:
        - EVID-0001
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00005
      - TCK-00013
      definition_of_done:
        criteria:
        - "Agent process spawned with correct environment"
        - "Filesystem changes detected"
        - "Progress signals derived from activity"
        - "Exit detected and classified"
        - "Events normalized to AdapterEvent"
        evidence_ids:
        - EVID-0001

    - ticket_id: TCK-00022
      title: "Implement Claude Code instrumented adapter"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00022.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00022.md"
      scope:
        in_scope:
        - "Integrate with Claude Code hook system"
        - "Receive native tool requests"
        - "Send tool responses"
        - "Rich progress signals"
        out_of_scope:
        - "Other vendor adapters"
      binds:
        requirement_ids:
        - REQ-0010
        evidence_ids:
        - EVID-0001
        - EVID-0002
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00021
      definition_of_done:
        criteria:
        - "Claude Code hooks integrated"
        - "Tool requests received natively"
        - "Tool responses delivered"
        - "Rich progress signals captured"
        - "Session lifecycle managed"
        evidence_ids:
        - EVID-0001
        - EVID-0002

    # =================================================================
    # PHASE 7: Integration
    # =================================================================
    - ticket_id: TCK-00023
      title: "Implement factory run CLI command"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00023.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00023.md"
      scope:
        in_scope:
        - "apm2 factory run command"
        - "Load PRD/RFC/ticket spec"
        - "Spawn session"
        - "Monitor to completion"
        - "Machine-readable output"
        out_of_scope:
        - "Multi-work orchestration (future)"
      binds:
        requirement_ids:
        - REQ-0001
        - REQ-0028
        - REQ-1006
        evidence_ids:
        - EVID-0001
        - EVID-1006
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00017
      - TCK-00018
      - TCK-00022
      definition_of_done:
        criteria:
        - "apm2 factory run <spec> works"
        - "Spec loaded and validated"
        - "Session spawned with correct context"
        - "Completion status reported"
        - "JSON output mode supported"
        evidence_ids:
        - EVID-0001
        - EVID-1006

    - ticket_id: TCK-00024
      title: "End-to-end integration tests"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00024.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00024.md"
      scope:
        in_scope:
        - "E2E test with simulated agent"
        - "Full workflow from spec to evidence"
        - "Policy enforcement validation"
        - "Evidence bundle verification"
        - "Failure mode testing"
        out_of_scope:
        - "Performance benchmarks"
      binds:
        requirement_ids:
        - REQ-0001
        - REQ-0026
        evidence_ids:
        - EVID-0001
        - EVID-1003
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      dependencies:
      - TCK-00023
      definition_of_done:
        criteria:
        - "E2E test completes full workflow"
        - "Evidence bundle generated"
        - "Gate receipt passes"
        - "Policy denials tested"
        - "Failure modes (timeout, entropy) tested"
        evidence_ids:
        - EVID-0001
        - EVID-1003

    # =================================================================
    # OPTIONAL HARDENING
    # =================================================================
    - ticket_id: TCK-00025
      title: "Implement seccomp sandbox for black-box adapter"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00025.yaml#ticket_meta"
        body_path: "documents/work/tickets/TCK-00025.md"
      scope:
        in_scope:
        - "Define seccomp profile for agent processes"
        - "Restrict syscalls to minimum required set"
        - "Allow only mediated I/O paths"
        out_of_scope:
        - "Other platform sandboxing (macOS, Windows)"
      binds:
        requirement_ids:
        - REQ-0004
        evidence_ids:
        - EVID-0014
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_KERNEL
      - DOMAIN_SECURITY
      dependencies:
      - TCK-00021
      definition_of_done:
        criteria:
        - "Seccomp profile blocks direct network/filesystem syscalls"
        - "Agent can only communicate via mediated channels"
        - "Profile violations logged and session terminated"
        optional: true
        hardening_phase: "Pre-production"

    requirement_coverage:
      notes: |
        All 38 PRD requirements are covered by at least one ticket.
        REQ-0020 (partition tolerance), REQ-0021 (holonic scaling), REQ-0037
        (canonical root selection) are partially addressed via lease mechanics
        (TCK-00018) with full federation deferred to RFC-0002.
      uncovered_requirements: []
