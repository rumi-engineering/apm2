rfc_design_decisions:
  schema_version: "2026-02-01"
  template_version: "2026-01-23"

  phase_1_topic_taxonomy:
    required_minimum:
      - category: "system"
        pattern: "ledger.head"
      - category: "work"
        pattern: "work.<work_id>.events"
      - category: "gate"
        pattern: "gate.<work_id>.<changeset_digest>.<gate_id>"
      - category: "episode"
        pattern: "episode.<episode_id>.{lifecycle,tool,io}"
      - category: "defect"
        pattern: "defect.new"
    rules:
      - "defect id appears in payload; not in the topic string"
      - "gate topics MUST include changeset_digest and gate_id"
      - "topics are ASCII, dot-delimited, length-bounded; wildcard grammar is tightly constrained (no regex)"

  control_loop_consumers:
    statement: |
      Scheduler/reducer/CLI/UI are consumers only. Pulses are wakeups; correctness
      requires ledger cursor catch-up and CAS verification. No pulse may advance
      admission, gating, or lease state without ledger verification.
    roles:
      - name: "Scheduler/Reducer"
        invariants:
          - "Treat pulses as wakeups only; always read ledger from cursor."
          - "Never advance admission/gating/leases without ledger verification."
      - name: "CLI/UI/Operators"
        invariants:
          - "UI refresh triggered by pulse must render from ledger/CAS state."
          - "Never display pulse payload as authoritative status."
      - name: "Automation/Watchers"
        invariants:
          - "Use pulses to trigger fetch; persist decisions only after ledger verification."

  truth_plane_preconditions:
    description: |
      Truth-Plane Preconditions define the minimal ledger/CAS artifacts that must
      exist before a Pulse Plane topic is meaningful. This table is HEF-only and
      covers pulse topics exclusively. If a trigger or artifact is missing from
      the truth-plane, it is labeled NEW WORK REQUIRED and must be tracked as a
      dependency.
    table:
      - category: "system"
        topic_pattern: "ledger.head"
        trigger_events:
          - "Any committed KernelEvent append (ledger seq advances)"
        required_pointers:
          - "ledger_cursor (seq_id)"
          - "event_hash (EventRecord.event_hash)"
          - "event_type"
        preconditions_status: "PARTIAL"
        evidence:
          - "crates/apm2-core/src/ledger/storage.rs:412-518"
          - "crates/apm2-core/src/ledger/storage.rs:719-736"
          - "proto/kernel_events.proto:52-93"
        new_work_required:
          - "Daemon outbox that emits pulses only after ledger commit"

      - category: "work"
        topic_pattern: "work.<work_id>.events"
        trigger_events:
          - "WorkOpened"
          - "WorkTransitioned"
          - "WorkCompleted"
          - "WorkAborted"
          - "WorkPrAssociated"
        required_pointers:
          - "ledger_cursor (seq_id)"
          - "event_hash"
          - "work_id"
          - "time_envelope_ref (if present)"
        preconditions_status: "SCHEMA_DEFINED"
        evidence:
          - "proto/kernel_events.proto:187-239"
        new_work_required:
          - "Pulse publisher mapping from WorkEvent -> topic"

      - category: "gate"
        topic_pattern: "gate.<work_id>.<changeset_digest>.<gate_id>"
        trigger_events:
          - "GateReceipt"
        required_pointers:
          - "ledger_cursor (seq_id)"
          - "event_hash"
          - "gate_id"
          - "changeset_digest"
          - "lease_id"
          - "work_id (derived via PolicyResolvedForChangeSet changeset_digest mapping)"
          - "payload_hash"
          - "evidence_bundle_hash"
        preconditions_status: "PARTIAL"
        evidence:
          - "proto/kernel_events.proto:723-791"
        new_work_required:
          - "Mapping of changeset_digest -> work_id for GateReceipt pulses"
          - "Pulse publisher mapping from GateReceipt -> topic"

      - category: "episode"
        topic_pattern: "episode.<episode_id>.lifecycle"
        trigger_events:
          - "EpisodeCreated"
          - "EpisodeStarted"
          - "EpisodeStopped"
          - "EpisodeQuarantined"
        required_pointers:
          - "episode_id"
          - "session_id"
          - "ledger_cursor (seq_id)"
          - "time_envelope_ref"
        preconditions_status: "NEW_WORK_REQUIRED"
        evidence:
          - "proto/apm2d_runtime_v1.proto:29-55"
          - "proto/kernel_events.proto:52-93"
        new_work_required:
          - "Add episode lifecycle events to kernel_events.proto OR add episode_id to existing session events"
          - "Ledger emission path for episode lifecycle events"

      - category: "episode"
        topic_pattern: "episode.<episode_id>.tool"
        trigger_events:
          - "ToolRequested"
          - "ToolDecided"
          - "ToolExecuted"
        required_pointers:
          - "episode_id"
          - "session_id"
          - "request_id"
          - "tool_name"
          - "tool_args_hash/result_hash"
          - "ledger_cursor (seq_id)"
          - "time_envelope_ref (if present)"
        preconditions_status: "NEW_WORK_REQUIRED"
        evidence:
          - "proto/kernel_events.proto:243-282"
        new_work_required:
          - "Add episode_id to tool events OR add mapping event (episode_id <-> session_id)"

      - category: "episode"
        topic_pattern: "episode.<episode_id>.io"
        trigger_events:
          - "StreamOutput (IPC only)"
        required_pointers:
          - "episode_id"
          - "stream_kind"
          - "seq"
          - "chunk_hash or cas_ref"
        preconditions_status: "NEW_WORK_REQUIRED"
        evidence:
          - "proto/apm2d_runtime_v1.proto:92-109"
        new_work_required:
          - "Define ledger event or CAS artifact for IO with hashes"

      - category: "defect"
        topic_pattern: "defect.new"
        trigger_events:
          - "DefectRecord (ledger event)"
        required_pointers:
          - "defect_id"
          - "defect_class"
          - "work_id"
          - "evidence_hashes"
          - "ledger_cursor (seq_id)"
        preconditions_status: "NEW_WORK_REQUIRED"
        evidence:
          - "crates/apm2-holon/src/defect.rs:382-437"
          - "proto/kernel_events.proto:52-93"
        new_work_required:
          - "Add defect event type to kernel_events.proto"
          - "Ledger emission path for DefectRecord"

  layering_note: |
    FAC v0 artifacts (ChangeSetBundle, ReviewReceipt, ReviewBlocked) are
    truth-plane objects anchored in the ledger + CAS. HEF pulses are derived
    wakeups that may reference those artifacts but never replace them; FAC
    preconditions are specified separately below.

  fac_v0_autonomy_preconditions:
    description: |
      FAC v0 autonomy requires internal diff observability, reviewer viability,
      and explicit blocked semantics without GitHub reads. Preconditions below
      are truth-plane anchored (ledger + CAS) and must exist before FAC v0 is
      considered autonomous.
    table:
      - id: "FAC-V0-001"
        name: "ChangeSetBundleV1 + changeset_digest binding"
        required_artifacts:
          - "ChangeSetBundleV1 stored in CAS (canonical diff + manifest)"
          - "changeset_digest computed via BLAKE3-256 over canonical bundle bytes with changeset_digest omitted from the hash input"
          - "binary_detected=true forces ReviewBlocked(BINARY_UNSUPPORTED) in v0"
        ledger_anchor:
          - "ChangeSetPublished ledger event referencing changeset_digest + cas_ref"
        preconditions_status: "PARTIAL"
        evidence:
          - "proto/kernel_events.proto:726-744"
          - "crates/apm2-core/src/fac/risk_tier.rs:292-313"
        new_work_required:
          - "Define ChangeSetBundleV1 schema + canonicalization rules"
          - "Add ChangeSetPublished event to kernel_events.proto"
          - "Emit ledger event with CAS hash + digest binding"

      - id: "FAC-V0-002"
        name: "Workspace snapshot/apply semantics"
        required_artifacts:
          - "WorkspaceSnapshotV1 (CAS) or equivalent episode-local snapshot"
          - "Deterministic patch apply + failure capture"
        ledger_anchor:
          - "ReviewBlockedRecorded on apply failure"
        preconditions_status: "PARTIAL"
        evidence:
          - "crates/apm2-daemon/src/episode/snapshot.rs:88-104"
        new_work_required:
          - "Define WorkspaceSnapshotV1 or patch-apply receipt schema"
          - "Emit ReviewBlockedRecorded with CAS logs on apply failure"

      - id: "FAC-V0-003"
        name: "ReviewReceipt (ledger anchored)"
        required_artifacts:
          - "ReviewArtifactBundleV1 in CAS (review text + tool logs)"
        ledger_anchor:
          - "ReviewReceiptRecorded ledger event referencing CAS hash"
        preconditions_status: "NEW_WORK_REQUIRED"
        evidence:
          - "proto/kernel_events.proto:73-93"
          - "proto/kernel_events.proto:436-466"
        new_work_required:
          - "Define ReviewReceiptRecorded event in kernel_events.proto"
          - "Define ReviewArtifactBundleV1 schema + canonicalization"

      - id: "FAC-V0-004"
        name: "ReviewBlocked (explicit liveness failures)"
        required_artifacts:
          - "ReviewBlocked CAS bundle with reason_code + logs"
        ledger_anchor:
          - "ReviewBlockedRecorded ledger event referencing CAS hash"
        preconditions_status: "NEW_WORK_REQUIRED"
        evidence:
          - "proto/kernel_events.proto:73-93"
        new_work_required:
          - "Define ReviewBlockedRecorded event + reason codes"

      - id: "FAC-V0-005"
        name: "ProjectionReceipt (optional)"
        required_artifacts:
          - "ProjectionReceipt signed by adapter (projection module)"
        ledger_anchor:
          - "Optional; projection-only artifact"
        preconditions_status: "EXISTS"
        evidence:
          - "crates/apm2-daemon/src/projection/projection_receipt.rs:200-238"

  resource_governance:
    limits:
      max_subscriptions_per_connection: 16
      max_patterns_per_subscription: 16
      max_total_patterns_per_connection: 64
      max_pulses_per_sec_per_subscriber: 100
      max_burst_pulses_per_subscriber: 200
      max_queue_depth_per_subscriber: 256
      max_bytes_in_flight_per_subscriber: 1048576
      max_pulse_payload_bytes: 2048
    drop_policy:
      order:
        - "episode.<episode_id>.io"
        - "episode.<episode_id>.tool"
        - "episode.<episode_id>.lifecycle"
        - "work.<work_id>.events"
        - "gate.<work_id>.<changeset_digest>.<gate_id>"
        - "ledger.head"
      notes:
        - "No topic is guaranteed; drop policy is best-effort under backpressure."

  failure_modes_and_recovery:
    - mode: "loss"
      behavior: "Expected; pulses are lossy hints."
      recovery: "Consumer reconciles via ledger cursor catch-up."
    - mode: "reorder"
      behavior: "Allowed; authoritative ordering is ledger cursor."
      recovery: "Consumer replays ledger in order."
    - mode: "duplication"
      behavior: "Allowed; pulses may repeat."
      recovery: "Consumer dedupes by pulse_id + ledger_cursor."
    - mode: "daemon_restart"
      behavior: "Subscriptions are dropped; in-flight pulses lost."
      recovery: "Client reconnects and resubscribes with since_ledger_cursor."
    - mode: "consumer_reconnect"
      behavior: "Pulse replay buffer optional and non-authoritative."
      recovery: "Ledger catch-up remains the source of truth."

  htf_semantics:
    ordering_authority: "LedgerTime (ledger cursor/seq)"
    expiry_and_windows_authority: "MonotonicTicks"
    advisory_only: "CausalTime/HLC"
    observational_only: "Wall time"
  decisions:
    - id: "DD-HEF-0001"
      title: "Pulse plane is non-authoritative and lossy"
      statement: |
        The Pulse Plane is a lossy hint layer derived strictly from committed
        ledger+CAS artifacts. Pulses are never admissive or authoritative; every
        consumer MUST verify by reading the ledger and CAS.
      context: |
        FAC authority is ledger+CAS only. Pulses exist to reduce polling and
        accelerate UX, not to replace proofs or receipts.
      alternatives:
        - id: "ALT-HEF-0001-A"
          name: "Authoritative pulse messages"
          pros:
            - "Lower latency"
          cons:
            - "Violates FAC truth model; enables spoofed admission"
          security_tradeoffs:
            - "High risk: pulse forgery becomes admission bypass"
          operability_tradeoffs:
            - "Higher coupling to delivery guarantees"
      chosen_rationale: "Maintains FAC truth invariants and fail-closed posture."
      impacted_requirement_ids:
        - "REQ-HEF-0001"
      evidence_ids:
        - "EVID-HEF-0001"

    - id: "DD-HEF-0002"
      title: "PulseEnvelope v1 schema with strict bounds"
      statement: |
        Define PulseEnvelopeV1 with bounded fields, explicit dedupe identifiers,
        and references to ledger cursor and CAS hashes. Unknown fields are
        rejected (fail-closed).
      context: |
        Pulses must be small and safe to parse under adversarial input.
      alternatives:
        - id: "ALT-HEF-0002-A"
          name: "Free-form JSON payloads"
          pros: ["Fast to prototype"]
          cons: ["Unbounded size, weak schema guarantees"]
          security_tradeoffs: ["Higher injection/DoS risk"]
          operability_tradeoffs: ["Harder versioning"]
      chosen_rationale: "Bounded protobuf with strict decode enables safe IPC."
      impacted_requirement_ids:
        - "REQ-HEF-0002"
      evidence_ids:
        - "EVID-HEF-0004"

    - id: "DD-HEF-0003"
      title: "Topic taxonomy + constrained wildcard grammar"
      statement: |
        Topics are ASCII, dot-delimited, length-bounded. Wildcards are limited to
        per-segment '*' and an optional terminal '>' (matches remaining segments),
        with a maximum of 2 wildcards per pattern. Regex and empty segments are
        forbidden.
      context: |
        Unbounded wildcard matching is a DoS vector and complicates ACL checks.
      alternatives:
        - id: "ALT-HEF-0003-A"
          name: "Regex matching"
          pros: ["Flexible filtering"]
          cons: ["High CPU cost, hard to secure"]
          security_tradeoffs: ["Regex DoS risk"]
          operability_tradeoffs: ["Harder to reason about ACLs"]
      chosen_rationale: "Simple bounded grammar keeps matching predictable."
      impacted_requirement_ids:
        - "REQ-HEF-0007"
      evidence_ids:
        - "EVID-HEF-0007"

    - id: "DD-HEF-0004"
      title: "Default-deny subscription ACLs and daemon-only publish"
      statement: |
        Operator connections may subscribe broadly. Session connections are
        deny-by-default: sessions may subscribe only to topics explicitly
        enumerated in the session capability manifest/lease (episode_id/work_id/gate_id
        scopes). Phase 1 session.sock forbids wildcards; allowlists must enumerate
        exact topics. Capability manifests may grant only within policy (never
        broaden beyond policy). Sessions never publish pulse topics; daemon-only
        publish from outbox after ledger commit.
      context: |
        Pulse traffic crosses the IPC boundary and must preserve RFC-0017 trust
        boundaries and SoD. Enforcement points: SubscribePulse handling in
        session_dispatch.rs (after session_token validation) and in
        dispatch.rs for operator.sock; pulse publisher applies ACL filtering
        per-connection before enqueue.
      alternatives:
        - id: "ALT-HEF-0004-A"
          name: "Allow sessions to publish pulses"
          pros: ["Simpler integration"]
          cons: ["Authority confusion, spoofing risk"]
          security_tradeoffs: ["Untrusted sessions could emit fake pulses"]
          operability_tradeoffs: ["Hard to audit"]
      chosen_rationale: "Preserves daemon authority and trust boundary."
      impacted_requirement_ids:
        - "REQ-HEF-0003"
      evidence_ids:
        - "EVID-HEF-0002"

    - id: "DD-HEF-0005"
      title: "Resource governance and drop policy"
      statement: |
        Enforce caps at the daemon boundary: max subscriptions per connection,
        max patterns, max pulses/sec per subscriber, max queue depth, and max
        bytes in-flight. Concrete Phase-1 limits are listed in
        resource_governance.limits. Backpressure triggers bounded drops with
        defined priority (episode.<id>.io drops first).
      context: |
        Pulses are optional hints; availability must never degrade daemon
        correctness.
      alternatives:
        - id: "ALT-HEF-0005-A"
          name: "Unlimited queues"
          pros: ["No drops"]
          cons: ["DoS risk, memory exhaustion"]
          security_tradeoffs: ["High availability risk"]
          operability_tradeoffs: ["Unbounded memory"]
      chosen_rationale: "Fail-closed and bounded resource use."
      impacted_requirement_ids:
        - "REQ-HEF-0004"
      evidence_ids:
        - "EVID-HEF-0007"

    - id: "DD-HEF-0006"
      title: "Information disclosure minimization"
      statement: |
        Pulse payloads carry only opaque IDs, hashes, and bounded metadata.
        File paths, tool arguments, diffs, or secrets are forbidden. No
        human-facing note field exists in Phase 1. CAS access remains policy
        gated; pulses do not grant read access. CAS read authorization is
        enforced by the daemon policy/broker layer before invoking core CAS
        read APIs.
      context: |
        Pulse traffic is cross-boundary and must be safe by default.
      alternatives:
        - id: "ALT-HEF-0006-A"
          name: "Include human-readable notes"
          pros: ["Convenient UX"]
          cons: ["Leakage risk"]
          security_tradeoffs: ["Sensitive data exposure"]
          operability_tradeoffs: ["Redaction complexity"]
      chosen_rationale: "Minimize disclosure and keep CAS as the only data plane."
      impacted_requirement_ids:
        - "REQ-HEF-0005"
      evidence_ids:
        - "EVID-HEF-0001"

    - id: "DD-HEF-0007"
      title: "Outbox invariant + HTF semantics"
      statement: |
        Pulse emission order is: CAS persist -> ledger commit -> outbox enqueue
        -> pulse publish. Outbox storage and fanout live in the daemon; apm2-core
        exposes only a post-commit notification interface and must not depend on
        daemon types. Ledger append MUST NOT block on pulse fanout. Post-commit
        notifications are best-effort and MUST NOT fail the commit. Outbox enqueue
        occurs after durable commit; fanout is decoupled from the commit path.
        Ordering is authoritative by LedgerTime (cursor/seq); expiry and backoff
        windows use MonotonicTicks; HLC is advisory only; wall time is
        observational.
      context: |
        Pulses must never outrun authoritative truth and must respect HTF.
      alternatives:
        - id: "ALT-HEF-0007-A"
          name: "Emit pulses before ledger commit"
          pros: ["Lower latency"]
          cons: ["False positives; violates truth-plane"]
          security_tradeoffs: ["Admission bypass risk"]
          operability_tradeoffs: ["Harder reconciliation"]
      chosen_rationale: "Preserves authoritative ordering and auditability."
      impacted_requirement_ids:
        - "REQ-HEF-0006"
      evidence_ids:
        - "EVID-HEF-0006"

    - id: "DD-HEF-0008"
      title: "Subscribe/resume semantics over ProtocolServer"
      statement: |
        Add SubscribePulse/Unsubscribe messages to ProtocolServer. Subscriptions
        include since_ledger_cursor. Consumers reconcile via ledger catch-up; any
        pulse replay buffer is optional and non-authoritative. JSON framing is
        never accepted on ProtocolServer sockets.
      context: |
        Reconnect/resume must be ledger-driven and must respect DD-009.
      alternatives:
        - id: "ALT-HEF-0008-A"
          name: "Durable broker replay"
          pros: ["Higher delivery probability"]
          cons: ["Out of Phase 1 scope; adds authority ambiguity"]
          security_tradeoffs: ["New infra attack surface"]
          operability_tradeoffs: ["Operational complexity"]
      chosen_rationale: "Keeps Phase 1 minimal and authority clear."
      impacted_requirement_ids:
        - "REQ-HEF-0008"
      evidence_ids:
        - "EVID-HEF-0003"

    - id: "DD-HEF-0009"
      title: "Control-loop consumers treat pulses as wakeups only"
      statement: |
        Scheduler/reducer/CLI/UI must treat pulses as wakeups only. Consumers
        reconcile correctness by reading the ledger from cursor and verifying CAS
        references. No pulse may advance admission, gating, or lease state without
        ledger verification.
      context: |
        HEF accelerates UX but cannot change authority semantics. Explicitly
        constraining consumers prevents accidental pulse-as-authority drift.
      alternatives:
        - id: "ALT-HEF-0009-A"
          name: "Allow consumers to treat pulses as authoritative hints"
          pros: ["Lower latency"]
          cons: ["Violates FAC truth model; enables spoofed admission"]
          security_tradeoffs: ["Admission bypass risk"]
          operability_tradeoffs: ["Harder reconciliation"]
      chosen_rationale: "Keeps FAC authority model intact while enabling wakeups."
      impacted_requirement_ids:
        - "REQ-HEF-0001"
        - "REQ-HEF-0008"
      evidence_ids:
        - "EVID-HEF-0001"

    - id: "DD-HEF-0010"
      title: "Canonical ChangeSetBundle + changeset_digest binding"
      statement: |
        All review decisions MUST bind to a canonical ChangeSetBundleV1 stored in
        CAS. The changeset_digest is computed as BLAKE3-256 over canonical bundle
        bytes with the changeset_digest field omitted from the hash input, and is
        anchored by a ledger event before any review or gate decision.
      context: |
        FAC v0 autonomy requires reviewers to see the exact diff without GitHub
        reads. Canonicalization prevents mismatched diffs and TOCTOU attacks.
      alternatives:
        - id: "ALT-HEF-0010-A"
          name: "Use GitHub diff as source of truth"
          pros: ["Already available"]
          cons: ["Violates projection-only posture; external TOCTOU risk"]
          security_tradeoffs: ["External spoofing and divergence risk"]
          operability_tradeoffs: ["Depends on network availability"]
      chosen_rationale: "Keeps diff observability internal and verifiable."
      impacted_requirement_ids:
        - "REQ-HEF-0009"
      evidence_ids:
        - "EVID-HEF-0009"

    - id: "DD-HEF-0011"
      title: "Reviewer episode contract (minimal tools, CAS logging, no GitHub truth)"
      statement: |
        Reviewer episodes MUST receive a workspace snapshot/apply input derived
        from ChangeSetBundleV1, run a minimal approved tool set
        (FileRead + GitOperation{DIFF, STATUS} + ArtifactFetch), and emit review
        artifacts/logs into CAS. ShellExec is forbidden by default and requires
        explicit capability allowlist. Reviewer decisions never depend on GitHub
        reads.
      tool_surface_mapping:
        - tool: "FileRead"
          proto_ref: "proto/tool_protocol.proto:41-74"
          handler_ref: "crates/apm2-daemon/src/protocol/session_dispatch.rs:303-351 (stub; RFC-0017 TCK-00260)"
        - tool: "GitOperation{DIFF, STATUS}"
          proto_ref: "proto/tool_protocol.proto:156-169"
          handler_ref: "crates/apm2-daemon/src/protocol/session_dispatch.rs:303-351 (stub; RFC-0017 TCK-00260)"
        - tool: "ArtifactFetch"
          proto_ref: "proto/tool_protocol.proto:225-239"
          handler_ref: "crates/apm2-daemon/src/protocol/session_dispatch.rs:303-351 (stub; RFC-0017 TCK-00260)"
        - tool: "ListFiles/Search"
          proto_ref: "proto/tool_protocol.proto:41-51 (not defined; NEW WORK REQUIRED TCK-00315)"
          handler_ref: "NEW WORK REQUIRED (TCK-00315)"
      context: |
        Autonomy requires reviewers to operate entirely inside Forge with
        deterministic inputs and evidence-carrying outputs.
      alternatives:
        - id: "ALT-HEF-0011-A"
          name: "Allow reviewers to fetch diffs from GitHub"
          pros: ["Less internal tooling"]
          cons: ["Breaks projection-only; leaks authority"]
          security_tradeoffs: ["External manipulation risk"]
          operability_tradeoffs: ["Network dependency"]
      chosen_rationale: "Keeps reviewer inputs and outputs within CAS/ledger."
      impacted_requirement_ids:
        - "REQ-HEF-0010"
      evidence_ids:
        - "EVID-HEF-0010"
        - "EVID-HEF-0011"

    - id: "DD-HEF-0012"
      title: "ReviewBlocked semantics (explicit liveness failures)"
      statement: |
        ReviewBlocked is a first-class, ledger-anchored outcome with explicit
        reason codes (including BINARY_UNSUPPORTED, missing artifacts, invalid
        bundles, and timeouts) and CAS logs. Retries are bounded by HTF windows;
        blocked outcomes must be surfaced as durable receipts.
      context: |
        Liveness requires reviewers to fail loudly and reproducibly when inputs
        are missing or invalid.
      alternatives:
        - id: "ALT-HEF-0012-A"
          name: "Silent retry without receipts"
          pros: ["Simpler"]
          cons: ["Hides liveness failures; stalls FAC"]
          security_tradeoffs: ["Opaque failure modes"]
          operability_tradeoffs: ["Hard to debug"]
      chosen_rationale: "Explicit blocked receipts preserve liveness and auditability."
      impacted_requirement_ids:
        - "REQ-HEF-0011"
      evidence_ids:
        - "EVID-HEF-0010"

    - id: "DD-HEF-0013"
      title: "FAC v0 autonomy is gated by end-to-end evidence"
      statement: |
        HEF enable-by-default is blocked until FAC v0 autonomy evidence exists:
        ChangeSetBundle -> reviewer episode -> ReviewReceipt -> GateReceipt ->
        projection via local sink/receipt (no external writes under
        network_access=DISALLOWED), with no GitHub reads for truth.
      context: |
        Without end-to-end evidence, HEF risks becoming a side channel rather
        than an accelerator for autonomous FAC.
      alternatives:
        - id: "ALT-HEF-0013-A"
          name: "Enable HEF without FAC v0 evidence"
          pros: ["Faster rollout"]
          cons: ["No autonomy guarantee; potential authority confusion"]
          security_tradeoffs: ["Unvalidated control loop behavior"]
          operability_tradeoffs: ["Unclear readiness"]
      chosen_rationale: "Ensures HEF accelerates FAC only when autonomy is proven."
      impacted_requirement_ids:
        - "REQ-HEF-0009"
        - "REQ-HEF-0010"
        - "REQ-HEF-0011"
      evidence_ids:
        - "EVID-HEF-0012"
