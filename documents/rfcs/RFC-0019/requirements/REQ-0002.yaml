requirement:
  schema_version: "2026-01-23"
  id: "REQ-0002"
  title: "Capability manifests must be real (no empty allowlists)"
  category: "FUNCTIONAL"
  priority: "P0"
  status: "PROPOSED"
  statement: |
    SpawnEpisode must install real capability manifests, not empty allowlist stubs.
    Role-based capability manifests must be defined for at least reviewer v0.
    Manifests must be stored as CAS artifacts (hash-addressed).
    SpawnEpisode must load manifests by hash.
    Policy resolution must decide which manifest hash is assigned to the session.
  rationale: |
    Current state: SpawnEpisode creates CapabilityManifest with empty allowlist
    (crates/apm2-daemon/src/protocol/dispatch.rs:2916-2926). This means the system
    cannot progress beyond "deny all" even with the legacy allow path removed.
  acceptance_criteria:
    - "Reviewer v0 capability manifest defined with: GitOperation (read-only), ArtifactFetch, ListFiles, Search"
    - "Capability manifests stored in CAS as hash-addressed artifacts"
    - "SpawnEpisode loads manifest by hash from policy resolution"
    - "Reviewer session can request allowed tools with deterministic allowlist behavior"
  evidence_ids:
    - "EVID-0002"
  source_refs:
    - "crates/apm2-daemon/src/protocol/dispatch.rs:2916-2926"
