requirement:
  schema_version: "2026-01-23"
  id: "REQ-0007"
  title: "xtask authority reduction staging"
  category: "FUNCTIONAL"
  priority: "P2"
  status: "PROPOSED"
  statement: |
    xtask authority must be progressively reduced:
    1. Add xtask mode to "emit internal receipts + request projection" instead of direct GitHub writes
    2. Stage cutover:
       - Stage 1: xtask does both (write + projection receipts) under explicit flags
       - Stage 2: xtask stops writes by default; projection worker writes
       - Stage 3: xtask write path removed from production FAC execution profiles; local/dev fallback is isolated only
       - Stage 4: production agent runtimes are hard-denied from direct GitHub API/gh actuation
    3. No GitHub write occurs without explicit allow flags
    4. FAC projection receipts are durable and independently auditable

    Security posture:
    - Default behavior MUST be least authority: no direct GitHub writes from production agent runtimes.
    - When writes are enabled, xtask MUST emit durable projection receipts (CAS) so reviewers can
      attribute every external write to a verifiable internal event chain.
    - Unknown or ambiguous projection stage state MUST fail closed to direct-write deny.
  rationale: |
    xtask already has explicit guardrails for status writes (xtask/src/util.rs:287-330).
    The goal is to shift writes from xtask to the projection worker while maintaining
    audit trail and explicit gating.
  acceptance_criteria:
    - "xtask has --emit-receipt-only mode"
    - "xtask requires explicit --allow-github-write flag for direct writes"
    - "Projection worker can perform GitHub writes independent of xtask"
    - "All GitHub writes have durable projection receipts"
    - "Audit trail shows which component performed each write"
    - "Production FAC agent profiles deny direct gh/GitHub API actuation and emit structured defects."
  evidence_ids:
    - "EVID-0007"
  source_refs:
    - "xtask/src/util.rs:287-330"
