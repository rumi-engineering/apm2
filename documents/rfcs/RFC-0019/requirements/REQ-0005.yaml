requirement:
  schema_version: "2026-01-23"
  id: "REQ-0005"
  title: "Episode event persistence to ledger"
  category: "FUNCTIONAL"
  priority: "P1"
  status: "PROPOSED"
  statement: |
    EpisodeRuntime must persist events to ledger:
    1. Provide episode event sink that appends to kernel ledger as episode runs
    2. Receipt event must be appended atomically at episode completion
    3. Episode event stream must survive daemon restart (ledger-backed)
    4. ReviewReceiptRecorded must always appear after its referenced CAS artifacts exist
  rationale: |
    Current state: EpisodeRuntime buffers events in memory and explicitly states it should
    stream to ledger in production (crates/apm2-daemon/src/episode/runtime.rs:1192-1211).
    This means episode events are lost on restart and receipts are not durable.
  acceptance_criteria:
    - "Episode events streamed to ledger as they occur"
    - "Receipt event appended atomically at completion"
    - "Events survive daemon restart"
    - "CAS artifacts exist before referencing receipt event"
  evidence_ids:
    - "EVID-0005"
  source_refs:
    - "crates/apm2-daemon/src/episode/runtime.rs:1192-1211"
