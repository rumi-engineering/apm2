requirement:
  schema_version: "2026-02-09"
  id: "REQ-0029"
  title: "Crash-safe effect execution: effect journal, RequestId idempotency key propagation, fail-closed in-doubt handling"
  category: "SECURITY"
  priority: "P0"
  status: "PROPOSED"
  statement: |
    AdmissionKernel MUST persist an effect execution journal (or equivalent) sufficient to
    classify each RequestId as one of: NotStarted, Started, Completed, Unknown.

    The journal MUST persist enough pre-effect bindings to resume safely after restart:
    request digest, selected as_of_ledger_anchor, policy_root_digest + epoch,
    witness seed objects (or their deterministic derivation parameters),
    boundary profile id + enforcement tier, and join id/selectors.

    For fail-closed tiers, Unknown state MUST trigger: no output release (including
    streaming), containment/quarantine per policy, and deny re-execution unless the
    effect is declared idempotent and boundary confirms not executed.

    Effect execution to external systems MUST carry an idempotency key derived from
    RequestId (or an HE id) whenever feasible.

    Primary delivery ticket: TCK-00501.
  rationale: |
    Consume-before-effect creates an in-doubt window on crash. Without an explicit journal
    and fail-closed in-doubt handling, restarts can create effect duplication or silent leakage.
  acceptance_criteria:
    - "Restart tests classify crash windows deterministically."
    - "Fail-closed tiers fail closed on Unknown and do not leak outputs."
    - "Where adapters support it, external calls carry RequestId idempotency key."
  evidence_ids:
    - "EVID-0024"
  source_refs:
    - "documents/rfcs/RFC-0019/19_admission_spine_v1_1_pcac_boundaries.md"
