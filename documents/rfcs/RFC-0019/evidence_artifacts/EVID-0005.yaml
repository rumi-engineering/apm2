evidence_artifact:
  schema_version: "2026-01-23"
  id: "EVID-0005"
  title: "Episode event persistence evidence"
  category: "INTEGRATION_TEST_RESULT"
  status: "APPROVED"
  description: |
    Evidence that episode events are persisted to ledger,
    survive daemon restart, and receipts are atomic.

    TCK-00321 Implementation Summary:
    1. Extended LedgerEventEmitter trait with emit_episode_event() and emit_review_receipt() methods
    2. Added ledger_emitter field to EpisodeRuntime with with_ledger_emitter() builder method
    3. Modified emit_event() to stream events to ledger when emitter is configured
    4. Implemented atomic receipt emission via emit_review_receipt()
    5. CAS-before-event ordering ensured by existing execute_tool -> record_tool_result flow
    6. Added integration tests verifying event persistence and restart survival
  requirement_ids:
    - "REQ-0005"
  source_refs:
    - "crates/apm2-daemon/src/episode/runtime.rs"
    - "crates/apm2-daemon/src/protocol/dispatch.rs"
    - "crates/apm2-daemon/src/ledger.rs"
  artifacts:
    - type: "integration_test"
      path: "crates/apm2-daemon/tests/tck_00321_episode_event_persistence.rs"
      description: "7 integration tests verifying episode event ledger persistence, atomic receipt emission, and restart survival simulation"
    - type: "implementation"
      path: "crates/apm2-daemon/src/episode/runtime.rs"
      description: "EpisodeRuntime with ledger_emitter field and modified emit_event() for ledger streaming"
    - type: "implementation"
      path: "crates/apm2-daemon/src/protocol/dispatch.rs"
      description: "LedgerEventEmitter trait with emit_episode_event() and emit_review_receipt() methods"
    - type: "implementation"
      path: "crates/apm2-daemon/src/ledger.rs"
      description: "SqliteLedgerEventEmitter implementations of emit_episode_event() and emit_review_receipt()"
