rfc_ticket_decomposition:
  schema_version: "2026-01-24"
  template_version: "2026-01-24"
  principles:
    - "Tickets MUST be atomic and independently verifiable."
    - "Each ticket MUST reference requirement_ids and evidence_ids."
    - "Cross-ticket dependencies MUST be explicit and minimal."
    - "Each ticket is a single YAML file containing all metadata, scope, plan, and criteria."
  ticket_plan:
    ticket_storage_root: "documents/work/tickets/"
    tickets:
      - ticket_id: "TCK-00316"
        title: "Session dispatcher viability closure"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00316.yaml#ticket_meta"
        scope:
          in_scope:
            - "Wire SessionDispatcher with CAS, ledger, clock, broker"
            - "Remove legacy allow path in production"
            - "Implement real PublishEvidence and EmitEvent"
          out_of_scope:
            - "Capability manifest implementation (separate ticket)"
        binds:
          requirement_ids:
            - "REQ-0001"
          evidence_ids:
            - "EVID-0001"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_KERNEL"
        dependencies: []
        definition_of_done:
          criteria:
            - "SessionDispatcher constructed with full dependencies in production path"
            - "RequestTool returns kernel-executed, CAS-backed results"
            - "Legacy allow path denied in production mode"
          evidence_ids:
            - "EVID-0001"

      - ticket_id: "TCK-00317"
        title: "Reviewer capability manifest (real allowlist)"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00317.yaml#ticket_meta"
        scope:
          in_scope:
            - "Define reviewer v0 capability manifest schema"
            - "Store manifest in CAS"
            - "SpawnEpisode loads manifest by hash"
          out_of_scope:
            - "Implementor capability manifest (future)"
        binds:
          requirement_ids:
            - "REQ-0002"
          evidence_ids:
            - "EVID-0002"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_SECURITY"
        dependencies:
          - "TCK-00316"
        definition_of_done:
          criteria:
            - "Reviewer manifest allows: GitOperation (read), ArtifactFetch, ListFiles, Search"
            - "Manifest stored in CAS with content hash"
            - "SpawnEpisode resolves manifest from policy"
          evidence_ids:
            - "EVID-0002"

      - ticket_id: "TCK-00318"
        title: "Workspace apply implementation (safe patch apply)"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00318.yaml#ticket_meta"
        scope:
          in_scope:
            - "Implement WorkspaceManager::apply (changeset apply) with isolated workspace"
            - "Base commit checkout from local mirror"
            - "Safe patch application with path validation"
            - "ReviewBlockedRecorded on failure"
          out_of_scope:
            - "Tool handler rooting (separate ticket)"
        binds:
          requirement_ids:
            - "REQ-0003"
          evidence_ids:
            - "EVID-0003"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
        dependencies: []
        definition_of_done:
          criteria:
            - "Workspace created per-episode"
            - "Patch paths validated for root containment"
            - "Failed apply emits ReviewBlockedRecorded"
          evidence_ids:
            - "EVID-0003"

      - ticket_id: "TCK-00319"
        title: "Root tool handlers per workspace"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00319.yaml#ticket_meta"
        scope:
          in_scope:
            - "Amend ListFiles/Search handlers to use workspace root"
            - "Amend GitOperation handlers similarly"
            - "Path traversal prevention"
            - "TOCTOU race mitigation: use O_NOFOLLOW or fstat verification (RSK-0005)"
          out_of_scope:
            - "Workspace creation (TCK-00318)"
        binds:
          requirement_ids:
            - "REQ-0003"
          evidence_ids:
            - "EVID-0003"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_SECURITY"
        dependencies:
          - "TCK-00318"
        definition_of_done:
          criteria:
            - "Tool handlers rooted to workspace, not daemon CWD"
            - "Symlink escape blocked"
            - "TOCTOU race mitigated via O_NOFOLLOW or fstat verification"
            - "ListFiles/Search reflect patched workspace"
          evidence_ids:
            - "EVID-0003"

      - ticket_id: "TCK-00320"
        title: "Tool result hash propagation (executor -> events -> artifacts)"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00320.yaml#ticket_meta"
        scope:
          in_scope:
            - "ToolExecutor returns CAS result_hash per tool execution (ToolResultData stored in CAS)"
            - "Propagate result_hash through tool lifecycle events (ToolExecuted) and tool responses"
            - "Accumulate per-episode tool result hashes for downstream indexing/audit"
          out_of_scope:
            - "ToolExecutionReceipt + ToolLogIndexV1 + SummaryReceipt (TCK-00327)"
        binds:
          requirement_ids:
            - "REQ-0004"
          evidence_ids:
            - "EVID-0004"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
        dependencies:
          - "TCK-00316"
        definition_of_done:
          criteria:
            - "Tool results returned from executor include CAS result_hash"
            - "Tool lifecycle events include result_hash and resolve in CAS"
            - "Per-episode accumulator contains complete ordered set of tool result hashes"
          evidence_ids:
            - "EVID-0004"

      - ticket_id: "TCK-00321"
        title: "Episode event sink to ledger"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00321.yaml#ticket_meta"
        scope:
          in_scope:
            - "Episode event sink appends to ledger"
            - "Atomic receipt emission at completion"
            - "CAS-before-event ordering"
          out_of_scope:
            - "Tool log capture (TCK-00320)"
        binds:
          requirement_ids:
            - "REQ-0005"
          evidence_ids:
            - "EVID-0005"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_KERNEL"
        dependencies:
          - "TCK-00316"
          - "TCK-00320"
        definition_of_done:
          criteria:
            - "Episode events persisted to ledger as they occur"
            - "Receipt emitted atomically at completion"
            - "Events survive daemon restart"
          evidence_ids:
            - "EVID-0005"

      - ticket_id: "TCK-00322"
        title: "Projection worker (daemon integration)"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00322.yaml#ticket_meta"
        scope:
          in_scope:
            - "Wire projection module into daemon"
            - "Ledger tailer for projection decisions"
            - "Work index: changeset -> work_id -> PR"
            - "GitHub adapter for status + comment"
          out_of_scope:
            - "Projection receipt event (TCK-00323)"
        binds:
          requirement_ids:
            - "REQ-0006"
          evidence_ids:
            - "EVID-0006"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_PROJECTION"
        dependencies:
          - "TCK-00321"
        definition_of_done:
          criteria:
            - "Projection worker runs as daemon task"
            - "ReviewReceiptRecorded triggers GitHub projection"
            - "Status + comment posted to PR"
          evidence_ids:
            - "EVID-0006"

      - ticket_id: "TCK-00323"
        title: "ProjectionReceiptRecorded kernel event"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00323.yaml#ticket_meta"
        scope:
          in_scope:
            - "Define ProjectionReceiptRecorded event schema"
            - "Canonicalization + topic derivation"
            - "Durable projection receipts in CAS"
            - "Idempotency via receipt lookup"
          out_of_scope:
            - "Tamper detection (optional v0.1)"
        binds:
          requirement_ids:
            - "REQ-0006"
          evidence_ids:
            - "EVID-0006"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_KERNEL"
          - "DOMAIN_PROJECTION"
        dependencies:
          - "TCK-00322"
        definition_of_done:
          criteria:
            - "ProjectionReceiptRecorded event defined"
            - "Projection receipts stored in CAS"
            - "Idempotency prevents duplicate projections"
          evidence_ids:
            - "EVID-0006"

      - ticket_id: "TCK-00324"
        title: "xtask cutover stage 1"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00324.yaml#ticket_meta"
        scope:
          in_scope:
            - "Add --emit-receipt-only mode to xtask"
            - "Require --allow-github-write for direct writes"
            - "xtask triggers ingestion + waits for projection"
          out_of_scope:
            - "Full xtask deprecation (future stages)"
        binds:
          requirement_ids:
            - "REQ-0007"
          evidence_ids:
            - "EVID-0007"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
        dependencies:
          - "TCK-00322"
          - "TCK-00323"
        definition_of_done:
          criteria:
            - "xtask has --emit-receipt-only mode"
            - "Direct writes require explicit flag"
            - "Default path uses projection worker"
          evidence_ids:
            - "EVID-0007"

      - ticket_id: "TCK-00325"
        title: "ViewCommitment capture + embedding in review artifacts"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00325.yaml#ticket_meta"
        scope:
          in_scope:
            - "Capture ViewCommitment during workspace materialization/episode execution"
            - "Store ViewCommitment as CAS artifact (apm2.view_commitment.v1)"
            - "Embed view_commitment_hash and policy_resolved_ref into review artifacts/receipts (holon-ready binding)"
          out_of_scope:
            - "Multi-cell anti-entropy replication (future)"
        binds:
          requirement_ids:
            - "REQ-0008"
          evidence_ids:
            - "EVID-0008"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_KERNEL"
        dependencies:
          - "TCK-00318"
          - "TCK-00321"
        definition_of_done:
          criteria:
            - "ViewCommitment stored in CAS and referenced by hash"
            - "Review artifacts include view_commitment_hash and policy_resolved_ref bindings"
            - "Missing pins/view commitment causes ReviewBlockedRecorded (fail closed)"
          evidence_ids:
            - "EVID-0008"

      - ticket_id: "TCK-00326"
        title: "ContextPack sealing + broker firewall initialization (end-to-end)"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00326.yaml#ticket_meta"
        scope:
          in_scope:
            - "Seal ContextPacks as CAS artifacts and reference them by hash"
            - "Initialize broker context firewall from context_pack_hash for every episode"
            - "Fail closed on missing/unsealable ContextPack (ReviewBlockedRecorded)"
            - "Embed capability_manifest_hash and context_pack_hash into review artifacts/receipts (authority binding)"
          out_of_scope:
            - "Cross-org policy governance (future)"
        binds:
          requirement_ids:
            - "REQ-0008"
          evidence_ids:
            - "EVID-0008"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_SECURITY"
        dependencies:
          - "TCK-00316"
          - "TCK-00317"
        definition_of_done:
          criteria:
            - "ContextPacks stored in CAS and loaded by hash"
            - "Context firewall initialized from sealed ContextPack for each episode"
            - "Reads/tool requests outside ContextPack are denied and recorded"
            - "Review artifacts include capability_manifest_hash and context_pack_hash bindings"
          evidence_ids:
            - "EVID-0008"

      - ticket_id: "TCK-00327"
        title: "ToolExecutionReceipt + ToolLogIndexV1 + SummaryReceipt integration"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00327.yaml#ticket_meta"
        scope:
          in_scope:
            - "Emit signed ToolExecutionReceipt per tool actuation (proof-carrying tool use)"
            - "ToolExecutionReceipt binds episode/policy/request/capability, args_hash/result_hash, and time envelope/duration"
            - "ToolLogIndexV1 indexes ToolExecutionReceipt hashes with canonical ordering and chunking support"
            - "Generate SummaryReceipt (loss profile + selectors) for review outcomes"
            - "Review artifacts reference tool_log_index_hash and summary_receipt_hash (single-pointer scaling)"
          out_of_scope:
            - "Exabyte-scale compaction pipelines (future RFC)"
        binds:
          requirement_ids:
            - "REQ-0010"
          evidence_ids:
            - "EVID-0010"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_KERNEL"
        dependencies:
          - "TCK-00320"
          - "TCK-00321"
        definition_of_done:
          criteria:
            - "ToolExecutionReceipts stored in CAS for every tool actuation"
            - "ToolLogIndexV1 stored in CAS referencing only resolvable ToolExecutionReceipt hashes"
            - "Review artifacts include tool_log_index_hash and summary_receipt_hash"
            - "Verifier can resolve ToolExecutionReceipt -> args_hash/result_hash -> CAS artifacts"
          evidence_ids:
            - "EVID-0010"

      - ticket_id: "TCK-00328"
        title: "AgentAdapterProfileV1 schema + registry selection by hash"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00328.yaml#ticket_meta"
        scope:
          in_scope:
            - "Define AgentAdapterProfileV1 schema + canonicalization"
            - "Store profiles as CAS artifacts and load by hash"
            - "AdapterRegistry selects profiles by hash (no ambient defaults)"
          out_of_scope:
            - "Vendor-specific deep integrations beyond profile-based execution"
        binds:
          requirement_ids:
            - "REQ-0009"
          evidence_ids:
            - "EVID-0009"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_KERNEL"
        dependencies: []
        definition_of_done:
          criteria:
            - "AgentAdapterProfileV1 stored in CAS and selected by hash"
            - "Misconfigured profile fails closed with ReviewBlockedRecorded(reason=ADAPTER_MISCONFIGURED)"
            - "Kernel-side tool execution enforced for all profiles"
          evidence_ids:
            - "EVID-0009"

      - ticket_id: "TCK-00329"
        title: "Adapter profiles for claude-code, gemini-cli, codex-cli, local-inference"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00329.yaml#ticket_meta"
        scope:
          in_scope:
            - "Provide AgentAdapterProfileV1 artifacts for claude-code, gemini-cli, codex-cli, local-inference"
            - "Default to black_box ledger-mediated driver where possible"
            - "Define permission_mode_map and capability_map per profile"
          out_of_scope:
            - "Automated installation/configuration of vendor CLIs"
        binds:
          requirement_ids:
            - "REQ-0009"
          evidence_ids:
            - "EVID-0009"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
        dependencies:
          - "TCK-00328"
        definition_of_done:
          criteria:
            - "Profiles exist for all target CLIs and are hash-addressed"
            - "Each profile runs a non-interactive episode under kernel tool mediation"
          evidence_ids:
            - "EVID-0009"

      - ticket_id: "TCK-00330"
        title: "Adapter conformance tests + ledger attribution"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00330.yaml#ticket_meta"
        scope:
          in_scope:
            - "Add conformance tests for each AgentAdapterProfileV1"
            - "Emit ledger events attributing runs by (work_id, episode_id, session_id, adapter_profile_hash)"
            - "Demonstrate non-interactive receipt production across profiles"
          out_of_scope:
            - "Full evaluation benchmark suite (post-v0)"
        binds:
          requirement_ids:
            - "REQ-0009"
          evidence_ids:
            - "EVID-0009"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_KERNEL"
        dependencies:
          - "TCK-00328"
        definition_of_done:
          criteria:
            - "Conformance tests pass for all profiles"
            - "Ledger events include adapter_profile_hash attribution"
          evidence_ids:
            - "EVID-0009"

      - ticket_id: "TCK-00331"
        title: "RoleSpecV1 + tool-call matrix + instruction conformance harness"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00331.yaml#ticket_meta"
        scope:
          in_scope:
            - "Define RoleSpecV1 schema + canonicalization; store in CAS by hash"
            - "Define tool-call matrix per role (allowed tools + budgets) and encode in RoleSpec"
            - "Emit role_spec_hash in episode start events and terminal receipts"
            - "Implement RoleSpec conformance harness (schema validation + tool allowlist consistency)"
            - "Provide minimum role specs: orchestrator, implementer, code_quality_reviewer, security_reviewer"
          out_of_scope:
            - "Full automatic role discovery or learning"
        binds:
          requirement_ids:
            - "REQ-0012"
          evidence_ids:
            - "EVID-0012"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_KERNEL"
          - "DOMAIN_DAEMON"
          - "DOMAIN_ADMISSION"
        dependencies:
          - "TCK-00330"
        definition_of_done:
          criteria:
            - "RoleSpecV1 artifacts exist in CAS and are selected by hash"
            - "Episode/receipt artifacts include role_spec_hash attribution"
            - "Conformance harness rejects inconsistent RoleSpecs and missing output schemas"
          evidence_ids:
            - "EVID-0012"

      - ticket_id: "TCK-00332"
        title: "Orchestrator revision loop (1..100 cycles) with deterministic stop conditions"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00332.yaml#ticket_meta"
        scope:
          in_scope:
            - "Implement FAC orchestration state machine in ledger events (iteration counter, budgets, termination reason)"
            - "Drive implementer + reviewer episodes iteratively until PASS/BLOCKED/BUDGET_EXHAUSTED/OPERATOR_STOP"
            - "Crash-only resumability: restart from ledger head/checkpoint without duplicating projections"
            - "Bind each iteration to ChangeSetBundleV1 + reviewer receipts + ledger anchor"
          out_of_scope:
            - "Automatic bug creation/triage loop (defer)"
        binds:
          requirement_ids:
            - "REQ-0011"
          evidence_ids:
            - "EVID-0011"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_KERNEL"
          - "DOMAIN_ADMISSION"
        dependencies:
          - "TCK-00331"
        definition_of_done:
          criteria:
            - "A work_id can run >= 20 revision iterations in integration test without human interaction"
            - "Restart resumes orchestration deterministically from ledger state"
            - "Termination reasons are recorded as authoritative facts"
          evidence_ids:
            - "EVID-0011"

      - ticket_id: "TCK-00333"
        title: "FAC productivity CLI/scripts (ledger/CAS oriented debug UX)"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00333.yaml#ticket_meta"
        scope:
          in_scope:
            - "Implement apm2 fac CLI commands: work status, episode inspect, receipt show"
            - "Support deterministic context rebuild for role+episode"
            - "Support crash-only resume helpers (restart from ledger anchor)"
          out_of_scope:
            - "GUI dashboards"
        binds:
          requirement_ids:
            - "REQ-0013"
          evidence_ids:
            - "EVID-0013"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_CLI"
          - "DOMAIN_DAEMON"
        dependencies:
          - "TCK-00332"
        definition_of_done:
          criteria:
            - "CLI can display work status and latest receipt hashes from ledger"
            - "CLI can inspect tool log index entries by episode without raw log parsing"
            - "CLI can rebuild role-scoped context deterministically"
          evidence_ids:
            - "EVID-0013"

      - ticket_id: "TCK-00334"
        title: "Horizontal specialization: specialist roles + diff-based routing"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00334.yaml#ticket_meta"
        scope:
          in_scope:
            - "Add 3+ specialist RoleSpecs (e.g., test_flake_fixer, rust_compile_error_fixer, dependency_updater_reviewer)"
            - "Implement diff classifier + routing heuristics to assign specialist roles with minimal context packs"
            - "Ensure specialists run with narrower tool budgets than generalists"
          out_of_scope:
            - "ML-based role routing"
        binds:
          requirement_ids:
            - "REQ-0014"
          evidence_ids:
            - "EVID-0014"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_ADMISSION"
          - "DOMAIN_DAEMON"
        dependencies:
          - "TCK-00331"
          - "TCK-00332"
        definition_of_done:
          criteria:
            - "Orchestrator can route at least 3 specialist roles based on diff classification"
            - "Specialists use scoped ContextPacks and reduced tool budgets"
          evidence_ids:
            - "EVID-0014"

      - ticket_id: "TCK-00335"
        title: "Efficiency primitives: context deltas, caching, and summary-first iteration economics"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00335.yaml#ticket_meta"
        scope:
          in_scope:
            - "Implement context delta injection between iterations (N -> N+1)"
            - "Cache repeated tool outputs (Search/FileRead) in CAS-backed caches when safe"
            - "Prefer summary receipts as iteration interfaces; zoom-in by selector only on demand"
          out_of_scope:
            - "Global exabyte compaction pipeline (future RFC)"
        binds:
          requirement_ids:
            - "REQ-0014"
          evidence_ids:
            - "EVID-0014"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_KERNEL"
        dependencies:
          - "TCK-00332"
        definition_of_done:
          criteria:
            - "Iteration N+1 default context uses deltas + summary receipts (no full history injection)"
            - "20-iteration loop stays within fixed context budget envelope using deltas and summaries"
          evidence_ids:
            - "EVID-0014"

      - ticket_id: "TCK-00336"
        title: "Refactor: remove unsafe-by-default protocol/bypass paths (exclude xtask)"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00336.yaml#ticket_meta"
        scope:
          in_scope:
            - "Remove or hard-disable any remaining legacy allow/bypass paths for tool execution"
            - "Remove deprecated protocol handlers that are unused by FAC v0"
            - "Add regression tests ensuring no tool executes without broker mediation"
          out_of_scope:
            - "xtask deprecation"
        binds:
          requirement_ids:
            - "REQ-0015"
          evidence_ids:
            - "EVID-0015"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
          - "DOMAIN_SECURITY"
        dependencies:
          - "TCK-00332"
        definition_of_done:
          criteria:
            - "No code path allows tool execution without broker mediation + ledger emission"
            - "Deprecated handlers are deleted or hard-disabled and covered by tests"
          evidence_ids:
            - "EVID-0015"

      - ticket_id: "TCK-00337"
        title: "Refactor: remove dead/unused modules and protocols after FAC stabilization"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00337.yaml#ticket_meta"
        scope:
          in_scope:
            - "Identify and remove dead/unused modules or unsafe-by-default patterns (excluding xtask)"
            - "Update docs and references accordingly"
          out_of_scope:
            - "Large-scale architecture rewrites"
        binds:
          requirement_ids:
            - "REQ-0015"
          evidence_ids:
            - "EVID-0015"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_DAEMON"
        dependencies:
          - "TCK-00336"
        definition_of_done:
          criteria:
            - "Unused codepaths removed; build and tests pass"
            - "FAC v0 path remains stable"
          evidence_ids:
            - "EVID-0015"

      - ticket_id: "TCK-00338"
        title: "Security hardening: broker sandboxing (allowlists, canonical paths, env scrub, timeouts)"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00338.yaml#ticket_meta"
        scope:
          in_scope:
            - "Implement strict command allowlists and canonical path validation for ShellExec"
            - "Enforce env allowlist/scrubbing; default deny unapproved env vars"
            - "Add timeouts and stall detection hardening across tools"
          out_of_scope:
            - "Full multi-tenant isolation"
        binds:
          requirement_ids:
            - "REQ-0016"
          evidence_ids:
            - "EVID-0016"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_SECURITY"
          - "DOMAIN_DAEMON"
        dependencies:
          - "TCK-00332"
        definition_of_done:
          criteria:
            - "Broker enforces strict execution constraints and emits structured denials"
            - "Regression tests cover allowlist and timeout behavior"
          evidence_ids:
            - "EVID-0016"

      - ticket_id: "TCK-00339"
        title: "Security hardening: prompt-injection resistance via evidence taint tracking"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00339.yaml#ticket_meta"
        scope:
          in_scope:
            - "Introduce taint classification for untrusted inputs (diffs, tool outputs, web content)"
            - "Define policies for what tainted content can flow into high-authority prompts/receipts"
            - "Emit PolicyViolation or ReviewBlockedRecorded on forbidden taint flows"
          out_of_scope:
            - "Formal proof of non-interference"
        binds:
          requirement_ids:
            - "REQ-0016"
          evidence_ids:
            - "EVID-0016"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_SECURITY"
          - "DOMAIN_KERNEL"
        dependencies:
          - "TCK-00338"
        definition_of_done:
          criteria:
            - "Taint tags propagate through evidence pointers and context compilation"
            - "Forbidden taint flows are denied and recorded"
          evidence_ids:
            - "EVID-0016"

      - ticket_id: "TCK-00340"
        title: "Security hardening: multi-holon policy inheritance enforcement + attestation tightening"
        ticket_files:
          meta_ref: "documents/work/tickets/TCK-00340.yaml#ticket_meta"
        scope:
          in_scope:
            - "Enforce policy inheritance rules across holonic boundaries (subleases are strict subsets)"
            - "Rachet attestation requirements by risk tier for receipts (ToolExecutionReceipt, ReviewReceipt, ProjectionReceipt)"
            - "Fail closed for missing attestations in high-risk tiers"
          out_of_scope:
            - "Cross-cell federation protocols"
        binds:
          requirement_ids:
            - "REQ-0016"
          evidence_ids:
            - "EVID-0016"
        custody_agent_roles:
          - "AGENT_IMPLEMENTER"
        responsibility_domains:
          - "DOMAIN_SECURITY"
          - "DOMAIN_KERNEL"
        dependencies:
          - "TCK-00339"
        definition_of_done:
          criteria:
            - "Higher risk tiers require stronger attestations without breaking low-tier throughput"
            - "Missing/invalid attestation fails closed where required"
          evidence_ids:
            - "EVID-0016"

