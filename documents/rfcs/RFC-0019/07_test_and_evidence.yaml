rfc_test_and_evidence:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  test_plan:
    unit:
      - id: "UT-0001"
        name: "SessionDispatcher with full context"
        description: "Verify dispatcher constructed with CAS/ledger/broker processes tools correctly"
        coverage_target: "REQ-0001"
      - id: "UT-0002"
        name: "CapabilityManifest allowlist enforcement"
        description: "Verify manifest allowlist blocks unauthorized tool requests"
        coverage_target: "REQ-0002"
      - id: "UT-0003"
        name: "Workspace path validation"
        description: "Verify patch paths validated for root containment"
        coverage_target: "REQ-0003"
      - id: "UT-0004"
        name: "ToolResultData result_hash propagation"
        description: "Verify tool execution surfaces CAS result_hash and preserves deterministic ordering"
        coverage_target: "REQ-0004"
      - id: "UT-0005"
        name: "Holon-ready receipt bindings"
        description: "Verify review artifacts bind view_commitment_hash, capability_manifest_hash, context_pack_hash, and policy_resolved_ref"
        coverage_target: "REQ-0008"
      - id: "UT-0006"
        name: "ToolExecutionReceipt canonicalization"
        description: "Verify ToolExecutionReceipt canonical bytes and hash stability (signature-critical)"
        coverage_target: "REQ-0010"
      - id: "UT-0007"
        name: "AgentAdapterProfileV1 canonicalization"
        description: "Verify adapter profile canonicalization and fail-closed behavior on misconfiguration"
        coverage_target: "REQ-0009"
      - id: "UT-0008"
        name: "ToolLogIndexV1 canonical ordering"
        description: "Verify ToolLogIndexV1 canonical ordering and stable hashing over ToolExecutionReceipt hashes"
        coverage_target: "REQ-0010"
      - id: "UT-0009"
        name: "RoleSpecV1 canonicalization and conformance"
        description: "Verify RoleSpecV1 canonicalization and conformance harness rejects inconsistent specs"
        coverage_target: "REQ-0012"
    integration:
      - id: "IT-0001"
        name: "E2E review episode with real stores"
        description: "Full flow: ingest -> episode -> receipt -> verify in CAS+ledger"
        coverage_target: "REQ-0001, REQ-0004, REQ-0005"
        test_file: "crates/apm2-daemon/tests/hef_fac_v0_e2e.rs"
      - id: "IT-0002"
        name: "Workspace isolation verification"
        description: "Verify tool navigation sees patched state, not daemon CWD"
        coverage_target: "REQ-0003"
      - id: "IT-0003"
        name: "Projection idempotency test"
        description: "Verify restart doesn't duplicate GitHub projections"
        coverage_target: "REQ-0006"
      - id: "IT-0004"
        name: "Holon-ready receipt E2E"
        description: "Verify ViewCommitment + ContextPack binding is present and verifiable from CAS+ledger"
        coverage_target: "REQ-0008"
      - id: "IT-0005"
        name: "Tool receipts + summary receipt E2E"
        description: "Verify ToolExecutionReceipt, ToolLogIndexV1, and SummaryReceipt are stored and resolvable"
        coverage_target: "REQ-0010"
      - id: "IT-0006"
        name: "Adapter profile conformance"
        description: "Verify each AgentAdapterProfileV1 can run a non-interactive episode and produce a ReviewReceipt"
        coverage_target: "REQ-0009"
      - id: "IT-0007"
        name: "Orchestration multi-iteration loop"
        description: "Verify orchestrator can drive >=20 revision iterations and resume deterministically from ledger after restart"
        coverage_target: "REQ-0011"
      - id: "IT-0008"
        name: "FAC productivity CLI smoke"
        description: "Verify apm2 fac CLI can render work status, inspect episodes via tool indices, and rebuild context deterministically"
        coverage_target: "REQ-0013"
    fuzz:
      - id: "FZ-0001"
        name: "Patch path fuzzing"
        description: "Fuzz patch file paths for escape attempts"
        coverage_target: "REQ-0003"
    perf:
      - id: "PF-0001"
        name: "20-iteration loop cost envelope"
        description: "Verify delta contexts + summary receipts keep multi-iteration FAC within fixed budgets"
        coverage_target: "REQ-0014"
    chaos:
      - id: "CH-0001"
        name: "CAS unavailability during tool execution"
        description: "Verify graceful degradation when CAS unavailable"
        coverage_target: "REQ-0001, REQ-0004"
      - id: "CH-0002"
        name: "Ledger unavailability during event emission"
        description: "Verify blocking behavior and recovery"
        coverage_target: "REQ-0005"
  evidence_bundle:
    root: "evidence/rfc/RFC-0019/"
    artifact_registry:
      mode: "FILE_PER_ARTIFACT"
      local_root: "evidence_artifacts/"
      local_artifacts:
        - id: "EVID-0001"
          file_ref: "evidence_artifacts/EVID-0001.yaml"
          description: "Session dispatcher viability evidence"
        - id: "EVID-0002"
          file_ref: "evidence_artifacts/EVID-0002.yaml"
          description: "Capability manifest implementation evidence"
        - id: "EVID-0003"
          file_ref: "evidence_artifacts/EVID-0003.yaml"
          description: "Workspace apply and isolation evidence"
        - id: "EVID-0004"
          file_ref: "evidence_artifacts/EVID-0004.yaml"
          description: "Tool result hash propagation evidence"
        - id: "EVID-0005"
          file_ref: "evidence_artifacts/EVID-0005.yaml"
          description: "Episode event persistence evidence"
        - id: "EVID-0006"
          file_ref: "evidence_artifacts/EVID-0006.yaml"
          description: "Projection worker wiring evidence"
        - id: "EVID-0007"
          file_ref: "evidence_artifacts/EVID-0007.yaml"
          description: "xtask authority reduction evidence"
        - id: "EVID-0008"
          file_ref: "evidence_artifacts/EVID-0008.yaml"
          description: "Holon-ready receipts binding evidence (ViewCommitment + ContextPack)"
        - id: "EVID-0009"
          file_ref: "evidence_artifacts/EVID-0009.yaml"
          description: "Agent adapter profile evidence (profiles + conformance)"
        - id: "EVID-0010"
          file_ref: "evidence_artifacts/EVID-0010.yaml"
          description: "ToolExecutionReceipt + ToolLogIndexV1 + SummaryReceipt evidence"
        - id: "EVID-0011"
          file_ref: "evidence_artifacts/EVID-0011.yaml"
          description: "Orchestration loop evidence (multi-iteration closed-loop FAC)"
        - id: "EVID-0012"
          file_ref: "evidence_artifacts/EVID-0012.yaml"
          description: "RoleSpecV1 evidence (hash-addressed role instructions + conformance)"
        - id: "EVID-0013"
          file_ref: "evidence_artifacts/EVID-0013.yaml"
          description: "FAC productivity CLI evidence"
        - id: "EVID-0014"
          file_ref: "evidence_artifacts/EVID-0014.yaml"
          description: "FAC efficiency evidence (deltas, caching, specialization)"
        - id: "EVID-0015"
          file_ref: "evidence_artifacts/EVID-0015.yaml"
          description: "Refactor evidence (remove dead/unused/unsafe-by-default paths)"
        - id: "EVID-0016"
          file_ref: "evidence_artifacts/EVID-0016.yaml"
          description: "Security hardening evidence (broker sandboxing, taint tracking, attestation tightening)"
        - id: "EVID-GROUND-001"
          file_ref: "evidence_artifacts/EVID-GROUND-001.yaml"
          description: "Grounding evidence for DEC-0001 (SessionDispatcher wiring)"
        - id: "EVID-GROUND-002"
          file_ref: "evidence_artifacts/EVID-GROUND-002.yaml"
          description: "Grounding evidence for DEC-0002 (tool receipts + log index)"
        - id: "EVID-GROUND-003"
          file_ref: "evidence_artifacts/EVID-GROUND-003.yaml"
          description: "Grounding evidence for DEC-0003 (Workspace isolation)"
        - id: "EVID-GROUND-004"
          file_ref: "evidence_artifacts/EVID-GROUND-004.yaml"
          description: "Grounding evidence for DEC-0004 (Projection idempotency)"
        - id: "EVID-GROUND-005"
          file_ref: "evidence_artifacts/EVID-GROUND-005.yaml"
          description: "Grounding evidence for DEC-0005 (Capability manifests)"
        - id: "EVID-GROUND-006"
          file_ref: "evidence_artifacts/EVID-GROUND-006.yaml"
          description: "Grounding evidence for DEC-0006 (Episode events to ledger)"
        - id: "EVID-GROUND-007"
          file_ref: "evidence_artifacts/EVID-GROUND-007.yaml"
          description: "Grounding evidence for DEC-0007 (xtask authority reduction)"
      imports: []
