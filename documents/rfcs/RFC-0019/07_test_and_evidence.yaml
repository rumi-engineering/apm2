rfc_test_and_evidence:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  test_plan:
    unit:
      - id: "UT-0001"
        name: "SessionDispatcher with full context"
        description: "Verify dispatcher constructed with CAS/ledger/broker processes tools correctly"
        coverage_target: "REQ-0001"
      - id: "UT-0002"
        name: "CapabilityManifest allowlist enforcement"
        description: "Verify manifest allowlist blocks unauthorized tool requests"
        coverage_target: "REQ-0002"
      - id: "UT-0003"
        name: "Workspace path validation"
        description: "Verify patch paths validated for root containment"
        coverage_target: "REQ-0003"
      - id: "UT-0004"
        name: "ToolLogIndex creation"
        description: "Verify tool log index aggregates all result hashes"
        coverage_target: "REQ-0004"
    integration:
      - id: "IT-0001"
        name: "E2E review episode with real stores"
        description: "Full flow: ingest -> episode -> receipt -> verify in CAS+ledger"
        coverage_target: "REQ-0001, REQ-0004, REQ-0005"
        test_file: "crates/apm2-daemon/tests/hef_fac_v0_e2e.rs"
      - id: "IT-0002"
        name: "Workspace isolation verification"
        description: "Verify tool navigation sees patched state, not daemon CWD"
        coverage_target: "REQ-0003"
      - id: "IT-0003"
        name: "Projection idempotency test"
        description: "Verify restart doesn't duplicate GitHub projections"
        coverage_target: "REQ-0006"
    fuzz:
      - id: "FZ-0001"
        name: "Patch path fuzzing"
        description: "Fuzz patch file paths for escape attempts"
        coverage_target: "REQ-0003"
    perf: []
    chaos:
      - id: "CH-0001"
        name: "CAS unavailability during tool execution"
        description: "Verify graceful degradation when CAS unavailable"
        coverage_target: "REQ-0001, REQ-0004"
      - id: "CH-0002"
        name: "Ledger unavailability during event emission"
        description: "Verify blocking behavior and recovery"
        coverage_target: "REQ-0005"
  evidence_bundle:
    root: "evidence/rfc/RFC-0019/"
    artifact_registry:
      mode: "FILE_PER_ARTIFACT"
      local_root: "evidence_artifacts/"
      local_artifacts:
        - id: "EVID-0001"
          file_ref: "evidence_artifacts/EVID-0001.yaml"
          description: "Session dispatcher viability evidence"
        - id: "EVID-0002"
          file_ref: "evidence_artifacts/EVID-0002.yaml"
          description: "Capability manifest implementation evidence"
        - id: "EVID-0003"
          file_ref: "evidence_artifacts/EVID-0003.yaml"
          description: "Workspace apply and isolation evidence"
        - id: "EVID-0004"
          file_ref: "evidence_artifacts/EVID-0004.yaml"
          description: "Tool log capture evidence"
        - id: "EVID-0005"
          file_ref: "evidence_artifacts/EVID-0005.yaml"
          description: "Episode event persistence evidence"
        - id: "EVID-0006"
          file_ref: "evidence_artifacts/EVID-0006.yaml"
          description: "Projection worker wiring evidence"
        - id: "EVID-0007"
          file_ref: "evidence_artifacts/EVID-0007.yaml"
          description: "xtask authority reduction evidence"
      imports: []
