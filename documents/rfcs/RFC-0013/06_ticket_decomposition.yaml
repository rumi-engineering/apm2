rfc_ticket_decomposition:
  schema_version: "2026-01-27"
  template_version: "2026-01-27"

  status: POPULATED
  populated_date: "2026-01-27"
  decompose_session_id: "COUNCIL-RFC-0013-DECOMPOSE"

  ticket_mapping:
    # Phase 0: Prerequisites (added by SA-1 structural review)
    - preliminary_id: TCK-PEND-000
      final_id: TCK-00156
      title: "Scaffold apm2-daemon module structure and setup infrastructure"
      phase: PHASE-0
      requirement_ids: [REQ-DAEMON-001, REQ-EVID-001]
      depends_on: []
      summary: |
        Scaffold the apm2-daemon crate and prepare shared infrastructure:
        1. Move DefectRecord from apm2-holon to apm2-core/src/cac/defect.rs
           to resolve inverted dependency.
        2. Update apm2-holon/src/lib.rs to re-export DefectRecord from apm2-core.
        3. Add zbus and nix/pty features to workspace Cargo.toml for
           cgroup and PTY integration.
        4. Remove unused imports in proto/apm2d_runtime_v1.proto.
        5. Create initial module structure for apm2-daemon.
      files_to_create:
        - crates/apm2-daemon/src/lib.rs
        - crates/apm2-daemon/src/episode/mod.rs
        - crates/apm2-daemon/src/protocol/mod.rs
        - crates/apm2-daemon/src/telemetry/mod.rs
        - crates/apm2-daemon/src/evidence/mod.rs

    # Phase 1A: Protocol Foundation
    - preliminary_id: TCK-PEND-001
      final_id: TCK-00157
      title: "Implement UDS protocol server with length-prefixed framing"
      phase: PHASE-1A
      requirement_ids: [REQ-PROTOCOL-001]
      depends_on: [TCK-00156]
      files_to_create:
        - crates/apm2-daemon/src/protocol/framing.rs
        - crates/apm2-daemon/src/protocol/server.rs
        - crates/apm2-daemon/src/protocol/handshake.rs

    - preliminary_id: TCK-PEND-002
      final_id: TCK-00158
      title: "Implement protobuf message definitions"
      phase: PHASE-1A
      requirement_ids: [REQ-PROTOCOL-001]
      depends_on: [TCK-00157]
      files_to_create:
        - proto/daemon_protocol.proto
        - crates/apm2-daemon/src/protocol/messages.rs
        - crates/apm2-daemon/src/protocol/golden_vectors.rs

    # Phase 1B: Episode Envelope and Lifecycle
    - preliminary_id: TCK-PEND-003
      final_id: TCK-00159
      title: "Implement EpisodeEnvelope type with canonicalization"
      phase: PHASE-1B
      requirement_ids: [REQ-EPISODE-001]
      depends_on: [TCK-00158]
      files_to_create:
        - crates/apm2-daemon/src/episode/envelope.rs
        - crates/apm2-daemon/src/episode/budget.rs
        - crates/apm2-daemon/src/episode/snapshot.rs

    - preliminary_id: TCK-PEND-004
      final_id: TCK-00160
      title: "Implement EpisodeRuntime with state machine"
      phase: PHASE-1B
      requirement_ids: [REQ-EPISODE-001, REQ-DAEMON-001]
      depends_on: [TCK-00159]
      files_to_create:
        - crates/apm2-daemon/src/episode/runtime.rs
        - crates/apm2-daemon/src/episode/state.rs
        - crates/apm2-daemon/src/episode/handle.rs

    # Phase 1C: PTY Runner and Basic Adapter
    - preliminary_id: TCK-PEND-005
      final_id: TCK-00161
      title: "Implement PTY spawning and output capture"
      phase: PHASE-1C
      requirement_ids: [REQ-ADAPTER-001]
      depends_on: [TCK-00160]
      files_to_create:
        - crates/apm2-daemon/src/episode/pty.rs
        - crates/apm2-daemon/src/episode/ring_buffer.rs
        - crates/apm2-daemon/src/episode/output.rs

    - preliminary_id: TCK-PEND-006
      final_id: TCK-00162
      title: "Implement basic HarnessAdapter trait and registry"
      phase: PHASE-1C
      requirement_ids: [REQ-ADAPTER-001]
      depends_on: [TCK-00161]
      files_to_create:
        - crates/apm2-daemon/src/episode/adapter.rs
        - crates/apm2-daemon/src/episode/registry.rs
        - crates/apm2-daemon/src/episode/raw_adapter.rs

    # Phase 2A: Tool Broker Foundation
    - preliminary_id: TCK-PEND-007
      final_id: TCK-00163
      title: "Implement capability manifest and validation"
      phase: PHASE-2A
      requirement_ids: [REQ-TOOL-001]
      depends_on: [TCK-00160]
      files_to_create:
        - crates/apm2-daemon/src/episode/capability.rs
        - crates/apm2-daemon/src/episode/scope.rs
        - crates/apm2-daemon/src/episode/tool_class.rs

    - preliminary_id: TCK-PEND-008
      final_id: TCK-00164
      title: "Implement ToolBroker with dedupe cache"
      phase: PHASE-2A
      requirement_ids: [REQ-TOOL-001]
      depends_on: [TCK-00163]
      files_to_create:
        - crates/apm2-daemon/src/episode/broker.rs
        - crates/apm2-daemon/src/episode/dedupe.rs
        - crates/apm2-daemon/src/episode/decision.rs

    # Phase 2B: Tool Execution and Receipts
    - preliminary_id: TCK-PEND-009a
      final_id: TCK-00165
      title: "Implement tool execution and budget charging"
      phase: PHASE-2B
      requirement_ids: [REQ-TOOL-001]
      depends_on: [TCK-00164]
      files_to_create:
        - crates/apm2-daemon/src/episode/executor.rs
        - crates/apm2-daemon/src/episode/budget_tracker.rs
        - crates/apm2-daemon/src/episode/tool_handler.rs

    - preliminary_id: TCK-PEND-009b
      final_id: TCK-00166
      title: "Implement tool receipt generation"
      phase: PHASE-2B
      requirement_ids: [REQ-RECEIPT-001]
      depends_on: [TCK-00165]
      files_to_create:
        - crates/apm2-daemon/src/evidence/receipt.rs
        - crates/apm2-daemon/src/evidence/binding.rs
        - crates/apm2-daemon/src/evidence/receipt_builder.rs

    - preliminary_id: TCK-PEND-010
      final_id: TCK-00167
      title: "Implement receipt signing and verification"
      phase: PHASE-2B
      requirement_ids: [REQ-RECEIPT-001]
      depends_on: [TCK-00166]
      files_to_create:
        - crates/apm2-daemon/src/evidence/signer.rs
        - crates/apm2-daemon/src/evidence/verifier.rs
        - crates/apm2-daemon/src/evidence/keychain.rs

    # Phase 2C: Telemetry Collection
    - preliminary_id: TCK-PEND-011
      final_id: TCK-00168
      title: "Implement cgroups v2 reader for resource metrics"
      phase: PHASE-2C
      requirement_ids: [REQ-TEL-001]
      depends_on: [TCK-00160]
      files_to_create:
        - crates/apm2-daemon/src/telemetry/cgroup.rs
        - crates/apm2-daemon/src/telemetry/stats.rs
        - crates/apm2-daemon/src/telemetry/proc_fallback.rs

    - preliminary_id: TCK-PEND-012
      final_id: TCK-00169
      title: "Implement TelemetryCollector and frame streaming"
      phase: PHASE-2C
      requirement_ids: [REQ-TEL-001]
      depends_on: [TCK-00168]
      files_to_create:
        - crates/apm2-daemon/src/telemetry/collector.rs
        - crates/apm2-daemon/src/telemetry/frame.rs
        - crates/apm2-daemon/src/telemetry/policy.rs

    # Phase 3A: Evidence Economics
    - preliminary_id: TCK-PEND-013
      final_id: TCK-00170
      title: "Implement flight recorder with ring buffers"
      phase: PHASE-3A
      requirement_ids: [REQ-EVID-001]
      depends_on: [TCK-00161, TCK-00169]
      files_to_create:
        - crates/apm2-daemon/src/evidence/recorder.rs
        - crates/apm2-daemon/src/evidence/config.rs
        - crates/apm2-daemon/src/evidence/trigger.rs

    - preliminary_id: TCK-PEND-014
      final_id: TCK-00171
      title: "Implement evidence TTL and pinning"
      phase: PHASE-3A
      requirement_ids: [REQ-EVID-001]
      depends_on: [TCK-00170]
      files_to_create:
        - crates/apm2-daemon/src/evidence/artifact.rs
        - crates/apm2-daemon/src/evidence/ttl.rs
        - crates/apm2-daemon/src/evidence/pin.rs

    - preliminary_id: TCK-PEND-015
      final_id: TCK-00172
      title: "Implement evidence compaction"
      phase: PHASE-3A
      requirement_ids: [REQ-EVID-001]
      depends_on: [TCK-00171]
      files_to_create:
        - crates/apm2-daemon/src/evidence/compaction.rs
        - crates/apm2-daemon/src/evidence/tombstone.rs
        - crates/apm2-daemon/src/evidence/summary.rs

    # Phase 3B: Vendor Adapter
    - preliminary_id: TCK-PEND-016
      final_id: TCK-00173
      title: "Implement Claude Code harness adapter"
      phase: PHASE-3B
      requirement_ids: [REQ-ADAPTER-001]
      depends_on: [TCK-00162, TCK-00164]
      files_to_create:
        - crates/apm2-daemon/src/episode/claude_code.rs
        - crates/apm2-daemon/src/episode/claude_parser.rs
        - crates/apm2-daemon/tests/fixtures/claude_code/

    # Phase 4: Integration and CLI
    - preliminary_id: TCK-PEND-017
      final_id: TCK-00174
      title: "Implement apm2 episode CLI commands"
      phase: PHASE-4
      requirement_ids: []
      depends_on: [TCK-00173, TCK-00172]
      files_to_create:
        - crates/apm2-cli/src/commands/episode.rs
        - crates/apm2-cli/src/client/daemon.rs
        - crates/apm2-cli/src/output/json.rs

    - preliminary_id: TCK-PEND-018a
      final_id: TCK-00175
      title: "Implement E2E lifecycle and budget tests"
      phase: PHASE-4
      requirement_ids: [REQ-EPISODE-001, REQ-DAEMON-001]
      depends_on: [TCK-00174]
      files_to_create:
        - crates/apm2-daemon/tests/e2e_lifecycle.rs
        - crates/apm2-daemon/tests/common/mod.rs
        - crates/apm2-daemon/tests/common/daemon.rs

    - preliminary_id: TCK-PEND-018b
      final_id: TCK-00176
      title: "Implement E2E tool and telemetry tests"
      phase: PHASE-4
      requirement_ids: [REQ-TOOL-001, REQ-TEL-001]
      depends_on: [TCK-00174]
      files_to_create:
        - crates/apm2-daemon/tests/e2e_tool.rs
        - crates/apm2-daemon/tests/e2e_telemetry.rs
        - crates/apm2-daemon/tests/common/mock_harness.rs

    - preliminary_id: TCK-PEND-018c
      final_id: TCK-00177
      title: "Implement E2E evidence and receipt verification tests"
      phase: PHASE-4
      requirement_ids: [REQ-EVID-001, REQ-RECEIPT-001]
      depends_on: [TCK-00174]
      files_to_create:
        - crates/apm2-daemon/tests/e2e_evidence.rs
        - crates/apm2-daemon/tests/e2e_receipt.rs
        - crates/apm2-daemon/tests/e2e_compaction.rs

  decomposition_gates:
    - gate: GATE-TCK-ATOMICITY
      status: PASSED
      notes: "All 22 tickets are atomic and completable in 1-2 days"
      evidence:
        council_session: "COUNCIL-RFC-0013-DECOMPOSE"
        assessment_date: "2026-01-27"
        sa2_verdict: "PASS"

    - gate: GATE-TCK-IMPLEMENTABILITY
      status: PASSED
      notes: "All tickets have clear implementation steps, file paths, and code examples"
      evidence:
        council_session: "COUNCIL-RFC-0013-DECOMPOSE"
        assessment_date: "2026-01-27"
        sa2_verdict: "PASS WITH CLARIFICATIONS"

    - gate: GATE-TCK-ANTI-COUSIN
      status: PASSED
      notes: "AD-LAYER-001 resolved cousin violation; all tickets extend existing patterns"
      evidence:
        council_session: "COUNCIL-RFC-0013-DECOMPOSE"
        assessment_date: "2026-01-27"
        sa3_verdict: "PASS"
        resolved_cousin_violations:
          - SA3-F-011

  ticket_statistics:
    total_tickets: 22
    phases:
      PHASE-0: 1
      PHASE-1A: 2
      PHASE-1B: 2
      PHASE-1C: 2
      PHASE-2A: 2
      PHASE-2B: 3
      PHASE-2C: 2
      PHASE-3A: 3
      PHASE-3B: 1
      PHASE-4: 4
    requirement_coverage:
      REQ-DAEMON-001: [TCK-00156, TCK-00160, TCK-00175]
      REQ-EPISODE-001: [TCK-00159, TCK-00160, TCK-00175]
      REQ-PROTOCOL-001: [TCK-00157, TCK-00158]
      REQ-TOOL-001: [TCK-00163, TCK-00164, TCK-00165, TCK-00176]
      REQ-TEL-001: [TCK-00168, TCK-00169, TCK-00176]
      REQ-EVID-001: [TCK-00170, TCK-00171, TCK-00172, TCK-00177]
      REQ-RECEIPT-001: [TCK-00166, TCK-00167, TCK-00177]
      REQ-ADAPTER-001: [TCK-00161, TCK-00162, TCK-00173]
    critical_path:
      - TCK-00156
      - TCK-00157
      - TCK-00158
      - TCK-00159
      - TCK-00160
      - TCK-00161
      - TCK-00162
      - TCK-00173
      - TCK-00174
      - TCK-00175
    critical_path_depth: 10
    parallelizable_tracks:
      track_a: [TCK-00163, TCK-00164, TCK-00165, TCK-00166, TCK-00167]
      track_b: [TCK-00168, TCK-00169]
      track_c: [TCK-00170, TCK-00171, TCK-00172]

  ticket_numbering_note: |
    Tickets TCK-00156 through TCK-00177 generated during DECOMPOSE session
    on 2026-01-27. All preliminary TCK-PEND-* tickets have been mapped to
    final ticket IDs.
