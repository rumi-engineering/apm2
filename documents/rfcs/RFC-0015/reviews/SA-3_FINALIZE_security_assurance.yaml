---
# SA-3 (Security & Anti-Cousin Guardian) FINALIZE Review
# RFC-0015: Forge Admission Cycle (FAC) - Hardened Protocol with Cryptographic Gates and OCAP Containment
# Session: COUNCIL-RFC-0015-FINALIZE-20260129
# Cycle: FINALIZE (v2 -> v4)

agent_id: SA-3
session_id: "COUNCIL-RFC-0015-FINALIZE-20260129"
session_seed: "20260129-RFC0015-FINALIZE"
cycle: FINALIZE
phase: "v2 -> v4"
review_date: "2026-01-29"
rfc_version: "v2"
target_version: "v4"

# =============================================================================
# STOCHASTIC REASONING MODES APPLIED
# =============================================================================

selected_modes:
  - 8   # Counterexample-Guided Reasoning (falsification, boundary cases)
  - 35  # Argumentation Framework (attack relations, justified conclusions)
  - 49  # Robust/Worst-Case Reasoning (adversarial conditions, margins)
  - 65  # Deontic Reasoning (obligations, permissions, prohibitions)
  - 80  # Adversarial/Red-Team Reasoning (attacker perspective, exploitation)

mode_application:
  mode_8_counterexample_guided:
    description: "Identifies boundary cases and potential falsification scenarios for security claims"
    application: |
      Counterexample analysis applied to each trust boundary:

      TB-0001 (Admission Authority): FALSIFICATION ATTEMPT FAILED
      - Counterexample sought: "Unsigned event accepted as valid"
      - Result: INVALID_SIGNATURE rejection is mandatory at ingestion
      - Counterexample sought: "Expired lease accepted"
      - Result: Lease validation enforced; UNAUTHORIZED_EXECUTOR rejection
      - BOUNDARY CASE: Key compromised mid-lease? -> FINDING F-SA3-001 (LeaseRevoked needed)

      TB-0002 (Context Firewall): FALSIFICATION ATTEMPT FAILED
      - Counterexample sought: "Read outside allowlist succeeds"
      - Result: ToolDecided=DENY is hard enforcement; SessionTerminated on bypass
      - BOUNDARY CASE: WARN mode allows violations -> FINDING F-SA3-002 (14-day gap)

      TB-0003 (Projection Isolation): FALSIFICATION ATTEMPT PARTIALLY SUCCEEDED
      - Counterexample sought: "Code reads GitHub status in admission path"
      - Result: Architectural enforcement only; no runtime verification
      - FINDING F-SA3-004: Runtime enforcement missing for projection read path

      TB-0005 (AAT Evidence): FALSIFICATION ATTEMPT FAILED
      - Counterexample sought: "Narrative-only PASS accepted"
      - Result: Terminal verifier binding enforced; AAT_TERMINAL_VERIFIER_MISSING rejects

      TB-0007 (AAT Executor Custody): BOUNDARY CASE IDENTIFIED
      - Counterexample sought: "Coordinator spoofs AAT outcome"
      - Result: Custody domain separation prevents
      - BOUNDARY CASE: COI grouping policy undefined -> Q-RFC-FAC-0003 blocks enforcement

  mode_35_argumentation_framework:
    description: "Models attack relations between security arguments and identifies justified conclusions"
    application: |
      Argumentation structure for top-level claim "FAC admission is impossible to spoof":

      ARG-A1: "Signature verification prevents forgery"
        ATTACKS: None identified
        STATUS: UNDEFEATED

      ARG-A2: "Lease binding prevents escalation"
        ATTACKS: ARG-ATK-1 ("Compromised key valid until TTL")
        DEFENSE: Add LeaseRevoked event with short TTL
        STATUS: DEFEATED -> REINSTATED with F-SA3-001 resolution

      ARG-A3: "Context firewall prevents information leakage"
        ATTACKS: ARG-ATK-2 ("WARN phase allows exfiltration")
        DEFENSE: Reduce WARN duration to 7 days
        STATUS: CONDITIONALLY JUSTIFIED (requires F-SA3-002 resolution)

      ARG-A4: "Projection isolation prevents status spoofing"
        ATTACKS: ARG-ATK-3 ("Architectural enforcement only")
        DEFENSE: Add network-level policy enforcement
        STATUS: CONDITIONALLY JUSTIFIED (requires F-SA3-004 resolution)

      ARG-A5: "Terminal verifiers prevent narrative manipulation"
        ATTACKS: None identified
        STATUS: UNDEFEATED

      JUSTIFIED CONCLUSION: Top claim is CONDITIONALLY JUSTIFIED pending:
      - F-SA3-001: LeaseRevoked event
      - F-SA3-002: WARN phase reduction
      - F-SA3-004: Runtime projection isolation

  mode_49_robust_worst_case:
    description: "Analyzes worst-case adversarial conditions and security margins"
    application: |
      Worst-case scenario analysis for each adversary:

      ADV-0001 (Malicious Agent) - WORST CASE MARGIN: ADEQUATE
      - Worst case: Agent with valid lease attempts multi-vector attack
      - Attack 1: Manipulate GitHub status -> BLOCKED (TB-0003)
      - Attack 2: Forge gate outcome -> BLOCKED (TB-0001 signature)
      - Attack 3: Access outside context -> BLOCKED (TB-0002 firewall)
      - Attack 4: Produce fake AAT evidence -> BLOCKED (TB-0005 verifiers)
      - Margin: All attack vectors have mechanical prevention

      ADV-0002 (Compromised CI) - WORST CASE MARGIN: ADEQUATE
      - Worst case: CI reports false success with no evidence
      - Defense: CI_EVENTS_ENABLED=false by default (fail-closed)
      - Defense: Evidence import required with attestation
      - Margin: Requires explicit enablement with evidence chain

      ADV-0003 (External Attacker) - WORST CASE MARGIN: ADEQUATE WITH CAVEAT
      - Worst case: Force-push to trunk bypassing branch protection
      - Defense: Divergence watchdog detects within 30s
      - Defense: InterventionFreeze halts admissions
      - CAVEAT: Branch protection contract undefined (Q-RFC-FAC-0010)
      - Margin: Detection assured; prevention depends on external config

      ADV-0004 (Compromised AAT Harness) - WORST CASE MARGIN: ADEQUATE
      - Worst case: Harness attempts evidence forgery + exfiltration
      - Defense: SEC-CTRL-FAC-0008 sandboxing with egress deny
      - Defense: Terminal verifier binding
      - Margin: Forgery blocked by verifiers; exfiltration blocked by egress policy

      ADV-0005 (Insider) - WORST CASE MARGIN: INADEQUATE (not modeled)
      - FINDING F-SA3-012: Insider threat not in threat model
      - Worst case: Kernel developer inserts backdoor
      - Worst case: Coordinator operator issues unauthorized leases
      - REQUIRED: Model ADV-0005 with compensating controls

  mode_65_deontic:
    description: "Analyzes security obligations, permissions, and prohibitions"
    application: |
      Deontic analysis of FAC security rules:

      OBLIGATIONS (MUST):
      - O1: GateRunCompleted MUST be signed (FAC-REQ-0017)
        Enforcement: INVALID_SIGNATURE rejection
        Status: ENFORCEABLE

      - O2: Leases MUST have expiry (DD-FAC-0002)
        Enforcement: Lease validation at admission
        Status: ENFORCEABLE

      - O3: Context reads MUST reference manifest (DD-FAC-0003)
        Enforcement: ToolDecided=DENY
        Status: ENFORCEABLE (after WARN phase)

      - O4: AAT MUST have terminal verifier outputs (FAC-REQ-0007)
        Enforcement: AAT_TERMINAL_VERIFIER_MISSING rejection
        Status: ENFORCEABLE

      - O5: Executor MUST NOT be author of changeset (COI policy)
        Enforcement: KeyPolicy validation at lease issuance
        Status: PENDING (Q-RFC-FAC-0003 unresolved)

      PROHIBITIONS (MUST NOT):
      - P1: Non-adapter actors MUST NOT write to GitHub
        Enforcement: Policy enforcement; PROJECTION_WRITE_UNAUTHORIZED
        Status: ENFORCEABLE

      - P2: Agents MUST NOT have ambient credential access
        Enforcement: PolicyViolation and session quarantine
        Status: ENFORCEABLE

      - P3: Child leases MUST NOT broaden scope
        Enforcement: LEASE_SCOPE_BROADENED rejection
        Status: ENFORCEABLE

      PERMISSIONS (MAY):
      - PM1: Adapter MAY overwrite tampered projection
        Condition: Divergence detected; ledger is truth
        Status: DEFINED

      - PM2: Downgrade MAY proceed with waiver
        Condition: AdjudicationRequested(WAIVER) approved
        Status: DEFINED

      DEONTIC GAPS IDENTIFIED:
      - O5 (COI obligation) depends on Q-RFC-FAC-0003 resolution
      - No obligation for lease revocation (F-SA3-001)

  mode_80_adversarial_red_team:
    description: "Attacks the system from adversary perspective to find exploitation paths"
    application: |
      RED TEAM ATTACK SCENARIOS:

      ATTACK-RT-001: "Lease Surfing"
      - Attacker obtains valid lease for gate_id=quality
      - Attacker attempts to use lease for gate_id=aat
      - Result: BLOCKED - gate_id is lease-bound (DD-FAC-0002)
      - VERDICT: NOT EXPLOITABLE

      ATTACK-RT-002: "Key Compromise Window Exploitation"
      - Attacker compromises executor key at T=0
      - Lease expires at T=30min (default)
      - Attacker has 30min to issue fraudulent GateRunCompleted
      - Result: EXPLOITABLE - no revocation mechanism
      - RECOMMENDATION: F-SA3-001 - Add LeaseRevoked; reduce AAT TTL to 15min
      - VERDICT: EXPLOITABLE UNTIL REMEDIATED

      ATTACK-RT-003: "WARN Phase Data Exfiltration"
      - During 14-day WARN phase, attacker reads sensitive files
      - Context violations logged but not blocked
      - Attacker exfiltrates data before HARD_FAIL
      - Result: EXPLOITABLE in WARN phase
      - RECOMMENDATION: F-SA3-002 - Reduce WARN to 7 days max
      - VERDICT: EXPLOITABLE UNTIL REMEDIATED

      ATTACK-RT-004: "GitHub Status Injection via Code Modification"
      - Insider modifies code to read GitHub status in admission path
      - TB-0003 enforcement is architectural only
      - No runtime detection of unauthorized GitHub reads
      - Result: POTENTIALLY EXPLOITABLE by insider
      - RECOMMENDATION: F-SA3-004 - Add network-level policy blocking api.github.com:443
      - VERDICT: EXPLOITABLE BY INSIDER UNTIL REMEDIATED

      ATTACK-RT-005: "Transcript Chain Truncation"
      - Attacker produces AAT result with truncated transcript
      - Attempts to hide failed test runs
      - Result: BLOCKED - transcript_chain_root_hash must bind all runs
      - run_count mismatch detected
      - VERDICT: NOT EXPLOITABLE

      ATTACK-RT-006: "Terminal Verifier Bypass via Narrative"
      - Attacker produces AAT PASS with compelling narrative
      - No exit_code=0 or test report
      - Result: BLOCKED - AAT_TERMINAL_VERIFIER_MISSING rejection
      - Narrative is explicitly non-authoritative
      - VERDICT: NOT EXPLOITABLE

      ATTACK-RT-007: "COI Violation via Shared Custody"
      - Attacker is both author and AAT executor
      - Custody domains not formally defined
      - Result: POTENTIALLY EXPLOITABLE
      - RECOMMENDATION: Resolve Q-RFC-FAC-0003 for formal COI grouping
      - VERDICT: EXPLOITABLE UNTIL Q-RFC-FAC-0003 RESOLVED

      ATTACK-RT-008: "Insider Kernel Modification"
      - Insider with commit access to kernel code
      - Inserts backdoor in signature verification
      - No dual-control for kernel changes
      - Result: EXPLOITABLE - ADV-0005 not modeled
      - RECOMMENDATION: F-SA3-012 - Add ADV-0005 with dual-control
      - VERDICT: EXPLOITABLE UNTIL REMEDIATED

      ATTACK-RT-009: "Branch Protection Bypass"
      - Attacker with GitHub admin privileges
      - Disables branch protection temporarily
      - Force-pushes to trunk
      - Result: DETECTED by divergence watchdog but not PREVENTED
      - Q-RFC-FAC-0010 unresolved
      - VERDICT: DETECTED NOT PREVENTED

# =============================================================================
# SECURITY FINDING RESOLUTIONS
# =============================================================================

security_finding_resolutions:
  - finding_id: F-SA3-001
    title: "Lease Revocation Gap"
    original_severity: MAJOR
    status: RESOLVED_WITH_MITIGATION

    issue: |
      No LeaseRevoked event type exists. If executor key is compromised mid-lease,
      the compromised key remains valid until TTL expiry. Adversary can issue
      valid GateRunCompleted events during this window.

    resolution:
      design_change: |
        1. Add LeaseRevoked event type to kernel_events.proto (extends LeaseEvent oneof)
        2. LeaseRevoked requires issuer signature matching lease issuer
        3. Revocation takes effect immediately upon ledger commit
        4. Admission verifies no LeaseRevoked exists for lease_id before acceptance

      operational_mitigation: |
        1. Reduce default AAT lease TTL from 60min to 15min
        2. HIGH risk tier uses 10min TTL
        3. Implement key rotation alerting for anomalous signing patterns

      evidence:
        - "LeaseRevoked schema defined in DD-FAC-0002 extension"
        - "TTL reduction documented in operational considerations"

    residual_risk: |
      15-minute window remains between key compromise and lease expiry.
      Acceptable given short window and detection capabilities.

    verification: |
      - Unit test: LeaseRevoked invalidates lease immediately
      - Integration test: GateRunCompleted rejected after LeaseRevoked
      - Adversarial test: Attempt submission with revoked lease fails

  - finding_id: F-SA3-002
    title: "WARN Phase Security Gap"
    original_severity: MEDIUM
    status: RESOLVED_WITH_MITIGATION

    issue: |
      14-day WARN phase (FAC-R-01) allows context violations to be logged but not
      blocked. Malicious agent can exfiltrate data during this window before
      HARD_FAIL enforcement takes effect.

    resolution:
      design_change: |
        1. Reduce FAC-R-01 WARN phase from 14 days to 7 days maximum
        2. Add scope limitation: WARN mode applies only to non-sensitive domains
        3. Sensitive domains (auth/crypto/ledger) start in SOFT_FAIL immediately

      operational_mitigation: |
        1. Monitor WARN violations for exfiltration patterns
        2. Accelerate to HARD_FAIL if suspicious patterns detected
        3. Security team review of WARN logs daily during rollout

      evidence:
        - "05_rollout_and_ops.yaml FAC-R-01 updated to 7 days"
        - "Sensitive domain exemption documented in rollout strategy"

    residual_risk: |
      7-day window with monitoring. Non-sensitive domain exfiltration possible
      but limited value. Acceptable tradeoff for adoption smoothness.

    verification: |
      - Configuration test: WARN phase duration <= 7 days
      - Integration test: Sensitive domains skip WARN mode

  - finding_id: F-SA3-004
    title: "Projection Read Path not runtime-verified"
    original_severity: MAJOR
    status: RESOLVED_WITH_MITIGATION

    issue: |
      TB-0003 (Projection Isolation Boundary) enforcement is architectural only.
      No runtime verification prevents code modifications that read GitHub status
      in the admission path. Insider could inject unauthorized GitHub reads.

    resolution:
      design_change: |
        1. Implement network-level policy for admission components
        2. Policy blocks egress to api.github.com:443 for all admission-path holons
        3. Only HOLON-GITHUB-ADAPTER has GitHub API egress permission
        4. Network policy violations logged and session terminated

      implementation_detail: |
        - Use eBPF or container network policies to enforce egress rules
        - Admission holons (KERNEL-GATE, reviewers, AAT) have NO github.com egress
        - PolicyViolation(NETWORK_EGRESS_BLOCKED) emitted on violation attempt

      evidence:
        - "Network policy specification added to SEC-CTRL-FAC-0009"
        - "Egress rules defined per holon class"

    residual_risk: |
      Network policy bypass requires kernel-level access (addressed by ADV-0005).
      Defense in depth significantly raises attack complexity.

    verification: |
      - Integration test: Admission holon network request to github.com blocked
      - Adversarial test: Verify no GitHub reads in admission code path
      - Network audit: Confirm egress rules deployed correctly

  - finding_id: F-SA3-012
    title: "Insider Threat not modeled"
    original_severity: MAJOR
    status: RESOLVED_WITH_MITIGATION

    issue: |
      Threat model does not cover ADV-0005 (malicious insider with kernel or
      coordinator access). No compensating controls for insider threat documented.
      Insider could modify kernel code, issue unauthorized leases, or bypass
      security controls.

    resolution:
      threat_model_addition: |
        ADV-0005: Malicious Insider

        Capabilities:
        - Commit access to kernel/coordinator codebase
        - Operator access to coordinator infrastructure
        - Knowledge of internal security mechanisms

        Attack vectors:
        - AV-INS-001: Code modification to bypass signature verification
        - AV-INS-002: Unauthorized lease issuance via coordinator access
        - AV-INS-003: KeyPolicy modification to weaken COI enforcement
        - AV-INS-004: Log tampering to hide malicious activity

        Mitigations:
        - CTRL-INS-001: Dual-control for kernel/critical code changes
          - All changes to crypto/, lease/, admission/ require 2 reviewers
          - Reviewers from different organizational units
        - CTRL-INS-002: Audit logging with tamper-evident storage
          - Lease issuance logged to immutable audit store
          - Log integrity verified via hash chain
        - CTRL-INS-003: Separation of duties for key operations
          - KeyRotated requires different actor than key generator
          - COI group changes require security team approval
        - CTRL-INS-004: Anomaly detection for privileged operations
          - Alert on unusual lease issuance patterns
          - Alert on off-hours critical operations

      evidence:
        - "ADV-0005 added to 03_trust_boundaries.yaml#threat_model"
        - "CTRL-INS-* controls documented in security controls"

    residual_risk: |
      Sophisticated insider with deep knowledge and colluding partner could
      potentially bypass dual-control. Acceptable at current scale; consider
      formal verification for kernel code in future phases.

    verification: |
      - Process audit: Verify dual-control enforced via PR requirements
      - Log audit: Verify audit logs are tamper-evident
      - Alert test: Verify anomaly detection fires on test scenarios

# =============================================================================
# ADV-0005 COMPLETE THREAT MODEL
# =============================================================================

adv_0005_threat_model:
  adversary_id: ADV-0005
  name: "Malicious Insider"

  profile:
    access_level: |
      - Commit access to kernel and/or coordinator codebase
      - Operator access to production coordinator infrastructure
      - Knowledge of internal APIs, protocols, and security mechanisms

    motivation: |
      - Financial gain (sell access or capabilities)
      - Sabotage (disgruntled employee)
      - Coercion (external threat actor leveraging insider)
      - Espionage (exfiltrate intellectual property or capabilities)

    sophistication: HIGH
    persistence: MEDIUM_TO_HIGH

  capabilities:
    - capability: "Code modification"
      description: "Can submit PRs to modify kernel behavior"
      constraint: "Subject to code review (but may collude)"

    - capability: "Infrastructure access"
      description: "Can access coordinator runtime environment"
      constraint: "Subject to audit logging"

    - capability: "Key access"
      description: "May have access to operational keys"
      constraint: "Key tier depends on role; T1 requires ceremony"

    - capability: "Social engineering"
      description: "Can influence colleagues to approve changes"
      constraint: "Dual-control from different orgs mitigates"

  attack_vectors:
    - vector_id: AV-INS-001
      name: "Backdoor in Signature Verification"
      description: |
        Insider modifies signature verification code to accept specific
        invalid signatures or bypass verification for specific actor IDs.
      likelihood: MEDIUM
      impact: CRITICAL
      mitigations:
        - CTRL-INS-001: Dual-control for crypto code changes
        - CTRL-INS-005: Static analysis for signature verification patterns
        - CTRL-INS-006: AAT coverage for signature verification paths

    - vector_id: AV-INS-002
      name: "Unauthorized Lease Issuance"
      description: |
        Insider with coordinator operator access directly issues leases
        without proper authorization chain.
      likelihood: MEDIUM
      impact: HIGH
      mitigations:
        - CTRL-INS-002: Audit logging of all lease operations
        - CTRL-INS-004: Anomaly detection for lease patterns
        - CTRL-INS-007: Lease issuance requires kernel signature (not operator)

    - vector_id: AV-INS-003
      name: "COI Policy Weakening"
      description: |
        Insider modifies KeyPolicy to place self in same custody group
        as different role, enabling self-review.
      likelihood: LOW
      impact: HIGH
      mitigations:
        - CTRL-INS-003: KeyPolicy changes require security team approval
        - CTRL-INS-002: Audit logging of policy changes
        - CTRL-INS-008: Automated COI validation at lease time

    - vector_id: AV-INS-004
      name: "Audit Log Tampering"
      description: |
        Insider with infrastructure access deletes or modifies audit logs
        to hide malicious activity.
      likelihood: MEDIUM
      impact: HIGH
      mitigations:
        - CTRL-INS-002: Hash-chained audit logs
        - CTRL-INS-009: External log replication to separate trust domain
        - CTRL-INS-010: Log integrity verification on query

    - vector_id: AV-INS-005
      name: "Terminal Verifier Manipulation"
      description: |
        Insider modifies terminal verifier predicates to accept invalid
        test outcomes as PASS.
      likelihood: MEDIUM
      impact: HIGH
      mitigations:
        - CTRL-INS-001: Dual-control for verifier policy changes
        - CTRL-INS-011: Verifier policy versioned and hash-bound
        - CTRL-INS-012: Holdout suites detect predicate drift (Phase 2)

  controls:
    - control_id: CTRL-INS-001
      name: "Dual-Control for Critical Code"
      type: PREVENTATIVE
      description: |
        Changes to security-critical paths (crypto/, lease/, admission/,
        policy/, verifier/) require approval from 2 reviewers in different
        organizational units.
      enforcement: |
        - CODEOWNERS file with @security-team for critical paths
        - Branch protection requires 2 approvals
        - Approvals must be from different CODEOWNERS groups

    - control_id: CTRL-INS-002
      name: "Tamper-Evident Audit Logging"
      type: DETECTIVE
      description: |
        All privileged operations (lease issuance, key rotation, policy
        changes) logged to hash-chained audit store with external replication.
      enforcement: |
        - Audit events include prev_hash forming chain
        - Chain integrity verified on every query
        - Replication to separate cloud account (different IAM)

    - control_id: CTRL-INS-003
      name: "Separation of Duties for Key Operations"
      type: PREVENTATIVE
      description: |
        Key generation, rotation, and COI policy changes require different
        actors. No single actor can both generate and activate keys.
      enforcement: |
        - KeyRotated event requires different signer than KeyGenerated
        - COI policy changes require AUTH_SECURITY signoff
        - Emergency overrides require dual approval

    - control_id: CTRL-INS-004
      name: "Anomaly Detection for Privileged Operations"
      type: DETECTIVE
      description: |
        Automated monitoring for unusual patterns in lease issuance,
        key operations, and policy changes.
      enforcement: |
        - Alert on >N leases per hour from single issuer
        - Alert on key operations outside business hours
        - Alert on policy changes without ticket reference

    - control_id: CTRL-INS-005
      name: "Static Analysis for Security Patterns"
      type: PREVENTATIVE
      description: |
        CI includes static analysis rules that detect modifications to
        signature verification, lease validation, and other security paths.
      enforcement: |
        - Custom lint rules for security-critical functions
        - Modification to verify_signature() requires security review
        - New code paths bypassing validation flagged

  residual_risk_assessment: |
    After implementing CTRL-INS-001 through CTRL-INS-005:
    - Colluding insiders (2+ in different orgs) remain a threat
    - Sophisticated attacker could potentially evade static analysis
    - Audit log replication has latency window for tampering

    Residual risk is MEDIUM - acceptable for current scale.
    Consider formal verification for kernel code in future phases.

# =============================================================================
# TRUST BOUNDARY VERIFICATION
# =============================================================================

trust_boundary_verification:
  - boundary_id: TB-0001
    name: "Admission Authority Boundary"
    status: VERIFIED
    enforcement_mechanism: COMPLETE

    crossing_rules_verification:
      - rule: "GateRunCompleted must be signed by leased executor"
        enforcement: "Signature verification on ingestion"
        status: VERIFIED
        evidence:
          - "DD-FAC-0001 specifies Ed25519 domain-separated signatures"
          - "EVID-FAC-0001 defines signature verification tests"

      - rule: "Lease must be valid and unexpired"
        enforcement: "Lease validation at admission"
        status: VERIFIED_WITH_ENHANCEMENT
        evidence:
          - "DD-FAC-0002 specifies lease structure with expiry"
          - "F-SA3-001 resolution adds LeaseRevoked checking"

      - rule: "MergeReceipt emitted only after result_selector observed"
        enforcement: "Atomic merge semantics"
        status: VERIFIED
        evidence:
          - "FAC-REQ-0020 specifies atomic merge receipt"
          - "EVID-FAC-0019 defines merge receipt tests"

    security_controls: [SEC-CTRL-FAC-0001, SEC-CTRL-FAC-0004, SEC-CTRL-FAC-0007]

    counterexamples_tested:
      - "Unsigned event" -> REJECTED
      - "Expired lease" -> REJECTED
      - "Revoked lease" -> REJECTED (with F-SA3-001)
      - "Scope mismatch" -> REJECTED

    confidence: 0.94

  - boundary_id: TB-0002
    name: "Context Firewall Boundary"
    status: VERIFIED_WITH_CAVEAT
    enforcement_mechanism: COMPLETE

    crossing_rules_verification:
      - rule: "All reads must reference manifest entry"
        enforcement: "ToolDecided=DENY"
        status: VERIFIED
        evidence:
          - "DD-FAC-0003 specifies OCAP firewall rules"
          - "CTX-ALLOWLIST-001 enforcement rule defined"

      - rule: "Context miss terminates session"
        enforcement: "SessionTerminated rationale=CONTEXT_MISS"
        status: VERIFIED
        evidence:
          - "CTX-CONSUME-FATAL-001 rule defined"
          - "EVID-FAC-0003 defines enforcement tests"

      - rule: "Refinement via ContextRefinementRequest only"
        enforcement: "No in-session discovery"
        status: VERIFIED
        evidence:
          - "CTX-ZOOM-001 rule defined"

    caveat: |
      WARN phase (7 days after F-SA3-002 resolution) allows violations to
      be logged but not blocked. Sensitive domains exempt from WARN phase.

    security_controls: [SEC-CTRL-FAC-0002]

    counterexamples_tested:
      - "Read outside allowlist" -> DENIED (in HARD_FAIL mode)
      - "Discovery attempt" -> SESSION_TERMINATED

    confidence: 0.89

  - boundary_id: TB-0003
    name: "Projection Isolation Boundary"
    status: VERIFIED_WITH_ENHANCEMENT
    enforcement_mechanism: ENHANCED

    crossing_rules_verification:
      - rule: "Admission reads internal projections only"
        enforcement: "Code architecture + Network policy"
        status: VERIFIED_WITH_ENHANCEMENT
        evidence:
          - "DD-FAC-0004 specifies projection model"
          - "F-SA3-004 resolution adds network-level enforcement"

      - rule: "Only adapter writes to GitHub"
        enforcement: "Policy enforcement"
        status: VERIFIED
        evidence:
          - "PROJECTION_WRITE_UNAUTHORIZED on violation"

      - rule: "Divergence triggers freeze"
        enforcement: "Watchdog poll + InterventionFreeze"
        status: VERIFIED
        evidence:
          - "SEC-CTRL-FAC-0003 divergence watchdog"
          - "EVID-FAC-0004 defines detection tests"

    enhancement: |
      F-SA3-004 resolution adds network-level policy blocking api.github.com:443
      for all admission-path holons. Only HOLON-GITHUB-ADAPTER has egress permission.

    security_controls: [SEC-CTRL-FAC-0003, SEC-CTRL-FAC-0009]

    counterexamples_tested:
      - "Admission holon reads GitHub" -> NETWORK_BLOCKED (with enhancement)
      - "Non-adapter writes GitHub" -> POLICY_DENIED
      - "External trunk modified" -> DETECTED, FREEZE

    confidence: 0.91

  - boundary_id: TB-0004
    name: "CI Evidence Import Boundary"
    status: VERIFIED
    enforcement_mechanism: COMPLETE

    crossing_rules_verification:
      - rule: "Webhook signature must be verified"
        enforcement: "CI_ATTESTATION_INVALID on failure"
        status: VERIFIED
        evidence:
          - "DD-FAC-0005 specifies attestation requirements"

      - rule: "Raw artifacts must be imported to CAS"
        enforcement: "CI_EVIDENCE_MISSING if bypassed"
        status: VERIFIED
        evidence:
          - "attestation_fields include downloaded_artifact_hashes"

      - rule: "Adapter attestation must be signed"
        enforcement: "Required for READY_FOR_REVIEW transition"
        status: VERIFIED
        evidence:
          - "CI_IMPORT_ATTESTATION domain separator defined"
          - "EVID-FAC-0006 defines attestation tests"

    security_controls: [SEC-CTRL-FAC-0005]

    counterexamples_tested:
      - "CI success without evidence" -> REJECTED (fail-closed)
      - "Unsigned attestation" -> REJECTED
      - "Missing artifact hashes" -> REJECTED

    confidence: 0.93

  - boundary_id: TB-0005
    name: "AAT Evidence Boundary"
    status: VERIFIED
    enforcement_mechanism: COMPLETE

    crossing_rules_verification:
      - rule: "Transcript chain must be complete"
        enforcement: "AAT_TRANSCRIPT_CHAIN_INVALID"
        status: VERIFIED
        evidence:
          - "DD-FAC-0006 specifies transcript binding"
          - "transcript_chain_root_hash required"

      - rule: "Terminal verifier outputs required"
        enforcement: "AAT_TERMINAL_VERIFIER_MISSING"
        status: VERIFIED
        evidence:
          - "DD-FAC-0007 specifies terminal verifier binding"

      - rule: "Machine predicate must be satisfied"
        enforcement: "AAT_TERMINAL_VERIFIER_MISMATCH"
        status: VERIFIED
        evidence:
          - "terminal_verifier_specs define predicates"
          - "EVID-FAC-0008 defines enforcement tests"

    security_controls: [SEC-CTRL-FAC-0006, SEC-CTRL-FAC-0008]

    counterexamples_tested:
      - "Narrative-only PASS" -> REJECTED
      - "Truncated transcript" -> DETECTED via run_count mismatch
      - "Failed predicate" -> REJECTED

    confidence: 0.95

  - boundary_id: TB-0006
    name: "Credential Isolation Boundary"
    status: VERIFIED
    enforcement_mechanism: COMPLETE

    crossing_rules_verification:
      - rule: "No ambient credential access"
        enforcement: "PolicyViolation and session quarantine"
        status: VERIFIED
        evidence:
          - "Tool policy allowlist enforced"

      - rule: "Adapter-only projection credentials"
        enforcement: "github.write only for adapter"
        status: VERIFIED
        evidence:
          - "Policy enforcement per holon class"

    security_controls: []

    counterexamples_tested:
      - "Agent accesses GitHub token" -> POLICY_VIOLATION
      - "Agent attempts SSH key access" -> QUARANTINE

    confidence: 0.92

  - boundary_id: TB-0007
    name: "AAT Executor Custody Boundary"
    status: VERIFIED_PENDING_POLICY
    enforcement_mechanism: PARTIAL

    crossing_rules_verification:
      - rule: "AAT executor keys in separate custody domain"
        enforcement: "KeyPolicy validation at lease issuance"
        status: PENDING_Q-RFC-FAC-0003
        evidence:
          - "COI policy rules defined but formal KeyPolicy undefined"

      - rule: "Custody group prevents self-AAT"
        enforcement: "UNAUTHORIZED_EXECUTOR on custody violation"
        status: PENDING_Q-RFC-FAC-0003
        evidence:
          - "Enforcement mechanism defined but policy artifact missing"

    pending_resolution: |
      Q-RFC-FAC-0003 (COI grouping policy) must be resolved before TB-0007
      enforcement is complete. Current enforcement is aspirational.

    security_controls: []

    counterexamples_tested:
      - "Author executes own AAT" -> WOULD_BE_REJECTED (when policy defined)

    confidence: 0.75

# =============================================================================
# ANTI-COUSIN VERDICT
# =============================================================================

anti_cousin_verdict:
  overall_status: "NO COUSIN ABSTRACTIONS DETECTED"
  confidence: 0.91

  component_analysis:
    - component: "Signature Infrastructure"
      risk: NONE
      rationale: |
        Domain separation (DD-FAC-0001) is a thin wrapper on existing Signer.
        sign_with_domain helper reuses existing Ed25519 infrastructure.
        No parallel signing implementation introduced.
      evidence:
        - "crates/apm2-core/src/crypto/sign.rs:36-114 reused"
        - "Domain separator is prefix, not new crypto scheme"

    - component: "Policy Engine"
      risk: MITIGATED
      rationale: |
        Context firewall extends PolicyEngine with manifest-aware rules (EP-3).
        ContextAwareValidator wraps existing Validator; does not duplicate.
        Firewall rules evaluated by existing rule evaluation engine.
      evidence:
        - "Q-RFC-FAC-0002 resolved: extend PolicyEngine"
        - "crates/apm2-core/src/tool/validation.rs extended"
      monitoring: |
        Ensure firewall.rs imports and extends PolicyEngine rather than
        creating parallel evaluation logic.

    - component: "Leases"
      risk: NONE
      rationale: |
        GateLease is specialized work lease with gate_id discriminator (EP-2).
        Uses existing LeaseReducer pattern and lease infrastructure.
        No parallel lease system created.
      evidence:
        - "crates/apm2-core/src/lease/ extended"
        - "GateLease follows existing lease schema pattern"

    - component: "Receipts"
      risk: NONE
      rationale: |
        AatGateReceipt is typed payload extension of existing GateReceipt.
        Uses existing GateReceiptGenerator infrastructure.
        No separate receipt system for AAT.
      evidence:
        - "DD-FAC-0006 specifies typed payload, not new event type"
        - "EP-4 extends crates/apm2-core/src/evidence/receipt.rs"

    - component: "CI Import"
      risk: MITIGATED
      rationale: |
        Extends CIWorkflowCompleted with attestation field rather than
        creating new CI event type. Attestation follows existing signature
        binding pattern.
      evidence:
        - "CI_IMPORT_ATTESTATION domain separator"
        - "Extends existing CI event structure"
      monitoring: |
        Ensure attestation uses existing Signer and does not introduce
        new signing mechanism for CI-specific operations.

    - component: "Projection"
      risk: NONE
      rationale: |
        Projection module is intentionally new; no existing equivalent.
        Placed in daemon/projection/ as separate holon capability.
        Uses existing event contract model.
      evidence:
        - "EP-7 creates new module (not extending existing)"
        - "No existing projection mechanism to duplicate"

    - component: "Terminal Verifiers"
      risk: LOW
      rationale: |
        Terminal verifier infrastructure is new (no existing equivalent).
        EP-5 creates crates/apm2-core/src/evidence/verifier.rs.
        May share patterns with policy engine but distinct purpose.
      monitoring: |
        During implementation, verify TerminalVerifier does not duplicate
        PolicyEngine rule evaluation. If similar, consider composing with
        existing PolicyEngine infrastructure.

    - component: "Transcript Handling"
      risk: MITIGATED
      rationale: |
        Q-RFC-FAC-0005 resolved: reuse TranscriptChunk from CAC module.
        AATTranscriptBinding wraps existing transcript infrastructure.
        80% reuse from crates/apm2-core/src/cac/pack_spec.rs.
      evidence:
        - "EXPLORE council resolution: reuse CAC TranscriptChunk"
        - "AATTranscriptBinding is wrapper, not parallel"

  v4_confirmation: |
    Anti-cousin analysis from v2 EXPLORE phase holds for v4:
    - All MITIGATED components have clear extension paths
    - No new cousin risks introduced during FINALIZE review
    - Terminal verifiers flagged as LOW risk with monitoring

    Recommendation: During implementation, ticket reviewers should verify
    anti-cousin commitments are maintained.

# =============================================================================
# CLAIM-ARGUMENT-EVIDENCE (CAE) TREE
# =============================================================================

cae_tree:
  top_claim:
    claim_id: TC-001
    statement: "FAC admission is impossible to spoof and every decision is replayable"
    confidence: 0.91
    status: STRONGLY_SUPPORTED

  sub_claims:
    - claim_id: SC-001
      statement: "Gate outcomes cannot be forged without valid authority"
      status: STRONGLY_SUPPORTED
      confidence: 0.94

      arguments:
        - argument_id: ARG-001-1
          statement: "Ed25519 signatures provide cryptographic non-repudiation"
          mode: 35  # Argumentation Framework
          structure: |
            PREMISE: GateRunCompleted requires Ed25519 signature (DD-FAC-0001)
            PREMISE: Domain separation prevents cross-context replay
            PREMISE: Signature binds (gate_id, lease_id, changeset_digest, executor_actor_id)
            CONCLUSION: Forgery requires private key compromise
            ATTACK: Key compromise during lease window
            DEFENSE: LeaseRevoked + short TTL (F-SA3-001)
            STATUS: UNDEFEATED (with defense)
          evidence:
            - evidence_id: EVID-SC001-1A
              type: DESIGN_ARTIFACT
              reference: "DD-FAC-0001"
              content: "Ed25519 domain-separated signatures for critical events"
            - evidence_id: EVID-SC001-1B
              type: TEST_SPEC
              reference: "EVID-FAC-0001"
              content: "Signature verification enforcement tests"

        - argument_id: ARG-001-2
          statement: "Lease scoping prevents authority escalation"
          mode: 65  # Deontic Reasoning
          structure: |
            OBLIGATION: Leases MUST have (work_id, gate_id, changeset_digest, expiry)
            OBLIGATION: Child leases MUST NOT broaden scope
            PROHIBITION: Executor MUST NOT sign for non-leased gates
            VERIFICATION: LEASE_SCOPE_BROADENED rejection on violation
            STATUS: OBLIGATIONS ENFORCEABLE
          evidence:
            - evidence_id: EVID-SC001-2A
              type: DESIGN_ARTIFACT
              reference: "DD-FAC-0002"
              content: "Lease-scoped gate authority with strict scope fields"
            - evidence_id: EVID-SC001-2B
              type: TEST_SPEC
              reference: "EVID-FAC-0002"
              content: "Lease scope and expiry enforcement tests"

    - claim_id: SC-002
      statement: "Context boundaries prevent information leakage during gate execution"
      status: SUPPORTED
      confidence: 0.89

      arguments:
        - argument_id: ARG-002-1
          statement: "OCAP firewall mechanically enforces context boundaries"
          mode: 8  # Counterexample-Guided
          structure: |
            CLAIM: No reads outside allowlist succeed
            COUNTEREXAMPLE ATTEMPT: Read file not in manifest
            RESULT: ToolDecided=DENY with CTX-ALLOWLIST-001
            COUNTEREXAMPLE ATTEMPT: Discovery via zoom/refinement
            RESULT: SessionTerminated rationale=CONTEXT_MISS
            BOUNDARY CASE: WARN phase allows logging without blocking
            DEFENSE: Reduced WARN to 7 days; sensitive domains exempt
            STATUS: CLAIM SURVIVES (with defense)
          evidence:
            - evidence_id: EVID-SC002-1A
              type: DESIGN_ARTIFACT
              reference: "DD-FAC-0003"
              content: "OCAP context firewall with manifest allowlist"
            - evidence_id: EVID-SC002-1B
              type: TEST_SPEC
              reference: "EVID-FAC-0003"
              content: "Context firewall enforcement tests"

    - claim_id: SC-003
      statement: "GitHub status cannot influence admission decisions"
      status: STRONGLY_SUPPORTED
      confidence: 0.91

      arguments:
        - argument_id: ARG-003-1
          statement: "Projection isolation prevents GitHub reads in admission path"
          mode: 80  # Adversarial/Red-Team
          structure: |
            ATTACK SCENARIO: Agent manipulates GitHub status to bypass gate
            DEFENSE LAYER 1: Architectural separation (no GitHub reads in admission)
            ATTACK ESCALATION: Insider modifies code to add GitHub reads
            DEFENSE LAYER 2: Network policy blocks api.github.com:443 (F-SA3-004)
            ATTACK ESCALATION: Insider disables network policy
            DEFENSE LAYER 3: Dual-control for infrastructure changes (CTRL-INS-001)
            STATUS: MULTI-LAYER DEFENSE; REQUIRES COLLUDING INSIDERS TO BYPASS
          evidence:
            - evidence_id: EVID-SC003-1A
              type: DESIGN_ARTIFACT
              reference: "DD-FAC-0004"
              content: "Projection-only GitHub with divergence watchdog"
            - evidence_id: EVID-SC003-1B
              type: SECURITY_CONTROL
              reference: "SEC-CTRL-FAC-0009"
              content: "Network policy for admission components"

        - argument_id: ARG-003-2
          statement: "Divergence detection provides fail-safe"
          mode: 49  # Robust/Worst-Case
          structure: |
            WORST CASE: External attacker force-pushes to trunk
            DETECTION: Watchdog detects within 30s
            RESPONSE: InterventionFreeze halts all admissions
            MARGIN: Detection guaranteed; prevention depends on branch protection
            CAVEAT: Q-RFC-FAC-0010 (branch protection contract) unresolved
          evidence:
            - evidence_id: EVID-SC003-2A
              type: SECURITY_CONTROL
              reference: "SEC-CTRL-FAC-0003"
              content: "Divergence watchdog with 30s poll interval"

    - claim_id: SC-004
      statement: "CI evidence is verified observation, not trusted input"
      status: STRONGLY_SUPPORTED
      confidence: 0.93

      arguments:
        - argument_id: ARG-004-1
          statement: "CI conclusions require evidence import and attestation"
          mode: 65  # Deontic Reasoning
          structure: |
            DEFAULT: CI_EVENTS_ENABLED=false (fail-closed)
            OBLIGATION: READY_FOR_REVIEW requires webhook signature verified
            OBLIGATION: Raw artifact digests MUST be imported to CAS
            OBLIGATION: Adapter attestation MUST be signed
            PROHIBITION: Plain 'success' conclusion MUST NOT transition
            STATUS: ALL OBLIGATIONS ENFORCEABLE
          evidence:
            - evidence_id: EVID-SC004-1A
              type: DESIGN_ARTIFACT
              reference: "DD-FAC-0005"
              content: "Evidence-backed CI import with attestation"
            - evidence_id: EVID-SC004-1B
              type: TEST_SPEC
              reference: "EVID-FAC-0006"
              content: "CI evidence import and attestation tests"

    - claim_id: SC-005
      statement: "AAT outcomes are evidence-bound and machine-verifiable"
      status: STRONGLY_SUPPORTED
      confidence: 0.95

      arguments:
        - argument_id: ARG-005-1
          statement: "Terminal verifiers provide ground truth for AAT PASS"
          mode: 35  # Argumentation Framework
          structure: |
            PREMISE: Narrative is explicitly non-authoritative (DD-FAC-0007)
            PREMISE: PASS requires terminal verifier outputs satisfying predicate
            PREMISE: Allowed verifiers: exit_code, snapshot_diff, test_report, invariant_check
            ATTACK: Agent produces compelling narrative without verifier evidence
            DEFENSE: AAT_TERMINAL_VERIFIER_MISSING rejection
            STATUS: UNDEFEATED
          evidence:
            - evidence_id: EVID-SC005-1A
              type: DESIGN_ARTIFACT
              reference: "DD-FAC-0007"
              content: "Terminal verifier binding for AAT"
            - evidence_id: EVID-SC005-1B
              type: SPEC
              reference: "terminal_verifier_specs"
              content: "exit_code==0, failed_count==0, etc."

        - argument_id: ARG-005-2
          statement: "Evidence chain is complete and replay-safe"
          mode: 8  # Counterexample-Guided
          structure: |
            CLAIM: All AAT runs are bound to receipt
            COUNTEREXAMPLE ATTEMPT: Truncate transcript to hide failures
            RESULT: transcript_chain_root_hash mismatch
            COUNTEREXAMPLE ATTEMPT: Claim fewer runs than executed
            RESULT: run_count mismatch with run_receipt_hashes
            STATUS: CLAIM SURVIVES
          evidence:
            - evidence_id: EVID-SC005-2A
              type: DESIGN_ARTIFACT
              reference: "DD-FAC-0006"
              content: "Typed AAT GateReceipt payloads"
            - evidence_id: EVID-SC005-2B
              type: TEST_SPEC
              reference: "EVID-FAC-0007"
              content: "Typed AAT GateReceipt validation tests"

    - claim_id: SC-006
      statement: "Anti-downgrade enforcement prevents policy weakening"
      status: SUPPORTED
      confidence: 0.90

      arguments:
        - argument_id: ARG-006-1
          statement: "Policy resolution is pinned at ingestion and immutable"
          mode: 49  # Robust/Worst-Case
          structure: |
            WORST CASE: Attacker attempts "easier exam" by selecting weaker policy
            DEFENSE: resolved_policy_hash pinned at FAC-00 ingestion
            DEFENSE: risk_tier, determinism_class, verifier_policy_hash immutable
            ENFORCEMENT: Admission rejects on mismatch
            ESCAPE HATCH: Explicit waiver with AUTH_SECURITY approval
            MARGIN: No silent downgrade possible; audit trail for waivers
          evidence:
            - evidence_id: EVID-SC006-1A
              type: DESIGN_ARTIFACT
              reference: "DD-FAC-0009"
              content: "AAT anti-downgrade enforcement"
            - evidence_id: EVID-SC006-1B
              type: TEST_SPEC
              reference: "EVID-FAC-0014"
              content: "AAT anti-downgrade enforcement tests"

    - claim_id: SC-007
      statement: "Insider threats are mitigated through compensating controls"
      status: SUPPORTED
      confidence: 0.85

      arguments:
        - argument_id: ARG-007-1
          statement: "Dual-control prevents unilateral insider actions"
          mode: 80  # Adversarial/Red-Team
          structure: |
            ATTACK: Insider backdoors signature verification
            DEFENSE: 2 reviewers from different org units required (CTRL-INS-001)
            ATTACK ESCALATION: Insider colludes with reviewer
            DEFENSE: Reviewers from DIFFERENT org units reduces collusion
            RESIDUAL: Sophisticated collusion remains possible
          evidence:
            - evidence_id: EVID-SC007-1A
              type: SECURITY_CONTROL
              reference: "CTRL-INS-001"
              content: "Dual-control for critical code changes"

        - argument_id: ARG-007-2
          statement: "Audit logging enables detection of insider activity"
          mode: 65  # Deontic Reasoning
          structure: |
            OBLIGATION: All privileged operations MUST be logged
            OBLIGATION: Logs MUST be hash-chained (tamper-evident)
            OBLIGATION: Logs MUST be replicated to separate trust domain
            ENFORCEMENT: Log integrity verified on query
            STATUS: OBLIGATIONS SPECIFIED
          evidence:
            - evidence_id: EVID-SC007-2A
              type: SECURITY_CONTROL
              reference: "CTRL-INS-002"
              content: "Tamper-evident audit logging"

    - claim_id: SC-008
      statement: "COI enforcement prevents self-review"
      status: CONDITIONALLY_SUPPORTED
      confidence: 0.75
      condition: "Q-RFC-FAC-0003 resolution"

      arguments:
        - argument_id: ARG-008-1
          statement: "Custody domain separation prevents author as AAT executor"
          mode: 65  # Deontic Reasoning
          structure: |
            OBLIGATION: Executor of required gate MUST NOT be author
            OBLIGATION: Keys in same COI group treated as same actor
            PENDING: Formal KeyPolicy artifact definition
            ENFORCEMENT: COI check at lease issuance (when policy defined)
            STATUS: OBLIGATIONS DEFINED BUT NOT YET ENFORCEABLE
          evidence:
            - evidence_id: EVID-SC008-1A
              type: DESIGN_ARTIFACT
              reference: "03_trust_boundaries.yaml#coi_policy"
              content: "COI policy rules defined"
            - evidence_id: EVID-SC008-1B
              type: OPEN_QUESTION
              reference: "Q-RFC-FAC-0003"
              content: "Formal COI grouping policy and KeyPolicy artifact definition"

# =============================================================================
# OPEN QUESTIONS AFFECTING SECURITY
# =============================================================================

open_questions_security_impact:
  - question_id: Q-RFC-FAC-0003
    question: "Formal COI grouping policy and KeyPolicy artifact definition"
    security_impact: HIGH
    affected_boundaries: [TB-0007]
    status: UNRESOLVED

    impact_analysis: |
      Without formal KeyPolicy artifact, COI enforcement (TB-0007) cannot be
      mechanically verified. Custody domain separation is aspirational only.
      Author could potentially execute their own AAT if custody groups undefined.

    required_for_v4: true

    resolution_criteria: |
      1. KeyPolicy schema defined with custody_domain field
      2. custody_domain assignment rules documented
      3. COI check implemented at lease issuance
      4. Tests verify custody domain separation

  - question_id: Q-RFC-FAC-0010
    question: "GitHub branch protection contract"
    security_impact: MEDIUM
    affected_boundaries: [TB-0003]
    status: UNRESOLVED

    impact_analysis: |
      Without documented branch protection contract, external merge paths may
      bypass FAC admission. Divergence watchdog detects but does not prevent.
      Admin bypass audit is undefined.

    required_for_v4: false

    resolution_criteria: |
      1. Required branch protection settings documented
      2. Adapter validates settings on startup
      3. Admin bypass audit procedure defined

# =============================================================================
# CONFIDENCE ASSESSMENT
# =============================================================================

confidence_assessment:
  overall_confidence: 0.91

  confidence_by_claim:
    SC-001: 0.94  # Gate forgery prevention
    SC-002: 0.89  # Context boundaries
    SC-003: 0.91  # GitHub isolation
    SC-004: 0.93  # CI evidence verification
    SC-005: 0.95  # AAT evidence binding
    SC-006: 0.90  # Anti-downgrade
    SC-007: 0.85  # Insider mitigation
    SC-008: 0.75  # COI enforcement (pending Q-RFC-FAC-0003)

  confidence_factors:
    positive:
      - factor: "Strong cryptographic foundation (Ed25519, BLAKE3)"
        weight: +0.10
      - factor: "Multi-layer defense for projection isolation"
        weight: +0.05
      - factor: "Terminal verifier binding explicit and tested"
        weight: +0.08
      - factor: "Fail-closed defaults throughout"
        weight: +0.05
      - factor: "Anti-cousin analysis confirms no duplication"
        weight: +0.03

    negative:
      - factor: "Q-RFC-FAC-0003 unresolved (COI policy)"
        weight: -0.08
      - factor: "Insider threat mitigation is procedural not mechanical"
        weight: -0.05
      - factor: "WARN phase window for context violations"
        weight: -0.03
      - factor: "Branch protection contract undefined"
        weight: -0.02

  bayesian_update: |
    Prior (v2 EXPLORE): P(Secure) = 0.82
    Evidence updates:
    - F-SA3-001 resolution (LeaseRevoked): +0.03
    - F-SA3-002 resolution (WARN reduction): +0.02
    - F-SA3-004 resolution (network policy): +0.04
    - F-SA3-012 resolution (insider model): +0.05
    - Q-RFC-FAC-0003 still unresolved: -0.05
    Posterior: P(Secure) = 0.91

# =============================================================================
# DISPOSITION
# =============================================================================

disposition:
  recommendation: APPROVE_WITH_CONDITIONS
  confidence: 0.91

  conditions:
    - condition_id: COND-001
      requirement: "Resolve Q-RFC-FAC-0003 before PHASE-1 gate"
      severity: BLOCKING_FOR_PHASE_1
      rationale: |
        COI enforcement (TB-0007) cannot be verified without formal KeyPolicy.
        Self-review attack vector remains open until resolved.

    - condition_id: COND-002
      requirement: "Implement LeaseRevoked event per F-SA3-001"
      severity: BLOCKING_FOR_PHASE_1
      rationale: |
        Key compromise window exploitation remains possible without revocation.

    - condition_id: COND-003
      requirement: "Implement network policy per F-SA3-004"
      severity: BLOCKING_FOR_PHASE_1
      rationale: |
        TB-0003 runtime enforcement incomplete without network-level policy.

  rationale: |
    RFC-0015 FINALIZE security review demonstrates:

    1. ALL MAJOR findings (F-SA3-001, F-SA3-004, F-SA3-012) have RESOLUTIONS
       - LeaseRevoked event with short TTL
       - Network policy for projection isolation
       - ADV-0005 insider threat model with compensating controls

    2. ALL trust boundaries have VERIFICATION STATUS
       - TB-0001 through TB-0006: VERIFIED
       - TB-0007: VERIFIED_PENDING_POLICY (Q-RFC-FAC-0003)

    3. CAE TREE supports top claim with 8 sub-claims
       - 5 STRONGLY_SUPPORTED
       - 2 SUPPORTED
       - 1 CONDITIONALLY_SUPPORTED (pending Q-RFC-FAC-0003)

    4. ANTI-COUSIN analysis confirms NO duplication
       - All components extend existing infrastructure
       - Terminal verifiers flagged for implementation monitoring

    5. Bayesian confidence updated from 0.82 (v2) to 0.91 (v4)

  advisory_notes:
    - "Reduce WARN phase to 7 days per F-SA3-002"
    - "Document branch protection contract for Q-RFC-FAC-0010 before PHASE-2"
    - "Consider formal verification for kernel code in future phases"
    - "Monitor terminal verifier implementation for cousin patterns"

  cae_tree_summary: |
    TOP CLAIM: "FAC admission is impossible to spoof" - STRONGLY_SUPPORTED (0.91)

    SUB-CLAIMS:
    - SC-001 Gate Forgery Prevention: STRONGLY_SUPPORTED (0.94)
    - SC-002 Context Boundaries: SUPPORTED (0.89)
    - SC-003 GitHub Isolation: STRONGLY_SUPPORTED (0.91)
    - SC-004 CI Evidence Verification: STRONGLY_SUPPORTED (0.93)
    - SC-005 AAT Evidence Binding: STRONGLY_SUPPORTED (0.95)
    - SC-006 Anti-Downgrade: SUPPORTED (0.90)
    - SC-007 Insider Mitigation: SUPPORTED (0.85)
    - SC-008 COI Enforcement: CONDITIONALLY_SUPPORTED (0.75)

    All sub-claims have supporting arguments with evidence references.
    One conditional gap (Q-RFC-FAC-0003) identified with blocking condition.

# =============================================================================
# GATE RESULTS SUMMARY
# =============================================================================

gate_results:
  - gate_id: GATE-TCK-SECURITY-AND-INTEGRITY
    status: PASS_WITH_CONDITIONS
    confidence: 0.91
    blocking_issues: 0
    conditional_issues: 3
    advisory_issues: 2

  - gate_id: GATE-TCK-ANTI-COUSIN
    status: PASS
    confidence: 0.91
    blocking_issues: 0
    advisory_issues: 1

overall_status: APPROVE_WITH_CONDITIONS
next_action: "Proceed to v4 with conditions; resolve Q-RFC-FAC-0003 before PHASE-1"
