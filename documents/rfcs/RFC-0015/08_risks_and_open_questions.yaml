rfc_risks_and_open_questions:
  schema_version: "2026-01-29"

  # CRITICAL: This file lists all "Known Unknowns" for v0 (Discovery) phase
  # These must be resolved or explicitly deferred during EXPLORE (v2) and FINALIZE (v4) phases

  risks:
    - id: RSK-RFC-FAC-0001
      statement: "Context firewall adoption friction causes agent failures during transition"
      impact: |
        Agents accustomed to broad file access fail frequently under OCAP containment;
        perceived as regression blocking productivity.
      likelihood: HIGH
      mitigations:
        - "Graduated rollout with warn-only phase before hard enforcement"
        - "Treat context misses as compiler defects; prioritize pack completeness fixes"
        - "Provide clear error messages with ContextRefinementRequest guidance"
        - "Monitor CONTEXT_MISS and CONTEXT_FIREWALL_DENY defect rates"
      related_prd_risk: RSK-FAC-0001
      status: ACCEPTED

    - id: RSK-RFC-FAC-0002
      statement: "Projection divergence false positives cause unnecessary factory freezes"
      impact: |
        Legitimate external changes (admin hotfixes) trigger PROJECTION_DIVERGENCE and
        InterventionFreeze, blocking all admissions until manual recovery.
      likelihood: MEDIUM
      mitigations:
        - "Document expected divergence scenarios and pre-authorize via emergency override"
        - "Implement grace period and re-check before triggering freeze"
        - "Provide expedited AdjudicationRequested(EMERGENCY_RECOVERY) path"
      related_prd_risk: RSK-FAC-0002
      status: ACCEPTED

    - id: RSK-RFC-FAC-0003
      statement: "Key management complexity leads to operational failures"
      impact: |
        Ed25519 key rotation, custody grouping, and COI enforcement add operational burden;
        misconfiguration could allow unauthorized signing or block legitimate actors.
      likelihood: MEDIUM
      mitigations:
        - "Define clear KeyPolicy artifact under CAC governance"
        - "Automate key rotation with KeyRotated event chain-of-custody"
        - "Provide tooling to audit key bindings and custody domains"
      related_prd_risk: RSK-FAC-0003
      status: ACCEPTED

    - id: RSK-RFC-FAC-0004
      statement: "AAT evidence binding increases implementation complexity"
      impact: |
        Transcript chain hashing, artifact digests, and attestation binding add significant
        implementation complexity and potential for validation bugs.
      likelihood: MEDIUM
      mitigations:
        - "Use chunked hashing with streaming digests"
        - "Define clear schema validation at each stage"
        - "Extensive property-based testing for evidence invariants"
      related_prd_risk: RSK-FAC-0008
      status: ACCEPTED

    - id: RSK-RFC-FAC-0005
      statement: "Terminal verifier policy drift causes false PASS or blocking"
      impact: |
        If verifier predicates become lax, AAT becomes spoofable; if too strict,
        AAT blocks safe refactors.
      likelihood: MEDIUM
      mitigations:
        - "Version verifier policies with policy_hash"
        - "Use holdout suites to detect false negatives (Phase 2)"
        - "Require invariants-first specs"
      related_prd_risk: RSK-FAC-0009
      status: ACCEPTED

  open_questions:
    # These are "Known Unknowns" that must be resolved during EXPLORE and FINALIZE phases

    - id: Q-RFC-FAC-0001
      question: |
        Canonical proto placement for new gate/projection/intervention events:
        extend kernel_events.proto with GateEvent and ProjectionEvent payloads
        vs create new fac_events.proto?
      decision_needed_by: "v2 (EXPLORE phase)"
      resolution_plan: |
        During EXPLORE phase, examine existing proto structure in proto/kernel_events.proto
        and determine if extension is feasible without breaking existing event handling.
        Prefer typed payload extension if existing event families support it.
      status: RESOLVED
      resolution: |
        EXTEND kernel_events.proto. Council SA-1 analysis confirmed proto uses oneof payload
        pattern with 8 existing event families. GateLease extends LeaseEvent oneof (tag 6);
        GateRunCompleted and MergeReceipt extend EvidenceEvent oneof (tags 3, 4).
        Evidence: proto/kernel_events.proto:43-54 shows extensible structure.
        Creating fac_events.proto would create architectural asymmetry and add maintenance burden.
      resolved_by: COUNCIL-RFC-0015-EXPLORE-20260129
      resolved_date: "2026-01-29"
      confidence: HIGH
      blocking_tickets:
        - TG-FAC-001
      related_prd_question: Q-FAC-0001

    - id: Q-RFC-FAC-0002
      question: |
        Context firewall integration point: daemon protocol layer or core library?
        Should the firewall be in apm2-daemon/src/protocol/ or apm2-core/src/context/?
      decision_needed_by: "v2 (EXPLORE phase)"
      resolution_plan: |
        During EXPLORE phase, examine existing tool mediation path and determine where
        ContextPackManifest allowlist checking can be most cleanly integrated.
      status: RESOLVED
      resolution: |
        CORE LIBRARY via ContextAwareValidator middleware at tool validation layer.
        Council SA-2 analysis evaluated 3 options:
        - Option A (Protocol Layer): Single point but couples layers - 0.65 probability
        - Option B (Tool Handlers): Late binding, scattered logic - 0.45 probability
        - Option C (Validator Middleware): Non-breaking, composable, testable - 0.75 probability

        Selected Option C: Create ContextAwareValidator trait in crates/apm2-core/src/tool/
        that wraps existing Validator with manifest checking. Integration point:
        crates/apm2-core/src/tool/mod.rs:66-75. Emit ToolDecided=DENY with rule_id
        "CTX-ALLOWLIST-001" on manifest miss.
      resolved_by: COUNCIL-RFC-0015-EXPLORE-20260129
      resolved_date: "2026-01-29"
      confidence: HIGH
      blocking_tickets:
        - TG-FAC-002

    - id: Q-RFC-FAC-0003
      question: |
        Formal COI grouping policy and KeyPolicy artifact definition:
        How should custody domains be defined and validated?
      decision_needed_by: "v2 (EXPLORE phase)"
      resolution_plan: |
        During EXPLORE phase, examine existing KeyManager implementation and define
        KeyPolicy schema with custody domain grouping. Implement COI validation in
        lease issuance path.
      status: UNRESOLVED
      blocking_tickets:
        - TG-FAC-001
      related_prd_question: Q-FAC-0003

    - id: Q-RFC-FAC-0004
      question: |
        How to obtain stable runner image digests from hosted CI for L1+ attestation?
        May require self-hosted runners for full attestation.
      decision_needed_by: "v4 (FINALIZE phase)"
      resolution_plan: |
        Survey hosted CI providers for environment attestation capabilities.
        Document self-hosted runner requirements for L1+. Define fallback policy
        for hosted runners with explicit attestation level documentation.
      status: UNRESOLVED
      blocking_tickets:
        - TG-FAC-004
      related_prd_question: Q-FAC-0004

    - id: Q-RFC-FAC-0005
      question: |
        AAT transcript schema: should we use existing TranscriptChunk from CAC
        or define new FAC-specific transcript types?
      decision_needed_by: "v2 (EXPLORE phase)"
      resolution_plan: |
        During EXPLORE phase, examine existing transcript handling in PRD-0007 CAC
        implementation and determine if existing types can be reused or extended.
      status: RESOLVED
      resolution: |
        REUSE TranscriptChunk from CAC module with FAC-specific wrapper.
        Council SA-2 analysis confirmed CAC module already handles transcript chunking
        with streaming hashing. Create AATTranscriptBinding wrapper:
        ```rust
        pub struct AATTranscriptBinding {
            pub transcript_chunks: Vec<TranscriptChunk>,  // Imported from CAC
            pub transcript_chain_root_hash: Hash,
            pub run_transcript_hashes: Vec<Hash>,
        }
        ```
        Reuse rate >= 80% from existing crates/apm2-core/src/cac/pack_spec.rs.
        Avoids duplication, maintains PRD-0007 conformance.
      resolved_by: COUNCIL-RFC-0015-EXPLORE-20260129
      resolved_date: "2026-01-29"
      confidence: MEDIUM
      blocking_tickets:
        - TG-FAC-005

    - id: Q-RFC-FAC-0006
      question: |
        Determinism envelope run count by risk tier: what is N for stability checks
        by risk tier, and when should deterministic enforcement expand beyond AAT?
      decision_needed_by: "v4 (FINALIZE phase)"
      resolution_plan: |
        Start with N=3 for AAT in T3 (HIGH risk); evaluate throughput impact and expand
        to other gates only after stability and cost metrics meet targets.
      status: UNRESOLVED
      blocking_tickets:
        - TG-FAC-007
      related_prd_question: Q-FAC-0006

    - id: Q-RFC-FAC-0007
      question: |
        Risk tier classification model: which signals (diff scope, module criticality,
        policy profile) determine HIGH/MED/LOW for AAT selection?
      decision_needed_by: "v4 (FINALIZE phase)"
      resolution_plan: |
        Start with policy-defined critical domains (auth/crypto/ledger/tool mediation)
        and expand with impact expansion heuristics; revise based on escape-rate metrics.
      status: UNRESOLVED
      blocking_tickets:
        - TG-FAC-006
      related_prd_question: Q-FAC-0008

    - id: Q-RFC-FAC-0008
      question: |
        Where should policy resolution be recorded (PolicyResolved event vs embedded
        in FAC-00 run receipt)?
      decision_needed_by: "v2 (EXPLORE phase)"
      resolution_plan: |
        During EXPLORE phase, examine existing policy handling and determine canonical
        location for resolved_policy_hash and policy tuple.
      status: RESOLVED
      resolution: |
        EMBEDDED in FAC-00 changeset ingestion event (ChangeSetIngested).
        SA-1 analysis: Policy resolution is part of FAC-00 stage outputs. Include
        resolved_policy_hash, resolved_risk_tier, resolved_determinism_class as
        fields in ChangeSetIngested event payload. This binds policy to changeset
        before any gate execution (CON-FAC-003: CAS-at-commit ordering).
        Evidence: Policy pinning follows DD-FAC-0009 anti-downgrade design.
      resolved_by: COUNCIL-RFC-0015-EXPLORE-20260129
      resolved_date: "2026-01-29"
      confidence: MEDIUM
      blocking_tickets:
        - TG-FAC-001
      related_prd_question: Q-FAC-0009

    - id: Q-RFC-FAC-0009
      question: |
        Should AAT reuse be allowed for LOW risk only, or for MED with explicit waiver?
      decision_needed_by: "v4 (FINALIZE phase)"
      resolution_plan: |
        Start with LOW-only reuse; expand based on cache integrity metrics and
        escape rate. MED reuse may require explicit waiver and audit.
      status: UNRESOLVED
      blocking_tickets:
        - TG-FAC-008
      related_prd_question: Q-FAC-0010

    - id: Q-RFC-FAC-0010
      question: |
        GitHub branch protection contract: exact settings required to ensure external
        merge paths cannot bypass FAC admission?
      decision_needed_by: "v4 (FINALIZE phase)"
      resolution_plan: |
        Document required GitHub branch protection settings. Codify in adapter
        handshake and validate on startup. Define audit for administrator bypass.
      status: UNRESOLVED
      blocking_tickets:
        - TG-FAC-003
      related_prd_question: Q-FAC-0005

  codebase_discovery_needs:
    # Specific codebase exploration needed during EXPLORE phase

    - id: DISCOVERY-FAC-0001
      area: "Proto Event Structure"
      question: "How are kernel events currently structured? Can we extend existing event families?"
      files_to_examine:
        - "proto/kernel_events.proto"
        - "crates/apm2-core/src/ledger/"
      affects_decisions:
        - DD-FAC-0001
        - DD-FAC-0002

    - id: DISCOVERY-FAC-0002
      area: "Tool Mediation Path"
      question: "Where is tool execution mediated? Where should context firewall integrate?"
      files_to_examine:
        - "crates/apm2-daemon/src/protocol/"
        - "crates/apm2-daemon/src/session/"
        - "crates/apm2-core/src/tool/"
      affects_decisions:
        - DD-FAC-0003

    - id: DISCOVERY-FAC-0003
      area: "Existing Signature Infrastructure"
      question: "How are signatures currently used? Can we reuse Ed25519 Signer?"
      files_to_examine:
        - "crates/apm2-core/src/crypto/sign.rs"
        - "crates/apm2-core/src/crypto/keys.rs"
      affects_decisions:
        - DD-FAC-0001

    - id: DISCOVERY-FAC-0004
      area: "Lease Implementation"
      question: "How are leases currently implemented? Can we extend for gate leases?"
      files_to_examine:
        - "crates/apm2-core/src/lease/"
        - "crates/apm2-daemon/src/session/"
      affects_decisions:
        - DD-FAC-0002

    - id: DISCOVERY-FAC-0005
      area: "GitHub Adapter"
      question: "How is GitHub integration currently implemented? Where is projection logic?"
      files_to_examine:
        - "crates/apm2-daemon/src/github/"
        - "crates/apm2-daemon/src/adapter/"
      affects_decisions:
        - DD-FAC-0004

    - id: DISCOVERY-FAC-0006
      area: "Context Pack Handling"
      question: "How are ContextPacks used? Where is manifest allowlist checked?"
      files_to_examine:
        - "crates/apm2-core/src/context/"
        - "crates/apm2-daemon/src/protocol/"
      affects_decisions:
        - DD-FAC-0003

    - id: DISCOVERY-FAC-0007
      area: "Transcript and Evidence"
      question: "How are transcripts and evidence currently handled? Can we extend for AAT?"
      files_to_examine:
        - "crates/apm2-core/src/evidence/"
        - "crates/apm2-core/src/transcript/"
      affects_decisions:
        - DD-FAC-0006
        - DD-FAC-0007

  council_discovered_findings:
    session_id: COUNCIL-RFC-0015-20260129-130000
    timestamp: "2026-01-29T13:00:00Z"
    verdict: APPROVED_WITH_REMEDIATION

    blocker_findings:
      - id: SA2-RFC0015-F001
        source_agent: SA-2
        source_mode: 11  # Bayesian
        title: "GateLease Schema Incompatible with Existing LeaseIssued Event"
        description: |
          RFC specifies GateLease with gate_id, changeset_digest, executor_actor_id, policy_hash
          and AAT extensions. Existing LeaseIssued has different fields. Bayesian probability
          of clean extension is ~0.25. Requires explicit proto placement decision.
        resolution_action: "Resolve Q-RFC-FAC-0001 as first EXPLORE task"
        blocks: [TG-FAC-001]

      - id: SA2-RFC0015-F002
        source_agent: SA-2
        source_mode: 44  # Means-End
        title: "OCAP Context Firewall Integration Point Unresolved"
        description: |
          No existing firewall infrastructure for content-hash validation at file read time.
          CapabilityManifest has OCAP patterns but scope differs from RCP manifest allowlist.
          Neither existing option provides clean path.
        resolution_action: "Resolve Q-RFC-FAC-0002 during EXPLORE"
        blocks: [TG-FAC-002]

      - id: F-SA3-008
        source_agent: SA-3
        source_mode: 65  # Deontic
        title: "Open Question Q-FAC-0003 Blocks COI Enforcement"
        description: |
          Formal COI grouping policy and KeyPolicy artifact definition not specified.
          The obligation "Executor must not be author" cannot be enforced without
          formal definition of how keys map to actors/COI groups.
        resolution_action: "Resolve Q-RFC-FAC-0003 before Phase 1 completion"
        blocks: [TG-FAC-001, TB-0007]

    major_security_findings:
      - id: F-SA3-001
        source_agent: SA-3
        source_mode: 8  # Counterexample-Guided
        title: "Lease Revocation Mechanism Not Specified"
        description: |
          If executor key is compromised mid-lease, there is no way to invalidate
          the lease before expiry. Adversary can issue valid GateRunCompleted.
        recommendation: "Add LeaseRevoked event type; consider short lease TTLs"
        phase_to_resolve: EXPLORE

      - id: F-SA3-002
        source_agent: SA-3
        source_mode: 49  # Robust/Worst-Case
        title: "Context Firewall WARN Mode Security Gap"
        description: |
          During FAC-R-01 (14 days WARN mode), context violations logged but not enforced.
          Malicious agent can exfiltrate data during this window.
        recommendation: "Shorter WARN window (7 days max); scope limitation for WARN mode"
        phase_to_resolve: FINALIZE

      - id: F-SA3-004
        source_agent: SA-3
        source_mode: 80  # Adversarial/Red-Team
        title: "Projection Read Path Enforcement Not Runtime-Verified"
        description: |
          TB-0003 enforcement is 'code architecture' only. Code modification could inject
          GitHub status reads without runtime detection.
        recommendation: "Add runtime policy enforcement; consider network-level isolation"
        phase_to_resolve: EXPLORE

      - id: F-SA3-012
        source_agent: SA-3
        source_mode: 80  # Adversarial/Red-Team
        title: "Adversary ADV-0005 (Insider) Not Modeled"
        description: |
          Threat model does not cover malicious insider with kernel or coordinator access.
          No compensating controls for insider threat documented.
        recommendation: "Add ADV-0005 to threat model; consider dual-control for kernel ops"
        phase_to_resolve: EXPLORE

    implementation_findings:
      - id: SA2-RFC0015-F003
        source_agent: SA-2
        source_mode: 53  # Heuristic
        title: "Terminal Verifier Enforcement Has No Existing Pattern"
        description: |
          No existing terminal verifier infrastructure. Requires entirely new:
          TerminalVerifier trait, VerifierPolicy schema, predicate evaluation engine.
        estimated_additional_tickets: 2-3
        phase_to_resolve: EXPLORE

      - id: SA2-RFC0015-F005
        source_agent: SA-2
        source_mode: 29  # Supervaluationism
        title: "Domain Separator Prefix Format Underdetermined"
        description: |
          Multiple valid interpretations for domain separation: concat vs length-prefix.
          Without precise specification, independent implementations may diverge.
        recommendation: "Create domain_separator.rs module specification before implementation"
        phase_to_resolve: EXPLORE

      - id: SA2-RFC0015-F010
        source_agent: SA-2
        source_mode: 76  # Calibration
        title: "Ticket Group Estimates Appear Low by 30-50%"
        description: |
          Historical calibration shows initial security-critical estimates are typically
          30-50% low due to testing and edge case handling.
        recommendation: "Apply 1.4x multiplier to ticket estimates during DECOMPOSE"
        affects: ALL_TICKET_GROUPS

    positive_findings:
      - id: SA1-RFC0015-v0-008
        source_agent: SA-1
        source_mode: 17  # Inductive Generalization
        title: "Protocol stages generalize well from existing patterns"
        assessment: "7 protocol stages (FAC-00 through FAC-06) follow established patterns"

      - id: SA1-RFC0015-v0-009
        source_agent: SA-1
        source_mode: 42  # Root Cause Analysis
        title: "All failure modes have explicit mitigations"
        assessment: "All 5 failure modes have corresponding solutions in design decisions"

    next_phase_guidance:
      phase: EXPLORE
      priority_order:
        - "P0: Resolve Q-RFC-FAC-0001 (proto placement) - blocks all ticket groups"
        - "P0: Resolve Q-RFC-FAC-0002 (context firewall integration)"
        - "P0: Resolve Q-RFC-FAC-0003 (COI grouping policy)"
        - "P1: Complete component mapping for all 21 requirements"
        - "P1: Add lease revocation mechanism to DD-FAC-0002"
        - "P1: Specify domain separator format precisely"
        - "P2: Add ADV-0005 (insider threat) to threat model"
