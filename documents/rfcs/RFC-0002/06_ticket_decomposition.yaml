rfc_ticket_decomposition:
  schema_version: "2026-01-24"
  template_version: "2026-01-24"
  principles:
  - "Tickets are atomic and independently verifiable"
  - "Shared utilities implemented before commands that depend on them"
  - "Commands ordered from simplest to most complex for incremental validation"
  - "Final cleanup ticket depends on all command implementations"
  ticket_plan:
    ticket_storage_root: "documents/work/tickets/"
    tickets:
    # =================================================================
    # PHASE 1: Infrastructure
    # =================================================================
    - ticket_id: TCK-00026
      title: "Create xtask crate structure"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00026.yaml#ticket_meta"
      scope:
        in_scope:
        - "Add xshell to workspace Cargo.toml dependencies"
        - "Add xtask to workspace members"
        - "Create xtask/Cargo.toml with dependencies"
        - "Create xtask/src/main.rs with clap CLI structure"
        - "Create xtask/src/tasks/mod.rs module"
        - "Stub subcommands: start-ticket, commit, push, check, finish"
        out_of_scope:
        - "Command implementations (later tickets)"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies: []
      definition_of_done:
        criteria:
        - "cargo build -p xtask compiles successfully"
        - "cargo xtask --help shows all subcommands"
        - "Each subcommand prints 'not implemented' placeholder"
        evidence_ids: []

    - ticket_id: TCK-00027
      title: "Implement shared utilities"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00027.yaml#ticket_meta"
      scope:
        in_scope:
        - "Create xtask/src/util.rs module"
        - "Implement validate_ticket_branch() - regex validation, extract RFC_ID and TICKET_ID"
        - "Implement main_worktree() - find main worktree path from any worktree"
        - "Implement ticket_yaml_path() - construct path to ticket YAML file"
        - "Unit tests for all utility functions"
        out_of_scope:
        - "Command implementations"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies:
      - TCK-00026
      definition_of_done:
        criteria:
        - "validate_ticket_branch parses RFC-XXXX/TCK-XXXXX branches correctly"
        - "validate_ticket_branch returns error for invalid branch names"
        - "main_worktree finds main worktree from any location"
        - "ticket_yaml_path constructs correct path"
        - "All utility functions have unit tests"
        evidence_ids: []

    # =================================================================
    # PHASE 2: Command Implementations (ordered by complexity)
    # =================================================================
    - ticket_id: TCK-00028
      title: "Implement finish command"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00028.yaml#ticket_meta"
      scope:
        in_scope:
        - "Validate current branch is a ticket branch"
        - "Check PR is merged via gh CLI"
        - "Remove worktree with git worktree remove"
        - "Delete local branch"
        - "Error handling with helpful messages"
        out_of_scope:
        - "Remote branch deletion (optional, warn only)"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies:
      - TCK-00027
      definition_of_done:
        criteria:
        - "Command validates it is run from a ticket worktree"
        - "Command checks PR merge status before cleanup"
        - "Worktree and local branch removed successfully"
        - "Clear error message if PR not merged"
        - "Feature parity with finish-eng-ticket.sh"
        evidence_ids: []

    - ticket_id: TCK-00029
      title: "Implement check command"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00029.yaml#ticket_meta"
      scope:
        in_scope:
        - "Validate current branch is a ticket branch"
        - "Parse ticket YAML for status"
        - "Check gh pr status"
        - "Check gh pr checks"
        - "Display review status (requested, completed)"
        - "State file handling for tracking reviews"
        out_of_scope:
        - "Modifying ticket status"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies:
      - TCK-00027
      definition_of_done:
        criteria:
        - "Command displays ticket status from YAML"
        - "Command shows PR status (open, merged, checks)"
        - "Command shows review status"
        - "JSON output structured for parsing"
        - "Feature parity with check-eng-ticket.sh"
        evidence_ids: []

    - ticket_id: TCK-00030
      title: "Implement start-ticket command"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00030.yaml#ticket_meta"
      scope:
        in_scope:
        - "Accept RFC_ID argument"
        - "Find next pending ticket in RFC ticket decomposition"
        - "Parse ticket YAML to extract metadata"
        - "Create worktree with git worktree add"
        - "Create branch named RFC-XXXX/TCK-YYYYY"
        - "Print instructions for developer"
        out_of_scope:
        - "Automatic PR creation"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies:
      - TCK-00027
      definition_of_done:
        criteria:
        - "Command finds next ticket by reading RFC tickets YAML"
        - "Command creates worktree in correct location"
        - "Branch naming follows RFC-XXXX/TCK-YYYYY convention"
        - "Clear output with next steps instructions"
        - "Feature parity with start-eng-ticket.sh"
        evidence_ids: []

    - ticket_id: TCK-00031
      title: "Implement commit command"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00031.yaml#ticket_meta"
      scope:
        in_scope:
        - "Validate current branch is a ticket branch"
        - "Run cargo fmt --check (or fix)"
        - "Run cargo clippy"
        - "Run cargo test"
        - "Rebase with main branch"
        - "Create commit with message and Co-Authored-By"
        - "Accept commit message as argument"
        out_of_scope:
        - "Push to remote (handled by push command)"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies:
      - TCK-00027
      definition_of_done:
        criteria:
        - "Command runs cargo fmt, clippy, test in sequence"
        - "Command fails fast if any check fails"
        - "Command rebases on main before commit"
        - "Commit message includes Co-Authored-By"
        - "Feature parity with commit-eng-ticket.sh"
        evidence_ids: []

    - ticket_id: TCK-00032
      title: "Implement push command"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00032.yaml#ticket_meta"
      scope:
        in_scope:
        - "Validate current branch is a ticket branch"
        - "Push branch to remote"
        - "Create PR if not exists (gh pr create)"
        - "Request reviews from AI reviewers (gemini-review, codex-review)"
        - "Enable auto-merge"
        - "Poll for check status"
        - "Parse review results"
        out_of_scope:
        - "Manual review requests"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies:
      - TCK-00027
      definition_of_done:
        criteria:
        - "Command pushes branch to origin"
        - "Command creates PR with correct title/body"
        - "Command requests AI reviews"
        - "Command enables auto-merge"
        - "Command shows check status"
        - "Feature parity with push-eng-ticket.sh"
        evidence_ids: []

    # =================================================================
    # PHASE 3: Cleanup
    # =================================================================
    - ticket_id: TCK-00033
      title: "Update docs and delete bash scripts"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00033.yaml#ticket_meta"
      scope:
        in_scope:
        - "Update SKILL.md with xtask command references"
        - "Update any documentation referencing old scripts"
        - "Delete scripts/dev/*.sh files"
        - "Update AGENTS.md if it references scripts"
        out_of_scope:
        - "Additional documentation beyond migration notes"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies:
      - TCK-00028
      - TCK-00029
      - TCK-00030
      - TCK-00031
      - TCK-00032
      definition_of_done:
        criteria:
        - "All bash scripts deleted from scripts/dev/"
        - "SKILL.md references cargo xtask commands"
        - "No documentation references old script names"
        - "Full workflow tested with new commands"
        evidence_ids: []

    # =================================================================
    # PHASE 4: Review Gate Enforcement
    # =================================================================
    - ticket_id: TCK-00034
      title: "Implement review sign-off commands"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00034.yaml#ticket_meta"
      scope:
        in_scope:
        - "cargo xtask review security <PR_URL> - Run security review"
        - "cargo xtask review quality <PR_URL> - Run code quality review"
        - "cargo xtask review uat <PR_URL> - Manual UAT sign-off"
        - "Each command reads appropriate prompt, runs review, posts comment, updates status"
        - "Commands are idempotent (can re-run to update review)"
        out_of_scope:
        - "Branch protection configuration (manual step)"
        - "Automated retry logic"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies:
      - TCK-00032
      definition_of_done:
        criteria:
        - "cargo xtask review security <PR> runs Gemini security review"
        - "cargo xtask review quality <PR> runs Codex code quality review"
        - "cargo xtask review uat <PR> posts UAT approval and updates status"
        - "Each command updates the corresponding ai-review/* status check"
        - "Unit tests for PR URL parsing and review type logic"
        evidence_ids: []

    - ticket_id: TCK-00035
      title: "Implement security review exec command"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00035.yaml#ticket_meta"
      scope:
        in_scope:
        - "cargo xtask security-review-exec approve <PR_URL> - Approve PR after security review"
        - "cargo xtask security-review-exec deny <PR_URL> --reason <reason> - Deny PR with reason"
        - "cargo xtask security-review-exec onboard - Show required reading paths"
        - "Validate PR exists and is OPEN before posting"
        - "--dry-run flag for all approve/deny commands"
        - "Post detailed PR comments explaining approval/denial"
        out_of_scope:
        - "Automated review logic (this is for human/AI reviewer execution)"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies:
      - TCK-00034
      definition_of_done:
        criteria:
        - "cargo xtask security-review-exec approve <PR> posts approval comment and updates status"
        - "cargo xtask security-review-exec deny <PR> --reason <reason> posts denial comment"
        - "cargo xtask security-review-exec onboard prints required reading paths"
        - "PR validation fails with error for closed/merged/missing PRs"
        - "--dry-run flag prevents API calls while showing what would happen"
        - "Unit tests for required reading file existence"
        evidence_ids: []

    # =================================================================
    # PHASE 5: Bug Fixes
    # =================================================================
    - ticket_id: TCK-00103
      title: "Fix silent failure in ticket status detection"
      ticket_files:
        meta_ref: "documents/work/tickets/TCK-00103.yaml#ticket_meta"
      scope:
        in_scope:
        - "Add CompletedTicketsResult enum to distinguish success from network failure"
        - "Update get_completed_tickets() to return structured result instead of silent fallback"
        - "Update start_ticket.rs caller to handle new result type with warning"
        - "Add unit tests for error handling paths"
        out_of_scope:
        - "Caching mechanism for offline operation"
        - "Retry logic with backoff"
        - "--offline flag (future enhancement)"
      binds:
        requirement_ids: []
        evidence_ids: []
      custody_agent_roles:
      - AGENT_IMPLEMENTER
      responsibility_domains:
      - DOMAIN_TOOLING
      dependencies:
      - TCK-00035
      definition_of_done:
        criteria:
        - "Network failure produces visible warning instead of silent empty set"
        - "get_completed_tickets() returns CompletedTicketsResult enum"
        - "start-ticket command warns when GitHub API unavailable"
        - "Unit tests verify error handling paths"
        - "cargo test -p xtask ticket_status passes"
        evidence_ids: []

    verification:
      acceptance_criteria:
      - "cargo build -p xtask compiles without warnings"
      - "cargo xtask --help shows all subcommands"
      - "Each command produces equivalent output to bash script"
      - "Full workflow test: start-ticket -> commit -> push -> check -> finish"
      - "Cross-platform: commands work on Linux and macOS"
