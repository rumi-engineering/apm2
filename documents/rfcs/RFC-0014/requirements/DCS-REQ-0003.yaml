requirement:
  id: DCS-REQ-0003
  title: "Canonicalizer Governance"
  imported_from: PRD-0007/REQ-0009
  status: ACTIVE

  statement: |
    Every event envelope MUST include schema_version, schema_digest, canonicalizer_id, and
    canonicalizer_version to enable fail-closed validation and cross-version verification.

  rationale: |
    Canonicalizer metadata ensures that signed events can be replayed deterministically
    and rejected when schema governance does not match.

  acceptance_criteria:
    - id: AC-001
      description: "Schema registry tracks all known schema digests"
      verification: "Lookup succeeds for registered digest"
    - id: AC-002
      description: "Unknown schema_digest triggers event rejection"
      verification: "Append returns SchemaMismatch error"
    - id: AC-003
      description: "Canonicalizer version mismatch prevents signature verification"
      verification: "Verify canonicalizer mismatch fails validation"

  design_references:
    - "02_design_decisions.yaml#DD-0004"
    - "04_contracts_and_versioning.yaml#CTR-0004"
