rfc_meta:
  schema_version: "2026-01-28"
  template_version: "2026-01-28"
  rfc:
    id: RFC-0014
    title: "Distributed Consensus and Replication Layer for APM2 Ledger+CAS Truth Substrate"
    status: DRAFT
    created_date: "2026-01-28"
    last_updated_date: "2026-01-28"
    version: "2.0.0"
    version_history:
      - version: "0.1.0"
        date: "2026-01-28"
        phase: "v0 (Discovery)"
        notes: "Initial RFC creation from PRD-0007"
      - version: "2.0.0"
        date: "2026-01-28"
        phase: "v2 (Grounded)"
        notes: "EXPLORE mode complete - design decisions grounded in codebase evidence"
    abstract: |
      This RFC specifies a distributed consensus and replication layer that extends APM2's
      append-only ledger and content-addressed storage (CAS) to multi-node operation. The
      design employs a hybrid approach: HotStuff/PBFT-based BFT consensus for control plane
      operations requiring total ordering (promotions, capability grants, policy changes) and
      CRDT/anti-entropy replication for data plane observations. The architecture preserves
      holonic authority constraints, maintains hash-chain integrity across nodes, and enables
      migration from the current single-node SQLite WAL implementation.
  binds_to_prd:
    prd_id: PRD-0007
    prd_base_path: "documents/prds/PRD-0007/"
    requirement_registry_ref: "documents/prds/PRD-0007/requirements/"
    evidence_bundle_ref: "documents/prds/PRD-0007/12_evidence_bundle.yaml"
    prd_meta_ref: "documents/prds/PRD-0007/00_meta.yaml"
  protocol_profile:
    id: DISTRIBUTED_CONSENSUS
    applies: true
    inherited_from_prd: false
    profile_ref: "documents/rfcs/RFC-0014/04_contracts_and_versioning.yaml"
  custody:
    producing_agent_roles:
      - AGENT_AUTHOR
      - AGENT_ARCHITECT
    responsible_domains:
      - DOMAIN_KERNEL
      - DOMAIN_SECURITY
      - DOMAIN_RUNTIME
      - DOMAIN_DISTRIBUTED_SYSTEMS
    authority_signoffs_required:
      - AUTH_ARCHITECTURE
      - AUTH_SECURITY
      - AUTH_RELIABILITY
  refs:
    standards:
      requirement_schema: "standards/schemas/02_requirement.schema.yaml#requirement_schema"
      evidence_artifact_schema: "standards/schemas/01_evidence_artifact.schema.yaml#evidence_artifact_schema"
      quality_coverage_schema: "standards/schemas/03_quality_coverage.schema.yaml#quality_coverage_schema"
      gate_review_schema: "standards/schemas/06_gate_review.schema.yaml#gate_review_schema"
      waiver_schema: "standards/schemas/05_waiver.schema.yaml#waiver_schema"
      ticket_meta_schema: "standards/schemas/04_ticket_meta.schema.yaml#ticket_meta_schema"
      lint_spec: "standards/lint/LINT_SPEC.yaml#lint_spec"
    laws:
      - id: LAW-03
        name: "Monotone Ledger vs. Overwritable Projection"
        ref: "documents/skills/laws-of-holonic-agent-systems/references/law_03.md"
      - id: LAW-10
        name: "Anti-Entropy & Merge Semantics"
        ref: "documents/skills/laws-of-holonic-agent-systems/references/law_10.md"
      - id: LAW-11
        name: "Conservation of Work and Idempotent Actuation"
        ref: "documents/skills/laws-of-holonic-agent-systems/references/law_11.md"
      - id: LAW-13
        name: "Semantic Contracting"
        ref: "documents/skills/laws-of-holonic-agent-systems/references/law_13.md"
      - id: LAW-15
        name: "Measurement Integrity"
        ref: "documents/skills/laws-of-holonic-agent-systems/references/law_15.md"
  implementation:
    language: Rust
    edition: "2024"
    rust_version: "1.85"
    primary_crates:
      - apm2-core
      - apm2-daemon
    new_modules:
      - path: "crates/apm2-core/src/consensus/"
        purpose: "Consensus protocol implementation"
      - path: "crates/apm2-core/src/schema_registry/"
        purpose: "Distributed schema governance"
    key_dependencies:
      - name: tokio
        version: "1.x"
        purpose: "Async runtime for consensus and networking"
      - name: prost
        version: "0.12.x"
        purpose: "Protobuf encoding for consensus messages"
      - name: ed25519-dalek
        version: "2.x"
        purpose: "Ed25519 signatures for consensus attestations"
      - name: blake3
        version: "1.x"
        purpose: "Merkle tree digests and content addressing"
      - name: rustls
        version: "0.23.x"
        purpose: "TLS for inter-node communication"
      - name: serde_jcs
        version: "0.1.x"
        purpose: "Canonical JSON serialization (RFC 8785)"
    proto_files:
      - path: "proto/consensus_v1.proto"
        purpose: "Consensus protocol message definitions"
        status: NEW
      - path: "proto/kernel_events.proto"
        purpose: "Extended with consensus envelope fields"
        status: EXTEND
