---
# SA-3 (Security & Anti-Cousin Guardian) Review
# RFC-0014: Distributed Consensus and Replication Layer for APM2 Ledger+CAS Truth Substrate
# Cycle: 1 (Discovery Phase)

agent_id: SA-3
cycle: 1
review_date: "2026-01-28"
rfc_version: "0.1.0"
selected_modes:
  - 8   # Counterexample-Guided reasoning
  - 35  # Argumentation reasoning
  - 49  # Robust/Worst-Case reasoning
  - 65  # Deontic reasoning
  - 72  # Moral/Ethical reasoning

# =============================================================================
# EXECUTIVE SUMMARY
# =============================================================================

security_assessment:
  overall_posture: ADEQUATE
  confidence: 0.72
  summary: |
    RFC-0014 presents a sound architectural foundation for distributed consensus at
    local-quorum scale (4-7 nodes). The hybrid BFT/CRDT approach correctly separates
    control plane (total ordering) from data plane (eventual consistency). Trust
    boundaries are well-defined with appropriate invariants.

    However, significant security evidence is PENDING implementation. The RFC's
    security claims rest on placeholder artifacts (EVID-0008, EVID-0009, EVID-0011)
    that must be populated before production deployment. Three findings require
    attention before approval.

# =============================================================================
# TRUST BOUNDARY REVIEW
# =============================================================================

trust_boundary_review:
  - boundary_id: TB-0001
    name: "Network Genesis Boundary"
    status: ADEQUATE
    invariant_completeness: 0.90
    notes: |
      Genesis security is well-specified:
      - INV-0001: T0 signature verification
      - INV-0002: Minimum validator set (3f+1)
      - INV-0003: Ledger head hash adoption (epoch 0)

      CONCERN: No invariant specifies time-lock or delay on genesis acceptance.
      A replay of an old genesis block could reset network state if nodes
      rejoin after partition.

      REMEDIATION: Add INV-0004 requiring genesis.timestamp to be within
      acceptable window of node's local time (e.g., 24h) on initial bootstrap.

  - boundary_id: TB-0002
    name: "Validator Quorum Boundary"
    status: ADEQUATE
    invariant_completeness: 0.95
    notes: |
      Quorum boundary is robust:
      - INV-0004: 2f+1 signature threshold
      - INV-0005: Validator set membership verification
      - INV-0006: Key rotation via quorum consensus

      The equivocation detection (TS-0003) and slashing mechanism provide
      accountability. HSM recommendation for T1 keys is appropriate.

      MINOR: Consider adding explicit invariant for validator set change rate
      (e.g., max 1 validator change per epoch) to prevent rapid takeover.

  - boundary_id: TB-0003
    name: "Node Membership Boundary"
    status: CONCERN
    invariant_completeness: 0.75
    notes: |
      Joining node security has gaps:
      - INV-0007: Schema handshake requirement is good
      - INV-0008: Multi-source sync (2f+1) is appropriate
      - INV-0009: Checkpoint verification is critical

      MISSING: No invariant for rate-limiting join attempts. An attacker could
      exhaust resources via rapid join/leave cycles (Sybil-adjacent attack).

      MISSING: No specification of what "joining" means cryptographically.
      Does the joining node need a pre-existing credential? How is identity
      established before handshake?

      REMEDIATION: Add INV-0010 for join rate limiting and INV-0011 for
      initial identity establishment (e.g., invitation token signed by T1).

  - boundary_id: TB-0004
    name: "Inter-Node Communication Boundary"
    status: ADEQUATE
    invariant_completeness: 0.90
    notes: |
      Communication security is well-specified:
      - INV-0010: mTLS >= TLS 1.3
      - INV-0011: Certificate chain to network CA
      - INV-0012: Per-message signatures

      Message replay mitigation via monotonic sequence numbers is specified.

      MINOR: Traffic analysis mitigation is marked "optional" - consider
      mandatory padding for control plane messages to prevent timing attacks.

  - boundary_id: TB-0005
    name: "Actor-to-Kernel Boundary"
    status: ADEQUATE
    invariant_completeness: 0.85
    notes: |
      OCAP model is preserved:
      - INV-0013: Lease validation on tool requests
      - INV-0014: Capability subset constraint
      - INV-0015: Session key delegation chain

      Good alignment with existing KeyManager patterns in apm2-core/src/crypto/keys.rs.

      MINOR: No explicit invariant for cross-node capability verification.
      When a capability was granted on Node A, how does Node B verify it?

  - boundary_id: TB-0006
    name: "Relay Holon Boundary"
    status: ADEQUATE
    invariant_completeness: 0.80
    notes: |
      Relay trust model is appropriately limited:
      - INV-0016: mTLS for all tunnels
      - INV-0017: Relay cannot sign consensus proposals

      The "trusted for availability but not integrity" model is correct.
      End-to-end signatures prevent relay from spoofing.

      CONCERN: No invariant for tunnel timeout/keepalive. A relay could hold
      connections indefinitely, preventing workers from switching to backup.

      REMEDIATION: Add INV-0018 for maximum tunnel idle time and forced
      reconnection to alternative relay.

# =============================================================================
# THREAT MODEL ASSESSMENT
# =============================================================================

threat_coverage:
  - threat_id: TS-0001
    name: "Validator Key Compromise"
    mitigation_status: ADEQUATE
    notes: |
      Mitigations are comprehensive:
      - HSM storage for T1 keys
      - Monthly rotation schedule
      - Threshold signatures (mentioned but not specified)
      - Rapid revocation via governance

      Residual risk correctly identified: attacker gets one vote.

      CONCERN: Threshold signature requirement is mentioned but not formalized.
      Is it 2-of-3? 3-of-5? This affects key ceremony complexity.

      EVIDENCE NEEDED: EVID-0011 (Key Rotation Security Analysis) is PENDING.

  - threat_id: TS-0002
    name: "Network Partition"
    mitigation_status: ADEQUATE
    notes: |
      Partition handling is sound:
      - Quorum requirement prevents minority finalization
      - Heartbeat monitoring for detection
      - Automatic reconciliation on heal

      Residual risk (temporary liveness loss) is acceptable.

      MINOR: Consider specifying maximum partition duration for deterministic
      behavior (e.g., if partitioned > 1 hour, require manual intervention).

  - threat_id: TS-0003
    name: "Equivocation Attack"
    mitigation_status: PARTIAL
    notes: |
      Detection mechanism is well-specified:
      - Equivocation = two conflicting signed messages for same round
      - Cryptographic proof generation
      - Automatic slashing

      CONCERN: Slashing is mentioned but not specified. What does slashing mean?
      Loss of stake? Removal from validator set? Both?

      CONCERN: "Automatic" slashing could be gamed. An attacker could frame
      a validator by replaying old messages if nonces aren't properly scoped.

      EVIDENCE NEEDED: EVID-0009 (Equivocation Detection Test Results) is PENDING.

  - threat_id: TS-0004
    name: "Schema Poisoning"
    mitigation_status: ADEQUATE
    notes: |
      Schema governance is robust:
      - Registration requires consensus vote (quorum)
      - Digest verification at every event
      - Fail-closed for unknown schemas
      - Canonical encoding prevents ambiguity

      Residual risk (requires quorum compromise) is acceptable given BFT model.

  - threat_id: TS-0005
    name: "Anti-Entropy Poisoning"
    mitigation_status: ADEQUATE
    notes: |
      Pull-based sync model is correct:
      - Receiver initiates (prevents push attacks)
      - Schema and signature verification
      - Merkle proof verification
      - Multi-source sync with majority agreement

      Good separation of control plane (must agree) from data plane (can diverge).

# =============================================================================
# SECURITY PROPERTY ANALYSIS (via 5 Reasoning Modes)
# =============================================================================

security_property_analysis:
  - property_id: SEC-PROP-0001
    name: "Safety (Agreement)"
    claim: "No two honest nodes finalize different events at the same sequence ID"

    mode_8_counterexample: |
      SCENARIO: Long partition with validator set change
      1. Network partitions into A (4 nodes) and B (3 nodes)
      2. Partition A finalizes events 100-200
      3. Partition A performs validator rotation (removes 2 nodes)
      4. Partition heals; B has old validator set
      5. B attempts to finalize conflicting events with old quorum

      MITIGATION CHECK: INV-0006 requires key rotation via quorum, so B cannot
      have valid rotation. However, if B had > 2f+1 old validators, ambiguity exists.

      FINDING: RFC should specify that validator set changes are non-reversible
      and require full network participation to prevent partition confusion.

    mode_35_argumentation: |
      ARGUMENT STRUCTURE (Toulmin):
      - CLAIM: Safety holds under f Byzantine faults
      - GROUND: BFT quorum requires 2f+1 signatures; only 2f+1 honest exist
      - WARRANT: Two conflicting QCs would require 2*(2f+1) - (3f+1) = f+1 overlap
      - BACKING: Any overlap node signed both = Byzantine (contradiction if honest)
      - REBUTTAL: Assumes synchronous signature delivery; async gaps could weaken
      - QUALIFIER: HIGH confidence for local quorum (< 500ms p99)

    mode_49_worst_case: |
      WORST-CASE SCENARIO: f validators compromised + leader compromised
      - Attacker controls leader slot and f validators
      - Attacker proposes conflicting events to different subsets
      - Result: 2f+1 honest nodes cannot both finalize conflicting events
      - Safety preserved, but liveness may suffer (view changes)

      CATASTROPHIC SCENARIO: f+1 validators compromised
      - Attacker controls quorum
      - Safety VIOLATED: can finalize arbitrary events
      - Mitigation: Geographic/organizational diversity (noted in TB-0002)

    mode_65_deontic: |
      OBLIGATIONS CREATED:
      - MUST: Validators MUST NOT sign conflicting proposals for same round
      - MUST: Nodes MUST verify 2f+1 signatures before accepting finalization
      - MUST: Nodes MUST record equivocation evidence if detected
      - SHOULD: Operators SHOULD distribute validators across trust boundaries
      - MAY: Operators MAY implement additional monitoring

    mode_72_moral_ethical: |
      ETHICAL IMPLICATIONS OF FAILURE:
      - Conflicting finalization creates "two truths" - integrity violation
      - Users depending on ledger for authorization could be harmed
      - Legal/compliance implications for audit trails
      - Trust in system fundamentally broken if safety fails

      PROPORTIONALITY: BFT consensus is appropriate given criticality

  - property_id: SEC-PROP-0002
    name: "Liveness (Termination)"
    claim: "Proposed events eventually finalize under synchrony with f Byzantine faults"

    mode_8_counterexample: |
      SCENARIO: Byzantine leader with honest-looking proposals
      1. Byzantine leader proposes valid-looking but slow proposals
      2. Each proposal takes exactly timeout-1 to gather signatures
      3. System technically makes progress but at degraded rate

      NOT A COUNTEREXAMPLE: This is a performance attack, not liveness failure.
      Liveness is preserved; throughput is degraded.

      SCENARIO: Relay Holon DoS
      1. Workers behind NAT depend on single relay
      2. Relay becomes unavailable
      3. Workers cannot participate in consensus

      FINDING: Liveness for NAT-bound workers depends on relay availability.
      RFC mentions "multiple relays" but doesn't specify failover mechanism.

    mode_35_argumentation: |
      ARGUMENT STRUCTURE:
      - CLAIM: Liveness under synchrony
      - GROUND: HotStuff/PBFT have proven liveness with view-change protocol
      - WARRANT: Network synchrony bound ensures message delivery
      - BACKING: p99 < 500ms latency assumption (CON-SCALE-001)
      - REBUTTAL: Relay failures could extend effective message delay
      - QUALIFIER: MEDIUM confidence (relay dependency not fully specified)

    mode_49_worst_case: |
      WORST-CASE SCENARIO: f Byzantine nodes + network at edge of synchrony
      - Message delays approach maximum bound
      - View changes occur frequently
      - Throughput degrades to near-zero
      - Result: Technically live but operationally useless

      CATASTROPHIC SCENARIO: Prolonged asynchrony (> synchrony assumption)
      - Liveness CANNOT be guaranteed (FLP impossibility)
      - Mitigation: Design for eventual synchrony, not perpetual

    mode_65_deontic: |
      OBLIGATIONS:
      - MUST: System MUST progress under stated synchrony assumptions
      - SHOULD: Operators SHOULD monitor message latency
      - SHOULD: Workers SHOULD have multiple relay options
      - MAY: System MAY degrade gracefully under adversarial conditions

    mode_72_moral_ethical: |
      ETHICAL IMPLICATIONS:
      - Liveness failure = denial of service
      - Users cannot record legitimate events
      - Work in progress may be lost or orphaned
      - Less severe than safety failure but still harmful

  - property_id: SEC-PROP-0003
    name: "Accountability (Non-Repudiation)"
    claim: "Byzantine behavior produces cryptographic evidence identifying the faulty node"

    mode_8_counterexample: |
      SCENARIO: Deniable equivocation via key rotation
      1. Validator V signs proposal A with key K1
      2. V rotates to key K2 (via valid KeyRotated event)
      3. V signs conflicting proposal B with K2
      4. Old signature (K1, A) and new signature (K2, B) don't obviously conflict

      MITIGATION CHECK: INV-0006 requires round tracking. If both A and B are
      for the same round, equivocation is detectable regardless of key.

      FINDING: Equivocation detection must track (validator_id, round) not just
      (public_key, round). RFC should clarify this.

    mode_35_argumentation: |
      ARGUMENT STRUCTURE:
      - CLAIM: Byzantine behavior is accountable
      - GROUND: All messages are signed; equivocation = two signatures same round
      - WARRANT: Signatures are unforgeable (Ed25519 assumption)
      - BACKING: EVID-0009 will demonstrate detection (PENDING)
      - REBUTTAL: Key management bugs could allow plausible deniability
      - QUALIFIER: MEDIUM confidence (evidence pending)

    mode_49_worst_case: |
      WORST-CASE: Byzantine node with full key access to HSM
      - Can sign arbitrary messages
      - All messages appear valid
      - Equivocation detectable IF both signatures observed

      CATASTROPHIC: Signatures observed on different partitions, never reconciled
      - Evidence may exist on one partition only
      - If partition never heals, evidence lost

    mode_65_deontic: |
      OBLIGATIONS:
      - MUST: Nodes MUST record and propagate equivocation evidence
      - MUST: Evidence MUST be included in ledger (immutable record)
      - SHOULD: Evidence SHOULD trigger automatic governance response
      - MAY: Human review MAY be required for slashing execution

    mode_72_moral_ethical: |
      ETHICAL IMPLICATIONS:
      - Accountability enables justice/recourse for bad actors
      - False accusation must be impossible (cryptographic proof)
      - Slashing has real consequences; must be irrefutable

  - property_id: SEC-PROP-0004
    name: "Hash Chain Integrity"
    claim: "Hash chain from genesis to any event is tamper-evident"

    mode_8_counterexample: |
      SCENARIO: Collision attack on BLAKE3 (hypothetical)
      1. Attacker finds BLAKE3 collision for event_hash
      2. Creates two events with same hash but different content
      3. Chain appears valid but contains substituted event

      NOT REALISTIC: BLAKE3 has no known collision vulnerabilities.
      RFC correctly identifies "cannot break BLAKE3" as assumption.

    mode_35_argumentation: |
      ARGUMENT STRUCTURE:
      - CLAIM: Tamper-evidence via hash chaining
      - GROUND: Each event_hash = H(payload || prev_hash)
      - WARRANT: Modifying any event changes its hash, breaking chain
      - BACKING: Standard cryptographic construction; existing tests pass
      - REBUTTAL: Hash function weakness would invalidate
      - QUALIFIER: HIGH confidence (BLAKE3 well-analyzed)

    mode_49_worst_case: |
      WORST-CASE: Simultaneous control of all nodes
      - Attacker controls all validators
      - Can rewrite history if all nodes cooperate
      - Genesis hash published out-of-band is only anchor

      MITIGATION: Out-of-band genesis publication provides external anchor

    mode_65_deontic: |
      OBLIGATIONS:
      - MUST: Nodes MUST verify hash chain on sync
      - MUST: Nodes MUST reject events with invalid chain
      - SHOULD: Operators SHOULD publish genesis hash externally

    mode_72_moral_ethical: |
      ETHICAL IMPLICATIONS:
      - Hash chain is audit foundation
      - Regulatory compliance often depends on tamper-evidence
      - Historical revisionism would undermine trust

  - property_id: SEC-PROP-0005
    name: "Key Compromise Containment"
    claim: "Key rotation limits future exposure while preserving historical verification"

    mode_8_counterexample: |
      SCENARIO: Delayed detection of compromise
      1. Key K1 compromised at time T
      2. Attacker signs malicious events until T+30d
      3. Compromise detected at T+30d
      4. Key rotated to K2
      5. Events T to T+30d remain validly signed by K1

      FINDING: RFC correctly states "not forward secrecy for signatures."
      Historical events signed by compromised key remain valid.
      This is acceptable given auditability > repudiation.

    mode_35_argumentation: |
      ARGUMENT STRUCTURE:
      - CLAIM: Key rotation contains future exposure
      - GROUND: New key cannot sign old messages; old key cannot sign new
      - WARRANT: KeyRotated event establishes transition point
      - BACKING: Standard key rotation semantics
      - REBUTTAL: Rotation delay exposes system during compromise window
      - QUALIFIER: MEDIUM confidence (rotation timing not specified)

    mode_49_worst_case: |
      WORST-CASE: T0 root key compromised
      - Attacker can sign new genesis
      - Can rotate all validator keys
      - Complete network takeover possible

      MITIGATION: T0 air-gapped, multi-party ceremony (Q-0005)
      RESIDUAL: "Network halt + new genesis" is catastrophic recovery

    mode_65_deontic: |
      OBLIGATIONS:
      - MUST: Key rotation MUST be recorded in ledger
      - MUST: Historical events MUST remain verifiable with old key
      - SHOULD: Rotation SHOULD occur on regular schedule
      - SHOULD: Compromise detection SHOULD trigger immediate rotation

    mode_72_moral_ethical: |
      ETHICAL IMPLICATIONS:
      - Users affected by compromise during window
      - Transparency about compromise essential
      - Rotation must not destroy evidence of compromise

# =============================================================================
# ANTI-COUSIN ASSESSMENT
# =============================================================================

anti_cousin_assessment:
  status: COMPLIANT
  confidence: 0.85
  notes: |
    RFC-0014 introduces new abstractions that EXTEND rather than DUPLICATE existing patterns:

    1. LedgerBackend Trait (DD-0002)
       - EXTENDS: Existing Ledger in storage.rs
       - PATTERN: Follows existing trait patterns (Reducer, Adapter)
       - STATUS: COMPLIANT - trait extraction, not duplication

    2. SchemaRegistry (DD-0004)
       - NEW CAPABILITY: Distributed schema governance
       - PATTERN: Follows existing fail-closed validation patterns
       - STATUS: COMPLIANT - genuinely new requirement

    3. TrustHierarchy (DD-0003)
       - EXTENDS: Existing KeyManager in crypto/keys.rs
       - CONCERN: T2/T3 overlap with existing actor_id patterns
       - STATUS: COMPLIANT - KeyManager for T2/T3, new HSM for T1

    4. ConsensusLayer
       - NEW CAPABILITY: BFT consensus
       - No existing equivalent
       - STATUS: COMPLIANT - genuinely new

    5. AntiEntropyLayer
       - NEW CAPABILITY: CRDT-based sync
       - No existing equivalent
       - STATUS: COMPLIANT - genuinely new

    ALIGNMENT CHECK:
    - KeyManager: T2/T3 keys should use existing KeyManager, not duplicate
    - Ledger: SqliteLedgerBackend wraps existing Ledger
    - Canonicalize trait: New proto messages should implement existing Canonicalize

    POTENTIAL COUSINS TO MONITOR:
    - SchemaRegistry vs. existing event validation in reducer/traits.rs
    - QuorumCertificate vs. existing signature patterns in crypto/sign.rs

    Recommendation: During implementation, enforce that new consensus signatures
    use existing crypto primitives (ed25519-dalek, blake3) rather than introducing
    alternative cryptographic implementations.

# =============================================================================
# FINDINGS
# =============================================================================

findings:
  - finding_id: FND-SA3-001
    category: SECURITY_DEFECT
    severity: MAJOR
    location: "03_trust_boundaries.yaml#TB-0003"
    title: "Node Membership Boundary Missing Join Rate Limit and Identity Bootstrap"
    description: |
      TB-0003 (Node Membership Boundary) lacks invariants for:
      1. Rate-limiting join attempts to prevent resource exhaustion
      2. Initial identity establishment before handshake

      An attacker could exhaust resources via rapid join/leave cycles.
      New nodes have no specified credential before handshake begins.
    remediation: |
      Add two new invariants to TB-0003:

      INV-0010: "Join attempts rate-limited per source IP"
        verification: "join_attempts.filter(|j| j.source_ip == ip).count() <= MAX_JOIN_RATE"

      INV-0011: "Joining nodes must present invitation token signed by T1 validator"
        verification: "verify_signature(join_request.invitation, join_request.token, validator.public_key)"
    evidence_required:
      - "Rate limit threshold determination (e.g., 1 join/minute/IP)"
      - "Invitation token format specification"

  - finding_id: FND-SA3-002
    category: SECURITY_DEFECT
    severity: MAJOR
    location: "03_trust_boundaries.yaml#TS-0003"
    title: "Equivocation Detection Scoping Ambiguity"
    description: |
      TS-0003 (Equivocation Attack) mentions "automatic slashing" but does not specify:
      1. What slashing means (removal from validator set? stake loss?)
      2. How equivocation is scoped (by public_key or by validator_id)
      3. Nonce scoping to prevent replay-based framing attacks

      If equivocation is keyed only by public_key, a key rotation could allow
      ambiguous attribution. If nonces aren't properly scoped, an attacker
      could replay old messages to frame a validator.
    remediation: |
      Clarify in TS-0003 mitigations:

      1. "Slashing" defined as:
         - Immediate removal from active validator set
         - Recorded in ledger as ValidatorSlashed event
         - Requires governance vote for re-admission

      2. Equivocation detection keys on (validator_id, epoch, round):
         - Validator identity survives key rotation
         - Epoch prevents cross-epoch confusion
         - Round is primary conflict detector

      3. Add nonce scoping:
         - Proposals include unique nonce: (epoch, round, proposal_id)
         - Replay of proposal with same nonce ignored
         - First observation wins
    evidence_required:
      - "EVID-0009 must demonstrate nonce-scoped detection"
      - "ValidatorSlashed event specification"

  - finding_id: FND-SA3-003
    category: SECURITY_DEFECT
    severity: MINOR
    location: "03_trust_boundaries.yaml#TB-0006"
    title: "Relay Holon Missing Tunnel Timeout Invariant"
    description: |
      TB-0006 (Relay Holon Boundary) lacks specification for tunnel lifecycle:
      - No maximum idle time before forced disconnect
      - No keepalive requirements
      - No failover trigger mechanism

      A compromised or failed relay could hold connections indefinitely,
      preventing workers from switching to backup relays.
    remediation: |
      Add invariant to TB-0006:

      INV-0018: "Management tunnels timeout after inactivity"
        verification: "tunnel.last_activity + TUNNEL_TIMEOUT < now() implies tunnel.closed"

      INV-0019: "Workers must support multiple relay endpoints"
        verification: "worker.relay_endpoints.len() >= 2"

      INV-0020: "Tunnel failure triggers failover within bounded time"
        verification: "relay_failure_detected + FAILOVER_TIMEOUT >= reconnect_to_backup"

      Suggested values: TUNNEL_TIMEOUT = 5 minutes, FAILOVER_TIMEOUT = 30 seconds.
    evidence_required:
      - "EVID-0015 should include failover test results"

  - finding_id: FND-SA3-004
    category: EVIDENCE_GAP
    severity: BLOCKER
    location: "evidence_artifacts/"
    title: "Critical Security Evidence Artifacts Are Placeholders"
    description: |
      The following evidence artifacts are PENDING and contain only placeholder content:

      CRITICAL for security claims:
      - EVID-0008: BFT Safety Proof (backs SEC-PROP-0001, SEC-PROP-0002)
      - EVID-0009: Equivocation Detection Test Results (backs SEC-PROP-0003)
      - EVID-0011: Key Rotation Security Analysis (backs SEC-PROP-0005)
      - EVID-0015: Relay Holon Security Review (backs TB-0006)

      Without populated evidence, security claims are unsubstantiated.
    remediation: |
      Before RFC approval, populate evidence artifacts:

      EVID-0008: Reference specific BFT paper sections proving safety/liveness.
                 If using HotStuff, cite Yin et al. Theorem 1 (Safety) and
                 Theorem 2 (Liveness). Map to RFC's specific instantiation.

      EVID-0009: Document test cases for:
                 - Single equivocation detection
                 - Multi-validator equivocation
                 - Cross-partition equivocation reconciliation

      EVID-0011: Analyze:
                 - Rotation latency (time-to-effect after KeyRotated)
                 - Compromise window exposure
                 - Historical verification continuity

      EVID-0015: Include:
                 - Threat model specific to relay architecture
                 - mTLS implementation verification
                 - Failover mechanism testing
    evidence_required:
      - "Populated EVID-0008, EVID-0009, EVID-0011, EVID-0015"

  - finding_id: FND-SA3-005
    category: SECURITY_DEFECT
    severity: MINOR
    location: "02_design_decisions.yaml#DD-0003"
    title: "Threshold Signature Configuration Not Specified"
    description: |
      DD-0003 (Four-Tier Trust Hierarchy) mentions "threshold signatures requiring
      multiple keys" for T0 key ceremony, but does not specify:
      - Threshold scheme (Shamir? MuSig2? FROST?)
      - Threshold configuration (2-of-3? 3-of-5?)
      - Key holder distribution requirements
    remediation: |
      Add to DD-0003 or Q-0005:

      T0 Threshold Configuration:
      - Scheme: 3-of-5 Shamir Secret Sharing with FROST for signing
      - Key holders: Minimum 3 distinct organizational entities
      - Geographic distribution: No two key holders in same jurisdiction
      - Ceremony: Air-gapped signing machine, witnessed, recorded
    evidence_required:
      - "Threshold scheme selection rationale"
      - "Key holder diversity verification procedure"

# =============================================================================
# CLAIM-ARGUMENT-EVIDENCE (CAE) TREE
# =============================================================================

cae_tree: |
  TOP CLAIM: "RFC-0014 is secure against Byzantine attacks at local-quorum scale"
  Confidence: 0.72 (ADEQUATE with gaps)

  +-- SUB-CLAIM 1: "Safety preserved under f Byzantine faults" (SEC-PROP-0001)
  |   Status: SUPPORTED (pending EVID-0008)
  |   |
  |   +-- ARGUMENT 1.1: BFT quorum (2f+1) ensures conflicting QCs impossible
  |   |   Mode: 35 (Argumentation)
  |   |   Structure: Overlap argument requires f+1 common signers
  |   |   |
  |   |   +-- EVIDENCE 1.1.1: HotStuff/PBFT safety proof [PENDING: EVID-0008]
  |   |   +-- EVIDENCE 1.1.2: Quorum certificate structure (DD-0007) [PRESENT]
  |   |
  |   +-- COUNTEREXAMPLE CHECK 1.2: Long partition with validator change
  |       Mode: 8 (Counterexample-Guided)
  |       Status: MITIGATED by INV-0006 (key rotation requires quorum)
  |       Residual: Validator set changes should require full network
  |
  +-- SUB-CLAIM 2: "Liveness maintained under synchrony" (SEC-PROP-0002)
  |   Status: PARTIALLY SUPPORTED
  |   |
  |   +-- ARGUMENT 2.1: View-change protocol recovers from leader failure
  |   |   Mode: 35 (Argumentation)
  |   |   |
  |   |   +-- EVIDENCE 2.1.1: HotStuff liveness proof [PENDING: EVID-0008]
  |   |
  |   +-- WORST-CASE 2.2: Relay failure affects NAT-bound workers
  |       Mode: 49 (Robust/Worst-Case)
  |       Status: PARTIALLY MITIGATED
  |       Gap: Failover mechanism not specified (FND-SA3-003)
  |
  +-- SUB-CLAIM 3: "Byzantine behavior is accountable" (SEC-PROP-0003)
  |   Status: PARTIALLY SUPPORTED
  |   |
  |   +-- ARGUMENT 3.1: Cryptographic equivocation proof
  |   |   Mode: 35 (Argumentation)
  |   |   |
  |   |   +-- EVIDENCE 3.1.1: Equivocation detection tests [PENDING: EVID-0009]
  |   |
  |   +-- COUNTEREXAMPLE CHECK 3.2: Key rotation ambiguity
  |       Mode: 8 (Counterexample-Guided)
  |       Status: NEEDS CLARIFICATION (FND-SA3-002)
  |       Gap: Equivocation should key on validator_id not public_key
  |
  +-- SUB-CLAIM 4: "Hash chain integrity maintained" (SEC-PROP-0004)
  |   Status: STRONGLY SUPPORTED
  |   |
  |   +-- ARGUMENT 4.1: Cryptographic hash chaining
  |   |   Mode: 35 (Argumentation)
  |   |   |
  |   |   +-- EVIDENCE 4.1.1: Existing hash chain tests in storage.rs [PRESENT]
  |   |   +-- EVIDENCE 4.1.2: BLAKE3 security analysis (external) [PRESENT]
  |   |
  |   +-- WORST-CASE 4.2: All nodes compromised
  |       Mode: 49 (Robust/Worst-Case)
  |       Status: MITIGATED by out-of-band genesis publication
  |
  +-- SUB-CLAIM 5: "Key compromise is contained" (SEC-PROP-0005)
      Status: PARTIALLY SUPPORTED
      |
      +-- ARGUMENT 5.1: Key rotation limits future exposure
      |   Mode: 35 (Argumentation)
      |   |
      |   +-- EVIDENCE 5.1.1: Key rotation analysis [PENDING: EVID-0011]
      |
      +-- WORST-CASE 5.2: T0 root key compromise
          Mode: 49 (Robust/Worst-Case)
          Status: CATASTROPHIC (acknowledged in RFC)
          Mitigation: Air-gapped multi-party ceremony (Q-0005)

  DEONTIC OBLIGATIONS SUMMARY (Mode 65):
  - MUST: Verify 2f+1 signatures before finalization
  - MUST: Record equivocation evidence in ledger
  - MUST: Verify hash chain on sync
  - SHOULD: Use HSM for T1 keys
  - SHOULD: Distribute validators across trust boundaries

  ETHICAL IMPLICATIONS SUMMARY (Mode 72):
  - Safety failure: Integrity violation, two truths, trust breakdown
  - Liveness failure: Denial of service, work loss
  - Accountability failure: Injustice, false accusations possible
  - Hash chain failure: Audit failure, compliance violation
  - Key compromise: User harm during window, transparency essential

# =============================================================================
# RECOMMENDATIONS
# =============================================================================

recommendations:
  before_approval:
    - "Resolve FND-SA3-004: Populate critical security evidence artifacts"
    - "Resolve FND-SA3-002: Clarify equivocation detection scoping"
    - "Resolve FND-SA3-001: Add join rate limiting and identity bootstrap"

  before_implementation:
    - "Resolve FND-SA3-003: Specify relay tunnel timeout and failover"
    - "Resolve FND-SA3-005: Specify threshold signature configuration"
    - "Add genesis timestamp validity window (INV-0004)"
    - "Specify validator set change rate limit"

  during_implementation:
    - "Enforce use of existing crypto primitives (KeyManager, Canonicalize)"
    - "Implement Jepsen-style fault injection tests per TEST-CS-001 through TEST-CS-004"
    - "Monitor for cousin emergence in SchemaRegistry vs existing validation"

# =============================================================================
# DISPOSITION
# =============================================================================

disposition:
  recommendation: CONDITIONAL_APPROVAL
  conditions:
    - "FND-SA3-004 (Evidence Gaps) must be addressed before PHASE-1 gate"
    - "FND-SA3-002 (Equivocation Scoping) must be clarified in RFC text"
    - "FND-SA3-001 (Join Security) must be addressed before implementation"
  next_review: "CYCLE_2 after evidence artifacts populated"
