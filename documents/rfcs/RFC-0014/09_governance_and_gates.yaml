rfc_governance_and_gates:
  schema_version: "2026-01-28"

  governance_overview:
    description: |
      This RFC requires signoff from Architecture, Security, and Reliability
      authorities before implementation proceeds. Each gate evaluates specific
      aspects of the design and implementation.

    authority_requirements:
      - authority: AUTH_ARCHITECTURE
        scope:
          - "Component design and interfaces"
          - "LedgerBackend trait design"
          - "Consensus library selection"
          - "Namespace-to-quorum mapping"
        signoff_criteria:
          - "Interfaces are minimal and composable"
          - "Abstractions enable future extension"
          - "Design aligns with existing patterns (Reducer, Adapter traits)"

      - authority: AUTH_SECURITY
        scope:
          - "Trust model and signer tiers"
          - "Byzantine fault tolerance"
          - "Key management and HSM integration"
          - "Network security (TLS, authentication)"
        signoff_criteria:
          - "Threat scenarios addressed with mitigations"
          - "Cryptographic primitives correctly applied"
          - "Key ceremony procedures documented"
          - "Fail-closed behavior verified"

      - authority: AUTH_RELIABILITY
        scope:
          - "Fault tolerance and recovery"
          - "Migration and rollback procedures"
          - "Monitoring and alerting"
          - "Performance characteristics"
        signoff_criteria:
          - "Failure modes documented with recovery"
          - "Rollback tested and documented"
          - "SLO targets defined and measurable"
          - "Chaos testing planned"

  gates:
    - id: GATE-0001
      name: "RFC Design Review"
      type: TRUSTED
      purpose: "Validate RFC completeness and technical soundness"
      applies_to: "RFC document"
      pass_criteria:
        - "All required sections present"
        - "Design decisions have rationale and alternatives"
        - "Requirements traceable to design"
        - "Open questions have resolution path"
        - "Falsifiable evidence predicates defined for all deterministic gates"
      evidence_required:
        - "RFC document (this document)"
        - "Design review meeting notes"
      reviewers:
        - "AUTH_ARCHITECTURE"
        - "AUTH_SECURITY"

    - id: GATE-0002
      name: "Consensus Library Evaluation"
      type: TRUSTED
      purpose: "Validate consensus library selection"
      applies_to: "Q-0001 resolution"
      pass_criteria:
        - "Evaluation criteria documented"
        - "At least 2 options prototyped"
        - "Selection rationale documented"
        - "Known limitations documented"
      evidence_required:
        - "Evaluation report"
        - "Prototype code"
        - "Benchmark results"
      reviewers:
        - "AUTH_ARCHITECTURE"

    - id: GATE-0003
      name: "Security Model Review"
      type: TRUSTED
      purpose: "Validate trust model and security properties"
      applies_to: "03_trust_boundaries.yaml"
      pass_criteria:
        - "All trust boundaries documented"
        - "Threat scenarios have mitigations"
        - "Security properties formally stated"
        - "Key management procedures documented"
      evidence_required:
        - "Trust boundary analysis"
        - "Threat model review"
        - "Key ceremony documentation"
      reviewers:
        - "AUTH_SECURITY"

    - id: GATE-0004
      name: "LedgerBackend Trait Approval"
      type: DETERMINISTIC
      purpose: "Verify trait design is backward compatible"
      applies_to: "DCS-001 implementation"
      pass_criteria:
        - "SqliteLedgerBackend passes all existing tests"
        - "No behavioral changes to existing code"
        - "Trait is async-compatible"
        - "Error types are non_exhaustive"
      evidence_required:
        - "Test results (cargo test)"
        - "API compatibility analysis"
      reviewers:
        - "AUTH_ARCHITECTURE"

    - id: GATE-0005
      name: "Schema Migration Validation"
      type: DETERMINISTIC
      purpose: "Verify schema migration is backward compatible"
      applies_to: "DCS-003 implementation"
      pass_criteria:
        - "Migration runs on existing databases"
        - "Existing events readable after migration"
        - "New columns have nullable defaults"
        - "Rollback possible by ignoring new columns"
      evidence_required:
        - "Migration test results"
        - "Rollback test results"
      reviewers:
        - "AUTH_RELIABILITY"

    - id: GATE-0006
      name: "Consensus Safety Verification"
      type: DETERMINISTIC
      purpose: "Verify consensus implementation maintains safety"
      applies_to: "DCS-007b/DCS-007c/DCS-007d, DCS-008 implementation"
      pass_criteria:
        - "All TEST-CS-* tests pass"
        - "All TEST-BZ-* tests pass"
        - "Fault injection tests pass"
        - "No conflicting finality under partition"
      evidence_required:
        - "Test results"
        - "Fault injection logs"
        - "Coverage report"
      reviewers:
        - "AUTH_SECURITY"
        - "AUTH_RELIABILITY"

    - id: GATE-0007
      name: "Anti-Entropy Correctness"
      type: DETERMINISTIC
      purpose: "Verify CRDT merge and sync correctness"
      applies_to: "DCS-009 implementation"
      pass_criteria:
        - "All TEST-AE-* tests pass"
        - "CRDT properties verified (commutativity, associativity)"
        - "DefectRecorded events recorded correctly"
        - "Sync completes within SLO"
      evidence_required:
        - "Test results"
        - "Property-based test output"
        - "Performance benchmarks"
      reviewers:
        - "AUTH_ARCHITECTURE"

    - id: GATE-0010
      name: "Scale-Boundary Verification"
      type: DETERMINISTIC
      purpose: "Verify system stays within local-quorum scale limits"
      applies_to: "Consensus configuration"
      pass_criteria:
        - "Quorum size <= 7 nodes"
        - "Network latency p99 < 500ms"
        - "Consensus overhead < 10% of total bandwidth"
      evidence_required:
        - "Scale test results"
        - "Network topology diagram"
      reviewers:
        - "AUTH_ARCHITECTURE"
        - "AUTH_RELIABILITY"

    - id: GATE-0008
      name: "Migration Validation"
      type: DETERMINISTIC
      purpose: "Verify migration preserves data integrity"
      applies_to: "Migration procedure"
      pass_criteria:
        - "All TEST-MG-* tests pass"
        - "Hash chain verified before and after"
        - "No seq_id gaps"
        - "Rollback tested successfully"
      evidence_required:
        - "Migration test results"
        - "Hash chain verification logs"
        - "Rollback test results"
      reviewers:
        - "AUTH_RELIABILITY"

    - id: GATE-0009
      name: "Production Readiness"
      type: TRUSTED
      purpose: "Verify system ready for production deployment"
      applies_to: "PHASE-3 completion"
      pass_criteria:
        - "All previous gates passed"
        - "Monitoring and alerting configured"
        - "Runbooks documented"
        - "DR procedures tested"
        - "Performance meets SLO"
        - "Security evidence artifacts (EVID-0008, EVID-0009, EVID-0011, EVID-0015) are fully populated and approved"
      evidence_required:
        - "Metrics dashboard screenshot"
        - "Alert configuration"
        - "Runbook links"
        - "DR test results"
        - "Performance benchmark"
        - "Security evidence artifacts"
      reviewers:
        - "AUTH_ARCHITECTURE"
        - "AUTH_SECURITY"
        - "AUTH_RELIABILITY"

  slos:
    - name: "Consensus Finalization Latency"
      target: "p99 < 500ms"
      measurement: "apm2_consensus_finalization_latency_seconds"

    - name: "Consensus Availability"
      target: "99.9% uptime (allows 8.7h/year downtime)"
      measurement: "Quorum available and accepting proposals"

    - name: "Anti-Entropy Sync Latency"
      target: "Full sync within 60s for 100k events"
      measurement: "Time from empty node to fully synced"

    - name: "Byzantine Detection Latency"
      target: "Equivocation detected within 10s"
      measurement: "Time from equivocation to evidence generation"
