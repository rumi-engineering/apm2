requirement:
  id: REQ-DCP-0001
  title: "IPC Privilege Separation"
  status: ACTIVE

  statement: |
    The daemon control plane MUST separate privileged (operator-only) and
    session-scoped endpoints using dual sockets (operator.sock + session.sock).
    Legacy JSON IPC listeners and JSONâ†’protobuf adapters are forbidden (DD-009).

  rationale: |
    Privilege separation prevents session processes from accessing operator-only
    endpoints even when UID matches. Dual-socket topology provides a mechanical
    boundary that is enforceable and fail-closed.

  acceptance_criteria:
    - id: AC-DCP-0001-001
      description: "Privileged endpoints are reachable only via operator.sock."
      verification: "ADV-001 and ADV-002 return PERMISSION_DENIED from session scope."
    - id: AC-DCP-0001-002
      description: "Session-scoped endpoints require session_token on session.sock."
      verification: "Session-scoped call without valid session_token is rejected."
    - id: AC-DCP-0001-003
      description: "Legacy JSON IPC listener is absent and single-socket configs are rejected."
      verification: "ADV-012 + config-parse tests demonstrate fail-closed behavior."
    - id: AC-DCP-0001-004
      description: "JSON frames sent to ProtocolServer sockets are rejected pre-handler."
      verification: "ADV-012 demonstrates downgrade attempts fail before handler logic."

  design_references:
    - "02_design_decisions.yaml#DD-001"
    - "02_design_decisions.yaml#DD-009"

  test_references:
    - "07_test_and_evidence.yaml#ADV-001"
    - "07_test_and_evidence.yaml#ADV-002"
    - "07_test_and_evidence.yaml#ADV-012"

  law_refs:
    - LAW-05
