rfc_design_decisions:
  schema_version: "2026-02-09"

  formal_security_model:
    state_tuple:
      symbol: "S"
      definition: "S = (join_state, revalidate_state, consume_state, effect_state, revocation_frontier, delegation_state, boundary_flow_state, projection_state, crypto_state, time_authority_state, drift_state)"
      required_lifecycle_order:
        - "join"
        - "revalidate"
        - "consume"
        - "effect"
      fail_closed_verdict_rule:
        statement: "If any required field is missing, stale, unknown, or unverifiable, decision is deny."

    core_predicates:
      - "pcac_join_valid"
      - "pcac_revalidate_valid"
      - "pcac_consume_valid"
      - "pcac_effect_guarded"
      - "pcac_single_consume_enforced"
      - "pcac_intent_digest_equal"
      - "pcac_revocation_dominant"
      - "pcac_replay_complete"
      - "delegation_meet_exact_valid"
      - "boundary_flow_admissible"
      - "pcac_trade_secret_mode_valid"
      - "pcac_projection_isolation_valid"
      - "projection_compromise_contained"
      - "time_authority_envelope_valid"
      - "promotion_temporal_ambiguity == false"

    security_theorem:
      statement: "Authoritative external effect is admissible iff all core predicates are true."

    shared_temporal_contracts:
      contracts:
        - id: "TP-EIO29-001"
          predicate: "time_authority_envelope_valid"
        - id: "TP-EIO29-008"
          predicate: "promotion_temporal_ambiguity == false"
      ownership_rule: |
        Canonical semantic anchor is RFC-0016 temporal substrate semantics.
        Canonical profile-contract ownership is RFC-0019 snapshot/matrix temporal
        contract surfaces. RFC-0029 section 3 is execution/evaluation profile
        mirror for temporal-economics composition and is not the sole ownership
        source for security admission.

    temporal_arbitration:
      evaluator_tuple:
        - "evaluator_id"
        - "predicate_id"
        - "contract_digest_set"
        - "canonicalizer_tuple"
        - "time_authority_ref"
        - "window_ref"
        - "verdict"
        - "deny_reason"
      outcomes:
        - outcome: "ARBITRATION_AGREED_ALLOW"
          required_behavior: "Continue gate flow."
        - outcome: "ARBITRATION_AGREED_DENY"
          required_behavior: "Fail-closed deny."
        - outcome: "ARBITRATION_DISAGREEMENT_TRANSIENT"
          required_behavior: "Enter freeze (S3) and require adjudication receipt before temporal_arbitration_deadline_window_ref."
        - outcome: "ARBITRATION_DISAGREEMENT_PERSISTENT"
          required_behavior: "Fail-closed deny plus mandatory evaluator/policy rebaseline workflow."
      ordering_rule: "Temporal arbitration is predicate-level and precedes mode-ladder arbitration."

  invariants:
    - id: "INV-SIO28-01"
      statement: "consume_count(ajc_id) <= 1"
    - id: "INV-SIO28-02"
      statement: "consume.intent_digest == effect.intent_digest"
    - id: "INV-SIO28-03"
      statement: "Revocation dominance at revalidate and consume."
    - id: "INV-SIO28-04"
      statement: "No-bypass effect path."
    - id: "INV-SIO28-05"
      statement: "Temporal ambiguity denial with shared temporal contracts TP-EIO29-001 and TP-EIO29-008 satisfied."
    - id: "INV-SIO28-06"
      statement: "Projection surface never becomes authority input."
    - id: "INV-SIO28-07"
      statement: "Delegation is exact meet, never widening."
    - id: "INV-SIO28-08"
      statement: "Disclosure-control policy constraints are non-regressible hard constraints (mode phase-qualified; default posture trade-secret-only)."

  delegation_meet_contract:
    authority_vectors:
      parent_symbol: "A"
      overlay_symbol: "O"
      delegated_symbol: "D"
    exact_meet_rule: "D == meet(A, O) across all constrained dimensions."

    meet_dimensions:
      - dimension: "capabilities"
        restriction_order: "subset"
        meet_operator: "set intersection"
      - dimension: "scope"
        restriction_order: "subset"
        meet_operator: "set intersection"
      - dimension: "risk tier ceiling"
        restriction_order: "<="
        meet_operator: "numeric minimum"
      - dimension: "budgets"
        restriction_order: "<="
        meet_operator: "per-budget numeric minimum"
      - dimension: "stop predicates"
        restriction_order: "conjunctive"
        meet_operator: "conjunction of normalized predicate clauses"
      - dimension: "expiry"
        restriction_order: "<="
        meet_operator: "minimum expiry tick"
      - dimension: "taint floor"
        restriction_order: ">="
        meet_operator: "maximum taint floor"
      - dimension: "confidentiality ceiling"
        restriction_order: "<="
        meet_operator: "minimum admissible disclosure class"
      - dimension: "required sanitizers"
        restriction_order: "subset"
        meet_operator: "set union (cannot remove required sanitizer constraints)"

    lineage_integrity:
      statement: "delegation_lineage_hash is validated as independent chain-integrity predicate lineage_chain_integrity_valid, not as a meet-lattice dimension."

    satisfiability:
      required_predicate: "delegation_satisfiable(D) == true"
      proof_obligation: "Must demonstrate at least one non-empty admissible workset under D (capability + scope + budget + temporal validity + stop predicates)."
      non_admissible_condition: "Meet outputs that are algebraically valid but vacuously restrictive (admissible_workset == empty) are non-admissible."

    depth_and_computation_bounds:
      - "delegation_depth(D) <= delegation_max_depth is mandatory for promotable delegation chains."
      - "Satisfiability evaluation must complete within delegation_satisfiability_budget_ticks."
      - "Depth overflow or satisfiability-budget exhaustion is non-admissible."

    determinism_contract:
      algorithm_id: "delegation_meet_exact_v1"
      rules:
        - "Identical canonical inputs must produce identical output across verifier implementations."
        - "Promotion-critical arithmetic is integer/tick-space only; floating-point arithmetic is non-admissible."
        - "Canonical equality is byte-for-byte equality of canonicalized payload bytes."
        - "Hash equality is admissible only when hash domain separation includes schema_id and schema_major; collision ambiguity is fail-closed deny."

    falsification_obligations:
      - id: "FALS-SIO28-0001"
        deny_condition: "Widening attempt at any depth."
      - id: "FALS-SIO28-0002"
        deny_condition: "Independent verifier disagreement."
      - id: "FALS-SIO28-0003"
        deny_condition: "Non-computable field."
      - id: "FALS-SIO28-0004"
        deny_condition: "Lineage chain integrity mismatch."
      - id: "FALS-SIO28-0005"
        deny_condition: "Vacuous delegation admitted as promotable."
      - id: "FALS-SIO28-0006"
        deny_condition: "Delegation depth above delegation_max_depth admitted as promotable."
      - id: "FALS-SIO28-0007"
        deny_condition: "Satisfiability-budget exhaustion treated as allow."

  cryptography:
    agility_policy:
      required_object: "CryptoAgilityPolicyV1"
      rules:
        - "Authority-bearing paths may use only algorithms explicitly admissible for active policy epoch."
        - "Downgrade from stronger to weaker algorithm requires explicit signed policy transition and is non-promotable for Tier2+ unless independent security adjudication clears it."
        - "Unknown algorithm identifiers are deny."

    key_rotation:
      continuity_evidence_required:
        - "Overlap signatures between retiring and new keyset."
        - "Keyset descriptor digest and validity window bound to temporal authority."
      unsafe_rotation_indicators:
        - "Abrupt key replacement without overlap evidence."
        - "Key epoch mismatch in authority receipts."
      enforcement: "Any unsafe indicator denies promotion-critical operations."

    compromise_response:
      compromise_windows:
        - "W_detect"
        - "W_revoke"
        - "W_reseal"
      required_behavior:
        - "Detect within W_detect."
        - "Revoke within W_revoke."
        - "Reseal mandatory artifacts within W_reseal."
      retroactive_invalidation:
        - "Receipts signed solely by compromised keys after compromise epoch are non-trusted."
        - "Receipts before compromise epoch require corroboration by independent non-compromised verifier evidence for continued promotion-critical use."

    post_compromise_recovery:
      mandatory_components:
        - "Fresh policy root"
        - "Reverified authority chain"
        - "Replay over affected windows"
        - "Explicit PostCompromiseRecoveryReceiptV1"
      enforcement: "Any missing component is fail-closed deny."

  boundary_flow:
    admissibility:
      predicate: "boundary_admit = capability_allow and taint_allow and classification_allow and declass_receipt_valid"

    redundancy_declassification:
      rule: "declass_reason = REDUNDANCY_PURPOSE is admissible only for coded redundancy fragments required by recoverability policy."
      mandatory_constraints:
        - "Must carry redundancy_declassification_receipt."
        - "Must not expose authority-bearing plaintext semantics beyond required fragment metadata."
        - "Unknown or unscoped redundancy declassification intent is fail-closed deny."

    leakage_budget:
      limit_rule: "L_boundary(window_ref) <= L_boundary_max(risk_tier)"
      typed_contract:
        unit: "leakage_bits"
        constraints:
          - "Estimator family and confidence metadata must be declared in signed receipts."
          - "Unknown estimator semantics or unit ambiguity is fail-closed deny."

    timing_channel:
      containment_rules:
        - "Authority-critical gate outcomes exposed to projection surfaces must be release-bucketed to fixed tick boundaries."
        - "Promotion-critical denial/allow timing variance above timing_channel_budget_ticks is treated as leakage-budget violation."
        - "Timing-channel violations emit structured defects and quarantine affected projection paths until mitigated."

    leakage_overrun_behavior:
      - "Emit structured defect."
      - "Quarantine affected boundary channel."
      - "Block promotion-critical paths until declassification adjudication receipts are admitted."

  degradation_and_halt:
    mode_ladder:
      - mode: "S0"
        label: "nominal"
      - mode: "S1"
        label: "constrained degrade"
      - mode: "S2"
        label: "continuity-only"
      - mode: "S3"
        label: "fail-closed freeze"
      - mode: "S4"
        label: "emergency halt"
    constraints:
      - "No mode may permit bypass of pcac_consume_valid or boundary-flow checks."
      - "Freeze duration is bounded by max_fail_closed_freeze_windows."
      - "Freeze budget exhaustion escalates to S4 and blocks promotion."
      - "S3 may permit bounded evidence-regeneration/time-authority-recovery workflows that cannot authorize new external effects."

    joint_state_rule:
      statement: "Effective operating state is joint tuple (S_i, D_j)."
      arbitration: "Use typed dominance comparator mode_dominance_select over (profile_id, mode_symbol, severity_class) tuples."
      fail_closed_condition: "Unresolved comparator state is fail-closed deny."
      dominance_rule: "Security constraints always dominate when policies conflict."
      lineage_note: "Canonical joint-state arbitration contract is maintained in RFC-0019 cross-RFC gate-order contract; this two-profile projection is a specialization of RFC-0019 multi-profile composition algebra."

    halt_deadlock_distinction:
      - "Halt is explicit policy state."
      - "Deadlock is lack of progress without explicit halt and must emit dedicated defect signal."

  semantic_drift_contract:
    compatibility_surfaces:
      - "RFC-0016 temporal semantics"
      - "RFC-0019 snapshot and gate-order contracts"
      - "RFC-0028 security predicates and gates"
      - "RFC-0029 temporal and economics interlock predicates"

    diff_classes:
      - "NON_SEMANTIC"
      - "SEMANTIC_SAFE"
      - "SEMANTIC_RISKY"
      - "AMBIGUOUS"

    policy:
      non_promotable_classes:
        - "SEMANTIC_RISKY"
        - "AMBIGUOUS"
      adjudication_rule: "Ambiguity must be adjudicated before semantic_drift_deadline_window_ref; timeout is fail-closed deny."

  key_design_decisions:
    - decision_id: "DD-SIO28-0001"
      title: "Fail-closed security profile over PCAC lifecycle"
      status: "ACCEPTED"
      statement: "External effect admission is denied unless lifecycle and security predicates are all satisfied under fail-closed semantics."
      rationale: "Lifecycle correctness without explicit security-plane constraints is insufficient for adversarial external I/O."
      requirement_ids:
        - "REQ-0001"
        - "REQ-0002"

    - decision_id: "DD-SIO28-0002"
      title: "Predicate-complete admissibility theorem"
      status: "ACCEPTED"
      statement: "Authoritative external effect is admissible iff all fifteen core security predicates evaluate true."
      rationale: "A complete predicate basis prevents partial-evidence admission and blocks ambiguity masking."
      requirement_ids:
        - "REQ-0001"
        - "REQ-0002"
        - "REQ-0004"

    - decision_id: "DD-SIO28-0003"
      title: "Delegation exact-meet with satisfiability and depth bounds"
      status: "ACCEPTED"
      statement: "Promotion-critical delegation requires deterministic exact meet, satisfiability proof of non-empty workset, and bounded depth/computation."
      rationale: "Algebraic correctness without non-vacuity and bounded evaluation permits unsafe or non-terminating delegation paths."
      requirement_ids:
        - "REQ-0003"

    - decision_id: "DD-SIO28-0004"
      title: "Shared temporal arbitration is fail-closed"
      status: "ACCEPTED"
      statement: "Shared temporal predicates TP-EIO29-001 and TP-EIO29-008 are evaluated via canonical evaluator tuple with explicit arbitration outcomes and deny-on-ambiguity."
      rationale: "Temporal disagreement must not silently degrade into permissive admission for promotion-critical paths."
      requirement_ids:
        - "REQ-0002"
        - "REQ-0009"

    - decision_id: "DD-SIO28-0005"
      title: "Crypto agility with compromise windows and recovery proof"
      status: "ACCEPTED"
      statement: "Authority-bearing paths require epoch-bound algorithm allowlists, overlap-proven key rotation, compromise window obligations, and explicit post-compromise recovery receipts."
      rationale: "Downgrade and key-compromise scenarios must remain measurable, bounded, and fail-closed."
      requirement_ids:
        - "REQ-0002"
        - "REQ-0006"
        - "REQ-0009"

    - decision_id: "DD-SIO28-0006"
      title: "Typed boundary-flow and redundancy-purpose declassification"
      status: "ACCEPTED"
      statement: "Boundary admission is capability/taint/classification/declassification constrained, with typed leakage budgets and narrowly-scoped REDUNDANCY_PURPOSE declassification."
      rationale: "Containment and disclosure controls require explicit typed policy surfaces, not implicit best-effort behavior."
      requirement_ids:
        - "REQ-0004"
        - "REQ-0007"

    - decision_id: "DD-SIO28-0007"
      title: "Projection isolation and direct-GitHub authority elimination"
      status: "ACCEPTED"
      statement: "Production agent runtimes are forbidden from direct GitHub authority classes; projection writes are admitted only through isolated projection workers with receipt linkage."
      rationale: "Separating authority plane from projection plane constrains blast radius and preserves CAS+ledger truth roots under compromise."
      requirement_ids:
        - "REQ-0008"
        - "REQ-0009"

    - decision_id: "DD-SIO28-0008"
      title: "Mode-ladder containment with semantic drift blocking"
      status: "ACCEPTED"
      statement: "Security mode ladder S0-S4 and semantic drift classes enforce containment dominance and block promotion on ambiguous or risky drift."
      rationale: "Operational degradation and inter-RFC drift must remain policy-bounded, explicit, and fail-closed."
      requirement_ids:
        - "REQ-0006"
        - "REQ-0009"
