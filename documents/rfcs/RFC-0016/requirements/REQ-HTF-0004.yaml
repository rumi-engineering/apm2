requirement:
  id: REQ-HTF-0004
  title: "CausalTime stamping at message boundaries"
  status: ACTIVE

  statement: |
    Any cross-node or inter-holon message boundary carries a CausalTime (HLC)
    stamp. Receivers update their local HLC state using the HLC receive
    algorithm and emit defects on monotonicity violations.

    CausalTime is used only for correlation/cause tracing; it is not
    authoritative for protocol ordering or expiry.

  rationale: |
    Federation requires a causality stamp to stitch traces and detect anomalies
    without relying on cross-node wall time comparisons.

  acceptance_criteria:
    - id: AC-HTF-0004-001
      description: "Messages include HLC stamps when messaging exists."
      verification: "Protocol conformance tests for message envelopes."

    - id: AC-HTF-0004-002
      description: "Receivers update HLC state and preserve happens-before."
      verification: "Unit tests for HLC tick/receive rules."

    - id: AC-HTF-0004-003
      description: "HLC regressions emit defects and may quarantine senders by policy."
      verification: "Fault injection tests trigger HLC_REGRESSION."

  design_references:
    - "02_design_decisions.yaml#definitions_and_time_model"

  test_references:
    - "07_test_and_evidence.yaml#HLC Causality"

  law_refs:
    - LAW-15
