rfc_risks_and_open_questions:
  schema_version: "2026-01-27"
  template_version: "2026-01-27"
  rfc_id: RFC-0011

  risks:
    - id: RSK-0001
      statement: Canonicalizer divergence causes hash drift across implementations or versions
      impact: Breaks CAS dedupe, provenance, and stable-ID pinning
      likelihood: MEDIUM
      severity: CRITICAL
      mitigations:
        - Golden test vectors committed and run in CI
        - Versioned canonicalizer; include canonicalizer_version in receipts
        - Cross-language compatibility tests if multiple implementations exist
        - Canonicalizer id recorded in artifact envelopes
      evidence_ids:
        - EVID-0001
      status: OPEN
      owner: TBD

    - id: RSK-0002
      statement: Schema strictness slows iteration during early adoption
      impact: Machines may fail admission frequently; frustration and workarounds
      likelihood: HIGH
      severity: MEDIUM
      mitigations:
        - Bootstrap with small schema set and evolve intentionally
        - Provide machine-generated patch tooling that auto-validates before submission
        - Use staged rollout with warn, soft-fail, and hard-fail phases (TRADEOFF-0001)
      evidence_ids:
        - EVID-0002
      tradeoff_cluster: STRICTNESS_VS_VELOCITY
      status: MITIGATED_BY_DESIGN
      owner: TBD

    - id: RSK-0003
      statement: Target delivery churn breaks export pipeline due to vendor changes
      impact: External agent tooling stops working or requires urgent changes
      likelihood: MEDIUM
      severity: MEDIUM
      mitigations:
        - Version target profiles and pin in packs
        - Conformance tests run in AAT; failures become defects
        - Maintain fallback exports for critical vendors
      evidence_ids:
        - EVID-0006
      status: OPEN
      owner: TBD

    - id: RSK-0004
      statement: Consumption hermeticity causes early friction as packs are incomplete
      impact: Tasks fail because packs are incomplete; perceived as regressions
      likelihood: HIGH
      severity: MEDIUM
      mitigations:
        - Treat failures as compiler defects and fix packs quickly
        - Allow limited, explicitly budgeted escape hatches with strong defect emission
        - Prioritize pack completeness for most common workflows
        - Feedback SLA: 24h during rollout, 48h post-rollout
      evidence_ids:
        - EVID-0005
        - EVID-0010
      tradeoff_cluster: STRICTNESS_VS_VELOCITY
      status: MITIGATED_BY_DESIGN
      owner: TBD

    - id: RSK-0005
      statement: Indexing DCP from ledger becomes a performance bottleneck at scale
      impact: Stable-ID resolution and fetch becomes slow; consumption holons blocked
      likelihood: MEDIUM
      severity: HIGH
      mitigations:
        - Maintain a cached projection store (rebuildable from ledger)
        - Shard by namespace/kind; keep hot indexes in memory
        - Include compaction checkpoints
      evidence_ids:
        - EVID-0004
      status: OPEN
      owner: TBD

    - id: RSK-0006
      statement: Patch soup without compaction leads to unbounded history growth
      impact: Review and replay become slow or error-prone
      likelihood: MEDIUM
      severity: MEDIUM
      mitigations:
        - Define compaction thresholds (depth/time/size) per artifact kind
        - Require ChangeSet summaries to accompany compaction snapshots
        - Maintain provenance links from snapshots back to patch chains
      evidence_ids:
        - EVID-0003
      status: OPEN
      owner: TBD
      related_question: Q-0007

    - id: RSK-0007
      statement: Target profile miscalibration causes frequent failures for weaker models
      impact: Context budgets or rendering policies miscalibrated; tasks fail
      likelihood: MEDIUM
      severity: MEDIUM
      mitigations:
        - Default to conservative budgets; adjust via measured RunReceipt data
        - Maintain per-model profiles and gate by capability manifest
        - Automate profile tuning based on sufficiency metrics
      evidence_ids:
        - EVID-0009
      status: OPEN
      owner: TBD

    - id: RSK-0008
      statement: Bootstrap/ledger incompatibility creates deadlock during upgrades
      impact: Neither old nor new binary can operate; system unavailable
      likelihood: LOW
      severity: CRITICAL
      mitigations:
        - Pre-upgrade compatibility check (apm2 upgrade --check-compatibility)
        - Bootstrap-safe-mode for diagnostics
        - Emergency override with triple-signoff ceremony
        - Tiered recovery protocol (TIER_1 through TIER_4)
        - Rollback compatibility matrix
      evidence_ids:
        - EVID-0008
      status: MITIGATED_BY_DESIGN
      owner: TBD

  open_questions:
    - id: Q-0001
      question: |
        Exact canonicalization spec: strict RFC 8785 JCS vs a stricter CAC profile;
        how to publish, pin, and version test vectors and canonicalizer IDs?
      decision_needed_by: Phase 1 (Foundations)
      resolution_plan: |
        Define CAC-specific deviations from JCS (if any). Publish test vectors as
        governed artifacts in bootstrap bundle. Record canonicalizer_id in all receipts.
      priority: CRITICAL
      status: OPEN
      assigned_to: TBD

    - id: Q-0002
      question: |
        Stable ID namespace governance: who can mint namespaces, and how are
        collisions prevented across org/projects?
      decision_needed_by: Phase 2 (Admission + Provenance)
      resolution_plan: |
        Define namespace minting policy. Consider hierarchical namespaces with
        org/project prefixes. Implement collision detection in admission gate.
      priority: HIGH
      status: OPEN
      assigned_to: TBD

    - id: Q-0003
      question: |
        Do we need typed kernel events (ControlArtifactEvent) in the MVP, or is
        EvidencePublished metadata sufficient?
      decision_needed_by: Phase 2 (Admission + Provenance)
      resolution_plan: |
        Start with EvidencePublished metadata. Evaluate queryability and policy
        enforcement needs post-MVP. Add typed events if metadata proves insufficient.
      priority: MEDIUM
      status: DEFERRED
      deferral_rationale: |
        Out-of-scope for MVP per PRD non-goals. EvidencePublished metadata is
        sufficient for initial implementation.
      assigned_to: N/A

    - id: Q-0004
      question: |
        How to represent large binary artifacts within CAC-JSON (likely via CAS
        refs only) and enforce policies consistently?
      decision_needed_by: Phase 3 (Deterministic Fetch)
      resolution_plan: |
        Define a blob reference schema that includes CAS hash and size bounds.
        Policy enforces max size; large artifacts are stored in CAS, not inline.
      priority: HIGH
      status: OPEN
      assigned_to: TBD

    - id: Q-0005
      question: |
        Should defect records be first-class kernel events or remain evidence
        artifacts referenced by events?
      decision_needed_by: Phase 4 (ContextPack Compiler)
      resolution_plan: |
        Start with defects as evidence artifacts. Evaluate whether first-class
        events improve queryability and recurrence detection.
      priority: MEDIUM
      status: OPEN
      assigned_to: TBD

    - id: Q-0006
      question: |
        TargetProfile schema: what is the minimal stage taxonomy (plan/implement/
        review/ops) and which policies must be mandatory vs optional?
      decision_needed_by: Phase 5 (Target Delivery)
      resolution_plan: |
        Define minimal stage set based on current workflows. Make budget policies
        mandatory; rendering policies optional with defaults.
      priority: HIGH
      status: OPEN
      assigned_to: TBD

    - id: Q-0007
      question: |
        Compaction policy: when does patch depth require snapshotting, and how
        are ChangeSet summaries preserved across compaction?
      decision_needed_by: Post-MVP
      resolution_plan: |
        Define compaction thresholds based on observed patch depths. Require
        ChangeSet summaries as compaction inputs. Maintain provenance links.
      priority: LOW
      status: DEFERRED
      deferral_rationale: |
        Post-MVP enhancement. Initial implementation can accept unbounded patch
        history with periodic manual compaction.
      assigned_to: N/A

  resolved_unknowns:
    description: |
      RFC v2 (Grounded): All 7 Known Unknowns resolved by Council investigation.
      Session: COUNCIL-RFC-0011-20260127-EXPLORE
      Subagents: SA-1 (Structural Rigorist), SA-2 (Implementation Feasibility), SA-3 (Anti-Cousin Guardian)

    codebase_discoveries:
      - area: Canonicalizer integration
        question: How does new CAC canonicalizer relate to existing determinism/canonicalize.rs?
        investigation_target: crates/apm2-core/src/determinism/canonicalize.rs
        status: RESOLVED
        hypothesis_validated: true
        resolution: |
          New CAC-JSON canonicalizer required (YAML one inadequate for JSON-only mandate).
          Extension point: impl Canonicalize trait (events/canonical.rs:38-86).
          Create new canonicalize_json.rs with RFC 8785 JCS profile + CAC constraints.
        investigator: SA-1
        confidence: 95%

      - area: Ledger event emission
        question: What event families exist and how to add CAC-specific events?
        investigation_target: crates/apm2-core/src/events/
        status: RESOLVED
        hypothesis_validated: true
        resolution: |
          Dual-path approach: Kernel events (hash-chained) + CI events (observability).
          Kernel: Add ContextEvent to Payload oneof (tag 18+).
          CI: Add CACAdmissionReceipt referencing kernel hash.
        investigator: SA-1
        confidence: 92%

      - area: Policy engine integration
        question: How to integrate consumption mode restrictions with existing policy engine?
        investigation_target: crates/apm2-core/src/policy/engine.rs
        status: RESOLVED
        hypothesis_validated: true
        resolution: |
          RuleType enum is #[non_exhaustive] - add ConsumptionMode variant.
          Rule struct needs stable_ids Vec<String> field (parallel to existing paths).
          matches_consumption_rule() validates stable_id allowlist.
        investigator: SA-2
        confidence: 89%

      - area: Tool protocol extension
        question: How to add ArtifactFetch to existing tool protocol?
        investigation_target: crates/apm2-core/src/tool/
        status: RESOLVED
        hypothesis_validated: true
        resolution: |
          ArtifactPublish already exists (write direction); add ArtifactFetch (read direction).
          Proto oneof tag 17 available. Validation in validation.rs validate_artifact_fetch().
          Policy routing via get_tool_name() -> "artifact.fetch".
        investigator: SA-2
        confidence: 88%

      - area: Holon episode integration
        question: How to emit RunReceipts from holon execution?
        investigation_target: crates/apm2-holon/src/episode/controller.rs
        status: RESOLVED
        hypothesis_validated: true
        resolution: |
          EpisodeResult already contains needed data (tokens_consumed, time_consumed_ms, artifact_count).
          Emit receipt at line 647-655 before EpisodeLoopResult::new().
          Use existing event framework; do NOT create parallel EpisodeReceipt event type.
          Anti-cousin: Emit as artifact with EvidenceCategory::ExecutionReceipt.
        investigator: SA-3
        confidence: 91%

      - area: Build.rs bootstrap embedding
        question: How to embed bootstrap schema bundle at build time?
        investigation_target: crates/apm2-core/build.rs
        status: RESOLVED
        hypothesis_validated: true
        resolution: |
          prost_build pattern (lines 12-35) directly applicable.
          Generate bundle in build.rs, use include_bytes! + hash verification.
          Runtime verify_bootstrap_hash() fails startup on mismatch.
          Use EvidenceCategory::BootstrapSchema (extend enum if needed).
        investigator: SA-3
        confidence: 93%

      - area: AAT harness integration
        question: How does new selftest harness relate to existing xtask/src/aat module?
        investigation_target: xtask/src/aat/
        status: RESOLVED
        hypothesis_validated: true
        resolution: |
          HypothesisExecutor is stateless and reusable (executor.rs:81-93).
          Create CacSchemaTest adapter, not parallel hierarchy.
          Add cac_harness.rs under xtask/src/aat/ (NOT xtask/src/cac_test/).
          Reuse ALLOWED_ENV_VARS allowlist for environment isolation.
        investigator: SA-3
        confidence: 90%

  remaining_open_questions:
    description: |
      RFC v4 (Standard): All architectural questions resolved by Council FINALIZE session.
      Session: COUNCIL-RFC-0011-20260127-FINALIZE
      Vote: 2/3 READY (SA-1, SA-3), 1/3 NOT_READY (SA-2) with remediation path

    questions:
      - id: Q-0001-v2
        question: |
          Canonicalizer test vector governance: How to version and pin test vectors
          in bootstrap? Who can update vectors and when?
        decision_needed_by: Phase 1 (Foundations)
        priority: HIGH
        status: DEFERRED
        blocking: false
        rationale: |
          Non-blocking governance question. Implementation proceeds with initial vector set
          pinned in bootstrap bundle. Governance procedures (who can update, approval process)
          defined post-Phase-1 as operational policy.
        deferral_target: Post-Phase-1 operational documentation

      - id: Q-0002-v2
        question: |
          Stable ID namespace governance: Hierarchical format decided ("org:project:kind:id"),
          but specific namespace minting policy needs definition.
        decision_needed_by: Phase 2 (Admission + Provenance)
        priority: MEDIUM
        status: RESOLVED
        blocking: false
        resolution: |
          COUNCIL-RFC-0011-20260127-FINALIZE resolved:
          - Format: "namespace:kind:identifier[@version]" (hierarchical, colon-separated)
          - Reserved prefixes: "cac:*" (system), "bootstrap:*" (immutable), "internal:*" (kernel)
          - Collision detection: Admission gate rejects duplicate stable_id via namespace registry
          - MVP scope: "cac:" namespace sufficient; org namespace minting deferred
          - CNS-0009 requires registration with DOMAIN_KERNEL for new namespaces

      - id: Q-0006-v2
        question: |
          Consumption mode signal propagation: How does ToolRequest receive consumption_mode flag?
          Protocol doesn't yet carry this metadata.
        decision_needed_by: Phase 2 (Admission + Provenance)
        priority: HIGH
        status: RESOLVED
        blocking: false
        resolution: |
          COUNCIL-RFC-0011-20260127-FINALIZE resolved:
          - Add consumption_mode: bool field to ToolRequest message header
          - SessionContext propagates consumption_mode from EpisodeConfig
          - Policy engine reads consumption_mode from ToolRequest header
          - Implementation path: Extend apm2.tool.v1 proto, update validation.rs
          - Tracking ticket: CAC-TCK-0009 (ArtifactFetch implementation)

      - id: Q-0004-v2
        question: |
          Large binary artifact representation: How to handle non-JSON artifacts within
          CAC framework? What is the inlining threshold?
        decision_needed_by: Phase 4 (ContextPack Compiler)
        priority: HIGH
        status: RESOLVED
        blocking: false
        resolution: |
          COUNCIL-RFC-0011-20260127-FINALIZE resolved:
          - Inline threshold: Artifacts <= 10KB inlined as base64 in manifest
          - Large artifacts: Reference by content_hash only; stored in CAS
          - Binary hashing: BLAKE3 of raw bytes (not of base64 encoding)
          - Manifest includes size_bytes field for budget enforcement
          - Tracking ticket: CAC-TCK-0011 (ContextPack compiler)
