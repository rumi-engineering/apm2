evidence_artifact:
  schema_version: "2026-02-07"
  id: "EVID-0304"
  title: "Bounded decode and verifier resource economics evidence"
  category: "UNIT_TEST_RESULT"
  status: "PASS"
  description: |
    Evidence that bounded decode economics are enforced before and after
    proof decoding for directory proof verification. Decode bounds are applied
    before allocation-heavy parsing, and structural limits (depth, siblings,
    non-default sibling inflation) fail closed during verification.

    This artifact binds TCK-00357 hardening tests to the RFC-0020 evidence
    registry for bounded verifier economics under REQ-0011.

    TCK-00359 extends verifier economics evidence with cache amortization
    and invalidation correctness tests under REQ-0013 (see EVID-0013).
  requirement_ids:
    - "REQ-0011"
    - "REQ-0013"
  source_refs:
    - "documents/rfcs/RFC-0020/07_test_and_evidence.yaml"
    - "crates/apm2-daemon/src/identity/directory_proof.rs"
  artifacts:
    - type: "test_output"
      description: |
        Pre-decode byte/sibling bounds:
        - test_proof_exceeds_max_proof_bytes_rejected
        - test_proof_exceeds_max_siblings_rejected
        - test_truncated_proof_bytes_rejected
      ref:
        - "cargo test -p apm2-daemon identity::directory_proof::tests::test_proof_exceeds_max_proof_bytes_rejected"
        - "cargo test -p apm2-daemon identity::directory_proof::tests::test_proof_exceeds_max_siblings_rejected"
        - "cargo test -p apm2-daemon identity::directory_proof::tests::test_truncated_proof_bytes_rejected"
    - type: "test_output"
      description: |
        Post-decode depth/node economics:
        - test_empty_siblings_list_rejected
        - test_proof_exceeds_max_depth_rejected
        - test_proof_exceeds_profile_max_depth_rejected
        - directory_proof_rejects_non_default_sibling_inflation
      ref:
        - "cargo test -p apm2-daemon identity::directory_proof::tests::test_empty_siblings_list_rejected"
        - "cargo test -p apm2-daemon identity::directory_proof::tests::test_proof_exceeds_max_depth_rejected"
        - "cargo test -p apm2-daemon identity::directory_proof::tests::test_proof_exceeds_profile_max_depth_rejected"
        - "cargo test -p apm2-daemon identity::directory_proof::tests::directory_proof_rejects_non_default_sibling_inflation"
    - type: "test_output"
      description: |
        Kind compatibility fail-closed admission checks:
        - test_patricia_proof_rejected_at_admission
        - test_profile_kind_mismatch_rejected
      ref:
        - "cargo test -p apm2-daemon identity::directory_proof::tests::test_patricia_proof_rejected_at_admission"
        - "cargo test -p apm2-daemon identity::directory_proof::tests::test_profile_kind_mismatch_rejected"
