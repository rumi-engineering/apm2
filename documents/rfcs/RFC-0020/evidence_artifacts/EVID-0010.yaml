evidence_artifact:
  schema_version: "2026-02-07"
  id: "EVID-0010"
  title: "Directory head and identity proof artifact family evidence"
  category: "UNIT_TEST_RESULT"
  status: "PASS"
  description: |
    Evidence that REQ-0010 is implemented in the daemon identity and protocol
    layers. HolonDirectoryHeadV1, DirectoryProofV1, and IdentityProofV1 are
    implemented as deterministic CAS-addressable artifacts with explicit decode
    bounds and fail-closed validation. Authoritative identity-bearing boundary
    requests now require `identity_proof_hash` pointers and reject unproofed
    identity inputs.

    Phase 1 enforcement level (WVR-0103): Handler admission validates
    `identity_proof_hash` as a 32-byte non-zero shape commitment. Full CAS
    dereference and IdentityProofV1::verify() at admission time is deferred
    to TCK-00359 (CAS transport integration). The hash is bound into ALL
    signed ledger event payloads (both APPROVE and BLOCKED paths) for audit
    traceability.

    Entry status is proof-derived (TCK-00356 Fix 4): DirectoryProofV1 carries
    the entry_status field committed into the directory leaf by the directory
    authority. IdentityProofV1::verify() extracts status from the proof rather
    than accepting it as a caller parameter, preventing status bypass.

    Verification coverage includes:
    - SMT_256 proof verification against directory root commitments
    - proof byte bound enforcement (`proof_bytes_len <= max_proof_bytes`)
    - identity proof binding checks across cell/holon/head commitments
    - freshness-policy and tick-based staleness checks
    - boundary handler rejection when `identity_proof_hash` is missing/invalid
    - identity_proof_hash binding in both APPROVE and BLOCKED signed payloads
    - proof-derived entry status rejection for Revoked/Suspended entries
  requirement_ids:
    - "REQ-0010"
  source_refs:
    - "documents/rfcs/RFC-0020/requirements/REQ-0010.yaml"
    - "crates/apm2-daemon/src/identity/mod.rs"
    - "crates/apm2-daemon/src/identity/directory_proof.rs"
    - "proto/apm2d_runtime_v1.proto"
    - "crates/apm2-daemon/src/protocol/dispatch.rs"
    - "crates/apm2-daemon/src/protocol/apm2.daemon.v1.rs"
    - "documents/work/waivers/WVR-0103.yaml"
  artifacts:
    - type: "test_output"
      description: |
        Directory-head/proof artifact tests cover deterministic canonical bytes,
        bounded decoding, SMT root reconstruction, stale-proof rejection,
        missing-cell-hash fail-closed behavior, CAS fetch/decode round-trip,
        and proof-derived entry status rejection.
      ref: "cargo test -p apm2-daemon identity::directory_proof"
    - type: "test_output"
      description: |
        Authoritative review-receipt ingestion rejects missing/invalid
        identity_proof_hash pointers (fail-closed).
      ref: "cargo test -p apm2-daemon test_ingest_review_receipt_missing_identity_proof_hash_rejected"
    - type: "test_output"
      description: |
        Authoritative sublease delegation rejects missing/invalid
        identity_proof_hash pointers (fail-closed).
      ref: "cargo test -p apm2-daemon test_delegate_sublease_missing_identity_proof_hash_rejected"
    - type: "test_output"
      description: |
        Blocked review receipt signed payload contains identity_proof_hash
        (TCK-00356 Fix 2), ensuring audit binding parity with the APPROVE path.
      ref: "cargo test -p apm2-daemon test_blocked_receipt_payload_contains_identity_proof_hash"
