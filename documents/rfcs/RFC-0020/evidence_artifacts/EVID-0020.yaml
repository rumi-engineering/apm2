evidence_artifact:
  schema_version: "2026-01-23"
  id: "EVID-0020"
  title: "Optional VDF profile correctness and fail-closed enforcement evidence"
  category: "UNIT_TEST_RESULT"
  status: "PASS"
  description: |
    Evidence that optional VDF profiles used by EpochSealV1 satisfy RFC-0020
    requirements for deterministic challenge derivation, bounded validation,
    forged-proof rejection, and fail-closed handling of unimplemented
    verification schemes.

    This artifact covers TCK-00366 quality fixes and integrated behavior:
    - Deterministic challenge derivation from (cell_id, prior_epoch_root,
      quorum_anchor)
    - Sloth-v1 output verification and deterministic forged-output rejection
    - Fail-closed rejection for PietrzakV1 until cryptographic verification is
      implemented
    - Epoch seal policy integration for VDF-required links, including
      minimum-difficulty checks and challenge binding
    - Non-monotone VDF-sealed epoch rejection in verifier state progression
  requirement_ids:
    - "REQ-0020"
  source_refs:
    - "crates/apm2-core/src/htf/vdf_profile.rs"
    - "crates/apm2-core/src/htf/epoch_seal.rs"
  artifacts:
    - type: "test_output"
      description: |
        VDF profile contract and challenge determinism:
        - challenge_derivation_is_deterministic
        - challenge_derivation_binds_all_inputs
        - profile_input_hash_matches_derived_challenge
        - profile_new_rejects_zero_input_hash
        - profile_new_rejects_empty_output
        - profile_new_rejects_oversized_output
        - profile_new_rejects_zero_difficulty
        - profile_new_rejects_difficulty_above_max
      ref: "cargo test -p apm2-core htf::vdf_profile::tests::"
    - type: "test_output"
      description: |
        VDF proof verification and fail-closed behavior:
        - sloth_verify_accepts_valid_profile
        - sloth_verify_rejects_forged_output
        - pietrzak_verifier_fails_closed_until_implemented
        - default_verifier_rejects_pietrzak_profiles_fail_closed
      ref: "cargo test -p apm2-core htf::vdf_profile::tests::"
    - type: "test_output"
      description: |
        Epoch seal integration with VDF profiles and policy:
        - valid_sloth_vdf_profile_passes_verification
        - required_policy_accepts_vdf_when_min_difficulty_satisfied
        - vdf_present_without_vdf_verifier_is_rejected_fail_closed
        - required_policy_rejects_missing_vdf_profile
        - required_policy_rejects_vdf_below_minimum_difficulty
        - forged_vdf_output_is_rejected_deterministically
        - vdf_challenge_mismatch_is_rejected
        - non_monotone_vdf_sealed_epochs_are_rejected
        - vdf_profile_validation_rejects_bounded_violations
      ref: "cargo test -p apm2-core epoch_seal::tests::"
