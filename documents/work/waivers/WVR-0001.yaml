# WVR-0001: Gitleaks Secret Scanning Removal
# This waiver documents the intentional removal of gitleaks from CI
# due to trust boundary concerns with third-party scanning services.

waiver:
  schema_version: "2026-01-30"
  id: "WVR-0001"
  title: "Removal of Gitleaks Secret Scanning from CI"

  status: "APPROVED"

  scope:
    gate_ids:
      - "GATE-CI-SECRET-SCAN"
    requirement_ids: []
    quality_dimension_ids:
      - "SECURITY"

  rationale: |
    Third-party secret scanning tools (such as gitleaks-action) require sending
    codebase content to external services. This creates a trust boundary concern:
    the scanning service itself becomes a potential vector for credential exposure.

    By transmitting code to external parties for security scanning, we paradoxically
    increase the attack surface for credential leakage. The external service:
    - Receives full code diffs including potentially sensitive patterns
    - May cache or log scanned content
    - Represents an additional trust boundary that must be secured
    - Could be compromised, exposing all scanned repositories

    The security posture is improved by not transmitting potentially sensitive code
    to external parties, accepting the tradeoff of reduced automated secret detection.

  mitigations:
    - description: "Manual code review for secret hygiene during PR review"
      type: PROCEDURAL
      owner: "All reviewers"

    - description: "Targeted git log searches (git log -p -S) for suspected patterns"
      type: PROCEDURAL
      owner: "Security reviewer on-demand"

    - description: "Developer education on secret handling best practices"
      type: PROCEDURAL
      owner: "Team leads"

    - description: "Use of .gitignore for sensitive file patterns (.env, credentials, keys)"
      type: TECHNICAL
      owner: "Repository configuration"

    - description: "Pre-commit hooks for local secret detection (optional, developer-controlled)"
      type: TECHNICAL
      owner: "Individual developers"

  expiration_date: "2027-01-30"
  # Annual review required; renewal decision based on:
  # - Availability of self-hosted secret scanning solutions
  # - Changes in trust model for third-party services
  # - Incident history related to secret exposure

  required_signoffs:
    - "AUTH_SECURITY"

  evidence_ids:
    - "EVID-WVR-0001-COMMIT"

  references:
    pr_url: "https://github.com/rumi-engineering/apm2/pull/255"
    commit_sha: "96be98bd60a2aa221da71a130b6c55a25a29c8f4"
    commit_message: "chore(ci): remove gitleaks secret scan job"
    related_commit: "d685fb6"
    related_commit_message: "docs: remove gitleaks references from security documentation"

  approval:
    approver: "repository_owner"
    approval_date: "2026-01-30"
    approval_notes: |
      Approved based on trust boundary analysis. The risk of exposing code to
      third-party services outweighs the benefit of automated secret scanning.
      Mitigations through manual review and developer education are deemed sufficient.

  created_date: "2026-01-30"
  last_updated: "2026-01-30"
