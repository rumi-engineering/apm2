ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00577"
    title: "Receipt store permissions model: dedicated service user ownership + CLI writes only via broker APIs (minimize attacker write access)"
    status: "MERGED"
  binds:
    prd_id: "PRD-PLACEHOLDER"
    rfc_id: "RFC-0019"
    requirements: []
    evidence_artifacts: []
  custody:
    agent_roles: ["AGENT_IMPLEMENTER"]
    responsibility_domains: ["DOMAIN_SECURITY", "DOMAIN_RUNTIME"]
  dependencies:
    tickets:
      - ticket_id: "TCK-00528"
        reason: "Systemd units and service user model exist."
      - ticket_id: "TCK-00536"
        reason: "Permissions validation exists."
  scope:
    in_scope:
      - "Define a dedicated FAC service user (system-mode recommended)."
      - "Ensure `$APM2_HOME/private/fac/receipts` and queue directories are owned and writable only by that user."
      - "CLI commands that enqueue jobs MUST interact with broker/worker APIs rather than writing directly to queue when not running as service user."
      - "Maintain backward compatibility only via explicit `--unsafe-local-write` mode."
    out_of_scope:
      - "Multi-user ACL UI."
  plan:
    steps:
      - "Update runbooks and systemd units to run broker/worker as service user."
      - "Update CLI to request enqueue via broker endpoint when not privileged."
      - "Add permission checks and clear errors."
  definition_of_done:
    evidence_ids: []
    criteria:
      - "Non-service-user processes cannot forge receipts/queue files in default deployment."
      - "CLI still works via broker-mediated enqueue."
