ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00411"
    title: "Close residual direct status-write surfaces in executable review prompts and xtask UX contracts"
    status: "OPEN"
  binds:
    prd_id: "PRD-0009"
    rfc_id: "RFC-0018"
    requirements:
      - requirement_id: "REQ-HEF-0001"
        requirement_ref: "documents/rfcs/RFC-0018/requirements/REQ-HEF-0001.yaml#rfc_requirement"
      - requirement_id: "REQ-HEF-0010"
        requirement_ref: "documents/rfcs/RFC-0018/requirements/REQ-HEF-0010.yaml#rfc_requirement"
    evidence_artifacts:
      - evidence_id: "EVID-HEF-0001"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0001.yaml#rfc_evidence_artifact"
      - evidence_id: "EVID-HEF-0012"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0012.yaml#rfc_evidence_artifact"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
      - "AGENT_REVIEWER"
    responsibility_domains:
      - "DOMAIN_SECURITY"
      - "DOMAIN_RUNTIME"
      - "DOMAIN_BUILD_RELEASE"
  dependencies:
    tickets:
      - ticket_id: "TCK-00297"
        reason: "Stage X3 removed runtime status-write callsites but left executable prompt/docs drift unresolved."
      - ticket_id: "TCK-00405"
        reason: "Merge-gate enforcement should consume the same authoritative review contract this ticket hardens."
      - ticket_id: "TCK-00408"
        reason: "This ticket decomposes the prompt/docs closure portion of fail-closed side-effect cutover."
  scope:
    in_scope:
      - "Remove any direct GitHub status-write command (`gh api ... /statuses/...`) from executable review prompt assets used by xtask flows."
      - "Update `xtask` command help, usage text, and operator-facing logs so they do not claim direct status updates are performed."
      - "Deprecate or remove stale status-write control flags/messages that no longer affect behavior (`XTASK_ALLOW_STATUS_WRITES`, strict-mode write hints)."
      - "Add a deterministic repository lint that fails CI if direct status-write command strings reappear in prompt or xtask assets."
      - "Add regression tests for review/push flows that assert log text reflects removed writes (log-only/projection-only semantics)."
    out_of_scope:
      - "Reintroducing direct status writes from xtask or prompt runners."
      - "Changing daemon projection transport or merge policy logic."
      - "Bulk rewrite of review rubric content unrelated to status-write side effects."
  plan:
    steps:
      - "Patch `documents/reviews/CODE_QUALITY_PROMPT.md` to remove direct status-write actions and align with projection-only status semantics."
      - "Audit and update stale status-write wording in `xtask/src/main.rs`, `xtask/src/tasks/push.rs`, `xtask/src/tasks/review.rs`, `xtask/src/tasks/security_review_exec.rs`, and `xtask/src/util.rs`."
      - "Add a CI lint script (for example in `scripts/lint/`) that fails on `gh api --method POST` combined with `/statuses/` outside explicitly approved projection adapters."
      - "Add tests that validate status-removal messaging and no-op flag behavior in xtask review/push execution paths."
      - "Run cargo fmt --all && cargo clippy --workspace --all-targets --all-features -- -D warnings && cargo test --workspace."
  definition_of_done:
    evidence_ids:
      - "EVID-HEF-0001"
      - "EVID-HEF-0012"
    criteria:
      - "No executable review prompt or xtask flow contains a direct `/statuses/` write command."
      - "CI fails closed if direct status-write command strings are reintroduced."
      - "CLI/help/log output does not claim status checks are directly updated by xtask."
      - "Status-write flags that no longer influence runtime behavior are removed or explicitly marked inert with deterministic output."
      - "Regression tests cover the removed-write behavior and updated operator-facing contract text."
  notes:
    context: |
      Root cause observed in PR #443 re-review: Stage X3 removed direct status
      writes from Rust callsites, but an executable prompt still contained a
      `gh api ... /statuses/...` action and multiple operator-visible strings
      still advertised direct status updates. This left a hidden side-effect
      path and a stale control-plane contract.
    files: |
      - documents/reviews/CODE_QUALITY_PROMPT.md
      - xtask/src/main.rs
      - xtask/src/tasks/push.rs
      - xtask/src/tasks/review.rs
      - xtask/src/tasks/security_review_exec.rs
      - xtask/src/util.rs
      - scripts/lint/
      - .github/workflows/ci.yml
    security: |
      - Prompt/runtime surfaces must be treated as executable policy, not passive docs.
      - Side-effect affordances must be single-source-of-truth and fail closed.
      - Any mismatch between runtime behavior and operator contract is a policy bypass risk.
