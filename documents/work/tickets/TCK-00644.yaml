ticket_meta:
  schema_version: '2026-01-29'
  template_version: '2026-01-29'
  ticket:
    id: TCK-00644
    title: 'RFC-0032 Phase 3: enforce implementer claimability via BLOCKS edges + doctor diagnostics (waivers/late edges)'
    status: OPEN
  binds:
    prd_id: PRD-PLACEHOLDER
    rfc_id: RFC-0032
    requirements: []
    evidence_artifacts: []
  custody:
    agent_roles:
    - AGENT_IMPLEMENTER
    responsibility_domains:
    - DOMAIN_DAEMON
    - DOMAIN_PROJECTION
    - DOMAIN_TOOLING
  dependencies:
    tickets:
    - ticket_id: TCK-00643
      reason: Requires graph projections
    - ticket_id: TCK-00637
      reason: ClaimWorkV2 exists
  scope:
    in_scope:
    - 'Enforce claimability rule in ClaimWorkV2(IMPLEMENTER): reject claim if any unsatisfied incoming BLOCKS edge exists (prereq not Completed and no active waiver)'
    - Extend doctor output to surface blocked edges, active waivers (with expiry), and late edges added after work already in progress
    - Define severity levels and stable machine-readable reason strings for claim denial and diagnostics
    out_of_scope:
    - Auto-transitioning work state due to late edges (explicitly forbidden by RFC; WorkReducer remains sole authority)
  plan:
    steps:
    - 'Add projection queries: incoming BLOCKS edges and waiver state for a work_id'
    - Update ClaimWorkV2 handler to consult projections and fail with CAPABILITY_REQUEST_REJECTED when blocked
    - 'Update doctor logic to include: prerequisites not done, waiver expiry timers, and late-edge warnings when to_work state is already Claimed/InProgress/CiPending'
    - 'Add tests: blocked claim fails; waiver allows claim; late edge produces diagnostic without state mutation'
  definition_of_done:
    evidence_ids: []
    criteria:
    - Implementer claims are blocked when dependencies are not satisfied (unless waived).
    - Doctor output is fully derivable from ledger+CAS+projections and updates on relevant pulses/events.
    - Late edges are diagnosed but do not mutate work state automatically.
