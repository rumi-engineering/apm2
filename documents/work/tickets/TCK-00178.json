{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-27",
    "template_version": "2026-01-27",
    "ticket": {
      "id": "TCK-00178",
      "title": "Refactor security prompts and address findings",
      "status": "COMPLETED"
    },
    "binds": {
      "rfc_id": "RFC-0013",
      "requirements": [
        {
          "requirement_id": "REQ-SEC-001"
        }
      ]
    }
  },
  "acceptance_criteria": [
    {
      "criterion": "Shell injection prevention in xtask",
      "verification": "All model parameters passed to script commands are properly escaped"
    },
    {
      "criterion": "Panic-free protocol configuration",
      "verification": "FrameCodec configuration methods return Result instead of panicking"
    },
    {
      "criterion": "Consistent security documentation",
      "verification": "DoS and other security terms are properly formatted in backticks"
    }
  ],
  "implementation": {
    "files_to_modify": [
      {
        "path": "xtask/src/shell_escape.rs",
        "purpose": "Escape model parameter in build_script_command"
      },
      {
        "path": "crates/apm2-daemon/src/protocol/framing.rs",
        "purpose": "Change config methods to return Result"
      },
      {
        "path": "crates/apm2-daemon/src/protocol/server.rs",
        "purpose": "Update calls to framing config methods"
      }
    ],
    "implementation_steps": [
      {
        "step": 1,
        "action": "Fix shell injection in xtask",
        "details": "Apply escape_for_single_quote to model parameter in build_script_command. [DONE]"
      },
      {
        "step": 2,
        "action": "Refactor FrameCodec configuration",
        "details": "Change with_max_size and set_max_frame_size to return ProtocolResult. [DONE]"
      },
      {
        "step": 3,
        "action": "Update daemon protocol server",
        "details": "Update Connection::new and upgrade_to_full_frame_size to handle new Result types. [DONE]"
      },
      {
        "step": 4,
        "action": "Fix documentation formatting",
        "details": "Wrap DoS in backticks in protocol documentation. [DONE]"
      }
    ],
    "summary": "Refactor security prompts and xtask reviewers to eliminate shell injection\nrisks and potential panics in the protocol layer. Verified with workspace\nClippy and 2000+ tests.\n"
  },
  "notes": "Addressing security review findings for PR #199.\n",
  "test_requirements": [
    {
      "description": "Clippy check",
      "test_id": "LINT-00178-01",
      "verification_command": "cargo clippy --workspace --all-targets --all-features -- -D warnings"
    },
    {
      "description": "Workspace tests",
      "test_id": "TEST-00178-01",
      "verification_command": "cargo test --workspace --all-targets --all-features"
    }
  ]
}
