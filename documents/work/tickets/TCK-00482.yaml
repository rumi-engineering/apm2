ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00482"
    title: "PCAC mandatory cutover for DelegateSublease handler"
    status: "OPEN"
  binds:
    prd_id: "PRD-0009"
    rfc_id: "RFC-0027"
    requirements:
      - requirement_id: "REQ-0004"
        requirement_ref: "documents/rfcs/RFC-0027/requirements/REQ-0004.yaml#requirement"
      - requirement_id: "REQ-0006"
        requirement_ref: "documents/rfcs/RFC-0027/requirements/REQ-0006.yaml#requirement"
      - requirement_id: "REQ-0013"
        requirement_ref: "documents/rfcs/RFC-0027/requirements/REQ-0013.yaml#requirement"
    evidence_artifacts:
      - evidence_id: "EVID-0003"
        artifact_ref: "documents/rfcs/RFC-0027/evidence_artifacts/EVID-0003.yaml#evidence_artifact"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
      - "AGENT_REVIEWER"
    responsibility_domains:
      - "DOMAIN_RUNTIME"
      - "DOMAIN_SECURITY"
      - "DOMAIN_AUTHN_AUTHZ"
  dependencies:
    tickets:
      - ticket_id: "TCK-00424"
        reason: "TCK-00424 landed the optional PCAC wiring behind require_ajc_for_delegate_sublease policy flag."
      - ticket_id: "TCK-00426"
        reason: "Durable consume index must be available for mandatory single-consume enforcement."
  scope:
    in_scope:
      - "Set require_ajc_for_delegate_sublease to mandatory (remove policy toggle; PCAC is the only authority path)."
      - "Delete scattered authority checks in DelegateSublease handler that the PCAC kernel now covers: manual caller auth binding (~12 lines), manual HTF lease time authority validation (~18 lines), manual delegation narrowing/lineage checks (~40 lines), manual idempotent replay closure (~193 lines of full-tuple constant-time comparison)."
      - "Ensure kernel join/consume handles all replaced checks: identity binding via join input, freshness via revalidate, delegation narrowing via Law 5, linear consumption via DurableConsumeIndex."
      - "Retain field admission checks (bounded decode, length validation) as pre-kernel input validation — these are not authority checks."
      - "Retain sublease orchestrator issuance and persistence logic — PCAC gates authority, not business logic."
      - "Add regression tests proving: (a) no sublease issuance without consume(), (b) delegation widening denied by kernel, (c) stale authority denied by revalidate, (d) duplicate consume denied by durable index."
    out_of_scope:
      - "IngestReviewReceipt handler changes (TCK-00483)."
      - "Shared input builder extraction (TCK-00484)."
      - "Sovereignty epoch composition for Tier2+ sublease delegation."
  plan:
    steps:
      - "Remove require_ajc_for_delegate_sublease policy flag; make PCAC lifecycle unconditional."
      - "Identify and delete each scattered authority check that the kernel join/revalidate/consume now covers."
      - "Verify that kernel deny classes cover all removed check failure modes (DelegationWidening, StaleFreshness, LinearConsumptionViolation, InvalidDelegationChain)."
      - "Add negative tests for each removed check path via kernel deny."
      - "Run cargo fmt --all && cargo clippy --workspace --all-targets --all-features -- -D warnings && cargo doc --workspace --no-deps && cargo test --workspace."
  definition_of_done:
    evidence_ids:
      - "EVID-0003"
    criteria:
      - "No scattered authority checks remain in DelegateSublease handler outside of PCAC kernel calls."
      - "require_ajc_for_delegate_sublease flag is removed; PCAC lifecycle is unconditional."
      - "Estimated ~200-260 lines of scattered checks deleted, replaced by kernel calls."
      - "All deny cases previously handled by scattered checks are now handled by kernel deny taxonomy."
      - "Regression tests prove no authority-bearing sublease issuance without consume()."
  notes:
    security: |
      This ticket transitions DelegateSublease from dual-path (scattered + optional PCAC) to single-path
      (PCAC-only). The scattered checks being removed are NOT lost — they are subsumed by kernel laws
      (Law 1: linear consumption, Law 4: revocation dominance, Law 5: delegation narrowing, Law 6: boundary monotonicity).
    verification: |
      Include before/after line count evidence showing code reduction. Each deleted check must map to
      a kernel law or deny class that covers the same failure mode.
    general: |
      Completes RFC-0027 Phase 2 for the DelegateSublease path. TCK-00424 landed the optional wiring;
      this ticket makes it mandatory and deletes the old path.
