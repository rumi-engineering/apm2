ticket_meta:
  schema_version: "2026-01-24"
  template_version: "2026-01-24"
  ticket:
    id: "TCK-00312"
    title: "FAC v0 NEW WORK REQUIRED: ReviewReceipt artifacts + ledger event"
  binds:
    prd_id: "PRD-0009"
    rfc_id: "RFC-0018"
    requirements:
      - requirement_id: "REQ-HEF-0010"
        requirement_ref: "documents/rfcs/RFC-0018/requirements/REQ-HEF-0010.yaml#requirement"
    evidence_artifacts:
      - evidence_id: "EVID-HEF-0011"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0011.yaml#evidence_artifact"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
    responsibility_domains:
      - "DOMAIN_KERNEL"
      - "DOMAIN_EVIDENCE"
      - "DOMAIN_DAEMON"
  dependencies:
    tickets:
      - ticket_id: "TCK-00286"
        reason: "Foundational daemon infrastructure required"
      - ticket_id: "TCK-00287"
        reason: "Protocol server infrastructure required"
      - ticket_id: "TCK-00288"
        reason: "Episode runtime infrastructure required"
      - ticket_id: "TCK-00290"
        reason: "Tool broker infrastructure required"
      - ticket_id: "TCK-00293"
        reason: "CAS storage infrastructure required"
      - ticket_id: "TCK-00310"
        reason: "ChangeSetBundleV1 and ChangeSetPublished required for changeset_digest binding"
      - ticket_id: "TCK-00314"
        reason: "Capability allowlists required for CAS access"
      - ticket_id: "TCK-00254"
        reason: "RFC-0017: Session capability manifest infrastructure required"
      - ticket_id: "TCK-00260"
        reason: "RFC-0017: Tool execution context required"
  scope:
    in_scope:
      - "Create ReviewArtifactBundleV1 schema for reviewer outputs"
      - "Store review text in CAS as part of ReviewArtifactBundleV1"
      - "Store tool logs in CAS as part of ReviewArtifactBundleV1"
      - "Add ReviewReceiptRecorded ledger event type to kernel_events.proto"
      - "Bind ReviewReceipt to changeset_digest from ChangeSetPublished"
      - "Bind ReviewReceipt to time_envelope_ref for temporal anchoring"
      - "Add review receipt validation logic to evidence module"
      - "Emit ReviewReceiptRecorded from episode runtime on review completion"
    out_of_scope:
      - "Review execution logic (handled by episode runtime)"
      - "Workspace setup (covered by TCK-00311)"
      - "GateReceipt generation (downstream of ReviewReceipt)"
      - "End-to-end FAC harness (covered by TCK-00313)"
      - "GitHub integration for review storage"
  plan:
    steps:
      - "Read existing kernel_events.proto and evidence module structure"
      - "Design ReviewArtifactBundleV1 schema with fields for review_text_cas_hash, tool_logs_cas_hash, metadata"
      - "Create schemas/apm2/review_artifact_bundle_v1.yaml with full schema definition"
      - "Add ReviewReceiptRecorded event type to proto/kernel_events.proto with changeset_digest and artifact_bundle_hash fields"
      - "Implement review receipt validation in crates/apm2-core/src/evidence/"
      - "Wire episode runtime to store review outputs to CAS on completion"
      - "Wire episode runtime to emit ReviewReceiptRecorded with correct bindings"
      - "Add time_envelope_ref binding for temporal anchoring"
      - "Add tests for review receipt generation and validation"
      - "Verify ReviewReceiptRecorded events are queryable from ledger"
  definition_of_done:
    evidence_ids:
      - "EVID-HEF-0011"
    criteria:
      - "ReviewReceiptRecorded references ReviewArtifactBundleV1 CAS hash."
      - "ReviewReceipt binds changeset_digest + time_envelope_ref."
  notes:
    security: "default-deny, least privilege, fail-closed"
    verification: "Verify ReviewArtifactBundleV1 CAS hash is computed before ledger event emission"
    general: "Part of FAC v0 Preconditions group; review artifacts form the evidence chain for gate decisions"
