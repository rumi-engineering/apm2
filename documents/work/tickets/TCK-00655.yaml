ticket_meta:
  schema_version: '2026-01-29'
  template_version: '2026-01-29'
  ticket:
    id: TCK-00655
    title: 'RFC-0032: system acceptance tests AT-1..AT-5 (work open+graph; terminal contract; PR mapping; pulse wait; merge completion)'
    status: OPEN
  binds:
    prd_id: PRD-PLACEHOLDER
    rfc_id: RFC-0032
    requirements: []
    evidence_artifacts: []
  custody:
    agent_roles:
    - AGENT_QA
    - AGENT_IMPLEMENTER
    responsibility_domains:
    - DOMAIN_TESTING
    - DOMAIN_DAEMON
    - DOMAIN_CLI
    - DOMAIN_PROTOCOL
  dependencies:
    tickets:
    - ticket_id: TCK-00635
      reason: OpenWork required for AT-1
    - ticket_id: TCK-00643
      reason: Work graph required for AT-1
    - ticket_id: TCK-00640
      reason: fac push work-id terminal contract required for AT-2
    - ticket_id: TCK-00639
      reason: PR association required for AT-3
    - ticket_id: TCK-00653
      reason: Pulse plane required for AT-4
    - ticket_id: TCK-00654
      reason: Doctor wait integration must be pulse-driven for AT-4
    - ticket_id: TCK-00650
      reason: Merge completion fix required for AT-5
  scope:
    in_scope:
    - "Implement AT-1..AT-5 as reproducible system tests matching RFC-0032 section 15 acceptance contract."
    - Ensure tests are promotion-blocking and run in CI (or at least have a CI-fast subset with nightly full run)
    out_of_scope:
    - Benchmarking/performance testing (separate performance tickets if required)
  plan:
    steps:
    - Create a test harness capable of running daemon + CLI against a temp repo and temp ledger DB
    - 'Implement AT-1: open work A/B, add BLOCKS edge, claim enforcement, complete prereq and re-claim'
    - 'Implement AT-2: session terminates without push triggers doctor/nudge, then fac push with work-id creates required markers and transitions to CiPending'
    - 'Implement AT-3: PR association mapping uses WorkSpec repo identity; ensure (owner,name,pr) uniqueness'
    - 'Implement AT-4: subscribe to work.<id>.> and assert pulse-driven doctor reevaluation triggers without polling'
    - 'Implement AT-5: simulate merge completion and assert merge receipt + work.completed semantics correct (no misnamed gate_receipt_id)'
  definition_of_done:
    evidence_ids: []
    criteria:
    - AT-1..AT-5 exist, are reproducible, and fail with actionable diagnostics.
    - Test coverage is sufficient to block promotion on drift against RFC-0032 invariants.
  notes:
    verification: Prefer black-box tests using operator protocol and CLI binaries rather than calling internal Rust modules directly.

fac_security_contract:
  source: documents/work/tickets/FAC_SECURITY_MODEL_INVARIANTS_V1.yaml
  profile: FAC-RFC0032-BASELINE
  required_invariants:
    - INV-FAC-TRUTH-001
    - INV-FAC-WORK-BIND-001
    - INV-FAC-CLAIM-BIND-001
    - INV-FAC-ACTOR-BIND-001
    - INV-FAC-IDEMP-001
    - INV-FAC-EVID-001
  enforcement_requirements:
    - Any new requirement, code path, or test added under this ticket must map to one or more required_invariants.
    - Any invariant relaxation requires explicit amendment in this ticket and the shared security model document.
    - Reviewer denial is expected for invariant-unmapped behavior changes.
