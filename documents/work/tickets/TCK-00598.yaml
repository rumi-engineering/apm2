ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00598"
    title: "Headless GitHub App auth for `apm2 fac pr` (eliminate `APM2_GITHUB_APP_ID` flakiness)"
    status: "OPEN"
  binds:
    prd_id: "PRD-PLACEHOLDER"
    rfc_id: "RFC-0019"
    requirements: []
    evidence_artifacts: []
  custody:
    agent_roles: ["AGENT_IMPLEMENTER"]
    responsibility_domains: ["DOMAIN_RUNTIME", "DOMAIN_SECURITY"]
  dependencies:
    tickets:
      - ticket_id: "TCK-00596"
        reason: "Credential injection + redaction standards."
  scope:
    in_scope:
      - "Add non-interactive mode(s) for GitHub App config provisioning:"
      - "  * accept app_id + installation_id + private key path via flags (no prompts)"
      - "  * support writing `$APM2_HOME/github_app.toml` for non-secret config"
      - "  * support provisioning the private key via systemd credentials (preferred) or controlled file fallback"
      - "Improve error messages for missing GitHub app config to include service-user paths and systemd-credential guidance."
    out_of_scope:
      - "Key rotation automation (future)."
  plan:
    steps:
      - "Extend `apm2 fac pr auth-setup` with `--non-interactive` and `--for-systemd` variants."
      - "Ensure it works when no desktop keyring is present (headless VPS)."
      - "Update docs and `apm2 fac doctor --include-secrets` checks."
  definition_of_done:
    evidence_ids: []
    criteria:
      - "A headless compute host can run `apm2 fac pr auth-setup --app-id ... --installation-id ... --private-key-file ... --for-systemd` successfully."
      - "No requirement for a desktop keyring; systemd credentials path works. The `--for-systemd` flag skips keyring entirely."
      - "Missing GitHub app config does not affect `apm2 fac gates`."
