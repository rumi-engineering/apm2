{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-24",
    "template_version": "2026-01-24",
    "ticket": {
      "id": "TCK-00052",
      "title": "Implement anti-gaming logic"
    },
    "binds": {
      "prd_id": "PRD-0003",
      "rfc_id": "RFC-0004",
      "requirements": [
        {
          "requirement_id": "REQ-0004",
          "requirement_ref": "documents/prds/PRD-0003/requirements/REQ-0004.yaml#prd_requirement"
        },
        {
          "requirement_id": "REQ-0005",
          "requirement_ref": "documents/prds/PRD-0003/requirements/REQ-0005.yaml#prd_requirement"
        }
      ],
      "evidence_artifacts": [
        {
          "evidence_id": "EVID-0004",
          "artifact_ref": "documents/prds/PRD-0003/evidence_artifacts/EVID-0004.yaml#prd_evidence_artifact"
        },
        {
          "evidence_id": "EVID-0005",
          "artifact_ref": "documents/prds/PRD-0003/evidence_artifacts/EVID-0005.yaml#prd_evidence_artifact"
        }
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_SECURITY",
        "DOMAIN_BUILD_RELEASE"
      ]
    },
    "dependencies": {
      "tickets": [
        {
          "ticket_id": "TCK-00050",
          "reason": "Requires shared types: GamingViolation, AntiGamingResult, TodoItem, KnownLimitation"
        }
      ]
    },
    "scope": {
      "in_scope": [
        "Create xtask/src/aat/anti_gaming.rs module",
        "Add pub mod anti_gaming to xtask/src/aat/mod.rs",
        "Implement detect_if_test_patterns(diff: &str) -> Vec<GamingViolation>",
        "Implement detect_hardcoded_uuids(diff: &str) -> Vec<GamingViolation>",
        "Implement detect_mock_patterns(diff: &str) -> Vec<GamingViolation>",
        "Implement extract_todos(diff: &str) -> Vec<TodoItem>",
        "Implement check_todos_documented(todos, known_limitations) -> Vec<GamingViolation>",
        "Implement analyze_diff(diff: &str, known_limitations: &[KnownLimitation]) -> AntiGamingResult",
        "Each violation includes: file path, line number, pattern matched, context snippet",
        "Write unit tests for each detection pattern",
        "Write tests for TODO cross-referencing logic"
      ],
      "out_of_scope": [
        "Type definitions (TCK-00050)",
        "ML-based gaming detection",
        "Cross-PR pattern analysis",
        "Input variation testing (behavioral, handled by AAT skill)",
        "Automatic fix suggestions",
        "PR parsing (TCK-00051)",
        "Evidence bundling (TCK-00053)"
      ]
    },
    "plan": {
      "steps": [
        "Add pub mod anti_gaming to xtask/src/aat/mod.rs",
        "Create xtask/src/aat/anti_gaming.rs",
        "Import types from crate::aat::types",
        "Implement IF_TEST_REGEX: /if\\s+(is_)?test/, /cfg\\(test\\)/, /#\\[cfg\\(test\\)\\]/",
        "Implement UUID_REGEX: /[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i",
        "Implement MOCK_REGEX: /mock_\\w+/, /stub_\\w+/, /fake_\\w+/",
        "Implement TODO_REGEX: /TODO:|FIXME:|HACK:/",
        "Parse unified diff format to extract file paths and line numbers",
        "Implement cross-reference logic: TODO text must appear in Known Limitations",
        "Aggregate all violations into AntiGamingResult",
        "Write unit tests for each detection pattern",
        "Write tests for TODO cross-referencing logic"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-0004",
        "EVID-0005"
      ],
      "criteria": [
        "xtask/src/aat/anti_gaming.rs exists",
        "pub mod anti_gaming declared in xtask/src/aat/mod.rs",
        "detect_if_test_patterns() catches: if is_test, if test, cfg(test), #[cfg(test)]",
        "detect_hardcoded_uuids() catches UUID v4 patterns in added lines",
        "detect_mock_patterns() catches mock_, stub_, fake_ prefixed identifiers",
        "extract_todos() finds TODO, FIXME, HACK comments with file/line info",
        "check_todos_documented() flags TODOs not in Known Limitations",
        "analyze_diff() returns passed=true when no violations",
        "analyze_diff() returns passed=false with violation list when violations found",
        "Unit tests cover all pattern types",
        "cargo build succeeds",
        "cargo test passes",
        "cargo clippy passes with no warnings"
      ]
    },
    "notes": {
      "security": "This is security-critical - detects adversarial gaming of acceptance tests",
      "verification": "Test with synthetic diffs containing known gaming patterns",
      "general": "Uses types from TCK-00050. Focus on low false-positive rate."
    }
  }
}
