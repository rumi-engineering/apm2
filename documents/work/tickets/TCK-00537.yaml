ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00537"
    title: "Safe atomic file I/O primitives: atomic JSON write + O_NOFOLLOW open + bounded read helper (queue/leases/receipts)"
    status: "OPEN"
  binds:
    prd_id: "PRD-PLACEHOLDER"
    rfc_id: "RFC-0019"
    requirements: []
    evidence_artifacts: []
  custody:
    agent_roles: ["AGENT_IMPLEMENTER"]
    responsibility_domains: ["DOMAIN_SECURITY", "DOMAIN_RUNTIME"]
  dependencies:
    tickets: []
  scope:
    in_scope:
      - "Implement atomic writer: write to temp file in same directory, fsync, rename."
      - "Implement safe opener: refuse symlinks with O_NOFOLLOW (where available) and verify metadata."
      - "Implement bounded JSON reader (size cap, deny_unknown_fields) reused across queue and receipts."
      - "Migrate queue/lease/scheduler state writers to these helpers."
    out_of_scope:
      - "General-purpose FS library."
  plan:
    steps:
      - "Implement helper module."
      - "Refactor call sites to use helper."
      - "Add tests for symlink refusal and atomicity."
  definition_of_done:
    evidence_ids: []
    criteria:
      - "Queue and lease files cannot be replaced via symlink tricks in default mode."
      - "Partial writes do not produce malformed state; atomic rename ensures consistency."
