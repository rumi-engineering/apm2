ticket_meta:
  schema_version: "2026-01-25"
  template_version: "2026-01-25"
  ticket:
    id: "TCK-00074"
    title: "Implement AI-Powered Hypothesis Generation"
  binds:
    prd_id: "NONE"
    rfc_id: "RFC-0006"
    requirements:
      - requirement_id: "AAT-002"
        requirement_ref: "documents/rfcs/RFC-0006/01_problem_and_imports.yaml#rfc_local_requirements.requirements[15]"
    evidence_artifacts: []
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
    responsibility_domains:
      - "DOMAIN_BUILD_RELEASE"
  dependencies:
    tickets:
      - "TCK-00073"
  scope:
    in_scope:
      - "Replace stub generate_hypotheses() in aat.rs:207-251"
      - "Create prompt template for hypothesis generation"
      - "Invoke configured AI tool with PR description + diff"
      - "Parse AI response into Vec<Hypothesis>"
      - "Ensure at least 3 hypotheses with at least 1 error handling case"
    out_of_scope:
      - "Hypothesis caching"
      - "Multiple prompt template variants"
  plan:
    steps:
      - "Verify documents/reviews/AAT_HYPOTHESIS_PROMPT.md exists and update if needed"
      - "Template includes: PR description, diff summary, expected output format"
      - "Output format: JSON array of hypothesis objects"
      - "Replace generate_hypotheses() stub with AI invocation"
      - "Use AatToolConfig to select AI backend"
      - "Write prompt to temp file, invoke AI tool with input redirect"
      - "Parse JSON response into Vec<Hypothesis>"
      - "Validate: at least 3 hypotheses, at least 1 tests_error_handling=true"
      - "If validation fails, return error with actionable message"
      - "Verify cargo build succeeds"
      - "Verify cargo test passes"
      - "Verify cargo clippy passes with no warnings"
  definition_of_done:
    evidence_ids: []
    criteria:
      - "AAT_HYPOTHESIS_PROMPT.md verified and updated if needed"
      - "generate_hypotheses() invokes configured AI tool"
      - "AI response is parsed into Vec<Hypothesis>"
      - "At least 3 hypotheses are generated"
      - "At least 1 hypothesis has tests_error_handling=true"
      - "Errors from AI tool are propagated with context"
      - "cargo build succeeds"
      - "cargo test passes"
      - "cargo clippy passes with no warnings"
  notes:
    implementation_details: |
      Prompt template structure:
      ```markdown
      # Hypothesis Generation for AAT

      ## PR Description
      $PR_DESCRIPTION

      ## Diff Summary
      $DIFF_SUMMARY

      ## Instructions
      Generate testable hypotheses for this PR. Each hypothesis should:
      1. Have a clear prediction about behavior
      2. Include a verification method (command to run)
      3. At least one hypothesis MUST test error handling

      ## Output Format
      Return ONLY a JSON array:
      ```json
      [
        {
          "id": "H-001",
          "prediction": "When X, then Y",
          "verification_method": "cargo test test_name",
          "tests_error_handling": false
        }
      ]
      ```

      Generate at least 3 hypotheses.
      ```

      AI invocation pattern:
      ```rust
      let mut prompt_file = NamedTempFile::new()?;
      prompt_file.write_all(prompt.as_bytes())?;
      let prompt_path = prompt_file.path().display().to_string();

      let output = Command::new("sh")
          .args(["-c", &format!(
              "script -qec \"{} --yolo < '{}'\" /dev/null",
              config.ai_tool.command(),
              prompt_path
          )])
          .output()?;
      ```
    affected_files: |
      Existing: documents/reviews/AAT_HYPOTHESIS_PROMPT.md (verify and update if needed)
      Modified: xtask/src/tasks/aat.rs (replace generate_hypotheses stub)
