{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-24",
    "template_version": "2026-01-24",
    "ticket": {
      "id": "TCK-00063",
      "title": "Add Restart Monotonicity Boundary Tests"
    },
    "binds": {
      "prd_id": "NONE",
      "rfc_id": "RFC-0006",
      "requirements": [
        {
          "requirement_id": "MAINT-009",
          "requirement_ref": "documents/rfcs/RFC-0006/01_problem_and_imports.yaml#rfc_local_requirements.requirements[?]"
        }
      ],
      "evidence_artifacts": []
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_TESTING"
      ]
    },
    "dependencies": {
      "tickets": []
    },
    "scope": {
      "in_scope": [
        "Add test_restart_monotonicity_boundary_cases test function",
        "Test restart_attempt 0 -> 0 transition MUST FAIL",
        "Test restart_attempt 0 -> 1 transition MUST succeed",
        "Test restart_attempt 5 -> 5 transition MUST FAIL",
        "Test restart_attempt 5 -> 6 transition MUST succeed",
        "Test restart_attempt u32::MAX -> any transition MUST FAIL (overflow protection)",
        "Add test_restart_preserves_terminal_state_data test function",
        "Verify last_restart_attempt preserved in terminal states",
        "Verify resume_cursor preserved in terminal states",
        "Verify error context preserved in Crashed state"
      ],
      "out_of_scope": [
        "Changes to the reducer implementation logic",
        "Changes to SessionState struct definitions",
        "Integration tests or end-to-end tests",
        "Performance testing"
      ]
    },
    "plan": {
      "steps": [
        "Read crates/apm2-core/src/session/reducer.rs to understand existing test structure",
        "Identify the test module location and existing test patterns",
        "Implement test_restart_monotonicity_boundary_cases function",
        "Create test case for restart_attempt 0 -> 0 (assert failure/rejection)",
        "Create test case for restart_attempt 0 -> 1 (assert success)",
        "Create test case for restart_attempt 5 -> 5 (assert failure/rejection)",
        "Create test case for restart_attempt 5 -> 6 (assert success)",
        "Create test case for restart_attempt u32::MAX overflow scenario (assert failure)",
        "Implement test_restart_preserves_terminal_state_data function",
        "Create assertions for last_restart_attempt preservation in terminal states",
        "Create assertions for resume_cursor preservation in terminal states",
        "Create assertions for error context preservation in Crashed state",
        "Run cargo test to verify all new tests pass",
        "Run cargo clippy to ensure no warnings"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [],
      "criteria": [
        "test_restart_monotonicity_boundary_cases test exists and passes",
        "restart_attempt 0 -> 0 transition correctly rejected",
        "restart_attempt 0 -> 1 transition correctly accepted",
        "restart_attempt 5 -> 5 transition correctly rejected",
        "restart_attempt 5 -> 6 transition correctly accepted",
        "restart_attempt u32::MAX overflow correctly handled",
        "test_restart_preserves_terminal_state_data test exists and passes",
        "Terminal state data preservation verified for last_restart_attempt",
        "Terminal state data preservation verified for resume_cursor",
        "Error context preservation verified for Crashed state",
        "cargo build succeeds",
        "cargo test passes",
        "cargo clippy passes with no warnings"
      ]
    },
    "notes": {
      "security": "No security impact - test-only changes with no production code modifications",
      "affected_file": "crates/apm2-core/src/session/reducer.rs (test module)"
    }
  }
}
