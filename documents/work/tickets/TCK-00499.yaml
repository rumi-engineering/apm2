ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00499"
    title: "Spine conformance suite: no-bypass, replay across restart, tamper detection, fail-closed prerequisites, anti-rollback anchoring, downgrade resistance, and bounded-work regressions"
    status: "OPEN"
  binds:
    prd_id: "PRD-0010"
    rfc_id: "RFC-0019"
    requirements:
      - requirement_id: "REQ-0027"
        requirement_ref: "documents/rfcs/RFC-0019/requirements/REQ-0027.yaml#requirement"
    evidence_artifacts:
      - evidence_id: "EVID-0022"
        artifact_ref: "documents/rfcs/RFC-0019/evidence_artifacts/EVID-0022.yaml#evidence_artifact"
  custody:
    agent_roles: ["AGENT_QA", "AGENT_IMPLEMENTER", "AGENT_REVIEWER"]
    responsibility_domains: ["DOMAIN_SECURITY", "DOMAIN_RUNTIME", "DOMAIN_PERFORMANCE"]
  dependencies:
    tickets:
      - ticket_id: "TCK-00494"
        reason: "Need at least one endpoint migrated to kernel for meaningful no-bypass tests."
      - ticket_id: "TCK-00496"
        reason: "Quarantine semantics must be implemented to test saturation and flood cases."
      - ticket_id: "TCK-00500"
        reason: "Ledger trust verification + policy root resolver are required to test tamper detection and fail-closed prerequisites."
      - ticket_id: "TCK-00501"
        reason: "Effect execution journal/idempotency is required to test crash-restart and in-doubt handling safely."
      - ticket_id: "TCK-00502"
        reason: "Anti-rollback anchoring is required to meaningfully test rollback threat closure."
  scope:
    in_scope:
      - "No-bypass tests: authoritative endpoints cannot invoke effect/consume/quarantine outside kernel."
      - "Replay tests: duplicate consume denied across restart (PCAC-gated effects and declassification receipt consumption)."
      - "Fail-closed prerequisite tests: missing governance policy root or missing authoritative witnesses denies for fail-closed tiers."
      - "Ledger tamper tests: payload tampering is detected via signature verification; chain breaks detected; startup validation is checkpoint-bounded."
      - "Anti-rollback tests: rollback-to-earlier-seal that would pass local seal verification is denied when external anchor is enforced."
      - "Bounded-work tests: admission hot paths do not scan unbounded ledger history; startup validation is not O(N)."
      - "Output gating tests: fail-closed tier flows cannot release output (including streaming partials) before post-effect boundary checks complete."
      - "Digest-cycle regression tests: AdmissionBundle sealing cannot depend on receipt ids that depend on the bundle digest; CAC overlay cycles are prevented."
      - "Crash-window tests: restart during NotStarted/Started/Completed/Unknown states yields fail-closed behavior for fail-closed tiers."
      - "Downgrade resistance tests: client-controlled inputs cannot force lower tier / non-authoritative behavior for effect-capable endpoints."
      - "Observability exfil tests (best-effort): sensitive fields are not emitted in logs/traces under representative failures."
    out_of_scope: []
  plan:
    steps:
      - "Implement a daemon harness with temp dirs and controllable config."
      - "Add restart tests for durable consume + effect journal."
      - "Add adversarial flood tests for quarantine + per-session quotas."
      - "Add DB tamper tests for signature/chain validation."
      - "Add rollback tests backed by the external anchor test provider."
      - "Add performance guardrails (instrumentation hooks or black-box thresholds)."
  definition_of_done:
    evidence_ids: ["EVID-0022"]
    criteria:
      - "CI fails on kernel bypass attempts."
      - "CI fails on replay across restart."
      - "CI fails if fail-closed tiers accept missing prerequisites."
      - "CI fails if startup validation regresses to O(N) behavior."
      - "CI fails if rollback is not denied when external anchor is enforced."
      - "CI fails if downgrade-by-client is possible for effect-capable endpoints."
  notes:
    security: |
      This replaces reviewer heroics with enforced invariants. If these tests are not stable, the spine is not real.
