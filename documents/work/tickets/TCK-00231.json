{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-29",
    "template_version": "2026-01-29",
    "ticket": {
      "id": "TCK-00231",
      "title": "FAC: AAT spec validation requiring invariants",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0009",
      "rfc_id": "RFC-0015",
      "requirements": [
        {
          "requirement_id": "FAC-REQ-0011",
          "requirement_ref": "documents/rfcs/RFC-0015/01_problem_and_imports.yaml#rfc_imported_requirements"
        }
      ],
      "evidence_artifacts": [
        {
          "evidence_id": "EVID-FAC-0013",
          "artifact_ref": "documents/rfcs/RFC-0015/07_test_and_evidence.yaml#evidence_requirements"
        }
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_CORE"
      ]
    },
    "dependencies": {
      "tickets": [
        "TCK-00219"
      ]
    },
    "scope": {
      "in_scope": [
        "Define AatSpec struct",
        "Define Invariant struct with machine predicate",
        "Define AatStep struct (observational only)",
        "Implement validate() for spec validation"
      ],
      "out_of_scope": [
        "AAT execution",
        "Invariant evaluation"
      ]
    },
    "plan": {
      "steps": [
        "Create crates/apm2-core/src/fac/aat_spec.rs",
        "Define AatSpec struct with invariants and steps",
        "Define Invariant struct with machine_predicate",
        "Define AatStep struct with observational flag",
        "Implement validate() on AatSpec",
        "Check at least one invariant exists",
        "Check all invariants have machine predicates",
        "Check all steps are observational",
        "Write unit tests for validation"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-FAC-0013"
      ],
      "criteria": [
        "AAT specs require at least one invariant",
        "Step-only specs are rejected",
        "Invariants must have machine predicates",
        "cargo test -p apm2-core fac::aat_spec::tests passes"
      ]
    },
    "notes": {
      "security": "Invariant-first AAT specs ensure testable acceptance criteria.\nStep-only specs without machine-checkable invariants are rejected.\n",
      "implementation_details": "AatSpec fields:\n- spec_id, scenario_type\n- invariants: Vec<Invariant> (required, >= 1)\n- steps: Vec<AatStep> (observational only)\n\nInvariant fields:\n- invariant_id, statement\n- verifier_kind, machine_predicate (required)\n\nAatStep fields:\n- step_id, action, observational (must be true)\n",
      "affected_files": "Created: crates/apm2-core/src/fac/aat_spec.rs\n"
    }
  }
}
