ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00563"
    title: "Canonicalizer Tuple pinning: broker-admitted canonicalization version commitment + worker enforcement"
    status: "OPEN"
  binds:
    prd_id: "PRD-PLACEHOLDER"
    rfc_id: "RFC-0019"
    requirements: []
    evidence_artifacts: []
  custody:
    agent_roles: ["AGENT_IMPLEMENTER"]
    responsibility_domains: ["DOMAIN_SECURITY"]
  dependencies:
    tickets:
      - ticket_id: "TCK-00510"
        reason: "Broker stores admitted canonicalizer tuple commitment."
      - ticket_id: "TCK-00537"
        reason: "Atomic safe file IO for storing the tuple."
      - ticket_id: "TCK-00512"
        reason: "Job spec digest relies on canonicalization semantics."
  scope:
    in_scope:
      - "Define a `CanonicalizerTupleV1` commitment describing canonical JSON semantics used for digesting job specs/receipts."
      - "Broker stores admitted tuple digest under `$APM2_HOME/private/fac/broker/admitted_canonicalizer_tuple.v1`."
      - "Worker verifies canonicalizer tuple digest matches the broker-admitted digest at startup."
      - "If mismatch: default mode MUST fail-closed (deny execution) with actionable remediation."
      - "Record canonicalizer tuple digest in receipts for audit."
    out_of_scope:
      - "Cross-node tuple negotiation."
  plan:
    steps:
      - "Define tuple inputs (e.g., `apm2_core::determinism` version string + schema canonicalization mode id)."
      - "Implement broker persistence and CLI introspection."
      - "Implement worker validation and denial behavior."
  definition_of_done:
    evidence_ids: []
    criteria:
      - "Digest/canonicalization drift between broker and worker is detected and blocks actuation in default mode."
      - "Receipts include canonicalizer tuple digest for forensic audit."
  notes:
    security: |
      Without tuple pinning, a canonicalization behavior change can silently break digest binding, opening tamper windows.
