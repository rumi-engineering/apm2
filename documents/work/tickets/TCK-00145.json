{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-27",
    "template_version": "2026-01-27",
    "ticket": {
      "id": "TCK-00145",
      "title": "Implement AAT/selftest harness for CAC capabilities",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0007",
      "rfc_id": "RFC-0011",
      "requirements": [
        {
          "requirement_id": "CAC-REQ-0014",
          "requirement_ref": "documents/prds/PRD-0007/requirements/REQ-0014.yaml#prd_requirement"
        },
        {
          "requirement_id": "CAC-REQ-0007",
          "requirement_ref": "documents/prds/PRD-0007/requirements/REQ-0007.yaml#prd_requirement"
        }
      ],
      "evidence_artifacts": [
        "EVID-0007"
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_TESTING",
        "DOMAIN_AGENT_RUNTIME"
      ]
    },
    "dependencies": {
      "tickets": [
        "TCK-00144"
      ]
    },
    "scope": {
      "in_scope": [
        "Implement CacSchemaTest adapter for HypothesisExecutor",
        "Create cac_harness.rs module under xtask/src/aat/",
        "Define CacSelftestSuite struct with test discovery",
        "Implement hermetic test environment with budget constraints",
        "Generate AATReceipt with binary_hash binding",
        "Implement Ed25519 signing using GateReceipt pattern",
        "Add timeout/budget enforcement (time/tool/token limits)",
        "Capture test evidence: stdout, stderr, exit_code, duration"
      ],
      "out_of_scope": [
        "CapabilityManifest generation (TCK-00144)",
        "Capability gating (TCK-00146)",
        "CLI commands (TCK-00147)",
        "Parallel hierarchy for aat module (ANTI-COUSIN)"
      ]
    },
    "plan": {
      "steps": [
        "Create xtask/src/aat/cac_harness.rs module",
        "Define CacSchemaTest struct: capability_id, test_name, verification_method",
        "Implement CacSchemaTest -> Hypothesis adapter (wrap, not duplicate)",
        "Define CacSelftestSuite with discover() method for test enumeration",
        "Implement budget constraints: max_duration, max_tool_calls, max_tokens",
        "Define AATReceipt struct in crates/apm2-core/src/evidence/aat_receipt.rs",
        "Fields: receipt_id, binary_hash, tests_passed, tests_failed, budget_consumed",
        "Implement Ed25519 signing following GateReceipt pattern (receipt.rs:344-429)",
        "Add verify_binary_hash() to reject stale receipts",
        "Integrate with existing HypothesisExecutor (executor.rs)",
        "Write tests for budget enforcement and receipt signing"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-0007"
      ],
      "criteria": [
        "CacSelftestSuite::discover() enumerates all CAC schema tests",
        "Tests execute via HypothesisExecutor (no parallel hierarchy)",
        "Budget enforcement: timeout kills long-running tests",
        "AATReceipt includes binary_hash matching current binary",
        "AATReceipt signature verifiable with public key",
        "Stale receipt (wrong binary_hash) rejected by verify()",
        "All tests pass: cargo test cac_harness"
      ]
    },
    "notes": {
      "rust_textbook_refs": [
        {
          "file": ".claude/skills/rust-textbook/17_testing_fuzz_miri_evidence.md",
          "contracts": [
            "CTR-1701: Verification Plan Mandatory for Risk Anchors - CAC selftest for capabilities",
            "INV-1701: Tests Encode Invariants - capability tests prove behavior exists"
          ]
        },
        {
          "file": ".claude/skills/rust-textbook/07_errors_panics_diagnostics.md",
          "contracts": [
            "CTR-0701: Failure Channel Selection - Result for fallible test execution",
            "RSK-0701: Panic-as-DoS - timeout prevents hung tests from blocking"
          ]
        },
        {
          "file": ".claude/skills/rust-textbook/19_security_adjacent_rust.md",
          "contracts": [
            "CTR-1907: Complete Audit Data - AATReceipt captures all test evidence",
            "CTR-1908: Serialization in Crypto Contexts - propagate all errors in signing"
          ]
        }
      ],
      "codebase_context": {
        "new_files": [
          {
            "path": "xtask/src/aat/cac_harness.rs",
            "description": "CAC schema test harness (adapter over existing AAT infrastructure)"
          },
          {
            "path": "crates/apm2-core/src/evidence/aat_receipt.rs",
            "description": "AATReceipt struct with Ed25519 signing"
          }
        ],
        "extend_files": [
          {
            "path": "xtask/src/aat/mod.rs",
            "description": "Export cac_harness module"
          },
          {
            "path": "crates/apm2-core/src/evidence/mod.rs",
            "description": "Export aat_receipt module"
          }
        ],
        "reference_files": [
          {
            "path": "xtask/src/aat/executor.rs",
            "description": "HypothesisExecutor to reuse (lines 95-207)"
          },
          {
            "path": "xtask/src/aat/types.rs",
            "description": "Hypothesis struct for adapter pattern (lines 203-237)"
          },
          {
            "path": "crates/apm2-core/src/evidence/receipt.rs",
            "description": "GateReceipt signing pattern to follow (lines 344-429)"
          }
        ]
      },
      "security": "Binary hash binding prevents AATReceipt replay across versions (DD-0006).\nEd25519 signature ensures receipt integrity and origin.\nBudget constraints prevent resource exhaustion during selftest.\n",
      "architecture": "Per DD-0006: cac_harness.rs goes under xtask/src/aat/ (NOT parallel hierarchy).\nCacSchemaTest wraps as adapter to Hypothesis without duplicating types.\nHypothesisExecutor is stateless and generic (executor.rs:95-207).\nAATReceipt follows GateReceipt pattern for consistency.\n"
    }
  }
}
