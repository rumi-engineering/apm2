{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-29",
    "template_version": "2026-01-29",
    "ticket": {
      "id": "TCK-00214",
      "title": "FAC: Tamper detection and overwrite",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0009",
      "rfc_id": "RFC-0015",
      "requirements": [
        {
          "requirement_id": "FAC-REQ-0019",
          "requirement_ref": "documents/rfcs/RFC-0015/01_problem_and_imports.yaml#rfc_imported_requirements"
        }
      ],
      "evidence_artifacts": [
        {
          "evidence_id": "EVID-FAC-0005",
          "artifact_ref": "documents/rfcs/RFC-0015/07_test_and_evidence.yaml#evidence_requirements"
        }
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_SECURITY",
        "DOMAIN_DAEMON"
      ]
    },
    "dependencies": {
      "tickets": [
        "TCK-00212"
      ]
    },
    "scope": {
      "in_scope": [
        "Implement tamper detection between ledger and GitHub",
        "Emit DefectRecord(PROJECTION_TAMPER) on tamper",
        "Overwrite GitHub status to match ledger truth"
      ],
      "out_of_scope": [
        "Tamper alerts and notifications",
        "Root cause analysis"
      ]
    },
    "plan": {
      "steps": [
        "Modify crates/apm2-daemon/src/projection/github_sync.rs",
        "Implement detect_tamper(expected_status, actual_status)",
        "Define TamperEvent struct",
        "Implement on_tamper() to emit DefectRecord",
        "Call project_status() to overwrite tampered status",
        "Write unit tests for tamper detection",
        "Write unit tests for overwrite behavior"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-FAC-0005"
      ],
      "criteria": [
        "Tamper is detected when GitHub status differs from ledger",
        "DefectRecord(PROJECTION_TAMPER) is emitted",
        "Tampered status is overwritten with ledger truth",
        "cargo test -p apm2-daemon projection::github_sync::tests::tamper passes"
      ]
    },
    "notes": {
      "security": "Tamper detection ensures the ledger remains the authoritative source\nof truth. Any external modification of GitHub status is detected\nand corrected automatically.\n",
      "implementation_details": "TamperEvent fields:\n- expected_status (from ledger)\n- actual_status (from GitHub)\n- detected_at\n\nOn tamper:\n1. Emit DefectRecord(PROJECTION_TAMPER)\n2. Overwrite GitHub status to match ledger\n",
      "affected_files": "Modified: crates/apm2-daemon/src/projection/github_sync.rs\n"
    }
  }
}
