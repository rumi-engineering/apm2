{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-27",
    "template_version": "2026-01-27",
    "ticket": {
      "id": "TCK-00128",
      "title": "Implement CAC JSON Schema validator",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0007",
      "rfc_id": "RFC-0011",
      "requirements": [
        {
          "requirement_id": "CAC-REQ-0001",
          "requirement_ref": "documents/prds/PRD-0007/requirements/REQ-0001.yaml#prd_requirement"
        }
      ],
      "evidence_artifacts": [
        "EVID-0002"
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_KERNEL",
        "DOMAIN_COMPILER"
      ]
    },
    "dependencies": {
      "tickets": [
        "TCK-00127"
      ]
    },
    "scope": {
      "in_scope": [
        "Implement JSON Schema validator (draft 2020-12)",
        "Strict mode with unevaluatedProperties=false",
        "Size limits: max depth 128, max array 100000 members",
        "Unknown field rejection (fail-closed)",
        "Error location reporting with JSON path",
        "Integration with CAC-JSON canonicalizer"
      ],
      "out_of_scope": [
        "Schema authoring tools",
        "Schema migration utilities",
        "Bootstrap bundle embedding (separate ticket)"
      ]
    },
    "plan": {
      "steps": [
        "Add jsonschema crate dependency (jsonschema-rs) to apm2-core",
        "Create crates/apm2-core/src/cac/validator.rs module",
        "Implement CacValidator struct wrapping jsonschema::Validator",
        "Configure strict options: unevaluatedProperties=false",
        "Add size limit pre-validation before schema validation",
        "Implement ValidationError with JSON path location",
        "Create validate_cac_artifact() function for admission pipeline",
        "Write unit tests for unknown field rejection",
        "Write unit tests for size limit enforcement"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-0002"
      ],
      "criteria": [
        "Unknown fields rejected with ValidationError::UnknownField",
        "Arrays > 100000 members rejected with ValidationError::ArrayTooLarge",
        "Objects > 100000 properties rejected with ValidationError::ObjectTooLarge",
        "Depth > 128 rejected with ValidationError::MaxDepthExceeded",
        "Error messages include JSON path to violation",
        "All tests pass: cargo test cac_validator"
      ]
    },
    "notes": {
      "security": "Strict validation prevents schema bypass attacks",
      "architecture": "Use jsonschema-rs crate for draft 2020-12 support.\nPre-validate size limits before schema validation to prevent DoS.\nValidation happens after canonicalization in admission pipeline.\n"
    }
  }
}
