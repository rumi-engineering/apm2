{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-24",
    "template_version": "2026-01-24",
    "ticket": {
      "id": "TCK-00057",
      "title": "Fix Codex CLI invocation in xtask review"
    },
    "binds": {
      "prd_id": "NONE",
      "rfc_id": "RFC-0005",
      "requirements": [
        {
          "requirement_id": "MAINT-003",
          "requirement_ref": "documents/rfcs/RFC-0005/01_problem_and_imports.yaml#rfc_local_requirements.requirements[2]"
        }
      ],
      "evidence_artifacts": []
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_BUILD_RELEASE"
      ]
    },
    "dependencies": {
      "tickets": []
    },
    "scope": {
      "in_scope": [
        "Fix run_ai_review function in xtask/src/tasks/review.rs",
        "Replace invalid Codex CLI invocation with correct syntax",
        "Use 'codex review --base main' instead of invalid flags",
        "Update push.rs trigger_ai_reviews to use consistent Codex invocation",
        "Add better error handling for Codex execution",
        "Gracefully handle case when Codex CLI is not installed"
      ],
      "out_of_scope": [
        "Changes to Codex CLI itself",
        "New review types",
        "Alternative AI review tools"
      ]
    },
    "plan": {
      "steps": [
        "Review current Codex invocation in review.rs:291-293",
        "Replace .args(['-m', 'o3', '--approval-mode', 'full-auto', ...]) with correct args",
        "Use 'codex review --base main' subcommand",
        "Review push.rs:324-325 for same pattern and fix",
        "Add error handling for 'codex not found' case",
        "Print helpful message if Codex is not installed",
        "Test with actual PR to verify review executes"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [],
      "criteria": [
        "cargo xtask review quality <PR_URL> runs without argument errors",
        "No 'unexpected argument --approval-mode' errors",
        "Codex review executes successfully when Codex CLI is available",
        "Graceful error message when Codex CLI is not installed",
        "Review posts comment or updates status on PR",
        "cargo build succeeds",
        "cargo test passes",
        "cargo clippy passes with no warnings"
      ]
    },
    "notes": {
      "security": "Codex CLI handles its own authentication",
      "root_cause": "Invalid Codex CLI flags used; --approval-mode does not exist",
      "affected_files": [
        "xtask/src/tasks/review.rs lines 291-293",
        "xtask/src/tasks/push.rs lines 324-325"
      ]
    }
  }
}
