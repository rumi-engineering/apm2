ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00502"
    title: "Anti-rollback anchoring: implement external anchor provider(s) and enforce fail-closed tier gating when missing/mismatched"
    status: "OPEN"
  binds:
    prd_id: "PRD-0010"
    rfc_id: "RFC-0019"
    requirements:
      - requirement_id: "REQ-0030"
        requirement_ref: "documents/rfcs/RFC-0019/requirements/REQ-0030.yaml#requirement"
    evidence_artifacts:
      - evidence_id: "EVID-0025"
        artifact_ref: "documents/rfcs/RFC-0019/evidence_artifacts/EVID-0025.yaml#evidence_artifact"
  custody:
    agent_roles: ["AGENT_IMPLEMENTER", "AGENT_REVIEWER", "AGENT_QA"]
    responsibility_domains: ["DOMAIN_SECURITY", "DOMAIN_RUNTIME", "DOMAIN_GOVERNANCE"]
  dependencies:
    tickets:
      - ticket_id: "TCK-00500"
        reason: "Requires trusted seals and validated anchors to anchor externally."
  scope:
    in_scope:
      - "Define `AntiRollbackAnchor` interface and implement at least one provider suitable for production (provider choice is deployment-specific)."
      - "Provider MUST support verify_committed(anchor) semantics for LedgerAnchorV1."
      - "Integrate provider into startup verification: fail-closed tiers deny if the latest trusted seal is not externally committed or if external anchor state regresses."
      - "Integrate provider into admission: fail-closed tiers deny if external anchor is unavailable or inconsistent at request time."
      - "Add configuration + policy knobs so monitor tiers may run without external anchor, while fail-closed tiers deny."
    out_of_scope:
      - "Public transparency log publication beyond required anchoring (future)."
  plan:
    steps:
      - "Implement a minimal provider and a test provider."
      - "Wire provider checks into ledger verifier and kernel prerequisites."
      - "Add tests: rollback-to-earlier-seal is detected via external anchor; external anchor unavailability causes deny for fail-closed tiers."
  definition_of_done:
    evidence_ids: ["EVID-0025"]
    criteria:
      - "Fail-closed tiers cannot run without verified external anchor state."
      - "Rollback attacks that would pass purely local seal verification are denied."
      - "CI includes tests covering anchor mismatch and anchor outage behavior."
  notes:
    security: |
      This closes the gap between 'tamper-evident' and 'rollback-resistant' under a local-write adversary.
