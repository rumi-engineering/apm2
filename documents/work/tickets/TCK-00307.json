{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-24",
    "template_version": "2026-01-24",
    "ticket": {
      "id": "TCK-00307",
      "title": "HEF NEW WORK REQUIRED: DefectRecord ledger event",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0009",
      "rfc_id": "RFC-0018",
      "requirements": [
        {
          "requirement_id": "REQ-HEF-0001",
          "requirement_ref": "documents/rfcs/RFC-0018/requirements/REQ-HEF-0001.yaml#requirement"
        }
      ],
      "evidence_artifacts": [
        {
          "evidence_id": "EVID-HEF-0006",
          "artifact_ref": "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0006.yaml#evidence_artifact"
        }
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_PROTOCOL",
        "DOMAIN_DAEMON"
      ]
    },
    "dependencies": {
      "tickets": [
        {
          "ticket_id": "TCK-00287",
          "reason": "HEF foundation ticket must be completed first"
        },
        {
          "ticket_id": "TCK-00300",
          "reason": "PulseEnvelope proto definitions required for defect events"
        }
      ]
    },
    "scope": {
      "in_scope": [
        "Add DefectRecorded event type to proto/kernel_events.proto",
        "Reference DefectRecord struct or CAS hash in the event",
        "Emit defect ledger events from projection watchdog (divergence_watchdog.rs)",
        "Emit defect ledger events from context miss producers",
        "Emit defect ledger events from HTF regression producers",
        "Enable defect.new pulse topic derivation from ledger events"
      ],
      "out_of_scope": [
        "DefectRecord struct definition (assumed existing)",
        "Defect analysis or classification logic",
        "Defect remediation workflows",
        "Defect UI or reporting"
      ]
    },
    "plan": {
      "steps": [
        "Review existing DefectRecord struct and CAS storage patterns",
        "Define DefectRecorded event message in kernel_events.proto",
        "Include fields: defect_id, defect_type, cas_hash reference, timestamp",
        "Update divergence_watchdog.rs to emit DefectRecorded ledger events",
        "Identify and update context miss defect producers to emit ledger events",
        "Identify and update HTF regression defect producers to emit ledger events",
        "Implement topic derivation for defect.new from DefectRecorded events",
        "Add unit tests for DefectRecorded event serialization",
        "Add integration tests for defect ledger event emission flow",
        "Verify defect.new pulses are derived from ledger events"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-HEF-0006"
      ],
      "criteria": [
        "defect.new pulses are derived from DefectRecorded ledger events."
      ]
    },
    "notes": {
      "security": "default-deny, least privilege, fail-closed",
      "verification": "All defect events must flow through ledger before pulse emission"
    }
  }
}
