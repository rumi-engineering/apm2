{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-25",
    "template_version": "2026-01-25",
    "ticket": {
      "id": "TCK-00073",
      "title": "Add Configurable AI Tool Backend for AAT"
    },
    "binds": {
      "prd_id": "NONE",
      "rfc_id": "RFC-0006",
      "requirements": [
        {
          "requirement_id": "AAT-001",
          "requirement_ref": "documents/rfcs/RFC-0006/01_problem_and_imports.yaml#rfc_local_requirements.requirements[14]"
        }
      ],
      "evidence_artifacts": []
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_BUILD_RELEASE"
      ]
    },
    "dependencies": {
      "tickets": []
    },
    "scope": {
      "in_scope": [
        "Add AAT_AI_TOOL environment variable (default: gemini)",
        "Support values: gemini, claude-code",
        "Create AatToolConfig struct in xtask/src/aat/tool_config.rs",
        "Add --ai-tool CLI flag override"
      ],
      "out_of_scope": [
        "Additional AI tool backends beyond gemini and claude-code",
        "Auto-detection of available AI tools"
      ]
    },
    "plan": {
      "steps": [
        "Create xtask/src/aat/tool_config.rs with AatToolConfig struct",
        "Define AiTool enum with Gemini and ClaudeCode variants",
        "Implement AatToolConfig::from_env() to read AAT_AI_TOOL",
        "Add Default impl returning Gemini",
        "Add --ai-tool flag to AatArgs in main.rs",
        "Update xtask/src/aat/mod.rs to export tool_config module",
        "Verify cargo build succeeds",
        "Verify cargo test passes",
        "Verify cargo clippy passes with no warnings"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [],
      "criteria": [
        "AatToolConfig struct exists with from_env() method",
        "AAT_AI_TOOL=gemini selects Gemini backend",
        "AAT_AI_TOOL=claude-code selects Claude Code backend",
        "--ai-tool flag overrides environment variable",
        "Default is gemini when no env var or flag set",
        "cargo build succeeds",
        "cargo test passes",
        "cargo clippy passes with no warnings"
      ]
    },
    "notes": {
      "implementation_details": "```rust\n// xtask/src/aat/tool_config.rs\nuse std::env;\n\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Default)]\npub enum AiTool {\n    #[default]\n    Gemini,\n    ClaudeCode,\n}\n\nimpl AiTool {\n    pub fn command(&self) -> &'static str {\n        match self {\n            AiTool::Gemini => \"gemini\",\n            AiTool::ClaudeCode => \"claude\",\n        }\n    }\n}\n\n#[derive(Debug, Clone)]\npub struct AatToolConfig {\n    pub ai_tool: AiTool,\n}\n\nimpl AatToolConfig {\n    pub fn from_env() -> Self {\n        let ai_tool = env::var(\"AAT_AI_TOOL\")\n            .ok()\n            .and_then(|v| match v.to_lowercase().as_str() {\n                \"gemini\" => Some(AiTool::Gemini),\n                \"claude-code\" | \"claude\" => Some(AiTool::ClaudeCode),\n                _ => None,\n            })\n            .unwrap_or_default();\n        Self { ai_tool }\n    }\n\n    pub fn with_override(mut self, ai_tool: Option<AiTool>) -> Self {\n        if let Some(tool) = ai_tool {\n            self.ai_tool = tool;\n        }\n        self\n    }\n}\n```\n",
      "affected_files": "New: xtask/src/aat/tool_config.rs\nModified: xtask/src/aat/mod.rs (add module export)\nModified: xtask/src/main.rs (add --ai-tool CLI flag)\n"
    }
  }
}
