{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-25",
    "template_version": "2026-01-25",
    "ticket": {
      "id": "TCK-00076",
      "title": "Add Input Variation Testing"
    },
    "binds": {
      "prd_id": "NONE",
      "rfc_id": "RFC-0006",
      "requirements": [
        {
          "requirement_id": "AAT-004",
          "requirement_ref": "documents/rfcs/RFC-0006/01_problem_and_imports.yaml#rfc_local_requirements.requirements[17]"
        }
      ],
      "evidence_artifacts": []
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_BUILD_RELEASE"
      ]
    },
    "dependencies": {
      "tickets": [
        "TCK-00075"
      ]
    },
    "scope": {
      "in_scope": [
        "For each CLI command, generate at least 3 input variations",
        "Execute each variation and capture output",
        "Detect invariance (identical output for different inputs)",
        "Populate InputVariation struct with real data",
        "Flag invariance as anti-gaming violation"
      ],
      "out_of_scope": [
        "Semantic equivalence detection beyond string comparison",
        "Fuzz testing with random inputs",
        "Input generation using AI"
      ]
    },
    "plan": {
      "steps": [
        "Create xtask/src/aat/variation.rs module",
        "Define InputVariationGenerator struct",
        "Implement generate_variations() for CLI commands",
        "Variation strategies: argument order, flag forms, whitespace",
        "Execute each variation, capture output",
        "Compare outputs: if all identical, flag as invariant",
        "Populate InputVariation struct in evidence bundle",
        "Add AntiGamingViolation::InvariantOutput variant if needed",
        "Integrate into evidence.rs EvidenceBundleBuilder",
        "Verify cargo build succeeds",
        "Verify cargo test passes",
        "Verify cargo clippy passes with no warnings"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [],
      "criteria": [
        "InputVariationGenerator exists in xtask/src/aat/variation.rs",
        "At least 3 variations generated per CLI command",
        "Each variation is executed with output captured",
        "Invariance detected when all outputs are identical",
        "InputVariation struct populated with input, output, is_invariant",
        "Invariance flagged as anti-gaming violation",
        "cargo build succeeds",
        "cargo test passes",
        "cargo clippy passes with no warnings"
      ]
    },
    "notes": {
      "implementation_details": "```rust\n// xtask/src/aat/variation.rs\nuse std::process::Command;\nuse anyhow::Result;\n\n#[derive(Debug, Clone)]\npub struct InputVariation {\n    pub input: String,\n    pub output: String,\n    pub exit_code: Option<i32>,\n}\n\npub struct InputVariationGenerator;\n\nimpl InputVariationGenerator {\n    /// Generate variations for a CLI command.\n    ///\n    /// Strategies:\n    /// - Original command\n    /// - With --help flag (should show help, not run)\n    /// - With environment variable set\n    pub fn generate_variations(base_cmd: &str) -> Vec<String> {\n        vec![\n            base_cmd.to_string(),\n            format!(\"{} --help\", base_cmd),\n            format!(\"AAT_TEST=1 {}\", base_cmd),\n        ]\n    }\n\n    /// Execute variations and detect invariance.\n    pub fn execute_and_check(\n        variations: &[String]\n    ) -> Result<(Vec<InputVariation>, bool)> {\n        let mut results = Vec::new();\n        let mut outputs = Vec::new();\n\n        for cmd in variations {\n            let output = Command::new(\"sh\")\n                .args([\"-c\", cmd])\n                .output()?;\n\n            let stdout = String::from_utf8_lossy(&output.stdout).to_string();\n            outputs.push(stdout.clone());\n\n            results.push(InputVariation {\n                input: cmd.clone(),\n                output: stdout,\n                exit_code: output.status.code(),\n            });\n        }\n\n        // Check invariance: all outputs identical\n        let is_invariant = outputs.windows(2)\n            .all(|w| w[0] == w[1]);\n\n        Ok((results, is_invariant))\n    }\n}\n```\n",
      "affected_files": "New: xtask/src/aat/variation.rs\nModified: xtask/src/aat/mod.rs (add variation module)\nModified: xtask/src/aat/evidence.rs (populate InputVariation)\n"
    }
  }
}
