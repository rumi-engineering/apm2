{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-29",
    "template_version": "2026-01-29",
    "ticket": {
      "id": "TCK-00345",
      "title": "CLI consensus commands: daemon integration",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0009",
      "rfc_id": "RFC-0018"
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_RUNTIME",
        "DOMAIN_CONSENSUS"
      ]
    },
    "dependencies": {
      "tickets": [
        {
          "ticket_id": "TCK-00287",
          "reason": "ProtocolServer dispatchers must handle consensus queries."
        },
        {
          "ticket_id": "TCK-00288",
          "reason": "Protocol clients provide the IPC transport."
        }
      ]
    },
    "scope": {
      "in_scope": [
        "Replace mock data in `apm2 consensus status` with real daemon query.",
        "Replace mock data in `apm2 consensus validators` with real daemon query.",
        "Replace mock data in `apm2 consensus byzantine-evidence list` with real daemon query.",
        "Replace mock data in `apm2 consensus metrics` with real daemon query.",
        "Add daemon-side handlers for consensus state queries."
      ],
      "out_of_scope": [
        "Consensus algorithm implementation (separate concern).",
        "Byzantine fault detection logic (separate concern)."
      ]
    },
    "plan": {
      "steps": [
        "Define consensus query protobuf messages (ConsensusStatus, ValidatorList, ByzantineEvidence, ConsensusMetrics).",
        "Add handlers to privileged dispatcher (consensus queries are privileged).",
        "Wire handlers to consensus subsystem state (or return appropriate 'not configured' errors).",
        "Update OperatorClient with consensus query methods.",
        "Replace mock returns in consensus.rs with actual OperatorClient calls.",
        "Add tests."
      ]
    },
    "definition_of_done": {
      "criteria": [
        "All consensus commands query daemon instead of returning mock data.",
        "Commands return appropriate errors when consensus subsystem not configured.",
        "Commands return real data when consensus subsystem is active."
      ]
    },
    "notes": {
      "context": "Currently all consensus commands in crates/apm2-cli/src/commands/consensus.rs\nreturn mock/empty data and exit with UNHEALTHY status. This ticket wires them\nto actual daemon state.\n",
      "files": "- crates/apm2-cli/src/commands/consensus.rs\n- crates/apm2-cli/src/client/protocol.rs\n- crates/apm2-daemon/src/protocol/dispatch.rs\n"
    }
  }
}
