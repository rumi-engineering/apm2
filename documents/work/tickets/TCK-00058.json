{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-24",
    "template_version": "2026-01-24",
    "ticket": {
      "id": "TCK-00058",
      "title": "Add pre-commit checks to xtask commit"
    },
    "binds": {
      "prd_id": "NONE",
      "rfc_id": "RFC-0005",
      "requirements": [
        {
          "requirement_id": "MAINT-004",
          "requirement_ref": "documents/rfcs/RFC-0005/01_problem_and_imports.yaml#rfc_local_requirements.requirements[3]"
        }
      ],
      "evidence_artifacts": []
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_BUILD_RELEASE"
      ]
    },
    "dependencies": {
      "tickets": []
    },
    "scope": {
      "in_scope": [
        "Enhance xtask/src/tasks/commit.rs to run local checks before commit",
        "Run cargo fmt --check and fail if formatting issues found",
        "Run cargo clippy --all-targets -- -D warnings for lint checks",
        "Run cargo semver-checks if available (warn if not installed)",
        "Add --skip-checks flag to bypass checks when needed",
        "Display clear error messages indicating which check failed",
        "Provide suggestions for how to fix each type of failure"
      ],
      "out_of_scope": [
        "Changes to other xtask commands",
        "Git hooks integration",
        "CI workflow changes",
        "New lint rules"
      ]
    },
    "plan": {
      "steps": [
        "Add --skip-checks flag to commit command CLI definition",
        "Create run_pre_commit_checks() function",
        "Implement fmt check: cargo fmt --check",
        "Implement clippy check: cargo clippy --all-targets -- -D warnings",
        "Implement semver check: cargo semver-checks (with availability check)",
        "Print clear status for each check: [ok] or [X]",
        "If any check fails, print fix suggestion and exit with error",
        "If --skip-checks is set, skip all checks with warning message",
        "Only proceed to git commit if all checks pass (or skipped)",
        "Add unit tests for check execution logic"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [],
      "criteria": [
        "cargo xtask commit runs fmt check before commit",
        "cargo xtask commit runs clippy check before commit",
        "cargo xtask commit runs semver-checks before commit (if available)",
        "Commit fails if any check fails (unless --skip-checks)",
        "--skip-checks flag bypasses all pre-commit checks with warning",
        "Clear output showing which check failed and how to fix",
        "Warn if cargo-semver-checks is not installed (don't fail)",
        "cargo build succeeds",
        "cargo test passes",
        "cargo clippy passes with no warnings"
      ]
    },
    "notes": {
      "security": "No security impact - local development checks only",
      "type": "ENHANCEMENT - preventive measure to catch issues before CI",
      "rationale": "Fail-fast principle improves developer productivity by catching issues locally",
      "affected_file": "xtask/src/tasks/commit.rs"
    }
  }
}
