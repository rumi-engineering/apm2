ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00517"
    title: "Repo substrate: bare mirror + lane checkouts + patch injection provenance (eliminate pipeline SHA drift)"
    status: "OPEN"
  binds:
    prd_id: "PRD-PLACEHOLDER"
    rfc_id: "RFC-0019"
    requirements: []
    evidence_artifacts: []
  custody:
    agent_roles: ["AGENT_IMPLEMENTER"]
    responsibility_domains: ["DOMAIN_RUNTIME", "DOMAIN_SECURITY"]
  dependencies:
    tickets:
      - ticket_id: "TCK-00515"
        reason: "Lane workspaces must be created/reset from mirror."
      - ticket_id: "TCK-00516"
        reason: "Repo reset/clean operations must not risk rmtree disasters."
  scope:
    in_scope:
      - "Implement node-local bare mirror under `$APM2_HOME/private/fac/repo_mirror/<repo_id>.git`."
      - "Lane workspace checkouts MUST be sourced from mirror, not caller worktree."
      - "Implement source kinds: `mirror_commit` and `patch_injection`."
      - "Define patch bytes backend (fac_blobs_v1 or existing CAS) and bind patch digest into attestation."
      - "Ensure pipeline-style execution cannot run on drifting/dirty workspace without explicit patch injection."
    out_of_scope:
      - "Remote mirroring."
  plan:
    steps:
      - "Implement mirror bootstrap/update logic."
      - "Implement lane workspace reset to SHA + clean."
      - "Implement patch application + digest binding."
  definition_of_done:
    evidence_ids: []
    criteria:
      - "A job targeting SHA always executes on that SHA in lane workspace."
      - "Dirty content execution requires patch injection and changes cache/attestation material."
