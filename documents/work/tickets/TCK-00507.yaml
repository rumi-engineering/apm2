ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00507"
    title: "Continuity profile and sink snapshot resolution for economics gate input assembly"
    status: "OPEN"
  binds:
    prd_id: "PRD-0010"
    rfc_id: "RFC-0029"
    requirements:
      - requirement_id: "REQ-0009"
        requirement_ref: "documents/rfcs/RFC-0029/requirements/REQ-0009.yaml#requirement"
    evidence_artifacts:
      - evidence_id: "EVID-0009"
        artifact_ref: "documents/rfcs/RFC-0029/evidence_artifacts/EVID-0009.yaml#evidence_artifact"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
      - "AGENT_REVIEWER"
      - "AGENT_QA"
    responsibility_domains:
      - "DOMAIN_RELIABILITY"
      - "DOMAIN_RUNTIME"
  dependencies:
    tickets:
      - ticket_id: "TCK-00478"
        reason: "Economics module defines ProjectionSinkContinuityProfileV1 and SinkIdentitySnapshotV1 types that must be resolved."
  scope:
    in_scope:
      - "Implement ContinuityProfileResolver trait in crates/apm2-daemon/src/projection/ with methods: resolve_continuity_profile(sink_id) -> Option<ProjectionSinkContinuityProfileV1>, resolve_sink_snapshot(sink_id) -> Option<SinkIdentitySnapshotV1>, resolve_continuity_window(boundary_id) -> Option<ProjectionContinuityWindowV1>."
      - "Implement ConfigBackedResolver that loads profiles from daemon TOML configuration."
      - "Define daemon config schema extensions for projection sink profiles: sink_id, outage_window_ticks, replay_window_ticks, churn_tolerance, partition_tolerance, trusted_signers."
      - "Implement fallback chain: config -> DENY (fail-closed when no profile found)."
      - "Support GitHub as the single named sink with id 'github-primary'."
      - "Unit tests for resolver with config present, config missing, and malformed config."
    out_of_scope:
      - "Ledger-backed dynamic profile resolution (future: profiles emitted by admission cycle)."
      - "Multi-sink routing or sink discovery."
      - "Calling the resolver from the projection worker (see TCK-00505)."
  plan:
    steps:
      - "Define ContinuityProfileResolver trait with the three resolve methods."
      - "Extend daemon config schema (TOML) with [projection.sinks.github-primary] section."
      - "Implement ConfigBackedResolver: parse config at daemon startup, serve from memory."
      - "Add trusted_signers field to sink config for Ed25519 verifying keys (hex-encoded)."
      - "Implement resolve methods with fail-closed semantics: missing config -> None -> caller must DENY."
      - "Write unit tests: config present returns profile, config missing returns None, malformed config fails startup."
  definition_of_done:
    evidence_ids:
      - "EVID-0009"
    criteria:
      - "ConfigBackedResolver returns valid profile for configured sinks."
      - "Missing sink config returns None (caller enforces DENY)."
      - "Malformed config (e.g., invalid trusted signer hex) fails at daemon startup, not at resolve time."
      - "Profile fields map directly to economics module input types without lossy conversion."
  notes:
    security: |
      Trusted signer keys in config are security-critical. Config parsing must validate
      key format at startup (not lazily at first use). Invalid keys must prevent daemon
      start, not silently produce DENY at runtime where the failure mode is ambiguous.
    verification: |
      Include config validation tests for: valid hex keys, odd-length hex, non-hex chars,
      wrong key length (not 32 bytes), empty signers list.
    general: |
      This ticket provides the "where do economics gate inputs come from?" answer.
      The resolver is a thin config-backed layer now, with a clear trait boundary for
      future ledger-backed resolution.
