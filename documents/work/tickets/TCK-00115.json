{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-26",
    "template_version": "2026-01-26",
    "ticket": {
      "id": "TCK-00115",
      "title": "Implement RFC framer with CCP grounding",
      "status": "CLOSED"
    },
    "binds": {
      "rfc_id": "RFC-0010",
      "requirements": [
        {
          "requirement_id": "REQ-0004"
        }
      ]
    }
  },
  "dependencies": {
    "tickets": [
      {
        "ticket_id": "TCK-00114"
      }
    ]
  },
  "implementation": {
    "summary": "Create the rfc_framer module in apm2-core that generates RFC skeletons\nfrom Impact Map and CCP artifacts. The RFC includes a CCP grounding section\nwith component references and index hash. All path references are validated\nagainst CCP - invalid paths fail compilation.\n",
    "files_to_create": [
      {
        "path": "crates/apm2-core/src/rfc_framer/mod.rs",
        "purpose": "Module root exposing public API for RFC framing"
      },
      {
        "path": "crates/apm2-core/src/rfc_framer/framer.rs",
        "purpose": "Core RFC generation logic from Impact Map + CCP"
      },
      {
        "path": "crates/apm2-core/src/rfc_framer/grounding.rs",
        "purpose": "CCP grounding section generation and path validation"
      },
      {
        "path": "crates/apm2-cli/src/commands/factory/rfc.rs",
        "purpose": "CLI command implementation for 'factory rfc frame'"
      }
    ],
    "files_to_modify": [
      {
        "path": "crates/apm2-core/src/lib.rs",
        "changes": "Add 'pub mod rfc_framer;' to expose the new module"
      },
      {
        "path": "crates/apm2-cli/src/main.rs",
        "changes": "Register the rfc subcommand under factory"
      }
    ],
    "implementation_steps": [
      {
        "step": 1,
        "action": "Create rfc_framer module structure",
        "details": "Create crates/apm2-core/src/rfc_framer/mod.rs with:\n- pub mod framer;\n- pub mod grounding;\n- Re-export key types (RfcFrame, GroundingSection, ValidationError)\n"
      },
      {
        "step": 2,
        "action": "Implement RFC template loading in framer.rs",
        "details": "Load RFC template structure from documents/standards/templates/rfc/.\nParse section schema to understand required/optional sections.\nTemplate sections: 00_meta through 09_governance_and_gates.\n"
      },
      {
        "step": 3,
        "action": "Implement Impact Map consumption in framer.rs",
        "details": "Load impact_map.yaml from evidence/prd/<PRD-ID>/impact_map/.\nExtract mapped requirements and their CCP component targets.\nGroup requirements by phase for ticket decomposition section.\n"
      },
      {
        "step": 4,
        "action": "Implement CCP grounding section generation",
        "details": "In grounding.rs, generate ccp_grounding section with:\n- ccp_index_ref: path to CCP index\n- ccp_index_hash: BLAKE3 hash of index for staleness detection\n- impact_map_ref: path to impact map\n- component_references: list of affected CCP components\n"
      },
      {
        "step": 5,
        "action": "Implement path validation against CCP",
        "details": "In grounding.rs, validate all file paths in the RFC against CCP:\n- files_to_create must not exist in CCP (unless extending)\n- files_to_modify must exist in CCP\n- Return ValidationError for invalid paths (fail compilation)\n"
      },
      {
        "step": 6,
        "action": "Implement RFC section generation",
        "details": "Generate all RFC sections following template:\n- 00_meta.yaml: RFC metadata with CCP grounding\n- 01_problem_and_imports.yaml: Problem statement from PRD\n- 02_design_decisions.yaml: Populated from Impact Map\n- 06_ticket_decomposition.yaml: Generated from mapped requirements\n"
      },
      {
        "step": 7,
        "action": "Implement CLI command",
        "details": "In rfc.rs CLI, implement:\n- Parse --prd and --rfc arguments\n- Load Impact Map and CCP index\n- Validate paths (error on invalid)\n- Generate RFC directory structure\n- Write sections atomically\n"
      },
      {
        "step": 8,
        "action": "Register CLI command and export module",
        "details": "Update lib.rs to export rfc_framer module.\nUpdate main.rs to add rfc subcommand under factory.\n"
      }
    ],
    "code_examples": []
  },
  "acceptance_criteria": [
    {
      "criterion": "RFC includes CCP grounding section with index hash",
      "verification": "Check generated 00_meta.yaml contains ccp_grounding with valid ccp_index_hash"
    },
    {
      "criterion": "Invalid path references fail compilation",
      "verification": "Attempt to reference non-existent file in files_to_modify and verify error"
    },
    {
      "criterion": "RFC follows template structure",
      "verification": "Verify generated RFC has all required sections matching template schema"
    }
  ],
  "test_requirements": [
    {
      "test_id": "UT-115-01",
      "description": "Test RFC template loading and parsing",
      "verification_command": "cargo test -p apm2-core rfc_framer::framer::tests::template_loading"
    },
    {
      "test_id": "UT-115-02",
      "description": "Test Impact Map consumption",
      "verification_command": "cargo test -p apm2-core rfc_framer::framer::tests::impact_map"
    },
    {
      "test_id": "UT-115-03",
      "description": "Test CCP grounding section generation",
      "verification_command": "cargo test -p apm2-core rfc_framer::grounding::tests"
    },
    {
      "test_id": "UT-115-04",
      "description": "Test path validation against CCP",
      "verification_command": "cargo test -p apm2-core rfc_framer::grounding::tests::path_validation"
    },
    {
      "test_id": "UT-115-05",
      "description": "Test invalid path rejection",
      "verification_command": "cargo test -p apm2-core rfc_framer::grounding::tests::invalid_path_fails"
    },
    {
      "test_id": "IT-115-01",
      "description": "Integration test: full RFC generation",
      "verification_command": "cargo run --bin apm2 -- factory rfc frame --prd PRD-0005 --rfc RFC-0011"
    }
  ],
  "notes": "This ticket implements Phase 2 of RFC-0010. The RFC framer ensures all\ngenerated RFCs are grounded in the codebase's current state via CCP.\n\nKey design decisions:\n- Path validation fails closed (invalid = error, not warning)\n- CCP hash enables staleness detection during RFC review\n- Template structure is extensible via documents/standards/templates/rfc/\n\nDepends on TCK-00114 (Impact Map) being complete.\nThe generated RFC will be used by TCK-00116 (ticket emitter).\n"
}
