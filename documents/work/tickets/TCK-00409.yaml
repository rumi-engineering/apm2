ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00409"
    title: "Add CI drift guards for evidence refs, protocol enums, and review artifact integrity"
    status: "OPEN"
  binds:
    prd_id: "PRD-0010"
    rfc_id: "RFC-0020"
    requirements:
      - requirement_id: "REQ-0003"
        requirement_ref: "documents/rfcs/RFC-0020/requirements/REQ-0003.yaml#requirement"
      - requirement_id: "REQ-0034"
        requirement_ref: "documents/rfcs/RFC-0020/requirements/REQ-0034.yaml#requirement"
    evidence_artifacts:
      - evidence_id: "EVID-0001"
        artifact_ref: "documents/rfcs/RFC-0020/evidence_artifacts/EVID-0001.yaml#evidence_artifact"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
      - "AGENT_REVIEWER"
    responsibility_domains:
      - "DOMAIN_SECURITY"
      - "DOMAIN_BUILD_RELEASE"
      - "DOMAIN_DOCUMENTATION"
  dependencies:
    tickets:
      - ticket_id: "TCK-00405"
        reason: "Review-artifact integrity checks should reuse trusted reviewer/head-pin gate primitives."
  scope:
    in_scope:
      - "Add CI lint that validates requirement/evidence references in ticket and RFC evidence files resolve to existing IDs."
      - "Add CI lint that validates referenced test names/paths in evidence artifacts actually exist."
      - "Add CI lint for protocol/reason-code drift between source enums and protobuf schemas."
      - "Add CI check that review artifacts include exact PR number and head SHA and that values match current PR state."
      - "Fail CI when review prompts/scripts include deprecated direct status-write commands bypassing approved path."
      - "Provide a repo-local audit command to generate a drift report for recent PRs."
    out_of_scope:
      - "Automated repair of historical docs."
      - "Replacing RFC authoring workflow."
      - "Non-deterministic lint behavior requiring network-only resolution."
  plan:
    steps:
      - "Create validation scripts for requirement/evidence reference resolution and test symbol existence."
      - "Create protocol drift check that compares reason-code/source enums against protobuf definitions."
      - "Create review artifact check for PR/SHA integrity and trusted metadata fields."
      - "Integrate all checks into CI and pre-merge workflow as blocking jobs."
      - "Add fixtures reproducing observed drift classes from PRs #442, #443, #454."
      - "Document how to run drift audit locally and how to interpret failures."
      - "Run cargo fmt --all && cargo clippy --workspace --all-targets --all-features -- -D warnings && cargo test --workspace."
  definition_of_done:
    evidence_ids:
      - "EVID-0001"
    criteria:
      - "CI fails on broken requirement/evidence references."
      - "CI fails when evidence files reference missing tests."
      - "CI fails on enum/proto reason-code drift."
      - "CI fails when review artifacts are not pinned to exact PR head."
      - "Repo-local drift audit command reports deterministic pass/fail output."
  notes:
    context: |
      Re-reviews exposed repeated integrity drift: stale/mismatched review SHAs,
      evidence references to missing requirements/tests, and protocol-reason code
      mismatch. These defects weakened trust in both PASS and FAIL artifacts.

      Triggering PRs from incident set include #442, #443, #454.
    files: |
      - .github/workflows/ci.yml
      - scripts/review/
      - scripts/lint/
      - documents/rfcs/RFC-0020/evidence_artifacts/
      - documents/reviews/
    security: |
      - Drift checks must fail closed and be deterministic.
      - Review artifact checks must validate both identity and content pinning.
      - Lint bypass requires explicit waiver with audit trail.

