{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-26",
    "template_version": "2026-01-26",
    "ticket": {
      "id": "TCK-00116",
      "title": "Implement ticket emitter",
      "status": "CLOSED"
    },
    "binds": {
      "rfc_id": "RFC-0010",
      "requirements": [
        {
          "requirement_id": "REQ-0006"
        }
      ]
    }
  },
  "dependencies": {
    "tickets": [
      {
        "ticket_id": "TCK-00115"
      }
    ]
  },
  "implementation": {
    "summary": "Create the ticket_emitter module in apm2-core that decomposes RFCs into\natomic implementation tickets. Tickets have stable IDs, validated file\npaths against CCP, and verification commands derived from acceptance\ncriteria. Output follows the ticket schema for agent implementation.\n",
    "files_to_create": [
      {
        "path": "crates/apm2-core/src/ticket_emitter/mod.rs",
        "purpose": "Module root exposing public API for ticket emission"
      },
      {
        "path": "crates/apm2-core/src/ticket_emitter/emitter.rs",
        "purpose": "Core ticket generation logic from RFC decomposition"
      },
      {
        "path": "crates/apm2-core/src/ticket_emitter/validation.rs",
        "purpose": "File path validation against CCP and schema validation"
      },
      {
        "path": "crates/apm2-cli/src/commands/factory/tickets.rs",
        "purpose": "CLI command implementation for 'factory tickets emit'"
      }
    ],
    "files_to_modify": [
      {
        "path": "crates/apm2-core/src/lib.rs",
        "changes": "Add 'pub mod ticket_emitter;' to expose the new module"
      },
      {
        "path": "crates/apm2-cli/src/main.rs",
        "changes": "Register the tickets subcommand under factory"
      }
    ],
    "implementation_steps": [
      {
        "step": 1,
        "action": "Create ticket_emitter module structure",
        "details": "Create crates/apm2-core/src/ticket_emitter/mod.rs with:\n- pub mod emitter;\n- pub mod validation;\n- Re-export key types (Ticket, EmittedTicket, ValidationResult)\n"
      },
      {
        "step": 2,
        "action": "Implement RFC decomposition parser in emitter.rs",
        "details": "Load 06_ticket_decomposition.yaml from RFC directory.\nParse ticket definitions including:\n- ticket_id, title, phase\n- requirement_ids, description\n- files_to_create, files_to_modify\n- verification_commands, acceptance_criteria\n- blocked_by dependencies\n"
      },
      {
        "step": 3,
        "action": "Implement stable ticket ID generation",
        "details": "Generate stable ticket IDs (TCK-XXXXX format):\n- Check existing tickets in documents/work/tickets/\n- Allocate next available ID range for this RFC\n- Store ID mapping for idempotent re-runs\n"
      },
      {
        "step": 4,
        "action": "Implement file path validation in validation.rs",
        "details": "Validate all file paths against CCP index:\n- files_to_create: must not exist (or be marked as extension point)\n- files_to_modify: must exist in CCP\n- Report all validation errors with file and line context\n"
      },
      {
        "step": 5,
        "action": "Implement verification command generation",
        "details": "Generate verification commands from acceptance criteria:\n- Map test descriptions to cargo test commands\n- Include CLI integration test commands\n- Add cargo clippy and cargo fmt checks\n"
      },
      {
        "step": 6,
        "action": "Implement ticket YAML output",
        "details": "Generate ticket files following schema:\n- schema_version, template_version\n- ticket section with id, title, status, rfc_id, requirement_ids\n- implementation section with summary, files, steps\n- acceptance_criteria and test_requirements sections\n"
      },
      {
        "step": 7,
        "action": "Implement CLI command",
        "details": "In tickets.rs CLI, implement:\n- Parse --rfc argument\n- Load RFC ticket decomposition\n- Validate paths against CCP\n- Generate ticket files atomically\n- Report summary (tickets created, warnings)\n"
      },
      {
        "step": 8,
        "action": "Register CLI command and export module",
        "details": "Update lib.rs to export ticket_emitter module.\nUpdate main.rs to add tickets subcommand under factory.\n"
      }
    ],
    "code_examples": []
  },
  "acceptance_criteria": [
    {
      "criterion": "Stable ticket IDs",
      "verification": "Run emit twice and verify ticket IDs are identical"
    },
    {
      "criterion": "File paths validated against CCP",
      "verification": "Verify tickets with invalid paths are rejected with clear error"
    },
    {
      "criterion": "Verification commands present",
      "verification": "Check all emitted tickets have non-empty verification.commands array"
    }
  ],
  "test_requirements": [
    {
      "test_id": "UT-116-01",
      "description": "Test RFC decomposition parsing",
      "verification_command": "cargo test -p apm2-core ticket_emitter::emitter::tests::parse_decomposition"
    },
    {
      "test_id": "UT-116-02",
      "description": "Test stable ticket ID generation",
      "verification_command": "cargo test -p apm2-core ticket_emitter::emitter::tests::stable_ids"
    },
    {
      "test_id": "UT-116-03",
      "description": "Test file path validation against CCP",
      "verification_command": "cargo test -p apm2-core ticket_emitter::validation::tests"
    },
    {
      "test_id": "UT-116-04",
      "description": "Test verification command generation",
      "verification_command": "cargo test -p apm2-core ticket_emitter::emitter::tests::verification_commands"
    },
    {
      "test_id": "UT-116-05",
      "description": "Test ticket YAML schema compliance",
      "verification_command": "cargo test -p apm2-core ticket_emitter::emitter::tests::schema_compliance"
    },
    {
      "test_id": "IT-116-01",
      "description": "Integration test: full ticket emission",
      "verification_command": "cargo run --bin apm2 -- factory tickets emit --rfc RFC-0010"
    }
  ],
  "notes": "This ticket implements Phase 3 of RFC-0010. The ticket emitter is the\nfinal stage before agent implementation begins, producing atomic work\nunits with clear verification criteria.\n\nKey design decisions:\n- Stable IDs enable idempotent re-runs without duplicate tickets\n- CCP validation ensures tickets reference valid codebase locations\n- Verification commands are machine-executable for CI integration\n\nDepends on TCK-00115 (RFC framer) being complete.\nBlocks TCK-00117 (lint rules) which validates emitted tickets.\n"
}
