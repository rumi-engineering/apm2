{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-29",
    "template_version": "2026-01-29",
    "ticket": {
      "id": "TCK-00226",
      "title": "FAC: Determinism envelope schema (Phase 1 - schema only)",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0009",
      "rfc_id": "RFC-0015",
      "requirements": [
        {
          "requirement_id": "FAC-REQ-0005",
          "requirement_ref": "documents/rfcs/RFC-0015/01_problem_and_imports.yaml#rfc_imported_requirements"
        }
      ],
      "evidence_artifacts": [
        {
          "evidence_id": "EVID-FAC-0010",
          "artifact_ref": "documents/rfcs/RFC-0015/07_test_and_evidence.yaml#evidence_requirements"
        }
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_CORE"
      ]
    },
    "dependencies": {
      "tickets": [
        "TCK-00218"
      ]
    },
    "scope": {
      "in_scope": [
        "Define DeterminismStatus enum",
        "Define DeterminismEnvelope struct",
        "Implement compute_stability_digest()",
        "Implement check_stability()",
        "Define required_run_count() by tier"
      ],
      "out_of_scope": [
        "Enforcement (Phase 2)",
        "Nondeterminism quarantine"
      ]
    },
    "plan": {
      "steps": [
        "Create crates/apm2-core/src/fac/determinism.rs",
        "Define DeterminismStatus enum (Stable, Mismatch)",
        "Define DeterminismEnvelope struct",
        "Implement compute_stability_digest() as hash of terminal digests",
        "Implement check_stability() comparing run digests",
        "Implement required_run_count(risk_tier)",
        "Write unit tests for stability digest computation",
        "Write unit tests for run count by tier"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-FAC-0010"
      ],
      "criteria": [
        "DeterminismEnvelope schema is defined",
        "Run count by tier: HIGH=3, MED=2, LOW=1",
        "Phase 1 records metadata without enforcement",
        "cargo test -p apm2-core fac::determinism::tests passes"
      ]
    },
    "notes": {
      "security": "Determinism envelope captures N-run stability for later enforcement.\nPhase 1 captures the schema; Phase 2 enforces determinism requirements.\n",
      "implementation_details": "DeterminismEnvelope fields:\n- determinism_class, run_count, run_receipt_hashes\n- terminal_evidence_digest, terminal_verifier_outputs_digest\n- stability_digest\n\nstability_digest = hash(verdict, terminal_evidence_digest, terminal_verifier_outputs_digest)\n\nrequired_run_count:\n- HIGH: 3\n- MED: 2\n- LOW: 1\n",
      "affected_files": "Created: crates/apm2-core/src/fac/determinism.rs\n"
    }
  }
}
