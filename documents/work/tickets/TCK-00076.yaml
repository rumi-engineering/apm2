ticket_meta:
  schema_version: "2026-01-25"
  template_version: "2026-01-25"
  ticket:
    id: "TCK-00076"
    title: "Add Input Variation Testing"
  binds:
    prd_id: "NONE"
    rfc_id: "RFC-0006"
    requirements:
      - requirement_id: "AAT-004"
        requirement_ref: "documents/rfcs/RFC-0006/01_problem_and_imports.yaml#rfc_local_requirements.requirements[17]"
    evidence_artifacts: []
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
    responsibility_domains:
      - "DOMAIN_BUILD_RELEASE"
  dependencies:
    tickets:
      - "TCK-00075"
  scope:
    in_scope:
      - "For each CLI command, generate at least 3 input variations"
      - "Execute each variation and capture output"
      - "Detect invariance (identical output for different inputs)"
      - "Populate InputVariation struct with real data"
      - "Flag invariance as anti-gaming violation"
    out_of_scope:
      - "Semantic equivalence detection beyond string comparison"
      - "Fuzz testing with random inputs"
      - "Input generation using AI"
  plan:
    steps:
      - "Create xtask/src/aat/variation.rs module"
      - "Define InputVariationGenerator struct"
      - "Implement generate_variations() for CLI commands"
      - "Variation strategies: argument order, flag forms, whitespace"
      - "Execute each variation, capture output"
      - "Compare outputs: if all identical, flag as invariant"
      - "Populate InputVariation struct in evidence bundle"
      - "Add AntiGamingViolation::InvariantOutput variant if needed"
      - "Integrate into evidence.rs EvidenceBundleBuilder"
      - "Verify cargo build succeeds"
      - "Verify cargo test passes"
      - "Verify cargo clippy passes with no warnings"
  definition_of_done:
    evidence_ids: []
    criteria:
      - "InputVariationGenerator exists in xtask/src/aat/variation.rs"
      - "At least 3 variations generated per CLI command"
      - "Each variation is executed with output captured"
      - "Invariance detected when all outputs are identical"
      - "InputVariation struct populated with input, output, is_invariant"
      - "Invariance flagged as anti-gaming violation"
      - "cargo build succeeds"
      - "cargo test passes"
      - "cargo clippy passes with no warnings"
  notes:
    implementation_details: |
      ```rust
      // xtask/src/aat/variation.rs
      use std::process::Command;
      use anyhow::Result;

      #[derive(Debug, Clone)]
      pub struct InputVariation {
          pub input: String,
          pub output: String,
          pub exit_code: Option<i32>,
      }

      pub struct InputVariationGenerator;

      impl InputVariationGenerator {
          /// Generate variations for a CLI command.
          ///
          /// Strategies:
          /// - Original command
          /// - With --help flag (should show help, not run)
          /// - With environment variable set
          pub fn generate_variations(base_cmd: &str) -> Vec<String> {
              vec![
                  base_cmd.to_string(),
                  format!("{} --help", base_cmd),
                  format!("AAT_TEST=1 {}", base_cmd),
              ]
          }

          /// Execute variations and detect invariance.
          pub fn execute_and_check(
              variations: &[String]
          ) -> Result<(Vec<InputVariation>, bool)> {
              let mut results = Vec::new();
              let mut outputs = Vec::new();

              for cmd in variations {
                  let output = Command::new("sh")
                      .args(["-c", cmd])
                      .output()?;

                  let stdout = String::from_utf8_lossy(&output.stdout).to_string();
                  outputs.push(stdout.clone());

                  results.push(InputVariation {
                      input: cmd.clone(),
                      output: stdout,
                      exit_code: output.status.code(),
                  });
              }

              // Check invariance: all outputs identical
              let is_invariant = outputs.windows(2)
                  .all(|w| w[0] == w[1]);

              Ok((results, is_invariant))
          }
      }
      ```
    affected_files: |
      New: xtask/src/aat/variation.rs
      Modified: xtask/src/aat/mod.rs (add variation module)
      Modified: xtask/src/aat/evidence.rs (populate InputVariation)
