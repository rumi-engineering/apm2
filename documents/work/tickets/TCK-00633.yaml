ticket_meta:
  schema_version: '2026-01-29'
  template_version: '2026-01-29'
  ticket:
    id: TCK-00633
    title: 'RFC-0032 Phase 1: add FAC CAS JSON schemas + bounded decoding allowlist (WorkSpec/Context/LoopProfile/AuthorityBindings)'
    status: MERGED
  binds:
    prd_id: PRD-PLACEHOLDER
    rfc_id: RFC-0032
    requirements: []
    evidence_artifacts: []
  custody:
    agent_roles:
    - AGENT_IMPLEMENTER
    responsibility_domains:
    - DOMAIN_CORE
    - DOMAIN_EVIDENCE
    - DOMAIN_SECURITY
  dependencies:
    tickets: []
  scope:
    in_scope:
    - Define Rust structs for `apm2.work_spec.v1`, `apm2.work_context_entry.v1`, `apm2.work_loop_profile.v1`, `apm2.work_authority_bindings.v1`
    - Add schema ids to `crates/apm2-core/src/schema_registry/fac_schemas.rs` and ensure uniqueness + prefix tests pass
    - Enforce `#[serde(deny_unknown_fields)]` for all new CAS JSON structs
    - Implement bounded decoding on IPC surfaces via `fac_schemas::bounded_from_slice_with_limit` with RFC-0032 hard caps
    - Document and centralize per-artifact max byte limits (WorkSpec 256KiB, ContextEntry 256KiB, LoopProfile 64KiB, AuthorityBindings 256KiB)
    out_of_scope:
    - Protocol handlers that publish these artifacts (handled by later tickets)
  plan:
    steps:
    - Add new schema id constants + validators in `fac_schemas.rs`
    - Add new module(s) under `crates/apm2-core/src/fac/` or `crates/apm2-core/src/work/` for the CAS-backed structs
    - Write bounded decode tests (oversized payload -> fail-closed) and deny-unknown-fields tests (extra fields -> fail-closed)
    - Add helper for canonical JSON canonicalization prior to hashing/storing (reuse `apm2_core::determinism::canonicalize_json`)
  definition_of_done:
    evidence_ids: []
    criteria:
    - All new schema ids are registered and validated via existing fac schema registry tests.
    - Bounded decode rejects oversized inputs with `INVALID_ARGUMENT`-class errors (no partial writes).
    - Unknown JSON fields are rejected for all new schema structs.
  notes:
    security: 'This ticket is a drift barrier: treat schema allowlist + bounded decode as promotion-blocking.'
