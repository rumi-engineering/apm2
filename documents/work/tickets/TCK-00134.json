{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-27",
    "template_version": "2026-01-27",
    "ticket": {
      "id": "TCK-00134",
      "title": "Implement DCP stable-ID index",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0007",
      "rfc_id": "RFC-0011",
      "requirements": [
        {
          "requirement_id": "CAC-REQ-0001",
          "requirement_ref": "documents/prds/PRD-0007/requirements/REQ-0001.yaml#prd_requirement"
        },
        {
          "requirement_id": "CAC-REQ-0011",
          "requirement_ref": "documents/prds/PRD-0007/requirements/REQ-0011.yaml#prd_requirement"
        }
      ],
      "evidence_artifacts": [
        "EVID-0004",
        "EVID-0005"
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_KERNEL"
      ]
    },
    "dependencies": {
      "tickets": [
        "TCK-00132"
      ]
    },
    "scope": {
      "in_scope": [
        "Implement DCP index as projection over ledger events",
        "Map stable_id to content_hash for resolution",
        "Track schema ref for each artifact",
        "Build dependency graph edges between artifacts",
        "Support index rebuild from ledger replay",
        "Namespace format: 'namespace:kind:identifier[@version]'",
        "Collision detection for duplicate stable_ids"
      ],
      "out_of_scope": [
        "Namespace minting policy (organizational namespaces deferred)",
        "Cross-ledger federation",
        "Index sharding for scale"
      ]
    },
    "plan": {
      "steps": [
        "Create crates/apm2-core/src/cac/dcp_index.rs module",
        "Define DcpIndex struct with stable_id -> content_hash map",
        "Define DcpEntry struct: {stable_id, content_hash, schema_id, dependencies}",
        "Implement index_from_ledger() to rebuild from events",
        "Implement resolve(stable_id) -> Option<content_hash>",
        "Implement register(entry) with collision detection",
        "Add reserved prefix validation (cac:*, bootstrap:*, internal:*)",
        "Create namespace registry for collision prevention",
        "Write tests for resolution and collision detection"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-0004"
      ],
      "criteria": [
        "resolve(stable_id) returns correct content_hash for registered artifacts",
        "Duplicate stable_id registration rejected with CollisionError",
        "Reserved prefixes (cac:, bootstrap:, internal:) validated",
        "Index rebuild from ledger produces identical state",
        "Dependency graph edges correctly tracked",
        "All tests pass: cargo test dcp_index"
      ]
    },
    "notes": {
      "security": "DCP index is projection, not source of truth (DD-0008)",
      "architecture": "DCP is projection over ledger per DD-0008:\n- Ledger is authoritative append-only log\n- DCP index rebuilt on startup or compaction checkpoint\n- Namespace format: \"namespace:kind:identifier[@version]\" (Q-0002-v2 resolved)\n- Reserved prefixes: cac:*, bootstrap:*, internal:* (CNS-0009)\n"
    }
  }
}
