{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-27",
    "template_version": "2026-01-27",
    "ticket": {
      "id": "TCK-00156",
      "title": "Scaffold apm2-daemon module structure",
      "status": "CLOSED"
    },
    "binds": {
      "rfc_id": "RFC-0013",
      "requirements": [
        {
          "requirement_id": "REQ-DAEMON-001"
        }
      ]
    }
  },
  "acceptance_criteria": [
    {
      "criterion": "Module directories created with mod.rs files",
      "verification": "ls crates/apm2-daemon/src/{episode,protocol,telemetry,evidence}/mod.rs"
    },
    {
      "criterion": "Cargo.toml includes all declared dependencies",
      "verification": "cargo check -p apm2-daemon succeeds"
    },
    {
      "criterion": "lib.rs exports new modules",
      "verification": "grep 'mod episode' crates/apm2-daemon/src/lib.rs"
    }
  ],
  "implementation": {
    "code_examples": [
      {
        "description": "Module structure in lib.rs",
        "code": "pub mod episode;\npub mod protocol;\npub mod telemetry;\npub mod evidence;\n"
      }
    ],
    "files_to_create": [
      {
        "path": "crates/apm2-daemon/src/lib.rs",
        "purpose": "Library root exporting daemon modules"
      },
      {
        "path": "crates/apm2-daemon/src/episode/mod.rs",
        "purpose": "Episode runtime module"
      },
      {
        "path": "crates/apm2-daemon/src/protocol/mod.rs",
        "purpose": "UDS protocol and framing module"
      },
      {
        "path": "crates/apm2-daemon/src/telemetry/mod.rs",
        "purpose": "Telemetry collection module"
      },
      {
        "path": "crates/apm2-daemon/src/evidence/mod.rs",
        "purpose": "Evidence economics module"
      }
    ],
    "files_to_modify": [
      {
        "changes": "Add tokio, prost, nix, blake3, ed25519-dalek, zbus dependencies",
        "path": "crates/apm2-daemon/Cargo.toml"
      }
    ],
    "implementation_steps": [
      {
        "step": 1,
        "action": "Create lib.rs with module declarations",
        "details": "Create crates/apm2-daemon/src/lib.rs declaring episode, protocol,\ntelemetry, evidence modules. Re-export main.rs entry point.\n"
      },
      {
        "step": 2,
        "action": "Create episode module structure",
        "details": "Create crates/apm2-daemon/src/episode/mod.rs with placeholder exports\nfor EpisodeRuntime, EpisodeEnvelope, and state machine types.\n"
      },
      {
        "step": 3,
        "action": "Create protocol module structure",
        "details": "Create crates/apm2-daemon/src/protocol/mod.rs with placeholder exports\nfor framing, UDS server, and message types.\n"
      },
      {
        "step": 4,
        "action": "Create telemetry module structure",
        "details": "Create crates/apm2-daemon/src/telemetry/mod.rs with placeholder exports\nfor TelemetryCollector, CgroupReader, and TelemetryFrame.\n"
      },
      {
        "step": 5,
        "action": "Create evidence module structure",
        "details": "Create crates/apm2-daemon/src/evidence/mod.rs with placeholder exports\nfor FlightRecorder, RingBuffer, and retention types.\n"
      },
      {
        "step": 6,
        "action": "Update Cargo.toml with dependencies",
        "details": "Add to [dependencies]:\n- tokio = { version = \"1\", features = [\"full\"] }\n- prost = \"0.12\"\n- nix = { version = \"0.30\", features = [\"signal\", \"process\", \"fs\", \"pty\"] }\n- blake3 = \"1\"\n- ed25519-dalek = \"2\"\n- zbus = \"4.4\"\n"
      }
    ],
    "summary": "Scaffold the apm2-daemon module structure required by RFC-0013.\nCreates four new module directories (episode, protocol, telemetry, evidence)\nand updates Cargo.toml with all declared dependencies.\n"
  },
  "notes": "Phase: PHASE-0 (Prerequisites)\nGenerated from RFC RFC-0013 DECOMPOSE session on 2026-01-27.\nThis ticket MUST complete before TCK-00157, TCK-00159, TCK-00167, TCK-00169.\n",
  "test_requirements": [
    {
      "description": "Cargo check passes",
      "test_id": "UT-00156-01",
      "verification_command": "cargo check -p apm2-daemon"
    },
    {
      "description": "Module structure exists",
      "test_id": "UT-00156-02",
      "verification_command": "test -d crates/apm2-daemon/src/episode && test -d crates/apm2-daemon/src/protocol"
    }
  ]
}
