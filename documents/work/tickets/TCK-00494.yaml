ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00494"
    title: "RequestTool cutover: handler becomes thin wrapper over AdmissionKernel plan/execute (no direct broker/effect calls)"
    status: "OPEN"
  binds:
    prd_id: "PRD-0010"
    rfc_id: "RFC-0019"
    requirements:
      - requirement_id: "REQ-0025"
        requirement_ref: "documents/rfcs/RFC-0019/requirements/REQ-0025.yaml#requirement"
    evidence_artifacts:
      - evidence_id: "EVID-0020"
        artifact_ref: "documents/rfcs/RFC-0019/evidence_artifacts/EVID-0020.yaml#evidence_artifact"
  custody:
    agent_roles: ["AGENT_IMPLEMENTER", "AGENT_REVIEWER", "AGENT_QA"]
    responsibility_domains: ["DOMAIN_RUNTIME", "DOMAIN_SECURITY"]
  dependencies:
    tickets:
      - ticket_id: "TCK-00488"
        reason: "Kernel must exist."
      - ticket_id: "TCK-00489"
        reason: "Bundle binding required for receipt completeness."
  scope:
    in_scope:
      - "Refactor RequestTool handler to: decode -> validate session/envelope -> kernel.plan -> kernel.execute -> respond."
      - "Remove direct effect execution from handler path for authoritative mode."
      - "Ensure PCAC lifecycle is enforced inside kernel and receipts bind to AdmissionBundle digest."
      - "Ensure handler cannot release tool output directly (including streaming); output must flow through kernel boundary mediation."
      - "Add authoritative-mode guardrails: handler MUST deny (fail closed) if kernel is unavailable for fail-closed tiers; no silent fallback to legacy effect-capable path."
    out_of_scope:
      - "PublishEvidence/EmitEvent cutover (TCK-00498)."
  plan:
    steps:
      - "Add authoritative-mode routing toggle if needed, but default MUST be deny (not fallback) for fail-closed tiers."
      - "Rewrite handler to delegate admission to kernel."
      - "Add integration tests proving (a) handler cannot execute effect without kernel, and (b) handler cannot stream/release output before kernel post-effect boundary checks for fail-closed tiers."
  definition_of_done:
    evidence_ids: ["EVID-0020"]
    criteria:
      - "RequestTool handler contains no admission logic beyond decode/transport/observability."
      - "Broker/effect is called only inside AdmissionKernel for authoritative mode."
      - "No-bypass test exists and is stable."
      - "No-early-output test exists and is stable (fail-closed tiers)."
      - "No legacy effect-capable fallback exists for fail-closed tiers in authoritative mode."
