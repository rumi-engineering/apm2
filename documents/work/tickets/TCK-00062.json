{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-24",
    "template_version": "2026-01-24",
    "ticket": {
      "id": "TCK-00062",
      "title": "Add Automated Pattern Validation"
    },
    "binds": {
      "prd_id": "NONE",
      "rfc_id": "RFC-0006",
      "requirements": [
        {
          "requirement_id": "MAINT-012",
          "requirement_ref": "documents/rfcs/RFC-0006/01_problem_and_imports.yaml#rfc_local_requirements.requirements[MAINT-012]"
        }
      ],
      "evidence_artifacts": []
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_BUILD_RELEASE"
      ]
    },
    "dependencies": {
      "tickets": []
    },
    "scope": {
      "in_scope": [
        "Create new xtask/src/tasks/lint.rs file",
        "Define LintArgs struct with optional --fix flag",
        "Implement check for direct std::env::temp_dir usage",
        "Implement check for shell interpolation patterns",
        "Report findings as warnings (not errors)",
        "Add lint module export to xtask/src/tasks/mod.rs",
        "Add lint subcommand to xtask/src/main.rs",
        "Include helpful messages about proper patterns to use"
      ],
      "out_of_scope": [
        "Auto-fix implementation (--fix flag parsed but not implemented)",
        "Integration with pre-commit hooks",
        "IDE integration",
        "Changes to existing xtask commands"
      ]
    },
    "plan": {
      "steps": [
        "Create xtask/src/tasks/lint.rs with module structure",
        "Define LintArgs struct with #[derive(Parser)] and optional --fix: bool field",
        "Implement run(args: LintArgs) function as entry point",
        "Create check_temp_dir_usage() function to scan for std::env::temp_dir",
        "Create check_shell_interpolation() function to scan for shell interpolation patterns",
        "Use glob to find all .rs files in crates/ and xtask/src/",
        "Parse each file and check for anti-patterns",
        "Print warnings with file path and line number for each violation",
        "Include suggestion text for proper pattern to use",
        "Return Ok(()) regardless of findings (warnings only)",
        "Add 'pub mod lint;' to xtask/src/tasks/mod.rs",
        "Add Lint variant to Subcommand enum in xtask/src/main.rs",
        "Add match arm to dispatch lint::run(args) in main()",
        "Test with cargo xtask lint to verify detection works"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [],
      "criteria": [
        "cargo xtask lint runs without error",
        "Detects std::env::temp_dir usage and reports file/line",
        "Detects shell interpolation patterns and reports file/line",
        "Warnings include helpful remediation suggestions",
        "Exit code is 0 (warnings do not fail the build)",
        "--fix flag is accepted (may be unimplemented placeholder)",
        "cargo build succeeds",
        "cargo test passes",
        "cargo clippy passes with no warnings"
      ]
    },
    "notes": {
      "security": "No security impact - static analysis tool for code quality",
      "patterns_to_detect": "std::env::temp_dir (use testdir or tempfile crate instead), shell interpolation (use xshell cmd! macro with proper quoting)",
      "warning_not_error": "Lint findings are warnings to allow gradual adoption without breaking CI"
    }
  }
}
