acceptance_criteria:
  - criterion: All integration tests pass
    verification: cargo test coordination_integration
  - criterion: Happy path produces valid receipt with deterministic JCS hash
    verification: Receipt validation in test
  - criterion: Atomic binding via CAS-at-commit (SessionBound committed BEFORE spawn)
    verification: Test logs and ledger event ordering verification
  - criterion: Coordination uses SessionSpawner trait for decoupling
    verification: Documentation and trait usage review
  - criterion: Golden test vectors verify versioned canonicalization (JCS 1.0)
    verification: cargo test --package apm2-core --lib coordination::canonicalization::tests
  - criterion: AGENTS.md follows module pattern
    verification: Documentation review
implementation:
  code_examples: []
  files_to_create:
    - path: crates/apm2-core/tests/coordination_integration.rs
      purpose: Integration test suite
  files_to_modify:
    - changes: Add SessionSpawner trait and AGENTS.md documentation
      path: crates/apm2-core/src/coordination/mod.rs
  implementation_steps:
    - "Define SessionSpawner trait in coordination/mod.rs"
    - "Update CoordinationEvent to include expected_transition_count"
    - "Implement versioned canonicalizer (JCS 1.0) and canonical_bytes() method"
    - "Add golden test vectors for coordination events and receipts"
    - "Implement MockSessionSpawner for integration tests"
    - "Implement coordination execution loop with NORMATIVE CAS-at-commit ordering"
    - "Write integration tests for happy path and TOCTOU races (verify commit-before-spawn)"
  summary: "Implement coordination end-to-end integration tests with CAS-at-commit atomicity and versioned canonicalization."

notes: "Phase: PHASE-1\nGenerated from RFC RFC-0012 ticket decomposition on 2026-01-27."
schema_version: "2026-01-26"
template_version: "2026-01-26"
test_requirements:
  - description: Unit tests pass
    test_id: UT-00155-01
    verification_command: cargo test -p apm2-core tck_00155
  - description: Integration test
    test_id: IT-00155-01
    verification_command: cargo run --bin apm2 -- factory tickets emit --rfc RFC-0012
ticket:
  depends_on: []
  id: TCK-00155
  requirement_ids: []
  rfc_id: RFC-0012
  status: READY
  title: Implement coordination end-to-end integration tests
