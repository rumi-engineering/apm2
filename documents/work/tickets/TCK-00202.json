{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-29",
    "template_version": "2026-01-29",
    "ticket": {
      "id": "TCK-00202",
      "title": "FAC: Domain separator module and sign_with_domain helper",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0009",
      "rfc_id": "RFC-0015",
      "requirements": [
        {
          "requirement_id": "FAC-REQ-0017",
          "requirement_ref": "documents/rfcs/RFC-0015/01_problem_and_imports.yaml#rfc_imported_requirements"
        }
      ],
      "evidence_artifacts": [
        {
          "evidence_id": "EVID-FAC-0001",
          "artifact_ref": "documents/rfcs/RFC-0015/07_test_and_evidence.yaml#evidence_requirements[0]"
        }
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_SECURITY",
        "DOMAIN_CORE"
      ]
    },
    "dependencies": {
      "tickets": []
    },
    "scope": {
      "in_scope": [
        "Create fac module directory structure",
        "Define domain separator constants for all critical event types",
        "Implement sign_with_domain helper function",
        "Implement verify_with_domain helper function",
        "Add unit tests for domain-separated signing"
      ],
      "out_of_scope": [
        "GateLease types (TCK-00203)",
        "GateRunCompleted types (TCK-00205)",
        "Integration with admission path"
      ]
    },
    "plan": {
      "steps": [
        "Create crates/apm2-core/src/fac/mod.rs",
        "Create crates/apm2-core/src/fac/domain_separator.rs",
        "Define domain separator constants: GATE_LEASE_ISSUED_PREFIX, LEASE_REVOKED_PREFIX, GATE_RUN_COMPLETED_PREFIX, MERGE_RECEIPT_PREFIX, CI_IMPORT_ATTESTATION_PREFIX, PROJECTION_RECEIPT_PREFIX, AAT_RESULT_REUSED_PREFIX, POLICY_RESOLVED_PREFIX, GATE_RECEIPT_PREFIX, QUARANTINE_EVENT_PREFIX",
        "Implement sign_with_domain(signer, domain_prefix, canonical_bytes) -> Signature",
        "Implement verify_with_domain(verifier, domain_prefix, canonical_bytes, signature) -> Result",
        "Add pub mod fac to crates/apm2-core/src/lib.rs",
        "Write unit tests for sign/verify roundtrip",
        "Write unit tests for cross-domain signature rejection"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-FAC-0001"
      ],
      "criteria": [
        "Domain separator constants are defined for all 10 critical event types",
        "sign_with_domain helper produces domain-separated signatures",
        "verify_with_domain rejects signatures with wrong domain prefix",
        "cargo test -p apm2-core fac::domain_separator::tests passes"
      ]
    },
    "notes": {
      "security": "Domain separation prevents cross-protocol signature replay attacks.\nEach event type has a unique prefix to ensure signatures cannot be\nreused across different event types.\n",
      "implementation_details": "Files to create:\n- crates/apm2-core/src/fac/mod.rs\n- crates/apm2-core/src/fac/domain_separator.rs\n\nFiles to modify:\n- crates/apm2-core/src/lib.rs (add pub mod fac;)\n",
      "affected_files": "Created: crates/apm2-core/src/fac/mod.rs\nCreated: crates/apm2-core/src/fac/domain_separator.rs\nModified: crates/apm2-core/src/lib.rs\n"
    }
  }
}
