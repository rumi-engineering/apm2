ticket_meta:
  schema_version: "2026-01-24"
  template_version: "2026-01-24"
  ticket:
    id: "TCK-00308"
    title: "HEF: Red-team and resilience test suite"
  binds:
    prd_id: "PRD-0009"
    rfc_id: "RFC-0018"
    requirements:
      - requirement_id: "REQ-HEF-0001"
        requirement_ref: "documents/rfcs/RFC-0018/requirements/REQ-HEF-0001.yaml#requirement"
      - requirement_id: "REQ-HEF-0003"
        requirement_ref: "documents/rfcs/RFC-0018/requirements/REQ-HEF-0003.yaml#requirement"
      - requirement_id: "REQ-HEF-0004"
        requirement_ref: "documents/rfcs/RFC-0018/requirements/REQ-HEF-0004.yaml#requirement"
      - requirement_id: "REQ-HEF-0005"
        requirement_ref: "documents/rfcs/RFC-0018/requirements/REQ-HEF-0005.yaml#requirement"
      - requirement_id: "REQ-HEF-0006"
        requirement_ref: "documents/rfcs/RFC-0018/requirements/REQ-HEF-0006.yaml#requirement"
      - requirement_id: "REQ-HEF-0008"
        requirement_ref: "documents/rfcs/RFC-0018/requirements/REQ-HEF-0008.yaml#requirement"
    evidence_artifacts:
      - evidence_id: "EVID-HEF-0001"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0001.yaml#evidence_artifact"
      - evidence_id: "EVID-HEF-0002"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0002.yaml#evidence_artifact"
      - evidence_id: "EVID-HEF-0003"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0003.yaml#evidence_artifact"
      - evidence_id: "EVID-HEF-0004"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0004.yaml#evidence_artifact"
      - evidence_id: "EVID-HEF-0005"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0005.yaml#evidence_artifact"
      - evidence_id: "EVID-HEF-0006"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0006.yaml#evidence_artifact"
      - evidence_id: "EVID-HEF-0007"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0007.yaml#evidence_artifact"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
    responsibility_domains:
      - "DOMAIN_PROTOCOL"
      - "DOMAIN_SECURITY"
  dependencies:
    tickets:
      - ticket_id: "TCK-00287"
        reason: "Base protocol infrastructure required before red-team testing"
      - ticket_id: "TCK-00302"
        reason: "Subscription registry and ACL enforcement must exist before testing ACL bypass attempts"
      - ticket_id: "TCK-00303"
        reason: "Resource governance and backpressure must exist before testing rate limits and allocation bombs"
      - ticket_id: "TCK-00304"
        reason: "Outbox and pulse publisher must exist before testing pulse ordering and loss recovery"
  scope:
    in_scope:
      - "Pulse-only admission attempt tests (verify pulse plane cannot bypass truth plane)"
      - "Unauthorized subscribe/publish tests (verify ACL enforcement)"
      - "Downgrade attempt tests (verify protocol version enforcement)"
      - "Oversize frame and allocation bomb tests (verify resource limits)"
      - "Subscription explosion and rate-limit enforcement tests"
      - "Replay, reorder, and duplication handling tests"
      - "Pulse loss recovery via ledger catch-up tests"
      - "Implementation of hef_redteam.rs test suite"
    out_of_scope:
      - "FAC v0 end-to-end testing (covered by TCK-00313)"
      - "Production deployment or monitoring"
      - "Performance benchmarking beyond resilience validation"
      - "Non-HEF red-team scenarios"
  plan:
    steps:
      - "Create hef_redteam.rs test file in crates/apm2-daemon/tests/"
      - "Implement pulse-only admission attempt test (verify fails closed)"
      - "Implement unauthorized subscribe test (session without capability)"
      - "Implement unauthorized publish test (session attempting publish)"
      - "Implement protocol downgrade attempt test"
      - "Implement oversize frame test (max_pulse_payload_bytes exceeded)"
      - "Implement allocation bomb test (many small subscriptions)"
      - "Implement subscription explosion test (max_subscriptions_per_connection exceeded)"
      - "Implement rate-limit enforcement test (max_pulses_per_sec_per_subscriber exceeded)"
      - "Implement replay detection test"
      - "Implement reorder handling test"
      - "Implement duplication handling test"
      - "Implement pulse loss recovery test (ledger catch-up mechanism)"
      - "Verify all red-team cases fail closed without affecting admission"
  definition_of_done:
    evidence_ids:
      - "EVID-HEF-0001"
      - "EVID-HEF-0002"
      - "EVID-HEF-0003"
      - "EVID-HEF-0004"
      - "EVID-HEF-0005"
      - "EVID-HEF-0006"
      - "EVID-HEF-0007"
    criteria:
      - "All red-team cases fail closed and do not affect admission."
  notes:
    security: "default-deny, least privilege, fail-closed"
    verification: "Each red-team test must demonstrate fail-closed behavior with explicit assertions"
