{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-25",
    "template_version": "2026-01-25",
    "ticket": {
      "id": "TCK-00074",
      "title": "Implement AI-Powered Hypothesis Generation"
    },
    "binds": {
      "prd_id": "NONE",
      "rfc_id": "RFC-0006",
      "requirements": [
        {
          "requirement_id": "AAT-002",
          "requirement_ref": "documents/rfcs/RFC-0006/01_problem_and_imports.yaml#rfc_local_requirements.requirements[15]"
        }
      ],
      "evidence_artifacts": []
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_BUILD_RELEASE"
      ]
    },
    "dependencies": {
      "tickets": [
        "TCK-00073"
      ]
    },
    "scope": {
      "in_scope": [
        "Replace stub generate_hypotheses() in aat.rs:207-251",
        "Create prompt template for hypothesis generation",
        "Invoke configured AI tool with PR description + diff",
        "Parse AI response into Vec<Hypothesis>",
        "Ensure at least 3 hypotheses with at least 1 error handling case"
      ],
      "out_of_scope": [
        "Hypothesis caching",
        "Multiple prompt template variants"
      ]
    },
    "plan": {
      "steps": [
        "Verify documents/reviews/AAT_HYPOTHESIS_PROMPT.md exists and update if needed",
        "Template includes: PR description, diff summary, expected output format",
        "Output format: JSON array of hypothesis objects",
        "Replace generate_hypotheses() stub with AI invocation",
        "Use AatToolConfig to select AI backend",
        "Write prompt to temp file, invoke AI tool with input redirect",
        "Parse JSON response into Vec<Hypothesis>",
        "Validate: at least 3 hypotheses, at least 1 tests_error_handling=true",
        "If validation fails, return error with actionable message",
        "Verify cargo build succeeds",
        "Verify cargo test passes",
        "Verify cargo clippy passes with no warnings"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [],
      "criteria": [
        "AAT_HYPOTHESIS_PROMPT.md verified and updated if needed",
        "generate_hypotheses() invokes configured AI tool",
        "AI response is parsed into Vec<Hypothesis>",
        "At least 3 hypotheses are generated",
        "At least 1 hypothesis has tests_error_handling=true",
        "Errors from AI tool are propagated with context",
        "cargo build succeeds",
        "cargo test passes",
        "cargo clippy passes with no warnings"
      ]
    },
    "notes": {
      "implementation_details": "Prompt template structure:\n```markdown\n# Hypothesis Generation for AAT\n\n## PR Description\n$PR_DESCRIPTION\n\n## Diff Summary\n$DIFF_SUMMARY\n\n## Instructions\nGenerate testable hypotheses for this PR. Each hypothesis should:\n1. Have a clear prediction about behavior\n2. Include a verification method (command to run)\n3. At least one hypothesis MUST test error handling\n\n## Output Format\nReturn ONLY a JSON array:\n```json\n[\n  {\n    \"id\": \"H-001\",\n    \"prediction\": \"When X, then Y\",\n    \"verification_method\": \"cargo test test_name\",\n    \"tests_error_handling\": false\n  }\n]\n```\n\nGenerate at least 3 hypotheses.\n```\n\nAI invocation pattern:\n```rust\nlet mut prompt_file = NamedTempFile::new()?;\nprompt_file.write_all(prompt.as_bytes())?;\nlet prompt_path = prompt_file.path().display().to_string();\n\nlet output = Command::new(\"sh\")\n    .args([\"-c\", &format!(\n        \"script -qec \\\"{} --yolo < '{}'\\\" /dev/null\",\n        config.ai_tool.command(),\n        prompt_path\n    )])\n    .output()?;\n```\n",
      "affected_files": "Existing: documents/reviews/AAT_HYPOTHESIS_PROMPT.md (verify and update if needed)\nModified: xtask/src/tasks/aat.rs (replace generate_hypotheses stub)\n"
    }
  }
}
