{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-24",
    "template_version": "2026-01-24",
    "ticket": {
      "id": "TCK-00301",
      "title": "HEF: Topic grammar + wildcard matcher with bounded complexity",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0009",
      "rfc_id": "RFC-0018",
      "requirements": [
        {
          "requirement_id": "REQ-HEF-0007",
          "requirement_ref": "documents/rfcs/RFC-0018/requirements/REQ-HEF-0007.yaml#requirement"
        }
      ],
      "evidence_artifacts": [
        {
          "evidence_id": "EVID-HEF-0007",
          "artifact_ref": "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0007.yaml#evidence_artifact"
        }
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_DAEMON"
      ]
    },
    "dependencies": {
      "tickets": [
        {
          "ticket_id": "TCK-00287",
          "reason": "HEF foundation ticket must be completed first"
        },
        {
          "ticket_id": "TCK-00300",
          "reason": "PulseEnvelope proto definitions required for topic handling"
        }
      ]
    },
    "scope": {
      "in_scope": [
        "Implement parser for dot-delimited topic grammar",
        "Implement matcher for per-segment '*' and terminal '>' wildcards",
        "Enforce max 2 wildcards per pattern",
        "Enforce ASCII-only characters in topic strings",
        "Reject empty segments in topic paths",
        "Enforce length bounds on topic strings and segments",
        "Create pulse_topic.rs module for topic validation and matching",
        "Wire topic parser into protocol module"
      ],
      "out_of_scope": [
        "Regex pattern support in topics",
        "Unicode/non-ASCII topic characters",
        "More than 2 wildcards per pattern",
        "Topic persistence or caching",
        "ACL enforcement (covered by TCK-00302)"
      ]
    },
    "plan": {
      "steps": [
        "Define topic grammar constants (max length, max segments, allowed chars)",
        "Implement TopicPattern struct with validation in pulse_topic.rs",
        "Implement single-segment '*' wildcard matching logic",
        "Implement terminal '>' wildcard matching logic",
        "Add wildcard count validation (max 2)",
        "Implement topic string parser with segment validation",
        "Add unit tests for valid patterns (exact, single wildcard, terminal wildcard)",
        "Add unit tests for invalid patterns (regex, empty segments, too many wildcards)",
        "Wire topic parser into protocol/mod.rs",
        "Add integration tests for topic matching in subscription flow"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-HEF-0007"
      ],
      "criteria": [
        "Invalid patterns (regex, empty segments, too many wildcards) are rejected."
      ]
    },
    "notes": {
      "security": "default-deny, least privilege, fail-closed",
      "verification": "All topic validation rejects malformed input before processing"
    }
  }
}
