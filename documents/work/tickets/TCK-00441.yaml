ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00441"
    title: "FAC review CLI contract and deterministic run-state schema"
    status: "OPEN"
  binds:
    prd_id: "PRD-0009"
    rfc_id: "RFC-0018"
    requirements:
      - requirement_id: "REQ-HEF-0019"
        requirement_ref: "documents/rfcs/RFC-0018/requirements/REQ-HEF-0019.yaml#rfc_requirement"
    evidence_artifacts:
      - evidence_id: "EVID-HEF-0017"
        artifact_ref: "documents/rfcs/RFC-0018/evidence_artifacts/EVID-HEF-0017.yaml#rfc_evidence_artifact"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
      - "AGENT_REVIEWER"
      - "AGENT_QA"
    responsibility_domains:
      - "DOMAIN_RUNTIME"
      - "DOMAIN_OBSERVABILITY"
  dependencies:
    tickets:
      - ticket_id: "TCK-00419"
        reason: "FAC command-surface authority cutover baseline must already exist."
  scope:
    in_scope:
      - "Define stable `apm2 fac review` command contract for `run`, `dispatch`, `status`, `project`, and `tail`."
      - "Define deterministic JSON/text output schemas for run identity, state, and terminal reason fields."
      - "Persist PR/work-scoped run-state metadata required for crash-safe resume."
      - "Enforce fail-closed behavior when run-state records are missing/corrupt/ambiguous."
    out_of_scope:
      - "GitHub workflow orchestration and authorization policy wiring."
      - "Liveness fallback model rotation policy implementation."
  plan:
    steps:
      - "Define command and output schema contracts in CLI module docs/tests."
      - "Implement run-state persistence model with deterministic serialization."
      - "Add status/projection reconstruction path from persisted state only."
      - "Add negative-path tests for missing/corrupt state behavior."
      - "Run required workspace checks for touched crates."
  definition_of_done:
    evidence_ids:
      - "EVID-HEF-0017"
    criteria:
      - "CLI commands and output schemas are stable and test-covered."
      - "Run-state persistence supports deterministic reconstruction after process restart."
      - "Ambiguous/missing run-state yields explicit fail-closed status."
  notes:
    security: |
      State reconstruction must not infer authority from ambient process inspection.
    verification: |
      Include unit tests for serialization compatibility and integration tests for restart reconstruction.
    general: |
      This ticket establishes the command/state contract consumed by subsequent workflow and liveness tickets.
