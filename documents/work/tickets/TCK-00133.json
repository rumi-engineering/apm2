{
  "schema": "apm2.ticket.v1",
  "ticket_meta": {
    "schema_version": "2026-01-27",
    "template_version": "2026-01-27",
    "ticket": {
      "id": "TCK-00133",
      "title": "Add CLI command: apm2 cac apply-patch",
      "status": "CLOSED"
    },
    "binds": {
      "prd_id": "PRD-0007",
      "rfc_id": "RFC-0011",
      "requirements": [
        {
          "requirement_id": "CAC-REQ-0002",
          "requirement_ref": "documents/prds/PRD-0007/requirements/REQ-0002.yaml#prd_requirement"
        }
      ],
      "evidence_artifacts": [
        "EVID-0003"
      ]
    },
    "custody": {
      "agent_roles": [
        "AGENT_IMPLEMENTER"
      ],
      "responsibility_domains": [
        "DOMAIN_TOOLING"
      ]
    },
    "dependencies": {
      "tickets": [
        "TCK-00132"
      ]
    },
    "scope": {
      "in_scope": [
        "Add apm2 cac apply-patch CLI command",
        "--expected-base flag for replay protection",
        "--dry-run flag for validation without commit",
        "--format flag for receipt output (json/yaml)",
        "Read patch from file or stdin",
        "Output AdmissionReceipt on success"
      ],
      "out_of_scope": [
        "Interactive patch editing",
        "Patch generation from diffs",
        "Batch patch application"
      ]
    },
    "plan": {
      "steps": [
        "Add 'cac' subcommand group to apm2-cli",
        "Add 'apply-patch' subcommand under 'cac'",
        "Implement --expected-base <hash> required flag",
        "Implement --patch <file> or stdin input",
        "Implement --patch-type (json-patch|merge-patch) flag",
        "Implement --dry-run flag for validation only",
        "Implement --format (json|yaml) flag for output",
        "Call AdmissionGate and output receipt",
        "Write CLI integration tests"
      ]
    },
    "definition_of_done": {
      "evidence_ids": [
        "EVID-0003"
      ],
      "criteria": [
        "apm2 cac apply-patch --help shows usage",
        "Command requires --expected-base flag",
        "--dry-run validates without committing",
        "Success outputs AdmissionReceipt in requested format",
        "Hash mismatch returns non-zero exit with error message",
        "All tests pass: cargo test cli_cac_apply_patch"
      ]
    },
    "notes": {
      "security": "--expected-base is required to enforce replay protection at CLI level",
      "architecture": "Follow existing CLI patterns in apm2-cli crate.\nUse clap derive macros for argument parsing.\nExit codes: 0=success, 1=validation_error, 2=replay_violation\n"
    }
  }
}
