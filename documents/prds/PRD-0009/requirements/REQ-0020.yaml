prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-0020"
  type: "SECURITY"
  source_id: "FAC-REQ-0119"
  title: "GateReceipt versioning and canonicalization"
  statement: |
    GateReceipt envelopes MUST include explicit versioning and canonicalization rules.
    Admission MUST reject unknown receipt versions or payload schema versions in enforce mode.
  acceptance_criteria:
    - "GateReceipt envelope includes receipt_version, payload_kind, payload_schema_version, payload_hash, evidence_bundle_hash, gate_id, lease_id, changeset_digest, executor_actor_id, and signature. Verified by: Schema validation test."
    - "Canonicalization rules are explicit: deterministic encoding, no maps, stable ordering of repeated fields, canonical_bytes() defined. Verified by: Test vector validation."
    - "Unknown payload_kind or payload_schema_version is rejected in enforce mode (allowed only in explicitly configured audit mode). Verified by: Version rejection test."
  evidence:
    evidence_ids:
      - EVID-0036
  law_alignment:
    - law_id: "LAW-01"
      enforcement: "Receipt-backed admission requires stable, versioned receipts."
      applies_to:
        - "GateReceipt"
    - law_id: "LAW-15"
      enforcement: "Measurement integrity via canonicalization and versioning."
      applies_to:
        - "Receipt verification"
  defect_codes:
    - code: "GATE_RECEIPT_VERSION_UNKNOWN"
      severity: "S1"
      description: "Unknown GateReceipt payload kind or schema version"
    - code: "GATE_RECEIPT_CANON_MISMATCH"
      severity: "S1"
      description: "Canonicalization mismatch for GateReceipt payload"
