prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-0002"
  type: "SECURITY"
  source_id: "FAC-REQ-0101"
  title: "Projection Divergence Emergency Stop"
  statement: |
    If external trunk diverges from internal MergeReceipt truth, FAC MUST freeze admissions
    until reconciled.
  acceptance_criteria:
    - "Divergence watchdog emits PROJECTION_DIVERGENCE defect and InterventionFreeze(repo). Verified by: Test that when external trunk HEAD differs from latest MergeReceipt result_selector, DefectRecord with code PROJECTION_DIVERGENCE is emitted and InterventionFreeze event with repo scope is recorded."
    - "Freeze blocks new admissions and merges for the repo until reconciliation. Verified by: Test that after InterventionFreeze, admission requests for the affected repo are rejected with freeze status and no new MergeReceipts can be issued."
    - "Unfreeze requires AdjudicationResolved(request_type=EMERGENCY_RECOVERY) or PRD-0007 emergency_override ceremony if the adapter cannot reconcile. Verified by: Test that InterventionUnfreeze is only accepted when preceded by valid AdjudicationResolved with request_type=EMERGENCY_RECOVERY or emergency_override ceremony completion."
    - "Divergence watchdog polls at configured HTF interval (TIME_TBD). Verified by: Test that watchdog compares external trunk HEAD to MergeReceipt result_selector at poll_interval_htf_ticks frequency."
    - "Projection tamper detection overwrites projection to match ledger truth and emits DefectRecord. Verified by: Test that when external status is modified by non-adapter identity, PROJECTION_TAMPER defect is emitted and projection is reapplied from ledger on next sync."
  evidence:
    evidence_ids:
      - EVID-0003
      - EVID-0004
  law_alignment:
    - law_id: "LAW-03"
      enforcement: "Ledger is truth; projections overwriteable; divergence detection halts factory"
      applies_to:
        - "GitHub adapter"
        - "Divergence watchdog"
    - law_id: "LAW-10"
      enforcement: "Atomic merge receipt binds (base, changeset) -> result; anti-entropy divergence checks"
      applies_to:
        - "Merge semantics"
        - "MergeReceipt"
  defect_codes:
    - code: "PROJECTION_DIVERGENCE"
      severity: "S0"
      description: "External trunk diverges from latest MergeReceipt"
    - code: "PROJECTION_TAMPER"
      severity: "S1"
      description: "External projection mutated by non-adapter identity"
  intervention_events:
    - event: "InterventionFreeze"
      description: "Repo/work scope freeze, signed by admission authority"
      trigger: "PROJECTION_DIVERGENCE detected"
    - event: "InterventionUnfreeze"
      description: "Signed unfreeze; requires adjudication or override ceremony"
      trigger: "AdjudicationResolved(EMERGENCY_RECOVERY) or emergency_override ceremony"
