prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-0012"
  type: "SECURITY"
  source_id: "FAC-REQ-0111"
  title: "AAT anti-downgrade invariant"
  statement: |
    For a given (work_id, changeset_digest), the resolved risk_tier, determinism_class,
    verifier_policy_hashes, and rcp_profile_ids MUST be pinned at FAC start and cannot be
    lowered without an explicit waiver. Admission MUST reject AAT receipts that diverge.
  acceptance_criteria:
    - "Resolved policy tuple is recorded at FAC-00 (resolved_policy_hash, resolved_risk_tier, resolved_verifier_policy_hashes, resolved_rcp_profile_ids, resolved_rcp_manifest_hashes). Verified by: Policy resolution event test."
    - "Admission rejects AAT receipts with policy_hash != resolved_policy_hash. Verified by: Negative test."
    - "Admission rejects AAT receipts with risk_tier lower than resolved_risk_tier. Verified by: Downgrade test."
    - "Admission rejects verifier_policy_hash not in resolved_verifier_policy_hashes. Verified by: Policy allowlist test."
    - "Admission rejects rcp_aat_manifest_hash or rcp_profile_id not matching resolved_rcp_profile_ids/manifest hashes. Verified by: Profile substitution test."
    - "Downgrades require AdjudicationRequested(WAIVER) with separate authority and are projection-visible. Verified by: Waiver audit test."
  evidence:
    evidence_ids:
      - EVID-0028
  law_alignment:
    - law_id: "LAW-01"
      enforcement: "Receipt-backed admission requires anti-downgrade enforcement."
      applies_to:
        - "GateReceipt"
        - "Policy resolution"
    - law_id: "LAW-15"
      enforcement: "Measurement integrity via pinned policy resolution."
      applies_to:
        - "Admission"
  defect_codes:
    - code: "AAT_POLICY_DOWNGRADE_ATTEMPT"
      severity: "S0"
      description: "Attempt to lower risk tier or determinism class without waiver"
    - code: "AAT_PROFILE_SUBSTITUTION"
      severity: "S1"
      description: "Receipt references unapproved RCP profile or manifest"
