prd_decisions_review:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  decisions:
    - id: DEC-FAC-0001
      statement: |
        Selected Design: Ed25519 signatures with domain separation for all critical events.
      rationale: |
        Critical events (GateRunCompleted, GateLeaseIssued, MergeReceipt, CI attestations,
        ProjectionReceipt) require cryptographic non-repudiation. Ed25519 provides fast,
        secure signatures with well-understood properties. Domain separators prevent
        cross-context signature reuse attacks.
      alternatives_considered:
        - id: ALT-HMAC
          description: Use HMAC-based message authentication for critical events.
          status: REJECTED
          reason: |
            HMAC requires shared secrets, complicating key management and preventing
            non-repudiation. Cannot prove which party signed without revealing key.
        - id: ALT-RSA
          description: Use RSA signatures for critical events.
          status: REJECTED
          reason: |
            RSA signatures are larger and slower than Ed25519. No compelling advantage
            for our use case where key sizes and verification speed matter.
        - id: ALT-NO-DOMAIN-SEP
          description: Use Ed25519 without domain separators.
          status: REJECTED
          reason: |
            Without domain separation, a signature for GateRunCompleted could potentially
            be replayed in a different context. Domain prefixes (e.g., "GATE_RUN_COMPLETED:")
            prevent this attack class.
      evidence_ids: []
    - id: DEC-FAC-0002
      statement: |
        Selected Design: OCAP containment with mechanical context firewall for consumption holons.
      rationale: |
        Hermetic consumption requires that holons cannot discover context outside their
        allocated ContextPack. Mechanical enforcement via OCAP-mediated tools with
        manifest-scoped read handles provides deterministic, auditable containment.
        Context misses terminate sessions and trigger refinement rather than allowing
        discretionary reads.
      alternatives_considered:
        - id: ALT-SOFT-CONTAINMENT
          description: Log context violations but allow reads to proceed.
          status: REJECTED
          reason: |
            Soft containment does not provide security guarantees. Holons could
            exfiltrate or be influenced by context outside their pack, breaking
            determinism and security properties.
        - id: ALT-POST-HOC-AUDIT
          description: Allow all reads; audit after the fact for policy violations.
          status: REJECTED
          reason: |
            Post-hoc audit cannot prevent the damage from unauthorized reads.
            Security-critical operations require prevention, not detection.
        - id: ALT-FILESYSTEM-JAIL
          description: Use filesystem-level sandboxing (chroot, containers).
          status: REJECTED
          reason: |
            Filesystem jails are coarse-grained and cannot enforce per-artifact
            allowlists. OCAP provides fine-grained, policy-driven access control
            with full auditability via ToolDecided events.
      evidence_ids: []
    - id: DEC-FAC-0003
      statement: |
        Selected Design: GitHub is a projection-only target; never a source of truth.
      rationale: |
        External forges (GitHub) can be manipulated by actors with access. FAC treats
        the internal ledger as the sole source of truth for admission decisions.
        GitHub status, checks, and merge state are projections of internal truth,
        not inputs to admission decisions. Divergence triggers freeze until reconciled.
      alternatives_considered:
        - id: ALT-GITHUB-AUTHORITATIVE
          description: Trust GitHub status checks as admission signals.
          status: REJECTED
          reason: |
            GitHub status can be manipulated by anyone with repo write access.
            Agents could spoof gate outcomes by setting external status. This
            fundamentally undermines the security model.
        - id: ALT-HYBRID-TRUST
          description: Trust GitHub for some signals (e.g., CI) but not others.
          status: REJECTED
          reason: |
            Hybrid trust creates confusion about which signals are authoritative.
            Simpler to have a single source of truth (ledger) and project to
            external systems.
        - id: ALT-NO-PROJECTION
          description: Do not project to GitHub; operate entirely internally.
          status: REJECTED
          reason: |
            GitHub integration is required for visibility and human review workflows.
            Projection provides the benefits of GitHub UI without trusting it as
            a source of truth.
      evidence_ids: []
    - id: DEC-FAC-0004
      statement: |
        Selected Design: Explicit law alignment with traceability to FAC protocol stages.
      rationale: |
        FAC is a security-critical protocol that must comply with the Laws of Holonic
        Agent Systems. Explicit alignment documentation ensures each protocol stage
        implements the required law enforcement mechanisms. Traceability enables
        auditing and gap analysis.
      alternatives_considered:
        - id: ALT-IMPLICIT-COMPLIANCE
          description: Assume law compliance without explicit documentation.
          status: REJECTED
          reason: |
            Implicit compliance cannot be audited. Security-critical systems require
            explicit traceability to demonstrate compliance.
        - id: ALT-LAW-PER-REQUIREMENT
          description: Document law alignment at requirement level only.
          status: REJECTED
          reason: |
            Requirements are high-level; enforcement happens in protocol stages.
            Stage-level alignment provides implementation-specific traceability
            that requirement-level alignment cannot.
      evidence_ids: []
    - id: DEC-FAC-0005
      statement: |
        Selected Design: CI evidence import fail-closed by default (CI_EVENTS_ENABLED=false).
      rationale: |
        CI conclusions from external systems cannot be trusted as admission signals.
        Fail-closed default ensures that CI observations are only used when explicitly
        enabled with proper evidence binding (raw artifact import, adapter attestation).
        This prevents accidental reliance on spoofable external signals.
      alternatives_considered:
        - id: ALT-FAIL-OPEN
          description: Enable CI events by default; trust CI conclusions.
          status: REJECTED
          reason: |
            Fail-open for security controls is an anti-pattern. CI conclusions
            can be spoofed by manipulating external CI configuration. Fail-closed
            ensures conscious enablement with proper safeguards.
        - id: ALT-CI-AUTHORITATIVE
          description: Treat CI success as sufficient for READY_FOR_REVIEW transition.
          status: REJECTED
          reason: |
            CI success without evidence binding provides no audit trail. A plain
            "success" conclusion tells us nothing about what was actually verified.
            Evidence import provides the raw artifacts for replay and audit.
        - id: ALT-ALWAYS-RERUN
          description: Always re-run CI locally; ignore external CI.
          status: REJECTED
          reason: |
            Re-running all CI locally is expensive and slow. Evidence import allows
            using external CI results when they can be properly attested, with
            fallback to local re-run for high-risk (T3) changes.
      evidence_ids: []
    - id: DEC-FAC-0006
      statement: |
        Selected Design: Typed GateReceipt payloads for AAT (no standalone AATReceipt event).
      rationale: |
        Avoids protocol bloat and keeps admission logic single-path. GateReceipt remains
        the sole receipt shape validated by HOLON-KERNEL-GATE, while AAT-specific fields
        live in a typed payload when gate_id=aat.
      alternatives_considered:
        - id: ALT-AAT-RECEIPT
          description: Introduce a standalone AATReceipt event.
          status: REJECTED
          reason: |
            Creates a parallel validation path and increases admission complexity.
        - id: ALT-AAT-METADATA
          description: Use untyped metadata fields on GateReceipt.
          status: REJECTED
          reason: |
            Weak typing makes validation ambiguous and reduces auditability.
      evidence_ids: []
    - id: DEC-FAC-0007
      statement: |
        Selected Design: Coordinator-managed determinism envelope enforced in Phase 2.
      rationale: |
        Determinism must be proven externally to gate executors to avoid adversarial
        self-attestation. Phase 2 enforcement prevents Phase 1 rollout delays while
        preserving fail-closed integrity when enabled.
      alternatives_considered:
        - id: ALT-EXECUTOR-SELF-ATTEST
          description: Allow gate executors to declare their own stability.
          status: REJECTED
          reason: |
            Executor self-attestation is an adversarial surface for nondeterminism.
        - id: ALT-PHASE1-ENFORCE
          description: Enforce determinism envelope in Phase 1.
          status: REJECTED
          reason: |
            High friction and environment dependency risk blocking core hardening rollout.
      evidence_ids: []
    - id: DEC-FAC-0008
      statement: |
        Selected Design: Evidence-bound AAT GateReceipts with transcript hash chains and attestation.
      rationale: |
        AAT runners are untrusted surfaces unless receipts bind to independently verifiable
        evidence. Transcript chains, artifact digests, and minimum attestation prevent
        “signed nonsense” from passing admission.
      alternatives_considered:
        - id: ALT-NARRATIVE-ONLY
          description: Accept narrative PASS with minimal artifacts.
          status: REJECTED
          reason: |
            Narrative-only receipts are spoofable and repeat the GitHub status failure mode.
        - id: ALT-ARTIFACT-ONLY
          description: Require only test reports without transcript chains.
          status: REJECTED
          reason: |
            Artifact-only receipts cannot prove execution conditions or ordering integrity.
      evidence_ids: []
    - id: DEC-FAC-0009
      statement: |
        Selected Design: Terminal verifier binding schema enforced for AAT PASS.
      rationale: |
        Schema-enforced verifier predicates prevent gradual dilution of “terminal verifiers”
        into narratives or heuristic logs.
      alternatives_considered:
        - id: ALT-ALLOW-ADVISORY
          description: Allow PASS based on advisory signals if logs look correct.
          status: REJECTED
          reason: |
            Advisory-based PASS is spoofable and breaks Law-04 terminal verifier requirements.
      evidence_ids: []
    - id: DEC-FAC-0010
      statement: |
        Selected Design: Risk-tiered, diff-aware AAT selection policy.
      rationale: |
        Full AAT on every PR would collapse throughput; risk-tiered selection preserves
        cadence while protecting critical domains.
      alternatives_considered:
        - id: ALT-FULL-AAT-ALWAYS
          description: Require full AAT on every changeset.
          status: REJECTED
          reason: |
            Throughput collapse and cost blowout without proportional safety gains.
        - id: ALT-NO-AAT
          description: Run AAT only on nightly main.
          status: REJECTED
          reason: |
            High-risk changes would merge without acceptance coverage.
      evidence_ids: []
    - id: DEC-FAC-0011
      statement: |
        Selected Design: Invariant-first AAT specifications.
      rationale: |
        Invariants prevent brittle step scripts and preserve refactor freedom while still
        enforcing product-level guarantees.
      alternatives_considered:
        - id: ALT-STEP-FIRST
          description: Step scripts define acceptance; invariants optional.
          status: REJECTED
          reason: |
            Step-first tests encode current behavior and block legitimate refactors.
      evidence_ids: []
  gate_reviews:
    - gate_id: GATE-PRD-SECURITY
      status: PENDING
      checklist:
        - item: "Ed25519 signature implementation reviewed for correctness"
          status: PENDING
        - item: "Domain separator uniqueness verified across event types"
          status: PENDING
        - item: "OCAP context firewall deny rules comprehensive"
          status: PENDING
        - item: "Key rotation and custody procedures documented"
          status: PENDING
        - item: "Projection divergence detection covers all attack vectors"
          status: PENDING
      evidence_ids: []
    - gate_id: GATE-PRD-PRODUCT
      status: PENDING
      checklist:
        - item: "Developer experience for context miss recovery acceptable"
          status: PENDING
        - item: "Waiver ceremony UX for COI cases documented"
          status: PENDING
        - item: "Graduated rollout plan reviewed with stakeholders"
          status: PENDING
        - item: "Escape hatch documentation complete"
          status: PENDING
      evidence_ids: []
  waivers: []
  future_upgrade_path:
    - Evaluate typed GateEvent/ProjectionEvent kernel proto once FAC workflows stabilize.
    - Add support for additional signature algorithms if Ed25519 becomes insufficient.
    - Extend CI attestation to L2+ with reproducible builds when ecosystem matures.
    - Implement automated COI waiver for well-defined low-risk artifact categories.
    - Consider decentralized key management for multi-org deployments.
