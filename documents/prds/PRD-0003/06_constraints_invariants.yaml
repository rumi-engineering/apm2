prd_constraints_invariants:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"

  constraints:
    - id: "CNS-0001"
      statement: "No PR may merge without AAT status check in success or waived state"
      rationale: "AAT is a mandatory quality gate to ensure all PRs are verified"
      enforcement: "GitHub branch protection rules require aat/acceptance status check"
      evidence_ids:
        - "EVID-0004"

    - id: "CNS-0002"
      statement: "AAT waivers require explicit approval from AUTH_AAT or AUTH_SECURITY"
      rationale: "Waivers bypass quality gate and must be authorized"
      enforcement: "Manual toggle requires authority role verification before status change"
      evidence_ids:
        - "EVID-0004"

    - id: "CNS-0003"
      statement: "AAT agent must form hypotheses BEFORE executing any verification commands"
      rationale: "Hypothesis-driven testing requires predictions before observation"
      enforcement: "Protocol enforces hypothesis recording timestamp before execution timestamp"
      evidence_ids:
        - "EVID-0005"

    - id: "CNS-0004"
      statement: "All AAT evidence bundles must be persisted for minimum 90 days"
      rationale: "Audit and debugging require access to historical verification results"
      enforcement: "Evidence storage retention policy enforced by infrastructure"
      evidence_ids:
        - "EVID-0003"

    - id: "CNS-0005"
      statement: "AAT must complete within 15 minutes or escalate to pending state"
      rationale: "Fast feedback cycles require bounded execution time"
      enforcement: "CI job timeout and AAT agent internal timeout"
      evidence_ids:
        - "EVID-0003"

  invariants:
    - id: "INV-0001"
      statement: "AAT verdict is deterministic given same PR content and environment"
      rationale: "Reproducibility requires deterministic behavior for same inputs"
      enforcement: "AAT agent uses fixed random seeds, pinned dependencies, isolated environment"
      evidence_ids:
        - "EVID-0003"
        - "EVID-0006"

    - id: "INV-0002"
      statement: "Every AAT run produces exactly one evidence bundle"
      rationale: "Traceability requires one-to-one mapping between runs and evidence"
      enforcement: "AAT agent generates unique bundle ID per run"
      evidence_ids:
        - "EVID-0003"

    - id: "INV-0003"
      statement: "AAT status check state is always one of: success, failure, pending"
      rationale: "GitHub API requires valid status state"
      enforcement: "AAT agent validates status before API call"
      evidence_ids:
        - "EVID-0004"

    - id: "INV-0004"
      statement: "Hypothesis formation timestamp always precedes execution timestamp"
      rationale: "Hypothesis-driven testing requires predictions before observations"
      enforcement: "AAT protocol enforces timestamp ordering in evidence bundle"
      evidence_ids:
        - "EVID-0005"
        - "EVID-0006"

    - id: "INV-0005"
      statement: "Anti-gaming check always runs regardless of hypothesis verification outcome"
      rationale: "Gaming detection is independent of functional correctness"
      enforcement: "AAT protocol requires anti-gaming step in all code paths"
      evidence_ids:
        - "EVID-0007"
