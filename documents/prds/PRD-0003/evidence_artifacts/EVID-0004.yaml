prd_evidence_artifact:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"

  id: "EVID-0004"
  category: "AUDIT_LOGS"
  title: "Status Check Toggle Audit"

  capture:
    paths:
      - "evidence/aat/status_check_audit/"

  verification:
    commands:
      - id: "CMD-0001"
        shell: "bash"
        command: |
          # Verify status check audit log integrity
          set -euo pipefail
          AUDIT_LOG="$1"

          if [[ ! -f "$AUDIT_LOG" ]]; then
            echo "Audit log not found: $AUDIT_LOG"
            exit 1
          fi

          # Validate each line is valid JSON
          while IFS= read -r line; do
            echo "$line" | jq empty || { echo "Invalid JSON in audit log"; exit 1; }
          done < "$AUDIT_LOG"

          # Check required fields in each entry
          jq -e '.[] | .timestamp, .action, .pr_number, .status' "$AUDIT_LOG" > /dev/null 2>&1 || \
          jq -s -e '.[] | .timestamp, .action, .pr_number, .status' "$AUDIT_LOG" > /dev/null || {
            echo "Audit entries missing required fields"
            exit 1
          }

          echo "Status check audit log validation passed"
        expected_exit_code: 0
        cwd: "."
        timeout_seconds: 60
        network_access: "DISALLOWED"
        allowlist_hosts: []
        constraints:
          - "Requires jq installed"

  data:
    classification: "INTERNAL"
    redaction:
      required: false
      guidance:
        - "Audit logs should not contain secrets"
