prd_evidence_artifact:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"

  id: "EVID-0003"
  category: "RECORDINGS"
  title: "AAT Agent Execution Trace"

  capture:
    paths:
      - "evidence/aat/execution_traces/"

  verification:
    commands:
      - id: "CMD-0001"
        shell: "bash"
        command: |
          # Verify AAT execution trace is complete and valid
          set -euo pipefail
          TRACE_FILE="$1"

          if [[ ! -f "$TRACE_FILE" ]]; then
            echo "Trace file not found: $TRACE_FILE"
            exit 1
          fi

          # Validate JSON structure
          jq empty "$TRACE_FILE" || { echo "Invalid JSON in trace file"; exit 1; }

          # Check required fields
          jq -e '.pr_number' "$TRACE_FILE" > /dev/null || { echo "Missing pr_number"; exit 1; }
          jq -e '.timestamp' "$TRACE_FILE" > /dev/null || { echo "Missing timestamp"; exit 1; }
          jq -e '.hypotheses' "$TRACE_FILE" > /dev/null || { echo "Missing hypotheses"; exit 1; }
          jq -e '.verdict' "$TRACE_FILE" > /dev/null || { echo "Missing verdict"; exit 1; }

          echo "AAT execution trace validation passed"
        expected_exit_code: 0
        cwd: "."
        timeout_seconds: 60
        network_access: "DISALLOWED"
        allowlist_hosts: []
        constraints:
          - "Requires jq installed"

  data:
    classification: "INTERNAL"
    redaction:
      required: true
      guidance:
        - "Redact any secrets or tokens from execution output"
        - "Redact personal identifiable information"
