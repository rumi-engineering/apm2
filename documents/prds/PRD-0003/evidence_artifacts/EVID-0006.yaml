prd_evidence_artifact:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"

  id: "EVID-0006"
  category: "TEST_RESULTS"
  title: "Hypothesis Verification Results"

  capture:
    paths:
      - "evidence/aat/hypothesis_results/"

  verification:
    commands:
      - id: "CMD-0001"
        shell: "bash"
        command: |
          # Verify hypothesis verification results
          set -euo pipefail
          RESULTS_FILE="$1"

          if [[ ! -f "$RESULTS_FILE" ]]; then
            echo "Results file not found: $RESULTS_FILE"
            exit 1
          fi

          # Validate JSON
          jq empty "$RESULTS_FILE" || { echo "Invalid JSON"; exit 1; }

          # Check each hypothesis has result
          jq -e '.hypotheses[] | .id, .prediction, .result, .actual_outcome, .executed_at' "$RESULTS_FILE" > /dev/null || {
            echo "Hypothesis result missing required fields"
            exit 1
          }

          # Verify formed_at < executed_at for all hypotheses
          INVALID_ORDER=$(jq '[.hypotheses[] | select(.formed_at >= .executed_at)] | length' "$RESULTS_FILE")
          if [[ "$INVALID_ORDER" -gt 0 ]]; then
            echo "Hypothesis formed_at must precede executed_at"
            exit 1
          fi

          # Check verdict is present
          jq -e '.verdict' "$RESULTS_FILE" > /dev/null || {
            echo "Missing verdict in results"
            exit 1
          }

          echo "Hypothesis verification results validation passed"
        expected_exit_code: 0
        cwd: "."
        timeout_seconds: 60
        network_access: "DISALLOWED"
        allowlist_hosts: []
        constraints:
          - "Requires jq installed"

  data:
    classification: "INTERNAL"
    redaction:
      required: true
      guidance:
        - "Redact any secrets from command output"
