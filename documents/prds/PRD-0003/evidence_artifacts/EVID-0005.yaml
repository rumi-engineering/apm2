prd_evidence_artifact:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"

  id: "EVID-0005"
  category: "RECORDINGS"
  title: "Hypothesis Formation Log"

  capture:
    paths:
      - "evidence/aat/hypothesis_formation/"

  verification:
    commands:
      - id: "CMD-0001"
        shell: "bash"
        command: |
          # Verify hypothesis formation log meets requirements
          set -euo pipefail
          HYPOTHESIS_LOG="$1"

          if [[ ! -f "$HYPOTHESIS_LOG" ]]; then
            echo "Hypothesis log not found: $HYPOTHESIS_LOG"
            exit 1
          fi

          # Validate JSON
          jq empty "$HYPOTHESIS_LOG" || { echo "Invalid JSON"; exit 1; }

          # Check minimum 3 hypotheses
          HYPO_COUNT=$(jq '.hypotheses | length' "$HYPOTHESIS_LOG")
          if [[ "$HYPO_COUNT" -lt 3 ]]; then
            echo "Insufficient hypotheses: $HYPO_COUNT (minimum 3 required)"
            exit 1
          fi

          # Check each hypothesis has required fields
          jq -e '.hypotheses[] | .id, .prediction, .verification_method, .formed_at' "$HYPOTHESIS_LOG" > /dev/null || {
            echo "Hypothesis missing required fields"
            exit 1
          }

          # Check at least one tests error handling
          ERROR_HYPO=$(jq '[.hypotheses[] | select(.tests_error_handling == true)] | length' "$HYPOTHESIS_LOG")
          if [[ "$ERROR_HYPO" -lt 1 ]]; then
            echo "No hypothesis tests error handling"
            exit 1
          fi

          echo "Hypothesis formation log validation passed"
        expected_exit_code: 0
        cwd: "."
        timeout_seconds: 60
        network_access: "DISALLOWED"
        allowlist_hosts: []
        constraints:
          - "Requires jq installed"

  data:
    classification: "INTERNAL"
    redaction:
      required: false
      guidance: []
