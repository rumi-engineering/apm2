prd_constraints_invariants:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  constraints:
  - id: CNS-0001
    statement: 'Execution is autonomous-only: during workflow execution there are
      no human owners, assignees, or maintainers; accountability is expressed only
      via authority roles, custody roles, and responsibility domains.'
    rationale: Human-in-the-loop assumptions break autonomy and introduce untracked
      decision points; the system must be self-governing and evidence-driven.
    enforcement: Templates and schemas forbid human assignee fields; governance gates
      and signoffs are role-based and recorded as events.
    evidence_ids:
    - EVID-0002
    - EVID-0021
  - id: CNS-0002
    statement: 'Default-deny security: network access, tool execution, and secrets
      access are denied unless explicitly permitted by policy and tied to a work lease.'
    rationale: Probabilistic agents must not have ambient authority; safe autonomy
      requires explicit, audited permissions.
    enforcement: Syscall mediation enforces deny-by-default; policy engine decisions
      are logged; violations trigger quarantine.
    evidence_ids:
    - EVID-0003
    - EVID-0013
  - id: CNS-0003
    statement: 'Minimum Structure for Maximum Automation: Artifacts MUST use minimal,
      opinionated YAML schemas (compression format); narrative is permitted but non-authoritative;
      Markdown tables are forbidden.'
    rationale: Structured "receipts" enable deterministic gating and token efficiency
      while avoiding the throughput loss of narrative-heavy collaboration.
    enforcement: Template lint and schema validation; gates ignore narrative fields
      and decide based on typed PASS/FAIL receipts.
    evidence_ids:
    - EVID-0002
  - id: CNS-0004
    statement: 'No uncontrolled side effects: agents cannot directly write outside
      designated work directories, execute arbitrary commands, or access external
      network endpoints.'
    rationale: Prevent exfiltration, corruption, and runaway behavior; ensure reproducibility
      and auditability.
    enforcement: Policy allowlists, OS sandboxing where available, and continuous
      policy violation detection.
    evidence_ids:
    - EVID-0003
    - EVID-0004
  - id: CNS-0005
    statement: 'Evidence-driven closure via Gate Receipts: work cannot be completed
      without reproducible evidence artifacts and signed "Gate Receipts" that are
      largely auto-generated by the harness.'
    rationale: Trust requires auditable receipts, not narrative assertions; auto-generation
      ensures high throughput without manual paperwork.
    enforcement: Completion reducer validates Gate Receipts and artifact refs; missing
      receipts trigger NEEDS_ADJUDICATION.
    evidence_ids:
    - EVID-0016
    - EVID-0002
  invariants:
  - id: INV-0001
    statement: 'Actor identity is stable across restarts: ActorID persists beyond
      SessionID and AttemptID.'
    rationale: Stable identity enables attribution, reputation, and durable addressing.
    enforcement: Supervisor persists ActorID and records session lineage; reducers
      and projections rely on ActorID, not PID.
    evidence_ids:
    - EVID-0001
    - EVID-0005
  - id: INV-0002
    statement: Ledger records are append-only, hash-chained, and signed over canonical
      encoded bytes; tampering is detectable.
    rationale: Dispute resolution and auditability require a verifiable record of
      truth.
    enforcement: Ledger writer enforces transactional hash chaining; verification
      tools validate integrity and signatures.
    evidence_ids:
    - EVID-0004
    - EVID-0016
  - id: INV-0003
    statement: 'Work ownership is enforced by authoritative leases: at most one active
      lease per work_id per authoritative subtree; lease issuance is restricted to
      the designated Lease Registrar.'
    rationale: Prevents duplicate execution costs and enables deterministic failover;
      ensures authority is centralized within a holonic scope.
    enforcement: Lease claim/renew/release reducer enforces uniqueness and validates
      the registrar signature.
    evidence_ids:
    - EVID-0006
  - id: INV-0011
    statement: 'Authority-of-Issuance and Deterministic Reconciliation: Only a designated
      Lease Registrar can mint leases; reconciliation after partition uses Canonical
      Root selection to determine the authoritative registrar and resolve conflicts.'
    rationale: Avoids the "split-brain" problem where multiple nodes might attempt
      to mint leases for the same work while partitioned.
    enforcement: Reducers identify non-authoritative leases post-merge and transition
      them to ABORTED_CONFLICT while preserving evidence.
    evidence_ids:
    - EVID-0006
  - id: INV-0004
    statement: 'Reducers and projections are deterministic and replayable: given the
      same ledger and reducer version, projections are identical.'
    rationale: Deterministic state enables autonomous coordination and debugging without
      human inference.
    enforcement: Property tests and simulation suites validate idempotency and convergence
      under partitions.
    evidence_ids:
    - EVID-0005
    - EVID-0006
  - id: INV-0005
    statement: Large blobs are not embedded in signed ledger records; they are referenced
      by content hash and stored in a content-addressed store.
    rationale: Keeps ledger compact, replayable, and safe to replicate; enables progressive
      disclosure and redaction.
    enforcement: Artifact publication tool enforces hash addressing; ledger stores
      only refs and hashes.
    evidence_ids:
    - EVID-0010
  - id: INV-0006
    statement: 'Adjudication is deterministic and non-blocking: every adjudication request
      MUST have a deadline and a fallback policy; timeouts trigger safe defaults.'
    rationale: Prevent deadlocks in autonomous execution while maintaining safety.
    enforcement: Kernel enforces ADJ.TIMEOUT and applies fallback_policy automatically.
    evidence_ids:
    - EVID-0006
  - id: INV-0007
    statement: 'Authority is exercised via N-of-M agent quorums: a decision artifact
      is binding only if it carries sufficient valid cryptographic signatures from
      the authorized group.'
    rationale: Removes human-in-the-loop dependencies for governance and gates.
    enforcement: "Projection reducers validate N-of-M signatures before transitioning work states."
    evidence_ids:
    - EVID-0004
  - id: INV-0008
    statement: 'Rework loops are finite and budget-constrained: every rework cycle
      MUST consume a retry budget; exceeding the budget triggers an automatic escalation
      to adjudication.'
    rationale: Prevent infinite autonomous loops and unbounded resource consumption.
    enforcement: Rework Controller tracks retries and enforces budget limits.
    evidence_ids:
    - EVID-0006
    - EVID-0018
  - id: INV-0009
    statement: 'Holonic Boundary Integrity: A holon (agent session) affects the universe
      only through Active States (outputs) and perceives it only through Sensory States
      (inputs); internal reasoning traces and intermediate states are non-exported.'
    rationale: Preserves privacy, bounds evidence size, and enables deterministic
      replay of external interactions.
    enforcement: Harness enforces seclusion of internal scratchpads; only mediated
      syscalls and events cross the boundary.
    evidence_ids:
    - EVID-0003
  - id: INV-0010
    statement: 'Crash-Only Corollary and Entropy Budget: Internal state is ephemeral;
      if a session exceeds its entropy budget (errors, stalls, violations), it must
      terminate and respawn from the immutable ledger.'
    rationale: Prevents state corruption and ensures recovery is always driven by
      the source of truth.
    enforcement: Supervisor monitors session entropy and enforces termination; respawn
      logic uses ledger state cursors.
    evidence_ids:
    - EVID-0004
    - EVID-0006
