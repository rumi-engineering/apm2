prd_success_metrics:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  metrics:
    - id: MET-0001
      name: "Spawn acknowledgment latency"
      type: PERFORMANCE
      target: "<100ms p99"
      measurement: |
        Time from SpawnEpisode IPC request to session_id returned.
        Measured on local Unix socket IPC with daemon warm, excluding
        external policy resolution network calls.
      evidence_ids:
        - EVID-0009
    - id: MET-0002
      name: "Session ready latency"
      type: PERFORMANCE
      target: "<2s p99"
      measurement: |
        Time from SpawnEpisode request to session fully ready (pack sealed,
        policy checked, sandbox ready). Includes internal policy resolution.
        Measured on local Unix socket IPC with daemon warm.
      evidence_ids:
        - EVID-0010
    - id: MET-0003
      name: "Tool mediation overhead"
      type: PERFORMANCE
      target: "<5ms p50"
      measurement: |
        Tool mediation overhead excluding actual tool execution time.
        Measures capability check, context firewall validation, and
        event emission.
      evidence_ids:
        - EVID-0011
    - id: MET-0004
      name: "Adversarial test pass rate"
      type: SECURITY
      target: "100%"
      measurement: |
        All adversarial tests (ADV-001 through ADV-009) must pass.
        Any failure indicates security regression.
      evidence_ids:
        - EVID-0001
        - EVID-0002
        - EVID-0003
        - EVID-0004
        - EVID-0005
        - EVID-0006
        - EVID-0007
        - EVID-0008
    - id: MET-0005
      name: "Context firewall termination latency"
      type: SECURITY
      target: "<100ms"
      measurement: |
        Time from denied read detection to SessionTerminated event emission.
        Session must be terminated, not just logged.
      evidence_ids:
        - EVID-0003
    - id: MET-0006
      name: "xtask direct usage rate"
      type: MIGRATION
      target: "<5% for removal gate"
      measurement: |
        Percentage of work operations using direct xtask invocation vs
        daemon-mediated apm2 CLI. Tracked via telemetry.
      evidence_ids:
        - EVID-0012
    - id: MET-0007
      name: "Daemon recovery time"
      type: RELIABILITY
      target: "<5s"
      measurement: |
        Time from daemon restart to LEASE_REVOKED signal delivery to all
        active sessions. No session should continue operating after this
        window without explicit re-authentication.
      evidence_ids:
        - EVID-0013
  reporting:
    frequency: "Per release"
    dashboard: "apm2-daemon-metrics"
    alerts:
      - metric_id: MET-0004
        threshold: "<100%"
        severity: P1
        action: "Block release; security regression"
      - metric_id: MET-0005
        threshold: ">100ms"
        severity: P2
        action: "Investigate context firewall enforcement delay"
