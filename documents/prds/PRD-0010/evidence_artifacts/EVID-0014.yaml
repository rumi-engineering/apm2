prd_evidence_artifact:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "EVID-0014"
  category: "SECURITY_TEST"
  title: "ADV-009: Unprivileged process attempts privileged endpoint access"
  description: |
    Adversarial test verifying operator credential enforcement. Test spawns
    process without operator credentials and attempts to call all privileged
    endpoints; expects PERMISSION_DENIED for all attempts regardless of
    request content or claimed identity.
  source_acceptance_test: ADV-009
  capture:
    paths:
      - "test/daemon/adversarial/adv_009_operator_auth.rs"
      - "evidence/adv/ADV-009/"
  verification:
    commands:
      - id: "CMD-0001"
        shell: "bash"
        command: "cargo test --workspace -- daemon::adversarial::adv_009"
        expected_exit_code: 0
        cwd: "."
        timeout_seconds: 60
        network_access: "DISALLOWED"
        allowlist_hosts: []
        constraints:
          - "Daemon must be running with operator auth enabled"
          - "Test process runs without operator credentials"
      - id: "CMD-0002"
        shell: "bash"
        command: "stat -c '%U:%G %a' /run/apm2/operator.sock"
        expected_exit_code: 0
        cwd: "."
        timeout_seconds: 5
        network_access: "DISALLOWED"
        allowlist_hosts: []
        constraints:
          - "Operator socket path matches configured path"
  assertions:
    - "All privileged endpoints (ClaimWork, SpawnEpisode, IssueCapability, Shutdown) reject unprivileged caller"
    - "Error response is generic PERMISSION_DENIED without endpoint enumeration"
    - "If token-based: expired token rejected"
    - "If token-based: error does not reveal token validity window"
    - "If socket-based: filesystem permissions match documented requirements"
    - "Operator-credentialed process can access privileged endpoints"
  data:
    classification: "INTERNAL"
    redaction:
      required: false
      guidance: []
