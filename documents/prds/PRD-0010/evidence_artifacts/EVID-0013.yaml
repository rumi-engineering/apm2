prd_evidence_artifact:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "EVID-0013"
  category: "INTEGRATION_TEST"
  title: "Daemon crash recovery integration test"
  description: |
    Integration test verifying daemon crash recovery. Simulates daemon crash
    with active sessions, verifies LEASE_REVOKED delivery within 5s, and
    confirms no orphaned sessions.
  source_acceptance_test: INT-001
  capture:
    paths:
      - "test/daemon/integration/crash_recovery.rs"
      - "evidence/integration/crash_recovery/"
  verification:
    commands:
      - id: "CMD-0001"
        shell: "bash"
        command: "cargo test --workspace -- daemon::integration::crash_recovery"
        expected_exit_code: 0
        cwd: "."
        timeout_seconds: 120
        network_access: "DISALLOWED"
        allowlist_hosts: []
        constraints:
          - "Test manages daemon lifecycle"
          - "Multiple active sessions spawned before crash"
  assertions:
    - "All sessions receive LEASE_REVOKED within 5s of daemon restart"
    - "SessionTerminated events with rationale=DAEMON_RESTART in ledger"
    - "No orphaned processes after recovery"
    - "Daemon state consistent with ledger after replay"
    - "New sessions can be spawned after recovery"
  data:
    classification: "INTERNAL"
    redaction:
      required: false
      guidance: []
