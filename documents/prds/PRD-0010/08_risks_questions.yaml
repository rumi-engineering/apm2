prd_risks_questions:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  risks:
    - id: RISK-0001
      name: "Migration surface larger than expected"
      description: |
        xtask deprecation assumes limited direct usage. If migration surface is larger
        (undocumented xtask behaviors, external scripts depending on xtask), removal
        may cause unexpected breakage.
      likelihood: MEDIUM
      impact: HIGH
      mitigation:
        - "Telemetry gate: removal blocked until <5% direct xtask usage"
        - "Extended deprecation period if telemetry shows high usage"
        - "Deprecation warnings with migration guidance for all commands"
      evidence_ids:
        - EVID-0012
    - id: RISK-0002
      name: "Container UID remapping breaks peer credential validation"
      description: |
        SO_PEERCRED returns container-namespace UID which may not match host UID
        when user namespaces remap. This could allow authentication bypass or
        incorrect privilege assignment.
      likelihood: MEDIUM
      impact: HIGH
      mitigation:
        - "Require --userns=host or equivalent for container deployments"
        - "Document container deployment constraints in deployment guide"
        - "Test peer credential validation in common container runtimes"
      evidence_ids:
        - EVID-0001
    - id: RISK-0003
      name: "Daemon becomes single point of failure"
      description: |
        With all work orchestration flowing through daemon, daemon unavailability
        blocks all agent operations. High availability requirements emerge.
      likelihood: LOW
      impact: HIGH
      mitigation:
        - "Daemon crash recovery within 5s (REQ-0013)"
        - "Session recovery via LEASE_REVOKED signals"
        - "Future: explore daemon clustering for multi-tenant deployment"
      evidence_ids:
        - EVID-0013
    - id: RISK-0004
      name: "Tool mediation latency impacts productivity"
      description: |
        Adding mediation layer for every tool call introduces latency. If overhead
        exceeds target (<5ms p50), developer productivity may suffer.
      likelihood: LOW
      impact: MEDIUM
      mitigation:
        - "Benchmark targets in success metrics (MET-0003)"
        - "Optimize hot path: capability check caching"
        - "Async event emission where possible"
      evidence_ids:
        - EVID-0011
    - id: RISK-0005
      name: "RFC-0015 breaking changes invalidate PRD-0010"
      description: |
        PRD-0010 depends on RFC-0015 concepts (PolicyResolvedForChangeSet, GateLeaseIssued).
        Breaking changes in RFC-0015 could require significant rework.
      likelihood: LOW
      impact: HIGH
      mitigation:
        - "Version pin in metadata: RFC-0015 v4.1+"
        - "Breaking change policy: coordinated update required"
        - "Integration tests verify RFC-0015 contract compatibility"
      evidence_ids:
        - EVID-0002
        - EVID-0004
  open_questions:
    - id: Q-0001
      question: "How should daemon handle multi-tenant workstation scenarios?"
      context: |
        Phase 1 targets single daemon per workstation. For shared development
        environments or CI runners with multiple users, additional isolation
        may be needed.
      proposed_answer: |
        Defer to Phase 2. Single daemon with work_id sharding could support
        multi-tenant. Alternative: per-user daemon instances with socket namespacing.
      status: DEFERRED
    - id: Q-0002
      question: "What is the compatibility story for Windows?"
      context: |
        SO_PEERCRED requires Unix domain sockets. Windows named pipes have different
        authentication mechanisms.
      proposed_answer: |
        Windows support is out of scope for Phase 1. Phase 2 could use Windows
        named pipe security descriptors or alternative authentication (e.g., JWT
        tokens via localhost HTTP).
      status: DEFERRED
    - id: Q-0003
      question: "Should daemon support hot reload of capability policies?"
      context: |
        Currently policy resolution queries governance at claim time. If policies
        change mid-episode, how should running sessions be affected?
      proposed_answer: |
        Policy is pinned at spawn time via policy_resolved_ref. Running sessions
        continue with original policy. New spawns get updated policy. No hot reload
        of active sessions.
      status: RESOLVED
    - id: Q-0004
      question: "How does tool broker mediate SSH operations without exposing keys?"
      context: |
        Git operations may require SSH authentication. Broker must mediate without
        exposing SSH private keys to session.
      proposed_answer: |
        Daemon spawns isolated ssh-agent per work_id. Agent socket path is internal
        to daemon. Tool broker uses SSH_AUTH_SOCK internally for git operations.
        Session process never sees SSH_AUTH_SOCK. Fallback: For SSH-less environments,
        git credential.helper with ephemeral token managed by daemon.
      status: RESOLVED
      resolved_by: REQ-0018
