prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-0008"
  type: "SECURITY"
  source_id: "DCP-G-0006"
  title: "IPC Authentication"
  statement: |
    apm2-daemon IPC MUST authenticate all clients via Unix socket peer credentials
    (SO_PEERCRED) and issue per-connection capability tokens; unauthenticated
    requests MUST be rejected.
  acceptance_criteria:
    - "Unix socket uses SO_PEERCRED to extract peer UID/GID. Verified by: Code inspection confirms SO_PEERCRED usage; ADV-001/ADV-002 show authentication enforcement."
    - "Per-connection capability tokens issued at connection establishment. Verified by: Protocol trace shows token exchange at connection."
    - "Unauthenticated requests rejected with PERMISSION_DENIED. Verified by: Test shows connection without valid peer creds is rejected."
    - "Container deployments with UID remapping documented. Verified by: Deployment guide includes --userns=host requirement."
  evidence:
    evidence_ids:
      - EVID-0001
      - EVID-0002
  law_alignment:
    - law_id: "LAW-05"
      enforcement: "Dual-Axis Containment: IPC authentication boundary"
      applies_to:
        - "Unix socket authentication"
        - "Capability token issuance"
  defect_codes:
    - code: "IPC_AUTH_FAILED"
      severity: "S1"
      description: "Peer credential validation failed"
    - code: "TOKEN_INVALID"
      severity: "S1"
      description: "Capability token validation failed"
