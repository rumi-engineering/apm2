prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-0007"
  type: "SECURITY"
  source_id: "DCP-G-0007"
  title: "Signed State Transitions"
  statement: |
    All state transitions through apm2-daemon MUST emit Ed25519 signed events to
    ledger with domain-separated prefixes; unsigned events MUST be rejected at
    ledger ingestion.
  acceptance_criteria:
    - "WorkClaimed, EpisodeSpawned, ToolDecided, ToolExecuted events are Ed25519 signed. Verified by: ADV-007 test shows unsigned receipt is rejected at ingestion."
    - "Signatures use domain-separated prefixes (WORK_CLAIMED:, EPISODE_SPAWNED:, etc.). Verified by: Signature verification code inspection confirms domain prefixes."
    - "Unsigned events rejected with INVALID_SIGNATURE defect. Verified by: Ledger ingestion test confirms rejection."
    - "Signature covers canonical encoding of event payload. Verified by: Test shows signature verification fails on payload modification."
  evidence:
    evidence_ids:
      - EVID-0007
  law_alignment:
    - law_id: "LAW-15"
      enforcement: "Measurement Integrity: All receipts Ed25519 signed"
      applies_to:
        - "State transition events"
    - law_id: "LAW-04"
      enforcement: "Stochastic Stability: Contract + Receipt + Evidence for every transition"
      applies_to:
        - "Event signing"
  defect_codes:
    - code: "INVALID_SIGNATURE"
      severity: "S0"
      description: "Event signature invalid or missing"
    - code: "DOMAIN_PREFIX_MISMATCH"
      severity: "S1"
      description: "Signature domain prefix does not match event type"
