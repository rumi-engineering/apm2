prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-0014"
  type: "FUNCTIONAL"
  source_id: "DCP-G-0010"
  title: "xtask Deprecation with Migration Path"
  statement: |
    xtask MUST NOT perform authority-affecting operations directly. Any external
    projection writes (e.g., GitHub status checks) MUST be disabled or routed
    through daemon-only projection mechanisms. Deprecation may proceed without
    telemetry gates; fail-closed on direct writes is mandatory.
  acceptance_criteria:
    - "xtask commands that would write to external projections hard-fail or route through daemon-only projection mechanisms. Verified by: status-write paths are removed or fail-closed."
    - "CI guardrail rejects direct GitHub status writes from xtask. Verified by: CI check fails on gh api status usage in xtask."
    - "xtask remains non-authoritative; attempts to bypass daemon control plane are blocked. Verified by: security tests and code inspection."
  evidence:
    evidence_ids:
      - EVID-0008
      - EVID-0012
  law_alignment:
    - law_id: "LAW-01"
      enforcement: "Loop Closure: All work flows through daemon control plane after deprecation"
      applies_to:
        - "xtask authority boundaries"
        - "projection-only workflows"
    - law_id: "LAW-05"
      enforcement: "OCAP containment: direct external writes are forbidden outside daemon mediation"
      applies_to:
        - "xtask external projections"
  defect_codes:
    - code: "XTASK_BYPASS_ATTEMPT"
      severity: "S1"
      description: "xtask attempted authority-affecting operation outside daemon"
    - code: "XTASK_EXTERNAL_WRITE"
      severity: "S1"
      description: "Direct external projection write from xtask"
