prd_success_metrics:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  metrics:
    - id: COORD-M-0001
      name: Autonomous session completion rate
      description: Fraction of sessions that complete work items without human intervention.
      baseline: "Manual operation baseline: 0% autonomous (all sessions manually spawned)."
      target: ">=80% within 30 days of deployment."
      measurement_method: |
        Count sessions spawned by coordination vs sessions spawned manually.
        Autonomous = coordination.session_bound events / total session.started events.
        Use Wilson score interval for confidence.
      evidence_ids:
        - EVID-COORD-0001
    - id: COORD-M-0002
      name: Work items per coordination
      description: Average number of work items processed per coordination session.
      baseline: "N/A (new capability)."
      target: ">=3 work items per coordination on average."
      measurement_method: |
        Aggregate coordination.completed events. Count work_outcomes in receipts.
        Compute mean and standard deviation.
      evidence_ids:
        - EVID-COORD-0001
    - id: COORD-M-0003
      name: Circuit breaker trigger rate
      description: Fraction of coordinations that abort due to circuit breaker.
      baseline: "N/A (new capability)."
      target: "<10% of coordinations trigger circuit breaker."
      measurement_method: |
        Count coordination.aborted events with reason=CIRCUIT_BREAKER_TRIGGERED.
        Divide by total coordination.completed + coordination.aborted events.
      evidence_ids:
        - EVID-COORD-0002
    - id: COORD-M-0004
      name: Human intervention rate
      description: Fraction of coordinations requiring human intervention.
      baseline: "100% (all work currently requires manual spawning)."
      target: "<20% of coordinations require human intervention."
      measurement_method: |
        Track escalation events emitted during coordination.
        Human intervention = coordinations with escalation / total coordinations.
      evidence_ids:
        - EVID-COORD-0002
    - id: COORD-M-0005
      name: Budget utilization efficiency
      description: Fraction of allocated budget actually used for successful work completion.
      baseline: "N/A (new capability)."
      target: ">60% of budget consumed by successful work execution."
      measurement_method: |
        From coordination receipts: successful_sessions * avg_session_cost / total_budget.
        Track wasted budget on failed attempts separately.
      evidence_ids:
        - EVID-COORD-0001
  guardrails:
    - id: GRD-COORD-001
      name: Hard budget ceiling
      threshold: "max_duration_ms and max_episodes MUST be specified (non-optional)."
      response_plan: |
        Coordination start fails if budget parameters missing.
        CLI validates and rejects requests without required budget fields.
        No coordination can run indefinitely.
      evidence_ids:
        - EVID-COORD-0003
      rationale: Prevents unbounded loop execution that could exhaust system resources.
    - id: GRD-COORD-002
      name: Circuit breaker
      threshold: "3 consecutive failures triggers coordination abort."
      response_plan: |
        Controller tracks consecutive failure count.
        On third consecutive failure, emit coordination.aborted with reason=CIRCUIT_BREAKER_TRIGGERED.
        Coordination terminates immediately.
        Receipt captures failure details for post-mortem.
      evidence_ids:
        - EVID-COORD-0002
      rationale: Prevents crash loop resource exhaustion when work items consistently fail.
    - id: GRD-COORD-003
      name: Work freshness check
      threshold: "Work state MUST be validated immediately before session spawn."
      response_plan: |
        Controller queries WorkReducer for current work state before spawning.
        If work state is not OPEN or IN_PROGRESS, skip and proceed to next work item.
        Log stale work detection as informational event.
      evidence_ids:
        - EVID-COORD-0004
      rationale: Prevents stale work state races where work is completed by another process.
