prd_goals_scope:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  goals:
    - id: COORD-G-0001
      statement: Event-sourced coordination state - CoordinationReducer tracks coordination state following established reducer patterns.
      measurable_outcomes:
        - CoordinationReducer processes ledger events deterministically.
        - Coordination state is reconstructable from event replay.
        - Checkpointing enables incremental state recovery.
    - id: COORD-G-0002
      statement: Work-session binding - Coordination creates binding relationships between work items and agent sessions.
      measurable_outcomes:
        - coordination.session_bound event links work_id to session_id.
        - coordination.session_unbound event releases binding on completion or failure.
        - Binding state is queryable from coordination projection.
    - id: COORD-G-0003
      statement: Coordination budget enforcement - Hard budget ceilings prevent unbounded resource consumption.
      measurable_outcomes:
        - max_episodes and max_duration_ms are mandatory configuration.
        - Budget consumption tracked and enforced per coordination.
        - Budget exhaustion triggers coordination termination.
    - id: COORD-G-0004
      statement: Serial execution loop - Controller sequentially spawns sessions for work items.
      measurable_outcomes:
        - Work queue processed in order with one active session at a time.
        - Session completion triggers next work item processing.
        - Loop terminates on queue exhaustion or stop condition.
    - id: COORD-G-0005
      statement: Stop condition enforcement - Circuit breaker and stop conditions prevent crash loops.
      measurable_outcomes:
        - 3 consecutive failures trigger coordination abort (circuit breaker).
        - max_attempts per work item limits retry count.
        - Work completion (queue empty) terminates coordination normally.
    - id: COORD-G-0006
      statement: CLI command interface - `apm2 coordinate` provides machine-readable coordination control.
      measurable_outcomes:
        - Command accepts work queue specification and budget configuration.
        - Command emits structured progress events.
        - Command returns coordination receipt on completion.
    - id: COORD-G-0007
      statement: Evidence receipt emission - Coordination produces structured evidence proving execution.
      measurable_outcomes:
        - receipt.coordination artifact emitted on coordination completion.
        - Receipt includes work item outcomes, budget usage, and stop condition.
        - Receipt stored in CAS and referenced in ledger event.
  scope:
    in_scope:
      - "CoordinationReducer implementing event-sourced state projection."
      - "Coordination events: coordination.started, coordination.session_bound, coordination.session_unbound, coordination.completed, coordination.aborted."
      - "CoordinationState tracking active coordination, bindings, budget, and attempt counts."
      - "CoordinationController implementing serial execution loop."
      - "Budget enforcement: max_episodes, max_duration_ms, max_tokens (optional)."
      - "Stop conditions: work_completed, budget_exhausted, max_attempts_exceeded, circuit_breaker_triggered."
      - "Work freshness validation before session spawn."
      - "CLI command: apm2 coordinate with work queue and budget options."
      - "CoordinationReceipt evidence artifact builder."
      - "Guardrails: GRD-COORD-001 (budget ceiling), GRD-COORD-002 (circuit breaker), GRD-COORD-003 (freshness check)."
    out_of_scope:
      - "Parallel agent execution (multiple concurrent sessions)."
      - "API rate limiting integration at coordination level."
      - "Human notification hooks (email, Slack, PagerDuty)."
      - "Cross-coordination dependencies and work DAG scheduling."
      - "Dynamic priority reordering within coordination."
      - "Coordination pause/resume functionality."
  success_criteria_summary:
    - Autonomous session completion rate >= 80% (sessions complete work without human intervention).
    - Work items per coordination >= 3 (coordination handles multi-item queues).
    - Circuit breaker trigger rate < 10% (system not in crash-loop state).
    - Human intervention rate < 20% (most coordinations complete autonomously).
