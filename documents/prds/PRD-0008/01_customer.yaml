prd_customer:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  segments:
    - id: CUST-COORD-0001
      name: Agent Operators
      description: Engineers and operators who spawn and monitor autonomous agent sessions for work execution.
      primary_jobs_to_be_done:
        - Start coordinated agent execution across multiple work items.
        - Monitor coordination progress and stop conditions.
        - Retrieve evidence receipts proving coordination outcomes.
        - Configure budget and episode limits for coordination sessions.
      constraints:
        - Must not require manual intervention for nominal execution paths.
        - Must provide clear signals when intervention is required.
    - id: CUST-COORD-0002
      name: System Administrators
      description: Engineers responsible for system configuration, resource allocation, and operational monitoring.
      primary_jobs_to_be_done:
        - Configure system-wide coordination budget ceilings.
        - Monitor coordination resource consumption.
        - Investigate coordination failures and circuit breaker triggers.
        - Manage coordination session lifecycle and cleanup.
      constraints:
        - Must prevent unbounded resource consumption.
        - Must provide audit trail for all coordination actions.
    - id: CUST-COORD-0003
      name: Holonic Kernel Team
      description: Engineers responsible for event-sourced state management and reducer infrastructure.
      primary_jobs_to_be_done:
        - Integrate CoordinationReducer with existing ledger infrastructure.
        - Ensure event determinism and replay correctness.
        - Maintain reducer checkpoint and recovery mechanisms.
      constraints:
        - Must follow established reducer patterns (SessionReducer, WorkReducer).
        - Must preserve ledger immutability and hash-chain integrity.
  stakeholder_entities:
    - id: STKH-COORD-0001
      name: HOLON-COORDINATOR
      entity_type: holon
      description: The coordination controller holon that manages work-to-session binding and loop execution.
      constraints:
        - Operates under explicit budgets (episodes, tokens, duration).
        - Emits structured events for all state transitions.
        - Respects circuit breaker stop conditions.
    - id: STKH-COORD-0002
      name: HOLON-WORK-EXECUTOR
      entity_type: holon
      description: The agent session holon spawned by coordination to execute individual work items.
      constraints:
        - Receives work context from coordination binding.
        - Reports completion status back to coordinator.
        - Operates within session-level budgets.
  user_journeys:
    - id: UJ-COORD-0001
      name: Serial Work Queue Execution
      steps:
        - Operator issues `apm2 coordinate` with work queue specification.
        - CoordinationReducer initializes coordination state with budget limits.
        - For each work item in queue, controller spawns agent session.
        - Session executes work and emits completion/failure event.
        - Controller records session outcome and checks stop conditions.
        - If stop condition met (budget exhausted, max attempts, work complete), coordination terminates.
        - Coordination evidence receipt is emitted with full execution summary.
      failure_modes:
        - Work item execution fails (session error, budget exceeded).
        - Circuit breaker triggers after consecutive failures.
        - Coordination budget exhausted before work queue completion.
      observability_notes:
        - All session spawns logged with work_id and session_id correlation.
        - Budget consumption tracked per coordination and per session.
        - Evidence receipt captures success/failure breakdown and budget usage.
    - id: UJ-COORD-0002
      name: Single Work Item Coordination
      steps:
        - Operator issues coordination request for single work item.
        - Coordination binds work to new session with retry budget.
        - Session executes and reports outcome.
        - If failure and retries remain, new session spawned.
        - Coordination terminates on success or retry exhaustion.
      failure_modes:
        - All retry attempts fail (max_attempts reached).
        - Session hangs beyond timeout.
      observability_notes:
        - Attempt count tracked in coordination state.
        - Each attempt correlated with unique session_id.
