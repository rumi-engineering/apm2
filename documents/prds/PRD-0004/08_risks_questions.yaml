prd_risks_questions:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"

  risks:
    - id: "RSK-0001"
      statement: "FindingSignature collision risk: different logical issues may produce the same signature due to normalization"
      impact: "High"
      likelihood: "Low"
      mitigations:
        - "Signature computation includes multiple fields (category, rule_id, language, api_surface, snippet_fingerprint) to reduce collision probability"
        - "Snippet fingerprint uses blake3 hash with sufficient entropy (256-bit)"
        - "Include file path hash as optional discriminator when same signature appears in unrelated contexts"
        - "Property tests verify collision resistance across synthetic and real-world finding corpora"
        - "Monitoring dashboard tracks signature cardinality; alert on unexpected clustering patterns"
        - "Manual review path for countermeasures affecting high-impact signatures"
      evidence_ids:
        - "EVID-0004"

    - id: "RSK-0002"
      statement: "Sync adapter eventual consistency window: GitHub state may lag internal ledger state, causing confusion or stale external views"
      impact: "Medium"
      likelihood: "Medium"
      mitigations:
        - "Sync adapter runs on every ledger commit with bounded latency SLO (target: <30 seconds)"
        - "GitHub state includes sync timestamp and ledger sequence number in metadata labels/comments"
        - "Agents and operators query ledger projections, never GitHub, for authoritative work state"
        - "Sync failures trigger exponential backoff with jitter; persistent failures alert operator"
        - "Divergence detection compares ledger state hash with GitHub state; auto-reconciles on mismatch"
        - "Clear documentation that GitHub is projection-only; internal state is authoritative"
      evidence_ids:
        - "EVID-0003"
        - "EVID-0007"

    - id: "RSK-0003"
      statement: "Countermeasure regression: deployed countermeasures may break existing code or introduce new defects"
      impact: "High"
      likelihood: "Medium"
      mitigations:
        - "Countermeasures require gate passage (AAT, security, code quality) before merge"
        - "CountermeasureProposed includes suggested remediation type; human review required for POLICY_UPDATE and SAFE_API types"
        - "Countermeasure PRs run full test suite including regression tests on affected code paths"
        - "Post-deployment monitoring tracks error rates and test failures; rollback if regression detected"
        - "Countermeasure effectiveness tracking measures recurrence reduction; ineffective countermeasures flagged for review"
        - "Staged rollout for countermeasures affecting core APIs (lint rules enabled warn-only before error)"
      evidence_ids:
        - "EVID-0005"
        - "EVID-0006"

    - id: "RSK-0004"
      statement: "Migration path complexity: transitioning from GitHub-centric workflows to ledger-authoritative model requires significant operational changes"
      impact: "Medium"
      likelihood: "High"
      mitigations:
        - "Phased migration: Phase 1 (dual-write) maintains GitHub as readable fallback while building ledger confidence"
        - "Phase 2 (ledger-primary) routes all agent queries to ledger projections; GitHub becomes write-only"
        - "Phase 3 (ledger-only) disables GitHub reads entirely; sync adapter handles all external projection"
        - "Migration scripts validate ledger/GitHub consistency during transition period"
        - "Feature flags control migration phases per work type (plans, changesets, findings)"
        - "Runbook documents rollback procedure if migration causes unacceptable disruption"
        - "Training materials for agents and operators on new CLI commands and workflows"
      evidence_ids:
        - "EVID-0003"

    - id: "RSK-0005"
      statement: "Reducer version drift: changes to reducer logic may produce different projections from the same event stream, breaking consistency guarantees"
      impact: "High"
      likelihood: "Medium"
      mitigations:
        - "Reducer implementations are versioned; version is recorded in checkpoint metadata"
        - "Reducer changes require explicit version bump and migration analysis"
        - "Property tests verify determinism: replay-from-genesis equals replay-from-checkpoint"
        - "Breaking reducer changes require full replay from genesis with new version"
        - "Checkpoint invalidation on version mismatch forces clean rebuild"
        - "Reducer versioning policy documented: additive changes OK, semantic changes require new version"
        - "CI verifies reducer determinism across synthetic event streams before merge"
      evidence_ids:
        - "EVID-0004"

  open_questions:
    - id: "Q-0001"
      question: "What is the migration path from current GitHub-centric workflows?"
      decision_needed_by: "Before implementation begins"
      resolution_plan: |
        Define three-phase migration plan in RFC:
        1. Dual-write phase: Write to both ledger and GitHub; reads from either.
        2. Ledger-primary phase: All agent reads from ledger projections; GitHub writes continue.
        3. Ledger-only phase: GitHub becomes sync-only projection target.
        Include rollback procedures, timeline estimates, and success criteria for each phase transition.
        Identify which work types (plans, changesets, findings) migrate in which order.

    - id: "Q-0002"
      question: "How are external contributions (non-agent PRs) handled?"
      decision_needed_by: "Before implementation begins"
      resolution_plan: |
        Define handling for human-authored PRs that bypass internal work lifecycle:
        - Option A: Require all PRs to originate from internal Plans (strict mode).
        - Option B: Allow external PRs with reduced traceability; create retroactive ChangeSet on PR open.
        - Option C: Hybrid mode where external PRs are permitted but flagged for enhanced review.
        Decision impacts sync adapter design: must detect external PRs and determine ledger representation.
        Consider implications for recurrence tracking when findings originate from external contributions.

    - id: "Q-0003"
      question: "What is the maximum acceptable sync latency between ledger and GitHub?"
      decision_needed_by: "During RFC design phase"
      resolution_plan: |
        Define SLO for sync latency based on user expectations and operational constraints:
        - Survey current GitHub workflow latency expectations (PR creation, status update, comment sync).
        - Benchmark sync adapter throughput under expected load (events per second).
        - Define P99 latency target (proposed: <30 seconds from ledger commit to GitHub reflection).
        - Determine acceptable behavior during GitHub outages (queue depth, backpressure, alerting).
        - Document trade-offs between sync frequency and GitHub API rate limits.
