prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-0002"
  type: "FUNCTIONAL"
  title: "Patch-first machine authoring"
  statement: |
    Machines MUST produce changes as patch streams (JSON Patch / Merge Patch) rather than
    whole-document rewrites. Admission MUST enforce replay protection via expected base hash.
    Every accepted patch MUST produce an admission receipt (evidence) and emit ledger provenance.
  acceptance_criteria:
    - "PatchRecords use JSON Patch or Merge Patch format. Verified by: Schema validation ensures patch_kind is json_patch_rfc6902 or json_merge_patch_rfc7396."
    - "Admission enforces replay protection via expected_base_hash. Verified by: Patch with wrong expected_base_hash is rejected with replay violation event."
    - "Accepted patches produce AdmissionReceipt with provenance. Verified by: AdmissionReceipt references patch_hash, base_hash, new_hash, schema_hash."
  evidence:
    evidence_ids:
      - EVID-0003
