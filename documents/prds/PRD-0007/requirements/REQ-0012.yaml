prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-0012"
  type: "FUNCTIONAL"
  title: "ContextPack compilation"
  statement: |
    The system MUST compile ContextPackSpec into ContextPackManifest with derived artifacts.
    Compilation MUST deep-pin transitive dependencies to produce self-contained packs.
    Compilation MUST be deterministic given resolved inputs and target profile. Context
    budgets MUST be enforced during compilation.
  acceptance_criteria:
    - "ContextPackSpec compiles to ContextPackManifest. Verified by: apm2 pack compile produces manifest from spec."
    - "Transitive dependencies are resolved and pinned. Verified by: Manifest includes all dependency stable_ids with content_hashes."
    - "Compilation is deterministic. Verified by: Same inputs produce identical manifest and derived artifacts."
    - "Budget ceilings are enforced. Verified by: Pack exceeding token/artifact/byte budget fails compilation."
  evidence:
    evidence_ids:
      - EVID-0010
