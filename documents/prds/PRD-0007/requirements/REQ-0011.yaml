prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-0011"
  type: "FUNCTIONAL"
  title: "ArtifactFetch tool protocol"
  statement: |
    The system MUST provide an ArtifactFetch tool for deterministic retrieval of context
    artifacts by stable ID or content hash. Policy MUST enforce that only stable-ID
    allowlisted reads are permitted in consumption mode. Hash mismatches MUST return
    errors and emit policy violations.
  acceptance_criteria:
    - "ArtifactFetch accepts stable_id or content_hash parameters. Verified by: Tool request schema includes both optional parameters."
    - "ArtifactFetch returns result_hash and/or inline_result. Verified by: Tool response includes hash and optional inline content."
    - "Policy enforces allowlisted reads in consumption mode. Verified by: Fetch of non-allowlisted stable_id returns PolicyViolation."
    - "Hash mismatches emit errors and violations. Verified by: expected_hash mismatch returns ToolError and DefectRecord."
    - "In consumption mode, ArtifactFetch MUST reject requests where content_hash is provided WITHOUT corresponding stable_id. Content-hash-only fetches are denied to enforce stable_id allowlist policy. Verified by: ArtifactFetch(content_hash=H, stable_id=None) in consumption mode returns PolicyViolation with error CONTENT_HASH_ONLY_FETCH_DENIED."
  evidence:
    evidence_ids:
      - EVID-0004
      - EVID-0005
