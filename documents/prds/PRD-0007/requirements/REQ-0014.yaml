prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-0014"
  type: "FUNCTIONAL"
  title: "AAT/selftest gating"
  statement: |
    The system MUST generate CapabilityManifest from the apm2 binary (not handwritten).
    Selftests MUST be hermetic and bounded (time/tool/token budgets). AATReceipt MUST
    be required for critical cutovers and agent planning gates.
  acceptance_criteria:
    - "CapabilityManifest is generated from binary. Verified by: apm2 capabilities --json produces manifest matching actual behavior."
    - "Selftests are hermetic and bounded. Verified by: AAT suites complete within max_duration_ms budget."
    - "AATReceipt gates critical cutovers. Verified by: Cutover fails without recent passing AATReceipt."
    - "AATReceipt gates agent planning. Verified by: Agent verifies receipt hash in CapabilityManifest before planning."
  evidence:
    evidence_ids:
      - EVID-0007
