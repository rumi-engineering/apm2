prd_customer:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  segments:
    - id: CUST-0001
      name: Holonic Kernel Team
      description: Engineers responsible for kernel governance, schema management, and policy enforcement.
      primary_jobs_to_be_done:
        - Define and enforce normative schemas for control artifacts.
        - Manage schema evolution and compatibility.
        - Ensure fail-closed admission and policy enforcement.
      constraints:
        - Must maintain backward compatibility with existing ledger and CAS primitives.
        - Must support algorithm agility for cryptographic operations.
    - id: CUST-0002
      name: Context Compiler Team
      description: Engineers building context compilation, export pipelines, and target profile management.
      primary_jobs_to_be_done:
        - Compile ContextPacks from stable-ID addressed artifacts.
        - Produce deterministic vendor exports from internal IR.
        - Enforce context budgets and deep-pinning closure.
      constraints:
        - Outputs must be byte-identical for identical inputs.
        - Must emit provenance receipts for all compilations.
    - id: CUST-0003
      name: Agent Runtime Team
      description: Engineers building agent execution environments and consumption mode enforcement.
      primary_jobs_to_be_done:
        - Enforce hermetic consumption with deterministic reads only.
        - Emit RunReceipts with context pack sufficiency and miss tracking.
        - Gate agent plans on capability manifests and AAT receipts.
      constraints:
        - No discretionary context discovery in consumption mode.
        - Pack misses must fail runs by default unless explicitly escalated.
    - id: CUST-0004
      name: Security Team
      description: Engineers responsible for security controls, threat modeling, and cryptographic operations.
      primary_jobs_to_be_done:
        - Define and enforce security properties across the CAC pipeline.
        - Maintain DoS limits in parsers and validators.
        - Ensure bootstrap trust root immutability.
      constraints:
        - Assume adversary includes state actors with advanced capabilities.
        - Must support post-quantum readiness via algorithm agility.
    - id: CUST-0005
      name: Tooling Team
      description: Engineers building CLI commands and developer experience for CAC operations.
      primary_jobs_to_be_done:
        - Provide machine-readable CLI contracts for all CAC operations.
        - Generate and verify capability manifests via selftests.
        - Support patch authoring and validation tooling.
      constraints:
        - All commands must be listed in capability manifests.
        - CLI behavior must match declared capabilities.
    - id: CUST-0006
      name: Policy Team
      description: Engineers defining and enforcing policies for context production and consumption.
      primary_jobs_to_be_done:
        - Define policy profiles for tool calls, reads, and budgets.
        - Enforce consumption hermeticity via policy rules.
        - Track defects and feed back into policy evolution.
      constraints:
        - Policies must be machine-readable and version-controlled.
        - Policy violations must emit structured defect records.
  stakeholder_entities:
    - id: STKH-0001
      name: HOLON-KERNEL-GOVERNANCE
      entity_type: holon
      description: Schema and policy authority for the holonic kernel.
      constraints:
        - Owns schema definitions and compatibility rules.
        - Must approve schema evolution.
    - id: STKH-0002
      name: HOLON-CONTEXT-COMPILER
      entity_type: holon
      description: Context compilation and export authority.
      constraints:
        - Owns ContextPack and target profile compilation.
        - Must emit provenance for all exports.
    - id: STKH-0003
      name: HOLON-AAT
      entity_type: holon
      description: Acceptance testing and receipt authority.
      constraints:
        - Owns AAT/selftest suite execution.
        - Must gate critical cutovers with passing receipts.
  user_journeys:
    - id: UJ-0001
      name: Context Production Mode
      steps:
        - Producer holon receives work_id and target artifact reference.
        - Producer operates under explicit lease/budget.
        - Producer proposes changes as PatchRecords with ChangeSet reports.
        - All tool calls are classified as planned/unplanned.
        - Evidence snapshots and extraction logs are published to CAS.
      failure_modes:
        - Budget exceeded before patch completion.
        - Tool call denied by policy.
        - Schema validation failure on proposed artifact.
      observability_notes:
        - All tool calls logged with planned/unplanned classification.
        - Evidence published with hash references in ledger.
    - id: UJ-0002
      name: Context Consumption Mode
      steps:
        - Consumer holon receives ContextPack manifest.
        - Consumer fetches artifacts only via stable-ID deterministic reads.
        - Discretionary discovery attempts are denied.
        - Consumer emits RunReceipt with sufficiency and miss tracking.
      failure_modes:
        - Context pack miss triggers defect and run failure.
        - Unauthorized read attempt denied by policy.
        - Budget exceeded during execution.
      observability_notes:
        - RunReceipt captures context_pack_miss and sufficiency.
        - Policy violations emit DefectRecord events.
