prd_decisions_review:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  decisions:
    - id: DEC-0001
      statement: "Adopt a declarative PipelineSpec IR executed by a pluggable StageRunner in the core CLI."
      rationale: |
        A PipelineSpec makes the compilation workflow explicit, versionable, and composable. It preserves CLI-first iteration while creating a clean seam for future daemon-backed execution and federation.
      alternatives_considered:
        - "Monolithic CLI-only compiler with implicit stage ordering."
        - "Daemon-resident compiler service with CLI as thin client."
      evidence_ids: []

    - id: DEC-0002
      statement: "Define a determinism envelope: all LLM outputs must be parsed into structured IR, validated, and written with stable ordering and atomic replace."
      rationale: |
        Determinism is the substrate for replay, audit, and low-noise collaboration. The envelope bounds model variability and prevents partial or corrupted writes.
      alternatives_considered:
        - "Accept best-effort freeform LLM outputs and rely on human review."
        - "Hard-pin one model forever (rejects controlled upgrades)."
      evidence_ids:
        - EVID-0006

    - id: DEC-0003
      statement: "Make repository truth a mandatory compiler input via CCP, and require requirement-to-component Impact Map before RFC emission."
      rationale: |
        Explicit CCP + Impact Map eliminates implicit knowledge and drives reuse-by-default. It prevents RFCs from proposing non-existent extension points and makes duplication risk machine-detectable.
      alternatives_considered:
        - "Generate RFCs without CCP, relying on ad-hoc search during implementation."
      evidence_ids:
        - EVID-0002
        - EVID-0003

    - id: DEC-0004
      statement: "Treat model routing as a governed profile with pinned provider+version per stage; record provenance in signed run manifests."
      rationale: |
        The factory must be able to upgrade models safely. Pinning and recording per-stage choices enables reproducibility, canarying, and controlled drift.
      alternatives_considered:
        - "Allow runtime fallback to any available model/provider."
      evidence_ids:
        - EVID-0007

    - id: DEC-0005
      statement: "Adopt a lint maturity model: warning-first for advisory rules, fail-closed for existential invariants (e.g., non-existent file references, missing mapping, missing manifests)."
      rationale: |
        Mechanism-first avoids SDLC deadlock. Existential invariants must be enforced to prevent systemic corruption; guidance rules can ratchet over time.
      alternatives_considered:
        - "Fail-closed on all lint rules from day one."
      evidence_ids: []

    - id: DEC-0006
      statement: "Make continuous refactor a first-class compilation stage (Refactor Radar) emitting bounded maintenance work."
      rationale: |
        At high code velocity, refactoring must be scheduled and measurable. The compiler is the natural locus because it already maintains the CCP signals needed to prioritize refactors.
      alternatives_considered:
        - "Ad-hoc refactoring triggered only by code review feedback."
      evidence_ids:
        - EVID-0011

    - id: DEC-0007
      statement: "Write all compiler outputs to evidence/ first; update governed documents/ only via an explicit promote step."
      rationale: |
        Evidence-first writes preserve reproducibility and allow deterministic replays without mutating plan-of-record documents.
        Promotion makes review and acceptance explicit and avoids partial or corrupted governed states on failed runs.
      alternatives_considered:
        - "Write outputs directly into documents/ as the default."
        - "Dual-write evidence/ and documents/ for every run."
      evidence_ids:
        - EVID-0001
        - EVID-0006

    - id: DEC-0008
      statement: "Rewrite the compiler entrypoint to accept explicit inputs (`--prd PRD-XXXX` or `--rfc RFC-XXXX`) with optional `--path`, avoiding ambiguous plan file arguments."
      rationale: |
        Using explicit input selectors reduces operator confusion and makes deterministic artifact discovery straightforward.
        The optional `--path` escape hatch preserves flexibility without making it the primary interface.
      alternatives_considered:
        - "Use `--plan <path>` as the primary interface."
      evidence_ids: []

  gate_reviews:
    - gate_id: GATE-PRD-SECURITY
      status: PENDING
      evidence_ids:
        - EVID-0008
    - gate_id: GATE-PRD-PRODUCT
      status: PENDING
      evidence_ids:
        - EVID-0001
        - EVID-0005
  waivers: []
