prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: REQ-0002
  type: FUNCTIONAL
  title: Codebase Context Pack generation
  statement: |
    The compiler MUST generate a Codebase Context Pack (CCP) for a given repository
    checkout, including:
      (a) a component atlas with stable component IDs and invariants,
      (b) a crate dependency graph derived from cargo metadata,
      (c) a public API entrypoint inventory,
      (d) churn/hotspot summaries, and
      (e) a prior decisions index.
  acceptance_criteria:
    - "CCP generation produces an index file listing all CCP sub-artifacts and their content hashes."
    - "Component IDs are stable across runs; renames require explicit mapping entries (no silent ID churn)."
    - "Atlas entries cite source locations and include AGENTS.md-derived invariant summaries where available."
    - "Crate graph is generated deterministically via `cargo metadata` and stored as a machine-readable artifact."
    - "CCP generation supports incremental operation by reusing cached sub-artifacts when inputs are unchanged."
  evidence:
    evidence_ids:
      - EVID-0002
      - EVID-0009
