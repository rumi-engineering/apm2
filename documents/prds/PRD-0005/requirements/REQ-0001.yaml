prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: REQ-0001
  type: FUNCTIONAL
  title: Single-command Idea Compiler entrypoint
  statement: |
    The system MUST provide a deterministic CLI entrypoint in the core `apm2` CLI
    that orchestrates the Idea Compiler pipeline end-to-end and can also execute
    each stage independently.
  acceptance_criteria:
    - "`apm2 factory compile --prd PRD-XXXX` runs CCP_Build -> Impact_Map -> RFC_Frame -> Ticket_Emit -> Skill_Sync (and optional Refactor_Radar) in declared order."
    - "Each stage can be executed independently (e.g., `apm2 factory ccp build`, `apm2 factory impact-map build --prd PRD-XXXX`)."
    - "All commands support a machine output mode (json or ndjson) that includes stage status, produced paths, and artifact hashes."
    - "All commands support `--dry-run` that reports intended writes without modifying files."
    - "The compiler fails closed on schema or lint violations, returning stable non-zero exit codes by failure class."
  evidence:
    evidence_ids:
      - EVID-0001
      - EVID-0005
