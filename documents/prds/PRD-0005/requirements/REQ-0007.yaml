prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: REQ-0007
  type: SECURITY
  title: Multi-model routing with explicit profiles and provenance
  statement: |
    The compiler MUST support running stages across multiple model providers and versions via a versioned routing profile.
    The routing profile MUST pin provider, model, and version per stage by default, and the compiler MUST record the selected route in the run manifest.
  acceptance_criteria:
    - "Routing profiles are stored as governed documents with schema versioning and deterministic parsing."
    - "Per stage, the route includes provider identifier, model identifier, and version or build tag."
    - "Per run, the run manifest records route selections, overrides, and retry decisions."
    - "Canary mode can run two routes for a stage and compare structured outputs, producing a diff finding and requiring acceptance to switch."
    - "If a provider is unavailable, the compiler fails closed unless an explicit fallback is configured in the profile."
  evidence:
    evidence_ids:
      - EVID-0007
      - EVID-0006
