prd_constraints_invariants:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  constraints:
    - id: CON-0001
      statement: "Compilation MUST be deterministic for a fixed repo state, PRD inputs, and routing profile."
    - id: CON-0002
      statement: "Compilation stages MUST be runnable without network access by default; any network access MUST be explicitly declared and allow-listed."
    - id: CON-0003
      statement: "All model/provider selections MUST be explicit and recorded per stage; no implicit 'use whatever is available' behavior."
    - id: CON-0004
      statement: "The compiler MUST prefer extension of existing components by default; any net-new substrate MUST be adjudicated and justified."
    - id: CON-0005
      statement: "The compiler MUST be crash-only and resumable from persisted artifacts; it must not depend on long-lived mutable in-memory state."
  invariants:
    - id: INV-0001
      statement: "All emitted RFC sections that reference crates/modules/files MUST reference paths that exist in the current checkout (linted)."
      rationale: "Prevents ticket churn caused by non-existent extension points."
    - id: INV-0002
      statement: "No new crate/module may be introduced by generated tickets unless the RFC includes an explicit justification and a deletion/migration plan entry."
      rationale: "Prevents cousin abstractions and uncontrolled surface area growth."
    - id: INV-0003
      statement: "Every compile run MUST emit a run manifest recording hashes for all inputs and outputs, plus routing provenance."
      rationale: "Enables reproducibility, auditability, and controlled upgrades."
    - id: INV-0004
      statement: "Stage outputs are written via atomic replace with stable ordering; partial writes are not permitted."
      rationale: "Prevents corrupted intermediate states and enables restartability."
    - id: INV-0005
      statement: "Skill documentation that instructs agents MUST be generated or validated against the compiler pipeline; manual, divergent instructions are prohibited."
      rationale: "Prevents process drift and bypass behavior."
