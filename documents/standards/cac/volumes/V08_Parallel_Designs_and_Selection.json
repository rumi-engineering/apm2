{
  "schema": "apm2.prd.volume.v1",
  "schema_version": "1.0.0",
  "sections": [
    {
      "content": {
        "option_A": {
          "core_choices": {
            "canonicalization": "JCS-like",
            "dcp_index": "Projection over EvidencePublished events",
            "ledger_representation": "EvidencePublished category+metadata",
            "normative_format": "CAC-JSON",
            "required_proto_changes": [
              "tool_protocol: add ArtifactFetch (and optional DcpResolve)"
            ],
            "schema_system": "JSON Schema 2020-12"
          },
          "id": "CAC-DESIGN-A",
          "schema": "apm2.design.option.v1",
          "schema_version": "1.0.0",
          "strengths": [
            "Lowest integration risk; builds on existing APM2 evidence system.",
            "Good incremental path; can evolve to typed events later.",
            "Keeps signed ledger stable while CAC matures."
          ],
          "suitability": {
            "long_term": "good with follow-on typed-event upgrade",
            "mvp": "excellent"
          },
          "summary": {
            "one_line": "Normative artifacts are CAC-JSON; admission and indexing are recorded via EvidencePublished metadata; only tool protocol adds ArtifactFetch.",
            "why": [
              "Fastest path to an end-to-end pipeline.",
              "Avoids kernel event schema changes during early adoption.",
              "Leverages existing Evidence/CAS patterns in APM2."
            ]
          },
          "title": "Option A: JSON-First CAC with EvidenceEvent Metadata (Minimal Proto Changes)",
          "weaknesses": [
            "Metadata strings are less type-safe and harder to query.",
            "Risk of inconsistent metadata key usage if not strictly validated.",
            "May require secondary indexes for performance."
          ]
        },
        "option_B": {
          "core_choices": {
            "canonicalization": "protobuf deterministic encoding rules",
            "dcp_index": "Projection over typed events",
            "ledger_representation": "new ControlArtifactEvent and DcpMappingEvent",
            "normative_format": "canonical proto bytes (with JSON view)",
            "required_proto_changes": [
              "kernel_events: add ControlArtifactEvent family",
              "tool_protocol: add ArtifactFetch"
            ],
            "schema_system": "proto3"
          },
          "id": "CAC-DESIGN-B",
          "schema": "apm2.design.option.v1",
          "schema_version": "1.0.0",
          "strengths": [
            "Highest rigor in message-level compatibility and queryability.",
            "Clear separation between metadata and content; fewer stringly-typed conventions.",
            "Potentially faster validation for typed messages."
          ],
          "suitability": {
            "long_term": "excellent if investment is affordable",
            "mvp": "medium"
          },
          "summary": {
            "one_line": "Define ControlArtifact and DCP mapping messages in proto; store canonical proto bytes in CAS; optionally provide JSON views for LLM authoring.",
            "why": [
              "Strong typing and better queryability.",
              "Aligns control plane with kernel message discipline (no maps, ordered repeats)."
            ]
          },
          "title": "Option B: Protobuf-First Control Plane (Typed Events + Typed Artifacts)",
          "weaknesses": [
            "Bigger up-front implementation and migration cost.",
            "LLM authoring in JSON must map precisely to proto fields; mismatches can be subtle.",
            "Proto evolution requires tighter coordination across components."
          ]
        },
        "option_C": {
          "core_choices": {
            "canonicalization": "JCS-like",
            "dcp_index": "Rebuildable projection with optional caching checkpoints",
            "ledger_representation": "EvidencePublished plus/or typed events",
            "normative_format": "CAC-JSON in CAS",
            "required_proto_changes": [
              "tool_protocol: add ArtifactFetch"
            ],
            "schema_system": "JSON Schema"
          },
          "id": "CAC-DESIGN-C",
          "schema": "apm2.design.option.v1",
          "schema_version": "1.0.0",
          "strengths": [
            "Strong systems thinking: single source of truth (ledger + CAS).",
            "Rebuildable state; easier for forensics and trust.",
            "Pairs naturally with holonic kernels and reducer pattern."
          ],
          "suitability": {
            "long_term": "good with projection scaling and checkpointing",
            "mvp": "good"
          },
          "summary": {
            "one_line": "Treat the ledger as the only authoritative state: artifacts in CAS; stable-ID resolution and context state are projections; minimize additional mutable stores.",
            "why": [
              "Maximizes auditability and reconstructability.",
              "Eliminates many classes of split-brain and hidden state."
            ]
          },
          "title": "Option C: Ledger-Native Context State (Event-Sourced Context, Minimal External Index)",
          "weaknesses": [
            "Requires careful projection performance engineering.",
            "Operational complexity if ledger grows quickly without compaction/checkpoints."
          ]
        }
      },
      "section_id": "OPTIONS",
      "title": "Parallel Design Options"
    },
    {
      "content": {
        "future_upgrade_path": [
          "Introduce typed ControlArtifactEvent when queryability and policy enforcement demand it.",
          "Generate typed events from existing EvidencePublished metadata to preserve continuity.",
          "Optionally move schema definitions to proto once the artifact set stabilizes."
        ],
        "id": "CAC-DESIGN-MASTER",
        "inputs_considered": [
          "CAC-DESIGN-A",
          "CAC-DESIGN-B",
          "CAC-DESIGN-C"
        ],
        "nonnegotiables": [
          "ArtifactFetch (or equivalent) deterministic stable-ID fetch surface is P0.",
          "Fail-closed validation and canonicalization prior to admission is P0.",
          "Consumption hermeticity and defect emission for unplanned reads is P0."
        ],
        "schema": "apm2.design.merge_rationale.v1",
        "schema_version": "1.0.0",
        "selected": {
          "deferred": [
            "CAC-DESIGN-B"
          ],
          "primary": [
            "CAC-DESIGN-A",
            "CAC-DESIGN-C"
          ]
        },
        "title": "Selected Design: JSON-First CAC with Ledger-Native DCP Projection and Deterministic Fetch",
        "why_this_combination": [
          "MVP must ship quickly and integrate with existing APM2 evidence/ledger patterns.",
          "Ledger-native projections preserve auditability and prevent split-brain sources of truth.",
          "Typed proto events are valuable but introduce coordination and migration costs; defer until CAC artifacts and workflows stabilize."
        ]
      },
      "section_id": "SELECTION",
      "title": "Selected Design"
    }
  ],
  "volume": {
    "generated_at": "2026-01-26",
    "source_prd_id": "APM2-PRD-CAC-0001",
    "title": "Parallel Designs and Selection",
    "volume_id": "V08"
  }
}
