{
  "$id": "cac.patch_record.v1.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "additionalProperties": false,
  "allOf": [
    {
      "if": {
        "properties": {
          "patch_kind": {
            "const": "json_patch_rfc6902"
          }
        }
      },
      "then": {
        "properties": {
          "patch": {
            "items": {
              "additionalProperties": false,
              "properties": {
                "from": {
                  "type": "string"
                },
                "op": {
                  "enum": [
                    "add",
                    "remove",
                    "replace",
                    "move",
                    "copy",
                    "test"
                  ],
                  "type": "string"
                },
                "path": {
                  "type": "string"
                },
                "value": {}
              },
              "required": [
                "op",
                "path"
              ],
              "type": "object"
            },
            "type": "array"
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "patch_kind": {
            "const": "json_merge_patch_rfc7396"
          }
        }
      },
      "then": {
        "properties": {
          "patch": {
            "type": "object"
          }
        }
      }
    }
  ],
  "properties": {
    "actor_id": {
      "minLength": 1,
      "type": "string"
    },
    "evidence_refs": {
      "items": {
        "$ref": "cac.common.v1.schema.json#/$defs/content_hash"
      },
      "type": "array"
    },
    "justification_code": {
      "type": "string"
    },
    "patch": {},
    "patch_kind": {
      "enum": [
        "json_patch_rfc6902",
        "json_merge_patch_rfc7396"
      ],
      "type": "string"
    },
    "record_id": {
      "$ref": "cac.common.v1.schema.json#/$defs/id_string"
    },
    "record_type": {
      "const": "patch_record"
    },
    "record_version": {
      "type": "string"
    },
    "schema_ref": {
      "additionalProperties": false,
      "properties": {
        "schema_hash": {
          "$ref": "cac.common.v1.schema.json#/$defs/content_hash"
        },
        "schema_id": {
          "type": "string"
        }
      },
      "required": [
        "schema_id"
      ],
      "type": "object"
    },
    "signature": {
      "type": "string"
    },
    "target": {
      "additionalProperties": false,
      "properties": {
        "expected_base_hash": {
          "$ref": "cac.common.v1.schema.json#/$defs/content_hash"
        },
        "stable_id": {
          "$ref": "cac.common.v1.schema.json#/$defs/stable_id"
        }
      },
      "required": [
        "stable_id",
        "expected_base_hash"
      ],
      "type": "object"
    },
    "timestamp": {
      "$ref": "cac.common.v1.schema.json#/$defs/timestamp"
    },
    "work_id": {
      "minLength": 1,
      "type": "string"
    }
  },
  "required": [
    "record_type",
    "record_version",
    "record_id",
    "timestamp",
    "actor_id",
    "work_id",
    "target",
    "patch_kind",
    "patch"
  ],
  "title": "CAC PatchRecord v1",
  "type": "object"
}
