{
  "$id": "cac.target_profile.v1.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$defs": {
    "context_budget": {
      "additionalProperties": false,
      "properties": {
        "max_artifacts": {
          "$ref": "cac.common.v1.schema.json#/$defs/quantity"
        },
        "max_bytes": {
          "$ref": "cac.common.v1.schema.json#/$defs/quantity"
        },
        "max_tokens": {
          "$ref": "cac.common.v1.schema.json#/$defs/quantity"
        }
      },
      "required": [
        "max_tokens",
        "max_artifacts",
        "max_bytes"
      ],
      "type": "object"
    },
    "format_id": {
      "enum": [
        "TOON",
        "JSON_COMPACT",
        "JSON_CANONICAL",
        "BULLET_IR",
        "MARKDOWN"
      ],
      "type": "string"
    }
  },
  "allOf": [
    {
      "$ref": "cac.artifact.envelope.v1.schema.json"
    },
    {
      "properties": {
        "kind": {
          "const": "target.profile"
        },
        "payload": {
          "additionalProperties": false,
          "properties": {
            "context_budgets": {
              "additionalProperties": false,
              "properties": {
                "default": {
                  "$ref": "#/$defs/context_budget"
                },
                "implement": {
                  "$ref": "#/$defs/context_budget"
                },
                "ops": {
                  "$ref": "#/$defs/context_budget"
                },
                "plan": {
                  "$ref": "#/$defs/context_budget"
                },
                "review": {
                  "$ref": "#/$defs/context_budget"
                }
              },
              "type": "object"
            },
            "delivery_policy": {
              "additionalProperties": false,
              "properties": {
                "targets": {
                  "items": {
                    "additionalProperties": false,
                    "properties": {
                      "format": {
                        "$ref": "#/$defs/format_id"
                      },
                      "target_id": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "target_id"
                    ],
                    "type": "object"
                  },
                  "type": "array"
                }
              },
              "type": "object"
            },
            "description": {
              "type": "string"
            },
            "instruction_bandwidth_policy": {
              "additionalProperties": false,
              "properties": {
                "data_tokens": {
                  "$ref": "cac.common.v1.schema.json#/$defs/quantity"
                },
                "example_tokens": {
                  "$ref": "cac.common.v1.schema.json#/$defs/quantity"
                },
                "instruction_tokens": {
                  "$ref": "cac.common.v1.schema.json#/$defs/quantity"
                }
              },
              "type": "object"
            },
            "profile_name": {
              "type": "string"
            },
            "rendering_policy": {
              "additionalProperties": false,
              "properties": {
                "fallback_formats": {
                  "items": {
                    "$ref": "#/$defs/format_id"
                  },
                  "type": "array"
                },
                "primary_format": {
                  "$ref": "#/$defs/format_id"
                }
              },
              "required": [
                "primary_format"
              ],
              "type": "object"
            },
            "retrieval_policy": {
              "additionalProperties": false,
              "properties": {
                "allowed": {
                  "type": "boolean"
                },
                "classes": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                },
                "max_fetches": {
                  "$ref": "cac.common.v1.schema.json#/$defs/quantity"
                }
              },
              "type": "object"
            }
          },
          "required": [
            "profile_name",
            "context_budgets",
            "rendering_policy"
          ],
          "type": "object"
        },
        "schema": {
          "const": "cac.target_profile.v1"
        }
      }
    }
  ],
  "title": "CAC TargetProfile v1"
}
