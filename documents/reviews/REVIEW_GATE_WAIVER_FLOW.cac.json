{
  "schema": "apm2.review_prompt.v1",
  "schema_version": "1.0.0",
  "kind": "review.prompt",
  "meta": {
    "stable_id": "dcp://apm2.reviews/prompt/review-gate-waiver-flow@1",
    "status": "ACTIVE",
    "classification": "INTERNAL",
    "replaces": "documents/reviews/REVIEW_GATE_WAIVER_FLOW.md",
    "canonicalizer": {
      "canonicalizer_id": "apm2.canonicalizer.jcs",
      "canonicalizer_version": "1.0.0",
      "vectors_ref": "dcp://apm2.cac/canonicalizer/vectors@v1"
    },
    "provenance": {
      "actor_id": "HOLON-DOC-GOVERNANCE",
      "work_id": "TCK-00680-docs-overhaul"
    }
  },
  "payload": {
    "title": "Review Gate Waiver Flow",
    "purpose": "This document defines the only acceptable override path when `review-gate` blocks a merge.",
    "policy": [
      "Overrides are waiver-only. No silent bypasses.",
      "Every waiver must be repo-committed and traceable to a ticket.",
      "Waivers are temporary and must include an expiry date."
    ],
    "required_artifacts": {
      "waiver_file": {
        "location": "documents/work/waivers/",
        "naming": "WVR-XXXX.yaml"
      },
      "waiver_links": [
        "Blocking PR number",
        "Waived commit SHA (40-hex)",
        "Blocking category (`security` and/or `code-quality`)",
        "Justification and remediation ticket",
        "Expiration timestamp"
      ],
      "pr_reference": "PR body (or maintainer comment) references `WVR-XXXX`."
    },
    "waived_commit_sha_semantics": {
      "description": "waiver.references.commit_sha MUST be bound to the exact code state being risk-accepted.",
      "patterns": [
        {
          "name": "Preferred (base-branch waiver)",
          "description": "The waiver file exists on the PR base branch (e.g., `main`).",
          "rule": "commit_sha MUST equal the PR head SHA being waived."
        },
        {
          "name": "PR-branch waiver (allowed, waiver-only head commit)",
          "description": "The waiver file is added on the PR branch.",
          "rules": [
            "The waiver MUST be introduced in a final, waiver-only commit that changes only waiver artifacts under `documents/work/waivers/`.",
            "commit_sha MUST equal the immediate parent of the waiver commit (the pre-waiver PR head).",
            "If any non-waiver changes are pushed after the waiver commit, the waiver is invalid and must be reissued."
          ]
        }
      ]
    },
    "approval_requirements": [
      "Security-domain maintainer approval for security gate waivers.",
      "Build/release maintainer approval for code-quality gate waivers.",
      "Explicit acknowledgement that the merge is risk-accepted until waiver expiry."
    ],
    "operator_procedure": [
      "Confirm gate failure reason from CI `Review Gate` job output.",
      "Create and commit `documents/work/waivers/WVR-XXXX.yaml`.",
      "Add `WVR-XXXX` reference in the PR thread.",
      "Re-run CI and capture evidence in the linked remediation ticket.",
      "Remove or close waiver when remediation lands."
    ]
  }
}
