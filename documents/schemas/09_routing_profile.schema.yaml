routing_profile_schema:
  schema_version: "2026-01-26"
  schema_id: "SCHEMA_ROUTING_PROFILE_V1"
  description: |
    Schema for routing profile configuration files.
    Routing profiles define how pipeline stages are routed to providers,
    enabling multi-model orchestration with configurable fallbacks.
  required_keys:
    - "profile_id"
    - "description"
    - "stages"
  keys:
    profile_id:
      type: "string"
      pattern: "^[a-z][a-z0-9_-]*$"
      min_length: 2
      max_length: 64
      description: "Unique identifier for the routing profile."
    description:
      type: "string"
      min_length: 5
      max_length: 500
      description: "Human-readable description of this routing profile."
    version:
      type: "string"
      pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
      default: "2026-01-26"
      description: "ISO date version string for profile versioning."
    stages:
      type: "object"
      description: "Map of pipeline stage names to provider configurations."
      min_items: 1
      value_type:
        type: "object"
        required_keys:
          - "provider"
        keys:
          provider:
            type: "string"
            description: "Provider identifier (e.g., 'local', 'anthropic', 'openai')."
          model:
            type: "string"
            description: "Model identifier (e.g., 'claude-3-5-sonnet'). Required for remote providers."
          endpoint:
            type: "string"
            format: "uri"
            description: "Optional custom endpoint URL for the provider."
          timeout_ms:
            type: "integer"
            minimum: 1000
            maximum: 600000
            default: 30000
            description: "Request timeout in milliseconds."
          retry_policy:
            type: "object"
            description: "Retry policy configuration."
            keys:
              max_retries:
                type: "integer"
                minimum: 0
                maximum: 10
                default: 3
                description: "Maximum number of retry attempts."
              initial_delay_ms:
                type: "integer"
                minimum: 100
                maximum: 30000
                default: 1000
                description: "Initial delay before first retry in milliseconds."
              backoff_multiplier:
                type: "number"
                minimum: 1.0
                maximum: 5.0
                default: 2.0
                description: "Multiplier for exponential backoff."
          stage_fallback:
            type: "object"
            description: "Stage-specific fallback configuration."
            keys:
              provider:
                type: "string"
                description: "Fallback provider identifier."
              model:
                type: "string"
                description: "Fallback model identifier."
              timeout_ms:
                type: "integer"
                minimum: 1000
                maximum: 600000
                description: "Fallback timeout in milliseconds."
    fallback:
      type: "object"
      description: "Global fallback configuration when primary providers are unavailable."
      keys:
        provider:
          type: "string"
          description: "Fallback provider identifier."
        model:
          type: "string"
          description: "Fallback model identifier."
        timeout_ms:
          type: "integer"
          minimum: 1000
          maximum: 600000
          default: 30000
          description: "Fallback timeout in milliseconds."
        reason:
          type: "string"
          max_length: 500
          description: "Human-readable reason for fallback usage."
    canary:
      type: "object"
      description: "Canary comparison configuration for A/B testing routes."
      keys:
        enabled:
          type: "boolean"
          default: false
          description: "Whether canary comparison is enabled."
        comparison_profile:
          type: "string"
          description: "Profile ID of the comparison routing profile."
        stages:
          type: "array"
          item_type: "string"
          description: "List of stage names to include in canary comparison."
        output_diffs:
          type: "boolean"
          default: true
          description: "Whether to generate detailed output diffs."
