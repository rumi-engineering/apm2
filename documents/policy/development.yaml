# APM2 Development Policy
#
# A more permissive policy suitable for local development environments.
# This policy allows common development operations while still maintaining
# some security boundaries.
#
# WARNING: This policy is more permissive than the default. Use with caution
# and only in trusted development environments.

policy:
  version: "1.0.0"
  name: "apm2-development"
  description: "Permissive policy for local development"

  rules:
    # ========================================================================
    # FILESYSTEM RULES
    # ========================================================================

    # Allow reading from workspace and common development paths
    - id: "fs-read-workspace"
      type: filesystem
      paths:
        - "./**"
        - "/tmp/**"
      decision: allow
      reason: "Allow reading workspace and temp files"

    # Allow writing to workspace (for code generation, etc.)
    - id: "fs-write-workspace"
      type: filesystem
      paths:
        - "./**"
      decision: allow
      reason: "Allow writing workspace files"

    # ========================================================================
    # TOOL RULES
    # ========================================================================

    # Allow all filesystem read operations in workspace
    - id: "tool-fs-read"
      type: tool_allow
      tool: "fs.read"
      paths:
        - "./**"
        - "/tmp/**"
      decision: allow

    # Allow filesystem write operations in workspace
    - id: "tool-fs-write"
      type: tool_allow
      tool: "fs.write"
      paths:
        - "./**"
      decision: allow

    # Allow filesystem edit operations
    - id: "tool-fs-edit"
      type: tool_allow
      tool: "fs.edit"
      paths:
        - "./**"
      decision: allow

    # Allow glob/search operations
    - id: "tool-fs-glob"
      type: tool_allow
      tool: "fs.glob"
      paths:
        - "./**"
      decision: allow

    # Allow grep/search operations
    - id: "tool-fs-grep"
      type: tool_allow
      tool: "fs.grep"
      paths:
        - "./**"
      decision: allow

    # Allow shell execution for common dev tools
    - id: "tool-shell-dev"
      type: tool_allow
      tool: "shell.exec"
      commands:
        - "cargo *"
        - "npm *"
        - "yarn *"
        - "pnpm *"
        - "python *"
        - "pip *"
        - "git *"
        - "make *"
        - "ls *"
        - "cat *"
        - "head *"
        - "tail *"
        - "grep *"
        - "find *"
        - "wc *"
      decision: allow
      reason: "Allow common development commands"

    # ========================================================================
    # NETWORK RULES
    # ========================================================================

    # Allow HTTPS connections to common development APIs
    - id: "network-dev-apis"
      type: network
      hosts:
        - "api.github.com"
        - "raw.githubusercontent.com"
        - "crates.io"
        - "static.crates.io"
        - "index.crates.io"
        - "registry.npmjs.org"
        - "pypi.org"
      ports:
        - 443
      decision: allow
      reason: "Allow package registry access"

    # Allow inference API access
    - id: "network-inference"
      type: network
      hosts:
        - "api.anthropic.com"
        - "api.openai.com"
      ports:
        - 443
      decision: allow
      reason: "Allow inference API access"

    # ========================================================================
    # BUDGET RULES
    # ========================================================================

    # Higher token budget for development (500K tokens)
    - id: "budget-tokens"
      type: budget
      budget_type: token
      limit: 500000
      decision: allow
      reason: "Development token budget"

    # Extended time budget (4 hours)
    - id: "budget-time"
      type: budget
      budget_type: time
      limit: 14400000
      decision: allow
      reason: "Development time budget (4 hours)"

    # Higher tool call budget (5000 calls)
    - id: "budget-tool-calls"
      type: budget
      budget_type: tool_calls
      limit: 5000
      decision: allow
      reason: "Development tool call budget"

    # Filesystem operations budget
    - id: "budget-fs-ops"
      type: budget
      budget_type: filesystem_ops
      limit: 10000
      decision: allow

    # Network operations budget
    - id: "budget-network-ops"
      type: budget
      budget_type: network_ops
      limit: 1000
      decision: allow

    # ========================================================================
    # INFERENCE RULES
    # ========================================================================

    - id: "inference-allowed"
      type: inference
      decision: allow
      reason: "Allow inference calls in development"

  # Default decision: DENY everything not explicitly allowed
  default_decision: deny
