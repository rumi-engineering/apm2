{
  "schema": "apm2.agents_context.v1",
  "module": "crates/apm2-core/src/credentials",
  "behaviors": [
    {
      "id": "BEH-CORE-CREDS-001",
      "kind": "invariant",
      "title": "All secret values use SecretString to prevent exposure",
      "description": "All secret values use secrecy::SecretString to prevent accidental exposure via Debug or logging. Secrets are zeroized on drop.",
      "rfc": ["RFC-0028"]
    },
    {
      "id": "BEH-CORE-CREDS-002",
      "kind": "invariant",
      "title": "Secrets stored in OS keyring, not in memory",
      "description": "Secrets are stored in OS keyring (Keychain/Secret Service/Credential Manager), not in memory. Keyring is authoritative.",
      "rfc": ["RFC-0028"]
    },
    {
      "id": "BEH-CORE-CREDS-003",
      "kind": "requirement",
      "title": "Store writes to keyring first, then cache",
      "description": "store() writes to both keyring and cache atomically (keyring first, then cache). remove() deletes from keyring first, then cache.",
      "rfc": ["RFC-0028"]
    },
    {
      "id": "BEH-CORE-CREDS-004",
      "kind": "invariant",
      "title": "Metadata excludes all secret values",
      "description": "CredentialProfileMetadata excludes all secret values and is safe for logging and external exposure.",
      "rfc": ["RFC-0028"]
    },
    {
      "id": "BEH-CORE-CREDS-005",
      "kind": "invariant",
      "title": "Hot-swap state machine enforces single concurrent swap",
      "description": "Only one hot-swap operation can be in progress at a time. start_swap() returns AlreadyInProgress if is_in_progress() is true.",
      "rfc": ["RFC-0028"]
    },
    {
      "id": "BEH-CORE-CREDS-006",
      "kind": "requirement",
      "title": "Hot-swap failure triggers rollback when configured",
      "description": "Failure at any hot-swap stage triggers RollingBack (if configured) or Failed. Previous profile stored for rollback capability.",
      "rfc": ["RFC-0028"]
    },
    {
      "id": "BEH-CORE-CREDS-007",
      "kind": "requirement",
      "title": "API keys never expire",
      "description": "is_expired() returns false for ApiKey variant. API keys do not expire.",
      "rfc": ["RFC-0028"]
    },
    {
      "id": "BEH-CORE-CREDS-008",
      "kind": "requirement",
      "title": "Refresh manager respects max retry limit",
      "description": "can_retry() returns false when attempts >= max_attempts. consecutive_failures resets to 0 on successful refresh.",
      "rfc": ["RFC-0028"]
    }
  ]
}
