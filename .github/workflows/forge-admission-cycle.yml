name: Forge Admission Cycle (Projection)

on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: "Optional PR number for projection diagnostics"
        required: false
        type: string

permissions:
  contents: read
  pull-requests: read

jobs:
  projection-note:
    name: Forge Admission Cycle Projection Note
    runs-on: ubuntu-24.04
    timeout-minutes: 5
    steps:
      - name: Explain projection mode
        env:
          GH_TOKEN: ${{ github.token }}
          REPO: ${{ github.repository }}
          INPUT_PR: ${{ github.event.inputs.pr_number }}
        run: |
          set -euo pipefail

          echo "forge-admission-cycle: projection-only mode"
          echo "GitHub does not compute FAC verdicts in this workflow."
          echo "Authoritative FAC logic must publish commit status context: apm2 / Forge Admission Cycle"

          if [[ -n "${INPUT_PR}" ]]; then
            if [[ ! "${INPUT_PR}" =~ ^[0-9]+$ ]]; then
              echo "invalid pr_number: ${INPUT_PR}" >&2
              exit 1
            fi

            head_sha="$(gh api "/repos/${REPO}/pulls/${INPUT_PR}" --jq '.head.sha')"
            echo "pr=${INPUT_PR} head_sha=${head_sha}"
            echo "current commit statuses for ${head_sha}:"
            gh api "/repos/${REPO}/commits/${head_sha}/status" \
              --jq '.statuses[] | {context,state,description}'
          fi
