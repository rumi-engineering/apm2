# apm2 ecosystem configuration example
# Copy this file to ecosystem.toml and customize for your setup

[daemon]
pid_file = "/var/run/apm2/apm2.pid"
operator_socket = "/var/run/apm2/operator.sock"
session_socket = "/var/run/apm2/session.sock"
log_dir = "/var/log/apm2"
state_file = "/var/lib/apm2/state.json"

# Credential profiles (stored securely in OS keyring)
# Use `apm2 creds add` to create profiles and store credentials

[[credentials]]
id = "claude-work"
provider = "claude"
auth_method = "session_token"

[[credentials]]
id = "claude-personal"
provider = "claude"
auth_method = "api_key"

[[credentials]]
id = "gemini-main"
provider = "gemini"
auth_method = "oauth"
refresh_before_expiry = "5m"

# Process definitions

[[processes]]
name = "claude-code-1"
command = "claude"
args = ["--session", "project-alpha"]
cwd = "/home/user/projects/alpha"
instances = 1

# Bind to credential profile (hot-swappable)
[processes.credentials]
profile = "claude-work"
hot_swap = true
hot_swap_signal = "SIGHUP"

[processes.restart]
max_restarts = 5
restart_window = "60s"
min_uptime = "30s"

[processes.restart.backoff]
type = "exponential"
initial_delay = "1s"
max_delay = "5m"

[processes.log]
out_file = "/var/log/apm2/claude-1.out.log"
err_file = "/var/log/apm2/claude-1.err.log"
timestamp = true

[processes.shutdown]
timeout = "30s"
signal = "SIGTERM"
force_kill = true

# Another process example
[[processes]]
name = "gemini-cli-1"
command = "gemini"
args = ["--project", "beta"]
cwd = "/home/user/projects/beta"

[processes.credentials]
profile = "gemini-main"
hot_swap = true
auto_refresh = true  # Auto-refresh OAuth token

[processes.restart]
max_restarts = 3
min_uptime = "10s"

# Health check example (future feature)
# [processes.health]
# type = "http"
# url = "http://localhost:8080/health"
# interval = "30s"
# timeout = "5s"
# unhealthy_threshold = 3
